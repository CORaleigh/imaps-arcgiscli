(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2412],{70189:(e,t,i)=>{"use strict";function s(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,i,s){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=s,r}function a(){return s()}function o(){return n(1,1,1,1)}function l(){return n(1,0,0,0)}function h(){return n(0,1,0,0)}function c(){return n(0,0,1,0)}function d(){return n(0,0,0,1)}i.d(t,{a:()=>r,c:()=>s,f:()=>n});const u=a(),p=o(),m=l(),g=h(),f=c(),_=d();Object.freeze({__proto__:null,create:s,clone:r,fromValues:n,createView:function(e,t){return new Float32Array(e,t,4)},zeros:a,ones:o,unitX:l,unitY:h,unitZ:c,unitW:d,ZEROS:u,ONES:p,UNIT_X:m,UNIT_Y:g,UNIT_Z:f,UNIT_W:_})},41419:(e,t,i)=>{"use strict";i.d(t,{t:()=>r});var s=i(54721);async function r(e,t){const{data:i}=await(0,s.default)(e,{responseType:"image",...t});return i}},86184:(e,t,i)=>{"use strict";i.d(t,{W:()=>c});var s=i(59472),r=i(77625),n=i(17387),a=i(88),o=i(74808),l=i(56396),h=i(86509);class c extends o.l{constructor(e){super(e.view),this._angleCutoff=l.d,this._style={},this._heightManifoldTarget=(0,r.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=a.KD.create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){(0,s.pC)(e)?((0,n.g)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if((0,s.Wi)(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,d);this.intersectsLine=a.KD.fromValues(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){(0,s.pC)(e)?(a.KD.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=(0,s.pC)(e)?a.KD.copy(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=(0,s.pC)(e)?{origin:(0,r.b)(e.origin),target:(0,r.b)(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,s.pC)(this._pointDistanceLine)||(0,s.pC)(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){(0,s.pC)(this.renderer)||(this.renderer=new h.J(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){(0,s.Wi)(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){(0,s.Wi)(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}syncHeightManifold(){(0,s.Wi)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){(0,s.Wi)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){(0,s.Wi)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){(0,s.Wi)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=(0,s.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,s.pC)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){(0,s.Wi)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=(0,s.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,s.pC)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){(0,s.Wi)(this.renderer)||(this.renderer.pointDistanceEnabled=(0,s.pC)(this._pointDistanceLine)&&this.visible,(0,s.pC)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){(0,s.pC)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const d=(0,r.c)()},71702:(e,t,i)=>{"use strict";i.d(t,{_:()=>h});var s=i(59472),r=i(88909),n=i(68500),a=i(89852),o=i(43446),l=i(74808);class h extends l.l{constructor(e){super(e.view),this._resources=null}get object(){return(0,s.pC)(this._resources)?this._resources.object:null}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,s.Wi)(this._resources))return;const e=this._resources.object,t=this.view._stage;e.geometries.forEach((e=>{t.remove(2,e.id)})),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),e.geometries.forEach((e=>{t.add(2,e)}))}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new a.Z("element",{isPickable:!1});e.add(0,t),e.addToViewContent([t.id]);const i=new r.Z({idHint:"element",castShadow:!1});this.createExternalResources(),this.createGeometries(i),i.geometries.forEach((t=>{e.add(2,t)})),this.forEachExternalResource((t=>{e.add(this._contentTypeFromResource(t),t)})),e.add(1,i),t.addObject(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}_contentTypeFromResource(e){return e instanceof n.Z?2:e instanceof o.Z?4:3}destroyResources(){const e=this.view._stage;!(0,s.Wi)(this._resources)&&e&&(e.remove(1,this._resources.object.id),e.remove(0,this._resources.layer.id),this.forEachExternalResource((t=>{e.remove(this._contentTypeFromResource(t),t.id),t.dispose()})),this._resources.object.geometries.forEach((t=>{e.remove(2,t.id)})),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,s.Wi)(this._resources)||this._resources.object.setVisible(e)}}},18795:(e,t,i)=>{"use strict";i.d(t,{R:()=>w});var s=i(59472),r=i(77625),n=i(17387),a=i(59691),o=i(67128),l=i(12811),h=i(34353),c=i(8344),d=i(69534),u=i(39746),p=i(68500),m=i(57511),g=i(94589),f=i(70189),_=i(71702);class w extends _._{constructor(e){super(e),this._handles=new a.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,r.c)(),this._up=(0,r.c)(),this._right=(0,r.c)(),this._transform=(0,l.a)(),this._renderOccluded=4,this._color=(0,f.f)(1,0,0,1),this._outlineColor=(0,f.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,h.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,h.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,n.k)(t,e),(0,n.k)(t,i))/3,(0,n.n)(this._up,(0,n.f)(this._up,e,t)),(0,n.n)(this._right,(0,n.f)(this._right,i,t)),(0,n.g)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new g.E(this.quadMaterialParameters,"right-angle-quad"),this._outlineMaterial=new m.U(this.outlineMaterialParameters,"right-angle-quad-outline"),this._handles.add(this.view.state.watch("camera",(()=>{this._updateTransform()})))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalResource(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=new p.Z(this._quadGeometryData(this._up,this._right),"right-angle-quad");e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,n.b)(c.WM.get(),this._up,this._right),i=new p.Z(u.Z.createPolylineGeometry([this._up,t,this._right]),"right-angle-quad-outline");e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);(0,o.i)(this._transform),(0,o.t)(this._transform,this._transform,this._position),(0,o.s)(this._transform,this._transform,[r,r,r]),(0,s.pC)(e)&&(e.objectTransformation=this._transform)}_quadGeometryData(e,t){const i=(0,n.b)(c.WM.get(),e,t);return new d.b({position:{size:3,data:[0,0,0,...t,...e,...i]}},{position:new Uint32Array([0,1,2,1,2,3])})}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}},74808:(e,t,i)=>{"use strict";i.d(t,{l:()=>s});class s{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},81718:(e,t,i)=>{"use strict";i.d(t,{rR:()=>d,w7:()=>u});var s,r,n=i(94588),a=i(77625),o=(i(67128),i(17333)),l=i(12811),h=i(1586),c=i(19132);i(74218);function d(e,t,i,s,r,n,a,l,h,c,d){const u=p[d.mode];let m,g,f=0;if((0,o.CM)(e,t,i,s,h.spatialReference,r,l))return u.requiresAlignment(d)?(f=u.applyElevationAlignmentBuffer(s,r,n,a,l,h,c,d),m=n,g=a):(m=s,g=r),(0,o.CM)(m,h.spatialReference,g,n,c.spatialReference,a,l)?f:void 0}function u(e,t,i,s,r){const a=((0,h.Vs)(e)?e.z:(0,c.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=(0,c.KO)(t,e,"ground")||0;return r&&(r.verticalDistanceToGround=0,r.sampledElevation=i),i}case"relative-to-ground":{const n=(0,c.KO)(t,e,"ground")||0,o=i.geometryZWithOffset(a,s);return r&&(r.verticalDistanceToGround=o,r.sampledElevation=n),o+n}case"relative-to-scene":{const n=(0,c.KO)(t,e,"scene")||0,o=i.geometryZWithOffset(a,s);return r&&(r.verticalDistanceToGround=o,r.sampledElevation=n),o+n}case"absolute-height":{const n=i.geometryZWithOffset(a,s);if(r){const i=(0,c.KO)(t,e,"ground")||0;r.verticalDistanceToGround=n-i,r.sampledElevation=i}return n}default:return(0,n.Bg)(i.mode),0}}(r=s||(s={}))[r.NONE=0]="NONE",r[r.UPDATE=1]="UPDATE",r[r.RECREATE=2]="RECREATE";const p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,s,r,n,a,o){const l=o.calculateOffsetRenderUnits(a),h=o.featureExpressionInfoContext;t*=3,s*=3;for(let n=0;n<r;++n){const r=e[t+0],n=e[t+1],a=e[t+2];i[s+0]=r,i[s+1]=n,i[s+2]=null==h?a+l:l,t+=3,s+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,s,r,n){let a=0;const o=n.spatialReference;t*=3,s*=3;for(let l=0;l<r;++l){const r=e[t+0],l=e[t+1],h=e[t+2],c=n.getElevation(r,l,h,o,"ground")||0;a+=c,i[s+0]=r,i[s+1]=l,i[s+2]=c,t+=3,s+=3}return a/r},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,s,r,n,a,o){let l=0;const h=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext,d=n.spatialReference;t*=3,s*=3;for(let a=0;a<r;++a){const r=e[t+0],a=e[t+1],o=e[t+2],u=n.getElevation(r,a,o,d,"ground")||0;l+=u,i[s+0]=r,i[s+1]=a,i[s+2]=null==c?o+u+h:u+h,t+=3,s+=3}return l/r},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,s,r,n,a,o){let l=0;const h=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext,d=n.spatialReference;t*=3,s*=3;for(let a=0;a<r;++a){const r=e[t+0],a=e[t+1],o=e[t+2],u=n.getElevation(r,a,o,d,"scene")||0;l+=u,i[s+0]=r,i[s+1]=a,i[s+2]=null==c?o+u+h:u+h,t+=3,s+=3}return l/r},requiresAlignment:()=>!0}};(0,l.a)(),(0,a.c)()},68397:(e,t,i)=>{"use strict";i.d(t,{G:()=>s});const s={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}},43446:(e,t,i)=>{"use strict";i.d(t,{Z:()=>P});var s=i(94588),r=i(6962),n=i(59472),a=i(32656),o=i(10923),l=i(39105),h=i(35470),c=i(33655),d=i(4094),u=i(41419),p=i(56469),m=i(8634),g=i(57319),f=i(10346),_=i(15853),w=i(84570),y=i(6091);const T=i(36544).Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function M(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const b=M("DXT1"),v=M("DXT3"),x=M("DXT5");function E(e,t){const i=new Int32Array(e,0,31);if(542327876!==i[0])return T.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return T.error("Unsupported format, must contain a FourCC code"),null;const s=i[21];let r,n;switch(s){case b:r=8,n=33776;break;case v:r=16,n=33778;break;case x:r=16,n=33779;break;default:return T.error("Unsupported FourCC code:",(a=s,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255))),null}var a;let o=1,l=i[4],h=i[3];0==(3&l)&&0==(3&h)||(T.warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,h=h+3&-4);const d=l,u=h;let p,m;131072&i[2]&&!1!==t&&(o=Math.max(1,i[7])),1===o||(0,c.wt)(l)&&(0,c.wt)(h)||(T.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let g=i[1]+4;const f=[];for(let t=0;t<o;++t)m=(l+3>>2)*(h+3>>2)*r,p=new Uint8Array(e,g,m),f.push(p),g+=m,l=Math.max(1,l>>1),h=Math.max(1,h>>1);return{textureData:{type:"compressed",levels:f},internalFormat:n,width:d,height:u}}class C{constructor(e,t,i){this.data=e,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new h.Z,this.data=e,this.id=C.idGen.gen(t),this.params=i||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=C.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;(0,n.Wi)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){(0,o.jc)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){(0,o.HK)(e.src)||(0,o.jc)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if((0,n.Wi)(e))return 0;if((0,r.eP)(e)||(0,r.lq)(e))return e.byteLength;const{width:i,height:s}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?C.getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*s*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){const t=this.params.mipmap&&!this.params.disableAnisotropy;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:t?e.parameters.maxMaxAnisotropy:void 0}}load(e,t){if((0,n.pC)(this.glTexture))return this.glTexture;if((0,n.pC)(this.loadingPromise))return this.loadingPromise;const i=this.data;return(0,n.Wi)(i)?(this.glTexture=new m.Z(e,this.createDescriptor(e),null),e.bindTexture(this.glTexture,0),this.glTexture):"string"==typeof i?this.loadFromURL(e,t,i):i instanceof Image?this.loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(e,i,t):((0,r.eP)(i)||(0,r.lq)(i))&&this.params.encoding===C.DDS_ENCODING?this.loadFromDDSData(e,i):(0,r.lq)(i)?this.loadFromPixelData(e,i):(0,r.eP)(i)?this.loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||(0,n.Wi)(this.glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if((0,n.pC)(this.powerOfTwoStretchInfo)){const{framebuffer:i,vao:s,sourceTexture:r}=this.powerOfTwoStretchInfo;r.setData(this.data),this.drawStretchedTexture(e,t,i,s,r,this.glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:s}=this.glTexture.descriptor;e!==i||t!==s?this.glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,s),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=function(e,t,i,s){const{textureData:r,internalFormat:n,width:a,height:o}=E(i,s);t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=n,t.width=a,t.height=o;const l=new m.Z(e,t,r);return e.bindTexture(l,0),l}(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture,0),this.glTexture}loadFromPixelData(e,t){(0,p.hu)(this.params.width>0&&this.params.height>0);const i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this.glTexture=new m.Z(e,i,t),e.bindTexture(this.glTexture,0),this.glTexture}async loadAsync(e){const t=(0,l.createAbortController)();this.loadingController=t;const i=e(t.signal);this.loadingPromise=i;const s=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===i&&(this.loadingPromise=null)};return i.then(s,s),i}loadFromURL(e,t,i){return this.loadAsync((async s=>{const r=await(0,u.t)(i,{signal:s});return this.loadFromImage(e,r,t)}))}loadFromImageElement(e,t,i){return i.complete?this.loadFromImage(e,i,t):this.loadAsync((async s=>{const r=await(0,d.f)(i,i.src,!1,s);return this.loadFromImage(e,r,t)}))}loadFromVideoElement(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}loadFromVideoElementAsync(e,t,i){return this.loadAsync((s=>(0,l.create)(((r,o)=>{const h=()=>{i.removeEventListener("loadeddata",c),i.removeEventListener("error",d),(0,n.pC)(u)&&u.remove()},c=()=>{i.readyState>=2&&(h(),r(this.loadFromImage(e,i,t)))},d=e=>{h(),o(e||new a.Z("Failed to load video"))};i.addEventListener("loadeddata",c),i.addEventListener("error",d);const u=(0,l.onAbort)(s,(()=>d((0,l.createAbortError)())))}))))}loadFromImage(e,t,i){const s=C.getDataDimensions(t);this.params.width=s.width,this.params.height=s.height;const r=this.createDescriptor(e);return r.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,r)||(0,c.wt)(s.width)&&(0,c.wt)(s.height)?(r.width=s.width,r.height=s.height,this.glTexture=new m.Z(e,r,t),e.bindTexture(this.glTexture,0),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,s,r,i),e.bindTexture(this.glTexture,0),this.glTexture)}requiresPowerOfTwo(e,t){const i=33071,s="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!(0,y.Z)(e.gl)&&(t.hasMipmap||!s)}makePowerOfTwoTexture(e,t,i,r,n){const{width:a,height:o}=i,l=(0,c.Sf)(a),h=(0,c.Sf)(o);let d;switch(r.width=l,r.height=h,this.params.powerOfTwoResizeMode){case 2:r.textureCoordinateScaleFactor=[a/l,o/h],d=new m.Z(e,r),d.updateData(0,0,0,a,o,t);break;case 1:case null:case void 0:d=this.stretchToPowerOfTwo(e,t,r,n);break;default:(0,s.Bg)(this.params.powerOfTwoResizeMode)}return r.hasMipmap&&d.generateMipmap(),d}stretchToPowerOfTwo(e,t,i,s){const r=new m.Z(e,i),n=new w.Z(e,{colorTarget:0,depthStencilTarget:0},r),a=new m.Z(e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=(0,f.ow)(e);return this.drawStretchedTexture(e,s,n,o,a,r),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:o,sourceTexture:a,framebuffer:n}:(o.dispose(!0),a.dispose(),n.detachColorTexture(),e.bindFramebuffer(null),n.dispose()),r}drawStretchedTexture(e,t,i,s,r,n){e.bindFramebuffer(i);const a=e.getViewport();e.setViewport(0,0,n.descriptor.width,n.descriptor.height);const o=t.program;e.bindProgram(o),o.setUniform4f("color",1,1,1,1),o.setUniform1i("tex",0),e.bindTexture(r,0),e.bindVAO(s),e.setPipelineState(t.pipeline),e.drawArrays(5,0,(0,g._V)(s,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height)}unload(){if((0,n.pC)(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this.powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if((0,n.pC)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),(0,n.pC)(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}C.idGen=new _.A,C.DDS_ENCODING="image/vnd-ms.dds";const P=C}}]);
//# sourceMappingURL=2412.js.map