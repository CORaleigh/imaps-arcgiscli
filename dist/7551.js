(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[7551],{12528:(e,t,i)=>{"use strict";i.d(t,{H:()=>r,a:()=>b,b:()=>x,c:()=>y});var r,s=i(55735),n=i(38256),o=i(14286),a=i(85461),l=i(51219),c=i(63230),h=i(73192),d=i(61514),p=i(91930),u=i(2489),v=i(79431),f=i(72023),g=i(8681),m=i(34658),_=i(61017);function x(e){const t=new l.kG,i=e.signedDistanceFieldEnabled;if(t.include(h.H),t.include(u.R,e),t.include(d.p,e),6===e.output)return t.include(v.R,e),t;t.include(p.c),t.fragment.include(_.n),t.fragment.include(c.Y),t.include(g.k,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(a.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?a.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:a.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=a.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `,s=e.pixelSnappingEnabled?i?a.H`
  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:a.H`
  posProj += quadOffset;
  if (inputSize.x == size.x) {
    posProj = alignToPixelOrigin(posProj, viewport.zw);
  }`:a.H`posProj += quadOffset;`;t.vertex.code.add(a.H`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${a.H.float(m.bf)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${a.H.float(m.bf)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${s}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?a.H`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const n=e.debugDrawBorder?a.H`(isBorder > 0.0 ? 0.0 : ${a.H.float(m.F)})`:a.H.float(m.F),o=a.H`
    ${e.debugDrawBorder?a.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?a.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${n} ||
          fillPixelColor.a + outlinePixelColor.a < ${a.H.float(m.bf)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${n}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:a.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${n}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?a.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(a.H`
      void main() {
        ${o}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(a.H`
    void main() {
      ${o}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(f.b),t.fragment.code.add(a.H`
    void main() {
      ${o}
      ${e.binaryHighlightOcclusionEnabled?a.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function y(e,t=w){var i,r,s;return e.textureIsSignedDistanceField?(i=e.anchorPos,r=e.distanceFieldBoundingBox,(s=t)[0]=i[0]*(r[2]-r[0])+r[0],s[1]=i[1]*(r[3]-r[1])+r[1]):(0,o.c)(t,e.anchorPos),t}!function(e){e.bindUniforms=function(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",n.Z),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",y(t))}}(r||(r={}));const w=(0,s.a)();var b=Object.freeze({__proto__:null,build:x,get HUDMaterial(){return r},calculateAnchorPosForRendering:y})},42738:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,b:()=>h,f:()=>d,i:()=>s,m:()=>o,r:()=>a,s:()=>l,t:()=>c});var r=i(60418);function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function n(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function o(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],d=i[2],p=i[3],u=i[4],v=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*d+n*p,e[3]=s*d+o*p,e[4]=r*u+n*v+a,e[5]=s*u+o*v+l,e}function a(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function l(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function c(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function h(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}let u=o,v=p;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:s,set:function(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e},invert:n,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:o,rotate:a,scale:l,translate:c,fromRotation:h,fromScaling:d,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:p,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=t[0],h=t[1],d=t[2],p=t[3],u=t[4],v=t[5];return Math.abs(i-c)<=r.E*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=r.E*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=r.E*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=r.E*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-u)<=r.E*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(l-v)<=r.E*Math.max(1,Math.abs(l),Math.abs(v))},mul:u,sub:v})},75384:(e,t,i)=>{"use strict";function r(){return[1,0,0,1,0,0]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}i.d(t,{a:()=>s,c:()=>r});Object.freeze({__proto__:null,create:r,clone:s,fromValues:function(e,t,i,r,s,n){return[e,t,i,r,s,n]},createView:function(e,t){return new Float64Array(e,t,6)}})},7646:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(56140),n=(i(95830),i(36544),i(68055),i(79881)),o=i(87566),a=(i(10923),i(57002),i(86035),i(72206)),l=i(41241),c=i(61106),h=i(53817),d=i(89333),p=i(93533),u=i(98675);let v=r=class extends h.Z{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=(0,p.En)(this.radius,this.radiusUnit,"meters"),r=e.spatialReference;let s,n="geographic";if(r.isWebMercator?n="webMercator":(null!=a.Z[r.wkid]||r.wkt&&0===r.wkt.indexOf("PROJCS"))&&(n="projected"),this.geodesic){let r;switch(n){case"webMercator":r=(0,l.Sx)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=e}s=this._createGeodesicCircle(r,i,t),"webMercator"===n&&(s=(0,l.$)(s))}else{let r;"webMercator"===n||"projected"===n?r=i/this._convert2Meters(1,e.spatialReference):"geographic"===n&&(r=(0,p.ty)(i,"meters",(0,d.Iu)(e.spatialReference).radius)),s=this._createPlanarCircle(e,r,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:s,geodesic:n}=this;return new r({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:s,geodesic:n})}_createGeodesicCircle(e,t,i){let r=0;const s=[];for(;r<360;){const n=[0,0],o=[e.x,e.y];(0,u.directGeodeticSolver)(n,o,r,t),this.hasZ&&n.push(e.z),s.push(n),r+=360/i}return s.push(s[0]),new h.Z(s)}_createPlanarCircle(e,t,i){let r=0;const s=[];for(;r<2*Math.PI;){const n=[e.x+Math.cos(-r)*t,e.y+Math.sin(-r)*t];this.hasZ&&n.push(e.z),s.push(n),r+=Math.PI/(i/2)}return s.push(s[0]),new h.Z({spatialReference:e.spatialReference,rings:[s]})}_convert2Meters(e,t){let i;if(null!=a.Z[t.wkid])i=a.Z.values[a.Z[t.wkid]];else{const e=t.wkt,r=e.lastIndexOf(",")+1,s=e.lastIndexOf("]]");i=parseFloat(e.substring(r,s))}return e*i}};(0,s._)([(0,n.Cb)({type:c.Z})],v.prototype,"center",void 0),(0,s._)([(0,n.Cb)()],v.prototype,"geodesic",void 0),(0,s._)([(0,n.Cb)()],v.prototype,"numberOfPoints",void 0),(0,s._)([(0,n.Cb)()],v.prototype,"radius",void 0),(0,s._)([(0,n.Cb)()],v.prototype,"radiusUnit",void 0),v=r=(0,s._)([(0,o.j)("esri.geometry.Circle")],v);const f=v},94394:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var r=i(56140),s=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(56700)),a=i(79710),l=i(57407),c=i(10113),h=i(99322);let d=class extends((0,l.h)((0,c.M)(o.Z))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new h.ZP,this.screenSizePerspectiveEnabled=!0,this.type="graphics"}destroy(){this.removeAll()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,r._)([(0,s.Cb)({type:a.Z})],d.prototype,"elevationInfo",void 0),(0,r._)([(0,s.Cb)((0,h.$o)())],d.prototype,"graphics",void 0),(0,r._)([(0,s.Cb)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,r._)([(0,s.Cb)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],d.prototype,"type",void 0),d=(0,r._)([(0,n.j)("esri.layers.GraphicsLayer")],d);const p=d},99322:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>p,JN:()=>h,$o:()=>d});var r=i(56140),s=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(83477)),a=i(32105),l=i(15988);const c=o.Z.ofType(l.Z);let h=class extends c{constructor(e){super(e),this.on("before-add",(e=>{e.item||e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(({item:e})=>{e.layer=null}))}destroy(){this._unownAll()}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())}_createNewInstance(e){return new c(e)}_ownAll(){this.items.forEach((e=>this._own(e)))}_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_unownAll(){this.items.forEach((e=>this._unown(e)))}_unown(e){e.layer===this.owner&&(e.layer=null)}};(0,r._)([(0,s.Cb)()],h.prototype,"owner",null),h=(0,r._)([(0,n.j)("esri.support.GraphicsCollection")],h);const d=(e="graphics")=>({type:h,cast:a.R,set(t){const i=(0,a.Z)(t,this._get(e),h);i.owner=this,this._set(e,i)}});const p=h},53900:(e,t,i)=>{"use strict";i.d(t,{Y6:()=>v});var r=i(27780),s=i(61106),n=(i(36348),i(77625)),o=i(17387),a=i(55735),l=i(38256),c=i(14286),h=i(34353);class d{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this._unnormalizationInfo=g(e,t)}tag(e){return e}createNew(){return this.tag((0,a.a)())}fromPoint(e){return this.tag((0,a.f)(e.x,e.y))}fromArray(e){return this.tag((0,a.f)(e[0],e[1]))}toArray(e){return[e[0],e[1]]}clone(e){return this.tag((0,a.d)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}createPoint(e){return new s.Z({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new s.Z({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return(0,c.m)(r,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}pointToArray(e){return[e.x,e.y]}zFromArray(e){}hasZ(){return!1}unnormalize(e){f(e,this._unnormalizationInfo)}fromXYZ(e){return this.tag((0,a.f)(e[0],e[1]))}toXYZ(e,t=0){return(0,n.f)(e[0],e[1],t)}}class p{constructor(e,t,i){this.valueType=e,this.spatialReference=t,this._unnormalizationInfo=g(t,i)}tag(e){return e}createNew(){return this.tag((0,n.c)())}fromPoint(e){return this.tag((0,n.f)(e.x,e.y,0===this.valueType?e.z:e.m))}fromArray(e){return this.tag((0,n.f)(e[0],e[1],e[2]||0))}toArray(e){return[e[0],e[1],e[2]]}clone(e){return this.tag((0,n.d)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}createPoint(e){return new s.Z({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new s.Z({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){const t=0===this.valueType,i=1===this.valueType;return{x:e[0],y:e[1],z:t?e[2]:void 0,m:i?e[2]:void 0,hasZ:t,hasM:i,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return(0,o.e)(r,e,t,i)}addDelta(e,t,i,r){e[0]+=t,e[1]+=i,0===this.valueType&&(e[2]+=r)}pointToArray(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}zFromArray(e){return 0===this.valueType?e[2]:void 0}hasZ(){return 0===this.valueType}unnormalize(e){f(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag((0,n.f)(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:i))}toXYZ(e,t=0){return this.tag((0,n.f)(e[0],e[1],0===this.valueType?e[2]:t))}}class u{constructor(e,t){this.spatialReference=e,this._unnormalizationInfo=g(e,t)}tag(e){return e}createNew(){return this.tag((0,l.a)())}fromPoint(e){return this.tag((0,l.b)(e.x,e.y,e.z,e.m))}fromArray(e){return this.tag((0,l.b)(e[0],e[1],e[2]||0,e[3]||0))}toArray(e){return[e[0],e[1],e[2],e[3]]}clone(e){return this.tag((0,l.f)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}createPoint(e){return new s.Z({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createPointFromArray(e){return new s.Z({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return(0,h.l)(r,e,t,i)}addDelta(e,t,i,r){e[0]+=t,e[1]+=i,e[2]+=r}pointToArray(e){return[e.x,e.y,e.z,e.m]}zFromArray(e){return e[2]}hasZ(){return!0}unnormalize(e){f(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag((0,l.b)(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e){return(0,n.f)(e[0],e[1],e[2])}}function v(e,t,i,r){return e&&t?new u(i,r):t?new p(1,i,r):e?new p(0,i,r):new d(i,r)}function f(e,t){if(!t.supported)return;let i=1/0,r=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let n=e.pos[0];for(;n<t.lowerBoundX;)n+=s;for(;n>t.upperBoundX;)n-=s;i=Math.min(i,n),r=Math.max(r,n),e.pos[0]=n}));const n=r-i;s-n<n&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=s)}))}function g(e,t){const i=(0,r.C5)(e);return"global"===t&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}},88958:(e,t,i)=>{"use strict";i.d(t,{w:()=>y});var r=i(56140),s=(i(95830),i(59472)),n=(i(36544),i(68055),i(79881),i(87566)),o=(i(10923),i(57002),i(86035),i(61106)),a=(i(36348),i(35470)),l=i(96071),c=i(59691),h=i(80621),d=i(53900);class p{constructor({grabbableForEvent:e}){this.events=new a.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var u=i(84678),v=i(37554),f=i(3521),g=i(636),m=i(53640),_=i(87008),x=i(69470);let y=class extends a.Z{constructor(e){super(),this._manipulator=null,this._stagedVertex=null,this.geometryType=null,this.elevationInfo=null,this.snapToSceneEnabled=null,this._handles=new c.Z,this._defaultZ=0,this._elevationDrawSurface=null,this._snappingDrawSurface=null,this._snappingEnabled=!1,this._createOperationCompleted=!1,this._pointerDownStates=new Set,this.view=e.view,this.drawingMode=(0,s.Pt)(e.drawingMode,g.n),this.geometryType=e.geometryType,this.elevationInfo=e.elevationInfo,this.coordinateHelper=(0,d.Y6)(e.hasZ,e.hasM,this.view.spatialReference,this.view.viewingMode),this._defaultZ=e.defaultZ,this.snapToSceneEnabled=e.snapToSceneEnabled,this.snappingEngine=new x.r(e.snappingOptions),this._snappingEnabled=e.snappingOptions.selfEnabled,this._handles.add((0,h.watch)(e.snappingOptions,"selfEnabled",(()=>{this._snappingEnabled=e.snappingOptions.selfEnabled}))),this._snappingDrawSurface=(0,s.Wg)(e.snappingDrawSurface),this._elevationDrawSurface=new u.a(this.elevationInfo,this._defaultZ,this.view),this._editGeometry=new f.hE(new v.XE(this.coordinateHelper),"segment"===this.geometryType?"polyline":this.geometryType),this._activeComponent=new v.wA(this._editGeometry.data),this._editGeometry.data.components.push(this._activeComponent),this._editGeometry.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.toArray(e.pos)}))),i=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}})),this._manipulator=new p({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),e.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType;const t=this.createManipulatorDragPipeline(this._manipulator),i=this._manipulator.events.on("immediate-double-click",(e=>{this._manipulator.dragging||"point"!==this.geometryType&&(this.complete(),e.stopPropagation())})),r=this._manipulator.events.on("immediate-click",(e=>{if(this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if((0,s.pC)(i))this.discardStagedVertex(),this.complete();else{const i=this._screenToMap(e.screenPoint);if((0,s.pC)(i))switch(this.drawingMode){case"freehand":break;case"click":case"hybrid":this.hasStagedVertex?this.commitStagedVertex():this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}}e.stopPropagation()}));this._handles.add([t,r,i])}get isCompleted(){return this._createOperationCompleted}createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this.createManipulatorDragPipelineClick(e);case"freehand":return this.createManipulatorDragPipelineFreehand(e);case"hybrid":return this.createManipulatorDragPipelineHybrid(e)}}createManipulatorDragPipelineClick(e){return(0,m.Xd)(e,((e,t,i,r)=>{const n="touch"===r&&this._snappingEnabled;if(this.isCompleted||!n)return;let o=null;t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||n&&0===this.vertices.length)&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":"start"===e.action&&n&&(o=new _.N(this._editGeometry,this.view,this.elevationInfo,r)),n&&(this.stagedVertex=this.snappingEngine.snap(e.mapEnd,(0,s.Wg)(o)));break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete(),n&&(this.commitStagedVertex(),this.snappingEngine.doneSnapping())}return e})),i.next((()=>{n&&this.snappingEngine.doneSnapping()}))}))}createManipulatorDragPipelineFreehand(e){return(0,m.Xd)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}createManipulatorDragPipelineHybrid(e){return(0,m.Xd)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}destroy(){this._handles.destroy(),this._handles=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":{if(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=(0,l.vW)(e.x,e.y),i=this._closeOnClickVertexIndex(t);if((0,s.pC)(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.toArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);(0,s.pC)(i)?(this.stagedVertex=this.snappingEngine.snap(i,new _.N(this._editGeometry,this.view,this.elevationInfo,e.pointerType)),this._manipulator.cursor="crosshair"):this._manipulator.cursor=null}e.stopPropagation();break}case"hold":"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}}get canRedo(){return this._editGeometry.canRedo}redo(){this._editGeometry.redo()}get canUndo(){return this._editGeometry.canUndo}undo(){this.snappingEngine.doneSnapping(),this._editGeometry.undo()}complete(e=!1){this.commitStagedVertex(),this._createOperationCompleted=!0,this.snappingEngine.doneSnapping(),this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:e,type:"complete"})}cancel(){this.complete(!0)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get numVertices(){return(0,s.pC)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get numCommittedVertices(){return this._activeComponent.vertices.length}get vertices(){const e=this._activeComponent.vertices.map((e=>this.coordinateHelper.toArray(e.pos)));return(0,s.pC)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}get spatialReference(){return this.view.spatialReference}get hasStagedVertex(){return(0,s.pC)(this._stagedVertex)}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if((0,s.Wi)(e))return void this.discardStagedVertex();this._stagedVertex=e;const t={componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)};this.emit("cursor-update",{updated:null,vertices:[t],operation:"apply",type:"vertex-update"})}commitStagedVertex(){if((0,s.pC)(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(e))}}discardStagedVertex(){this._stagedVertex=null}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),(0,s.Wi)(e))return null;const i=this._screenToMap(t.screenEnd);return(0,s.pC)(i)?{...t,mapStart:e,mapEnd:i}:null}}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_getDrawSurface(){let e=null;if(this.coordinateHelper.hasZ){let t=this._defaultZ,i=!1;(0,s.pC)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(i=!0),(0,s.pC)(this.snapToSceneEnabled)&&(i=this.snapToSceneEnabled),(0,s.pC)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(i=!1);const r=this._activeComponent.vertices.length;("segment"===this.geometryType||"polygon"===this.geometryType)&&r>0&&(t=this.coordinateHelper.zFromArray(this._activeComponent.vertices[0].pos),i=!1),i?e=this._snappingDrawSurface:(this._elevationDrawSurface.defaultZ=t,e=this._elevationDrawSurface)}else this._elevationDrawSurface.defaultZ=null,e=this._elevationDrawSurface;return e}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(e);return!!(0,s.pC)(i)&&function(e,t,i){const r=e.x-t.x,s=e.y-t.y;return r*r+s*s<=25}(i,t)}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[0].pos,w),e))return 0;if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[t.vertices.length-1].pos,w),e))return t.vertices.length-1}return null}};y=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.draw3D.DrawOperation")],y);const w=new o.Z({x:0,y:0,z:0})},84678:(e,t,i)=>{"use strict";i.d(t,{a:()=>a,i:()=>l});var r=i(59472),s=i(96071),n=i(46970),o=i(1586);class a{constructor(e,t,i){this.elevationInfo=e,this.defaultZ=t,this.view=i}screenToMap(e){if((0,r.pC)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,s.s1)(e.x,e.y),this.elevationInfo,this.defaultZ);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,s.s1)(e.x,e.y),this.elevationInfo,0);return(0,r.pC)(t)&&(t.z=void 0),t}mapToScreen(e){const t=(0,o.Tx)(e.x,e.y,(0,n.vQ)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class l{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return(0,r.pC)(t)&&(t.z=(0,n.Ou)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return(0,r.pC)(this.elevationInfo)&&(t=(0,o.Tx)(e.x,e.y,(0,n.vQ)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}},37554:(e,t,i)=>{"use strict";i.d(t,{wA:()=>l,kS:()=>a,XE:()=>c,Xz:()=>o});var r=i(53817),s=i(93833),n=(i(36348),i(53900));class o{constructor(e){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=e}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class a{constructor(e,t,i){this.type="edge",this.component=e,this.left=t,this.right=i,t.right=this,i.left=this}}class l{constructor(e){this.vertices=[],this.edges=[],this.data=e}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let r=null,s=e,n=t;do{r=s,r.index=n++,s=r.right?r.right.right:null}while(null!=s&&s!==i);r.left&&r!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(r),this.vertices.length-1)}findEndVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}}class c{constructor(e){this.coordinateHelper=e,this.undoStack=[],this.redoStack=[],this.components=[]}apply(e){e.apply(),this.undoStack.push(e),this.redoStack=[]}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();e.undo(),this.redoStack.push(e)}}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();e.apply(),this.undoStack.push(e)}}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,r)=>{const s=[];let n=i.vertices.find((e=>null==e.left));const o=n;do{s.push(t(n.pos)),n=n.right?n.right.right:null}while(n&&n!==o);e.push(s)})),new s.Z({paths:e,spatialReference:this.coordinateHelper.spatialReference})}toPolygon(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,r)=>{const s=[],n=i.vertices[0];let o=n;const a=o;do{s.push(t(o.pos)),o=o.right.right}while(o&&o!==a);s.push(t(n.pos)),e.push(s)})),new r.Z({rings:e,spatialReference:this.coordinateHelper.spatialReference})}static fromGeometry(e,t){const i=(0,n.Y6)(e.hasZ,e.hasM,e.spatialReference,t),r=new c(i);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const s=t[e],n=new l(r),c=s.length-1;for(let e=0;e<c;++e){const t=i.fromArray(s[e]),r=new o(n);n.vertices.push(r),r.pos=t,r.index=e}const h=n.vertices.length-1;for(let e=0;e<h;++e){const t=n.vertices[e],i=n.vertices[e+1],r=new a(n,t,i);n.edges.push(r)}const d=new a(n,n.vertices[n.vertices.length-1],n.vertices[0]);n.edges.push(d),r.components.push(n)}}break;case"polyline":{const t=e.paths;for(let e=0;e<t.length;++e){const s=t[e],n=new l(r),c=s.length;for(let e=0;e<c;++e){const t=i.fromArray(s[e]),r=new o(n);n.vertices.push(r),r.pos=t,r.index=e}const h=n.vertices.length-1;for(let e=0;e<h;++e){const t=n.vertices[e],i=n.vertices[e+1],r=new a(n,t,i);n.edges.push(r)}r.components.push(n)}}}return r}}},3521:(e,t,i)=>{"use strict";i.d(t,{hE:()=>o});var r=i(59472),s=i(35470),n=i(37554);class o extends s.Z{constructor(e,t){super(),this.data=e,this.type=t,this._dirty=!0,this._geometry=null}splitEdge(e,t){const i=new a(this,e,t);return this.data.apply(i),this._dirty=!0,i}moveVertices(e,t,i,r){let s=null;return this.data.lastOperation instanceof l&&this.data.lastOperation.canAccumulate(e)?(s=this.data.lastOperation,s.accumulate(t,i,r)):(s=new l(this,e,t,i,r),this.data.apply(s)),this._dirty=!0,s}removeVertices(e){let t=0;switch(this.type){case"point":t=1;break;case"polyline":t=2;break;case"polygon":t=3}const i=new c(this,e,t);return this.data.apply(i),this._dirty=!0,i}appendVertex(e){if(0===this.data.components.length)return null;const t=new h(this,this.data.components[0],e);return this.data.apply(t),this._dirty=!0,t}canRemoveVertex(){let e=0;switch(this.type){case"point":e=1;break;case"polyline":e=2;break;case"polygon":e=3}return this.data.components[0].vertices.length>e}undo(){this.data.undo(),this._dirty=!0}get canUndo(){return this.data.canUndo}redo(){this.data.redo(),this._dirty=!0}get canRedo(){return this.data.canRedo}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this.data.toPoint();break;case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}class a{constructor(e,t,i){this.helper=e,this.edge=t,this.t=i,this.createdVertex=null,this.left=null,this.right=null}apply(){let e="redo";const t=this.edge,i=t.component,s=t.component.data,o=t.left,a=t.right;i.edges.splice(i.edges.indexOf(t),1),(0,r.Wi)(this.createdVertex)&&(e="apply",this.createdVertex=new n.Xz(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=s.coordinateHelper.lerp(t.left.pos,t.right.pos,this.t,s.coordinateHelper.createNew()),(0,r.Wi)(this.left)&&(this.left=new n.kS(i,o,this.createdVertex)),this.left.left.left?i.edges.push(this.left):i.edges.unshift(this.left),o.right=this.left,(0,r.Wi)(this.right)&&(this.right=new n.kS(i,this.createdVertex,a)),i.edges.push(this.right),a.left=this.right,i.updateVertexIndex(this.createdVertex,o.index+1);const l={type:"vertex-add",vertices:[this.createdVertex],operation:e};this.helper.emit("vertex-add",l)}undo(){if((0,r.Wi)(this.createdVertex)||(0,r.Wi)(this.left)||(0,r.Wi)(this.right))return null;const e=this.edge,t=e.component,i=this.createdVertex.left,s=this.createdVertex.right,n=i.left,o=s.right;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.left.left?t.edges.push(this.edge):t.edges.unshift(this.edge),n.right=e,o.left=e,t.updateVertexIndex(n,n.index);const a={type:"vertex-remove",vertices:[this.createdVertex],operation:"undo"};this.helper.emit("vertex-remove",a)}}class l{constructor(e,t,i,r,s){this.helper=e,this.applied=!1,this.vertices=t,this.dx=i,this.dy=r,this.dz=s}apply(){this.vertices.forEach((e=>{this.helper.data.coordinateHelper.addDelta(e.pos,this.dx,this.dy,this.dz)})),this.helper.data.components.forEach((e=>{e.unnormalizeVertexPositions()}));const e={type:"vertex-update",vertices:this.vertices,operation:this.applied?"redo":"apply"};this.helper.emit("vertex-update",e),this.applied=!0}undo(){this.vertices.forEach((e=>{this.helper.data.coordinateHelper.addDelta(e.pos,-this.dx,-this.dy,-this.dz)}));const e={type:"vertex-update",vertices:this.vertices,operation:"undo"};this.helper.emit("vertex-update",e)}canAccumulate(e){if(e.length!==this.vertices.length)return!1;for(let t=0;t<e.length;++t)if(e[t]!==this.vertices[t])return!1;return!0}accumulate(e,t,i){this.vertices.forEach((r=>{this.helper.data.coordinateHelper.addDelta(r.pos,e,t,i)})),this.dx+=e,this.dy+=t,this.dz+=i;const r={type:"vertex-update",vertices:this.vertices,operation:"apply"};this.helper.emit("vertex-update",r)}}class c{constructor(e,t,i=0){this.helper=e,this.removedVertices=null,this._minNumberOfVertices=0,this.vertices=t,this._minNumberOfVertices=i}apply(){let e="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach((e=>{const t=this._removeVertex(e);(0,r.pC)(t)&&this.removedVertices.push(t)})),e="apply"):this.removedVertices.forEach((e=>{this._redoRemoveVertex(e)}));const t={type:"vertex-remove",vertices:this.vertices,operation:e};this.helper.emit("vertex-remove",t)}undo(){this.removedVertices.forEach((e=>{this._undoRemoveVertex(e)}));const e={type:"vertex-add",vertices:this.vertices,operation:"undo"};this.helper.emit("vertex-add",e)}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},r=e.left,s=e.right;return t.vertices.splice(t.vertices.indexOf(e),1),r&&(t.edges.splice(t.edges.indexOf(r),1),r.left.right=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.right.left=null),0===e.index&&s&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.right),0),r&&s&&(i.createdEdge=new n.kS(t,r.left,s.right),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.right,s.right.index-1),i}_redoRemoveVertex(e){console.warn("redo remove vertex not implemented yet")}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,r=t.left,s=t.right;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),r&&(i.edges.push(r),r.left.right=r),s&&(i.edges.push(s),s.right.left=s),i.updateVertexIndex(t,t.index)}}class h{constructor(e,t,i){this.helper=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}apply(){let e="redo";if((0,r.Wi)(this.addedVertex)&&(e="apply",this.addedVertex=new n.Xz(this.component)),0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{const e=(0,r.Wg)(this.component.findEndVertex());let t=null;e.right&&(this.originalEdge=e.right,t=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,(0,r.Wi)(this.left)&&(this.left=new n.kS(this.component,e,this.addedVertex)),this.component.edges.push(this.left),e.right=this.left,(0,r.pC)(this.originalEdge)&&(0,r.pC)(t)&&((0,r.Wi)(this.right)&&(this.right=new n.kS(this.component,this.addedVertex,t)),this.component.edges.push(this.right),t.left=this.right),this.component.updateVertexIndex(this.addedVertex,e.index+1)}const t={type:"vertex-add",vertices:[this.addedVertex],operation:e};this.helper.emit("vertex-add",t)}undo(){if((0,r.Wi)(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),(0,r.pC)(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),(0,r.pC)(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),(0,r.pC)(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),(0,r.pC)(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const e={type:"vertex-remove",vertices:[this.addedVertex],operation:"undo"};this.helper.emit("vertex-remove",e)}}},44263:(e,t,i)=>{"use strict";i.d(t,{V:()=>m});i(95830);var r=i(59472),s=i(77625),n=i(17387),o=i(59691),a=i(34353),l=i(46304),c=i(88),h=i(39746),d=i(68500),p=i(43965),u=i(57511),v=i(70189),f=i(86184),g=i(71702);class m extends g._{constructor(e){super(e),this._ray=c.kx.create(),this._externalResources=null,this._handles=new o.Z,this._isWorldDown=!1,this._start=(0,s.c)(),this._end=(0,s.f)(1,0,0),this._width=1,this._color=(0,v.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,v.f)(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=b,this.applyProps(e)}createExternalResources(){const e=new u.U(this.materialParameters,"lineVisualElement");this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()})));const t=new f.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,r.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalResource(e){(0,r.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,s.c)(),(0,s.c)()],i=3===this.extensionType;i&&t.push((0,s.c)(),(0,s.c)());const n=new d.Z(h.Z.createPolylineGeometry(t),"lineVisualElement");i&&(n.data.vertexAttributes[p._A.COLOR]={size:4,data:new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]),offsetIdx:0,strideIdx:4},n.data.indices[p._A.COLOR]=new Uint32Array([0,1,2,3])),e.addGeometry(n,(0,r.Wg)(this._externalResources).material),this.updateVertices(n)}updateVisibility(e){super.updateVisibility(e),(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,n.g)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,n.f)(this._end,e,this._end),c.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,n.m)(this._start,e)||((0,n.g)(this._start,e),c.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,n.m)(this._end,e)||((0,n.g)(this._end,e),c.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){(0,a.g)(e,this._color)||((0,a.c)(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,a.g)(e,this._innerColor)||((0,a.c)(this._innerColor,e),this.updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,r.pC)(e)!==(0,r.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,r.Wi)(e)||(0,r.Wi)(this._stippleOffColor)||!(0,a.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,r.pC)(e)?(0,v.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,r.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,r.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,r.Pt)(e,b),this.recreateGeometry()}updateMaterial(){(0,r.Wi)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){(0,r.pC)(this.object)&&this.updateVertices(this.object.geometries[0])}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(w):this.updateLineSegmentInfinite(this._extensionType,w);this.updateVertexAttributes(e,t),(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return c.KD.fromPoints(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,l.f)(this._ray,_),e){case 0:_.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")||0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,n.p)(_.ray.direction,_.ray.direction),2===this._extensionType&&null!=t&&(_.c1=Math.abs(i-t));break}}if(!c.oy.intersectClipRay(i.frustum.planes,_))return c.KD.fromPoints(this._start,this._end,t);const r=(0,l.g)(_,x),s=(0,l.d)(_,y);return c.KD.fromPoints(r,s,t)}updateVertexAttributes(e,t){const i=e.data.getVertexAttr()[p._A.POSITION].data;if(3===this.extensionType){{const e=c.KD.pointAt(t,-this.fadedExtensions.start,x);i[0]=e[0],i[1]=e[1],i[2]=e[2]}{const e=c.KD.pointAt(t,0,x);i[3]=e[0],i[4]=e[1],i[5]=e[2]}{const e=c.KD.pointAt(t,1,x);i[6]=e[0],i[7]=e[1],i[8]=e[2]}{const e=c.KD.pointAt(t,1+this.fadedExtensions.end,x);i[9]=e[0],i[10]=e[1],i[11]=e[2]}}else{{const e=c.KD.pointAt(t,0,x);i[0]=e[0],i[1]=e[1],i[2]=e[2]}{const e=c.KD.pointAt(t,1,x);i[3]=e[0],i[4]=e[1],i[5]=e[2]}}(0,r.pC)(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}const _=(0,l.b)(),x=(0,s.c)(),y=(0,s.c)(),w=c.KD.create(),b={start:.3333333333333333,end:.3333333333333333}},84845:(e,t,i)=>{"use strict";i.d(t,{L:()=>Ie});var r=i(59472),s=i(33655),n=i(77625),o=i(17387),a=i(17333),l=i(38256),c=i(34353),h=i(69996),d=i(8344),p=i(56469),u=i(39746),v=i(96071),f=i(67128),g=i(50897),m=i(30663),_=i(12811),x=i(55735),y=i(98501),w=i(14286),b=i(80905),P=i(27898),S=i(49366),C=i(24379);function T(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var O=i(82976),V=i(30090),E=i(10762),H=i(13405),A=i(12528),z=i(56140),D=i(23240),I=i(97853),M=i(44801),R=i(11379),U=i(51007),L=i(36904),F=i(89553),k=i(61514),Z=i(91930),j=i(2489),W=i(79431),q=i(72023),G=i(8681),N=i(76789),X=i(66704);class B extends I.A{initializeProgram(e){const t=B.shader.get(),i=this.configuration,r=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped});return new U.Z(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),R.i)}bindPass(e,t,i){F.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),N.L.bindUniforms(this.program,t,i),Z.c.bindUniforms(this.program,t),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio||1),F.G.bindViewport(this.program,i),6===this.configuration.output?W.A.bindUniforms(this.program):(j.R.bindUniforms(this.program,i),A.H.bindUniforms(this.program,t,i.camera.pixelRatio||1),G.k.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&j.R.bindVisibilityTexture(e,this.program,i)),4===this.configuration.output&&q.b.bindOutputHighlight(e,this.program,i)}bindDraw(e){F.G.bindView(this.program,e),F.G.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),k.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,s=this.configuration.polygonOffsetEnabled&&$,n=(i||r)&&4!==t.output?(t.depthEnabled||6===t.output)&&L.LZ:null;return(0,L.sm)({blending:0===t.output||7===t.output||4===t.output?i?Y:(0,X.$L)(e):null,depthTest:{func:515},depthWrite:n,colorWrite:L.BK,polygonOffset:s})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}B.shader=new D.J(A.a,(()=>i.e(3362).then(i.bind(i,13362))));const $={factor:0,units:-4},Y=(0,L.if)(1,771);class K extends M.m{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1}}(0,z._)([(0,M.o)({count:8})],K.prototype,"output",void 0),(0,z._)([(0,M.o)()],K.prototype,"occlusionTestEnabled",void 0),(0,z._)([(0,M.o)()],K.prototype,"sdf",void 0),(0,z._)([(0,M.o)()],K.prototype,"vvSize",void 0),(0,z._)([(0,M.o)()],K.prototype,"vvColor",void 0),(0,z._)([(0,M.o)()],K.prototype,"verticalOffset",void 0),(0,z._)([(0,M.o)()],K.prototype,"screenSizePerspective",void 0),(0,z._)([(0,M.o)({count:2})],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,z._)([(0,M.o)()],K.prototype,"debugDrawBorder",void 0),(0,z._)([(0,M.o)()],K.prototype,"binaryHighlightOcclusion",void 0),(0,z._)([(0,M.o)()],K.prototype,"slicePlaneEnabled",void 0),(0,z._)([(0,M.o)()],K.prototype,"polygonOffsetEnabled",void 0),(0,z._)([(0,M.o)()],K.prototype,"depthEnabled",void 0),(0,z._)([(0,M.o)({count:4})],K.prototype,"transparencyPassType",void 0),(0,z._)([(0,M.o)()],K.prototype,"pixelSnappingEnabled",void 0),(0,z._)([(0,M.o)()],K.prototype,"isDraped",void 0);class Q extends E.F5{constructor(e,t){super(t,e,ye),this.techniqueConfig=new K}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig}intersect(e,t,i,r,s,n,o,a,l){l?this.intersectDrapedHudGeometry(e,n,o,a):this.intersectHudGeometry(e,t,i,r,o,a)}intersectDrapedHudGeometry(e,t,i,r){const s=e.getAttribute(p.Xt.POSITION),n=e.getAttribute(p.Xt.SIZE),o=this.params,a=(0,A.c)(o);let l=1,c=1;if(r){const e=r(fe);l=e[0],c=e[5]}l*=e.screenToWorldRatio,c*=e.screenToWorldRatio;const h=me*e.screenToWorldRatio;for(let r=0;r<s.data.length/s.size;r++){const d=r*s.size,p=s.data[d],u=s.data[d+1],v=r*n.size;let f;_e[0]=n.data[v]*l,_e[1]=n.data[v+1]*c,o.textureIsSignedDistanceField&&(f=o.outlineSize*e.screenToWorldRatio/2),ie(t,p,u,_e,h,f,o,a)&&i()}}intersectHudGeometry(e,t,i,r,s,a){if(!r.options.selectionMode||!r.options.hud)return;if((0,S.PD)(t))return;const l=e.data,c=this.params;let h=1,d=1;if((0,y.f)(he,i),a){const e=a(fe);h=e[0],d=e[5],function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*d,e[4]=n*d,e[5]=o*d,e[6]=a*p,e[7]=l*p,e[8]=c*p}(he)}const u=l.getVertexAttr()[p.Xt.POSITION],v=l.getVertexAttr()[p.Xt.SIZE],g=l.getVertexAttr()[p.Xt.NORMAL],m=l.getVertexAttr()[p.Xt.AUXPOS1];(0,p.hu)(u.size>=3);const _=r.point,x=r.camera,w=(0,A.c)(c);h*=x.pixelRatio,d*=x.pixelRatio;const b="screen"===this.params.centerOffsetUnits;for(let e=0;e<u.data.length/u.size;e++){const t=e*u.size;(0,o.s)(ne,u.data[t],u.data[t+1],u.data[t+2]),(0,o.i)(ne,ne,i);const a=e*v.size;_e[0]=v.data[a]*h,_e[1]=v.data[a+1]*d,(0,o.i)(ne,ne,x.viewMatrix);const l=e*m.size;if((0,o.s)(ue,m.data[l+0],m.data[l+1],m.data[l+2]),!b&&(ne[0]+=ue[0],ne[1]+=ue[1],0!==ue[2])){const e=ue[2];(0,o.n)(ue,ne),(0,o.f)(ne,ne,(0,o.a)(ue,ue,e))}const p=e*g.size;if((0,o.s)(oe,g.data[p],g.data[p+1],g.data[p+2]),this.normalAndViewAngle(oe,he,x,ve),this.applyVerticalOffsetTransformationView(ne,ve,x,re),x.applyProjection(ne,ae),ae[0]>-1){let e=Math.floor(ae[0])+this.params.screenOffset[0],t=Math.floor(ae[1])+this.params.screenOffset[1];b&&(e+=ue[0],0!==ue[1]&&(t+=(0,C.sX)(ue[1],re.factorAlignment))),(0,C.TU)(_e,re.factor,_e);const i=ge*x.pixelRatio;let a;if(c.textureIsSignedDistanceField&&(a=c.outlineSize*x.pixelRatio/2),ie(_,e,t,_e,i,a,c,w)){const e=r.ray;if((0,o.i)(ce,ne,(0,f.a)(pe,x.viewMatrix)),ae[0]=_[0],ae[1]=_[1],x.unprojectFromRenderScreen(ae,ne)){const t=(0,n.c)();(0,o.g)(t,e.direction);const i=1/(0,o.l)(t);(0,o.a)(t,t,i),s((0,o.k)(e.origin,ne)*i,t,-1,1,!0,ce)}}}}}computeAttachmentOrigin(e,t){const i=e.data,r="getVertexAttr"in i?i.getVertexAttr():"vertexAttr"in i?i.vertexAttr:null;if(!r)return null;const s=p.Xt.POSITION,n=r[s],o="getIndices"in i?i.getIndices(s):"indices"in i?i.indices[s]:null;return(0,P.NO)(n,o,t)}createBufferWriter(){return new be(this)}normalAndViewAngle(e,t,i,r){return T(t)&&(t=(0,y.f)(de,t)),(0,o.t)(r.normal,e,t),(0,o.i)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,o.d)(le,xe),r}updateScaleInfo(e,t,i){const r=this.params;r.screenSizePerspective?(0,C.PV)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?(0,C.PV)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,s,n,o){const a=this.normalAndViewAngle(t,i,s,ve);return this.applyVerticalGroundOffsetView(e,a,s,o),this.applyVerticalOffsetTransformationView(o,a,s,n),this.applyPolygonOffsetView(o,a,r[3],s,o),this.applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,s,n){return this.applyCenterOffsetNDC(e,t,i,s),(0,r.pC)(n)&&(0,o.g)(n,s),this.applyPolygonOffsetNDC(s,t,i,s),s}applyPolygonOffsetView(e,t,i,r,n){const a=r.aboveGround?1:-1;let l=(0,s.Xx)(i);0===l&&(l=a);const c=a*l;if(this.params.shaderPolygonOffset<=0)return(0,o.g)(n,e);const h=(0,s.uZ)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-h*h)/h/r.viewport[2];return(0,o.a)(n,e,c>0?d:1/d),n}applyVerticalGroundOffsetView(e,t,i,r){const s=(0,o.l)(e),n=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(s),l=(0,o.a)(ne,t.normal,n*a);return(0,o.b)(r,e,l),r}applyVerticalOffsetTransformationView(e,t,i,r){const s=this.params;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const i=(0,o.l)(e);this.updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const n=(0,o.l)(e),a=s.screenSizePerspectiveAlignment||s.screenSizePerspective,l=(0,V.Hx)(i,n,s.verticalOffset,t.cosAngle,a);return this.updateScaleInfo(r,n,t.cosAngle),(0,o.a)(t.normal,t.normal,l),(0,o.b)(e,e,t.normal)}applyCenterOffsetView(e,t,i){const r="screen"!==this.params.centerOffsetUnits;return i!==e&&(0,o.g)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,o.n)(oe,i),(0,o.b)(i,i,(0,o.a)(oe,oe,t[2])))),i}applyCenterOffsetNDC(e,t,i,r){const s="screen"!==this.params.centerOffsetUnits;return r!==e&&(0,o.g)(r,e),s||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}applyPolygonOffsetNDC(e,t,i,r){const n=this.params.shaderPolygonOffset;if(e!==r&&(0,o.g)(r,e),n){const e=i.aboveGround?1:-1,o=e*(0,s.Xx)(t[3]);r[2]-=(o||e)*n}return r}getGLMaterial(e){return 0===e.output||7===e.output?new ee(e):4===e.output?new te(e):void 0}calculateRelativeScreenBounds(e,t,i=(0,g.Ue)()){return function(e,t,i,r=se){(0,w.c)(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class J extends O.Z{constructor(e){super({...e,...e.material.params}),this.updateParameters()}beginSlot(e){return e===(this.material.params.drawInSecondSlot?19:18)}updateParameters(e){this.updateTexture(this.material.params.textureId),this.selectProgram(e)}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(this.output,e),this.technique)}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}}class ee extends J{constructor(e){super(e),this.isOcclusionSlot=!1}beginSlot(e){const t=this.material.params.drawInSecondSlot?19:18;return this.material.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)}getTechnique(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(this.output,e),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(6,e),this.occlusionTechnique)}bind(e,t){const i=this.getTechnique();e.bindProgram(i.program),this.isOcclusionSlot||(this.bindTexture(e,i.program),this.bindTextureScale(e,i.program)),i.bindPass(e,this.material.params,t)}}class te extends J{constructor(e){super({...e,output:4})}}function ie(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),d=h+r[1]+2*s;if(o.textureIsSignedDistanceField){const e=o.distanceFieldBoundingBox;l+=r[0]*e[0],h+=r[1]*e[1],c-=r[0]*(1-e[2]),d-=r[1]*(1-e[3]),l-=n,c+=n,h-=n,d+=n}return e[0]>l&&e[0]<c&&e[1]>h&&e[1]<d}const re={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},se=(0,x.a)(),ne=(0,n.c)(),oe=(0,n.c)(),ae=(0,v.J$)(),le=(0,n.c)(),ce=(0,n.c)(),he=(0,m.a)(),de=(0,m.a)(),pe=(0,_.a)(),ue=(0,n.c)(),ve={normal:le,cosAngle:0},fe=(0,_.a)(),ge=1,me=2,_e=[0,0],xe=(0,n.f)(0,0,1),ye={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:(0,x.f)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...E.zh},we=(0,b.U$)().vec3f(p.Xt.POSITION).vec3f(p.Xt.NORMAL).vec2f(p.Xt.UV0).vec4u8(p.Xt.COLOR).vec2f(p.Xt.SIZE).vec4f(p.Xt.AUXPOS1).vec4f(p.Xt.AUXPOS2);class be{constructor(e){this.material=e,this.vertexBufferLayout=we}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices[p.Xt.POSITION].length}write(e,t,i,r){(0,H.ho)(t.indices[p.Xt.POSITION],t.vertexAttr[p.Xt.POSITION].data,e.transformation,i.position,r,6),(0,H.s5)(t.indices[p.Xt.NORMAL],t.vertexAttr[p.Xt.NORMAL].data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttr[p.Xt.UV0].data;let s,n,o,a;if(null==e||e.length<4){const e=this.material.params;s=0,n=0,o=e.texCoordScale[0],a=e.texCoordScale[1]}else s=e[0],n=e[1],o=e[2],a=e[3];o=Math.min(1.99999,o+1),a=Math.min(1.99999,a+1);const l=t.indices[p.Xt.POSITION].length,c=i.uv0;let h=r;for(let e=0;e<l;++e)c.set(h,0,s),c.set(h,1,n),h+=1,c.set(h,0,o),c.set(h,1,n),h+=1,c.set(h,0,o),c.set(h,1,a),h+=1,c.set(h,0,o),c.set(h,1,a),h+=1,c.set(h,0,s),c.set(h,1,a),h+=1,c.set(h,0,s),c.set(h,1,n),h+=1}(0,H.Vs)(t.indices[p.Xt.COLOR],t.vertexAttr[p.Xt.COLOR].data,4,i.color,r,6);{const e=t.indices[p.Xt.SIZE],s=t.vertexAttr[p.Xt.SIZE].data,n=e.length,o=i.size;let a=r;for(let t=0;t<n;++t){const i=s[2*e[t]],r=s[2*e[t]+1];for(let e=0;e<6;++e)o.set(a,0,i),o.set(a,1,r),a+=1}}t.indices[p.Xt.AUXPOS1]&&t.vertexAttr[p.Xt.AUXPOS1]&&(0,H.SW)(t.indices[p.Xt.AUXPOS1],t.vertexAttr[p.Xt.AUXPOS1].data,i.auxpos1,r,6),t.indices[p.Xt.AUXPOS2]&&t.vertexAttr[p.Xt.AUXPOS2]&&(0,H.SW)(t.indices[p.Xt.AUXPOS2],t.vertexAttr[p.Xt.AUXPOS2].data,i.auxpos2,r,6)}}var Pe=i(81718),Se=i(55197),Ce=i(68500);i(95830);function Te(e,t,i){switch(e){case"circle":return Oe(t,i);case"square":return Ve(t,i);case"cross":return function(e,t){return Ae(e,t,!1)}(t,i);case"x":return function(e,t){return Ae(e,t,!0)}(t,i);case"kite":return Ee(t,i);case"triangle":return function(e,t){const i=new Uint8Array(4*e*e),r=-.5,s=Math.sqrt(1.25),n=(e-t)/2;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=o*e+a,c=(a-n)/t,h=(o-n+.75)/t,d=-(1*c+r*h)/s,u=(1*(c-1)+r*-h)/s,v=-h,f=Math.max(d,u,v);(0,p.I0)(f*t/e+.5,i,4*l)}return i}(t,i);default:return Oe(t,i)}}function Oe(e,t){const i=e,r=new Uint8Array(4*i*i),s=i/2-.5,n=t/2;for(let t=0;t<i;t++)for(let o=0;o<i;o++){const a=o+i*t,l=o-s,c=t-s;let h=Math.sqrt(l*l+c*c)-n;h=h/e+.5,(0,p.I0)(h,r,4*a)}return r}function Ve(e,t){return He(e,t,!1)}function Ee(e,t){return He(e,t,!0)}function He(e,t,i){i&&(t/=Math.SQRT2);const r=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let n=0;n<e;n++){let o=n-.5*e+.25,a=.5*e-s-.75;const l=s*e+n;if(i){const e=(o+a)/Math.SQRT2;a=(a-o)/Math.SQRT2,o=e}let c=Math.max(Math.abs(o),Math.abs(a))-.5*t;c=c/e+.5,(0,p.I0)(c,r,4*l)}return r}function Ae(e,t,i){i&&(t*=Math.SQRT2);const r=.5*t,s=new Uint8Array(4*e*e);for(let t=0;t<e;t++)for(let n=0;n<e;n++){let o=n-.5*e,a=.5*e-t-1;const l=t*e+n;if(i){const e=(o+a)/Math.SQRT2;a=(a-o)/Math.SQRT2,o=e}let c;o=Math.abs(o),a=Math.abs(a),c=o>a?o>r?Math.sqrt((o-r)*(o-r)+a*a):a:a>r?Math.sqrt(o*o+(a-r)*(a-r)):o,c=c/e+.5,(0,p.I0)(c,s,4*l)}return s}var ze=i(43446),De=i(82942);class Ie{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,l.b)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,l.b)(1,1,1,1),this._elevationInfo=null,this.resources=new De.O({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),(0,r.pC)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?(0,r.pC)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){(0,c.g)(e,this._color)||((0,c.c)(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,(0,r.pC)(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.g)(e,this._outlineColor)||((0,c.c)(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;(0,r.Wi)(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if((0,r.Wi)(e)||(0,r.Wi)(t))return;const i=e.geometry;if((0,r.Wi)(i))return;const s=i.data.getVertexAttr()[p.Xt.SIZE].data,n=this.geometrySize;s[0]=n,s[1]=n,t.geometryVertexAttrsUpdated(0)}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Re,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Me}recreateGeometry(e,t){const i=this.createRenderGeometry();return(0,r.pC)(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new Q(this.materialParameters(t.id),"pointVisualElement"),s=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:s,forEach(e){e(t),e(i),(0,r.pC)(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return(0,s.uZ)((0,s.Sf)(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new ze.Z(Te(this._primitive,e,e*Me),"pointVisualElement",{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if((0,r.Wi)(this.resources.resources)||(0,r.Wi)(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.data.getAttribute("position");return(0,a.SH)(t.data,this.view.renderCoordsHelper.spatialReference,Ue,this.view.spatialReference),(0,h.G1)(e,Ue),!0}createRenderGeometry(){const e=this.geometry;if((0,r.Wi)(e))return null;const t=this.view.renderCoordsHelper,i=(0,Pe.w7)(e,this.view.elevationProvider,Se.o.fromElevationInfo(this.elevationInfo),t),s=(0,o.s)(d.WM.get(),e.x,e.y,i),n=d.WM.get();(0,a.SH)(s,e.spatialReference,n,t.spatialReference);const l=this.geometrySize,c=u.Z.createPointGeometry(null,n,null,[l,l],[0,0,0,1]);return new Ce.Z(c)}}const Me=.5,Re=[Me/2,Me/2,1-Me/2,1-Me/2],Ue=(0,n.c)()},82942:(e,t,i)=>{"use strict";i.d(t,{O:()=>c});var r=i(59472),s=i(80621),n=i(88909),o=i(68500),a=i(89852),l=i(43446);class c{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,r.pC)(this._resources)?this._resources.object:null}get resources(){return(0,r.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if((0,r.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t instanceof o.Z&&e.remove(2,t.id)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);for(const t of i)e.add(2,t)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new a.Z("element",{isPickable:!1});e.add(0,t),e.addToViewContent([t.id]);const i=new n.Z({idHint:"element",castShadow:!1}),r=this.resourceFactory.createResources(i,t);r.forEach((t=>{e.add(this._contentTypeFromResource(t),t)})),e.add(1,i),t.addObject(i),i.setVisible(this._visible);const o=this.resourceFactory.cameraChanged?(0,s.init)(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:t,object:i,external:r,cameraHandle:o}}_contentTypeFromResource(e){return e instanceof o.Z?2:e instanceof l.Z?4:3}_destroyResources(){if((0,r.Wi)(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(1,this._resources.object.id),null==e||e.remove(0,this._resources.layer.id),this._resources.external.forEach((t=>{null==e||e.remove(this._contentTypeFromResource(t),t.id),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){(0,r.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}},55197:(e,t,i)=>{"use strict";i.d(t,{o:()=>c});var r=i(59472),s=i(98160),n=i(36544),o=(i(30927),i(58722));const a=n.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return null!=e.cachedResult}class c{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,s.Z7)(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=function(e){if(null!=e){if(l(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,s.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,r.Pt)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if((0,r.Wi)(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&(0,r.pC)(t)&&(0,r.pC)(i)?(this._featureExpressionInfoContext=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}(e),function(e,t){if(null!=e&&!l(e)){if(!t||!e.arcade)return void a.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,o.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}(this._featureExpressionInfoContext,function(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}(s.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new c;return(0,r.pC)(e)&&t.setFromElevationInfo(e),t}}},76789:(e,t,i)=>{"use strict";i.d(t,{L:()=>n});var r=i(85461),s=i(91930);function n(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(s.c),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(r.H`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?r.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:r.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?r.H`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:r.H`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(r.H`
    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }
    `)}function o(e,t,i,r=a){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}!function(e){e.bindUniforms=function(e,t,i){if(!t.verticalOffset)return;const r=o(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),s=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*s,r.perDistance,r.minWorldLength,r.maxWorldLength)}}(n||(n={}));const a={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},73192:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});var r=i(85461);function s(e){const t=r.H`
    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `,i=r.H`

    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},2489:(e,t,i)=>{"use strict";i.d(t,{R:()=>n});var r=i(85461),s=i(91930);function n(e,t){const i=e;i.include(s.c),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),i.vertex.code.add(r.H`
    struct ProjectHUDAux {
      vec3 posModel;
      vec3 posView;
      vec3 vnormal;

      float distanceToCamera;
      float absCosAngle;
    };
  `),i.vertex.code.add(r.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = sign(pointGroundDistance);

      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation
      // we take the absolute value because the sign that is dropped is
      // instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);

        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.isDraped||i.vertex.code.add(r.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `),i.vertex.code.add(r.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?r.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?r.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(r.H`
    bool testVisibilityHUD(vec4 posProj) {
      // For occlusion testing, use the nearest pixel center to avoid
      // subpixel filtering messing up the color we use to test for
      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);

      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written
      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)
      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts

      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here
      if (uRenderTransparentlyOccludedHUD > 0.5) {
        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if
        // uRenderTransparentlyOccludedHUD = 0.75
        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
      }

      // and visible pixels that are not occluded by semi-transparent geometry here
      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
    }
  `)}!function(e){e.bindUniforms=function(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)},e.bindVisibilityTexture=function(e,t,i){t.setUniform1i("hudVisibilityTexture",4),e.bindTexture(i.hudVisibilityTexture,4),e.setActiveTexture(0)}}(n||(n={}))},79431:(e,t,i)=>{"use strict";i.d(t,{A:()=>r,R:()=>n});var r,s=i(85461);function n(e){const t=e;t.vertex.code.add(s.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }
    }
    else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(s.H`
  void main() {
    gl_FragColor = color;
  }
  `)}!function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(r||(r={}))},91930:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var r=i(85461),s=i(30090);function n(e){e.vertex.code.add(r.H`
    float screenSizePerspectiveMinSize(float size, vec4 factor) {
      float nonZeroSize = 1.0 - step(size, 0.0);

      return (
        factor.z * (
          1.0 +
          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding
          nonZeroSize *
          2.0 * factor.w / (
            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1
          )
        )
      );
    }
  `),e.vertex.code.add(r.H`
    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
      return absCosAngle * absCosAngle * absCosAngle;
    }
  `),e.vertex.code.add(r.H`
    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
      return vec4(
        min(params.x / (distanceToCamera - params.y), 1.0),
        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
        params.z,
        params.w
      );
    }
  `),e.vertex.code.add(r.H`
    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
    }
  `),e.vertex.code.add(r.H`
    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorFloat(
        size,
        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
      );
    }
  `),e.vertex.code.add(r.H`
    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
    }
  `),e.vertex.code.add(r.H`
    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
    }
  `)}!function(e){e.bindUniforms=function(e,t){if(t.screenSizePerspective){(0,s.bj)(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;(0,s.bj)(i,e,"screenSizePerspectiveAlignment")}}}(n||(n={}))},82976:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(59472),s=i(68397),n=i(26701);const o=class extends n.Z{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquireIfNotUndefined(this._textureId),this._textureNormal=this._acquireIfNotUndefined(e.normalTextureId),this._textureEmissive=this._acquireIfNotUndefined(e.emissiveTextureId),this._textureOcclusion=this._acquireIfNotUndefined(e.occlusionTextureId),this._textureMetallicRoughness=this._acquireIfNotUndefined(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))}bindTexture(e,t){(0,r.pC)(this._texture)&&(t.setUniform1i("tex",s.G.DIFFUSE),e.bindTexture(this._texture.glTexture,s.G.DIFFUSE)),(0,r.pC)(this._textureNormal)&&(t.setUniform1i("normalTexture",s.G.NORMAL),e.bindTexture(this._textureNormal.glTexture,s.G.NORMAL)),(0,r.pC)(this._textureEmissive)&&(t.setUniform1i("texEmission",s.G.EMISSION),e.bindTexture(this._textureEmissive.glTexture,s.G.EMISSION)),(0,r.pC)(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",s.G.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,s.G.OCCLUSION)),(0,r.pC)(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",s.G.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,s.G.METALLIC_ROUGHNESS))}bindTextureScale(e,t){const i=(0,r.pC)(this._texture)&&this._texture.glTexture;i&&i.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",i.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquireIfNotUndefined(e){if(!(0,r.Wi)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_releaseIfNotUndefined(e){void 0!==e&&(this._textureIDs.delete(e),this._textureRepository.release(e))}}},70573:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Z});var r=i(56140),s=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(82677)),a=i(59472),l=i(59691),c=i(69948),h=i(2887),d=i(35470),p=i(96071);let u=class extends d.Z.EventedAccessor{constructor(){super(...arguments),this._hasZ=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0}get hasZ(){return(0,a.pC)(this._hasZ)?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}canUndo(){return this.history.length>0}canRedo(){return this.redoHistory.length>0}undo(){if(!this.canUndo())return;const e=this.history.pop();e.undo(),this.redoHistory.push(e)}redo(){if(!this.canRedo())return;const e=this.redoHistory.pop();e.redo(),this.history.push(e)}getCoordsFromScreenPoint(e){const t=this.screenToMap(e);return(0,a.pC)(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return(0,a.pC)(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null}isDuplicateVertex(e,t){if(e.length){const[i,r]=e[e.length-1];return i===t[0]&&r===t[1]}return!1}getGeometryZValue(){return this.defaultZ}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const i=(0,a.Pt)(this.elevationInfo,v);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.s1)(e.x,e.y),i,this.getGeometryZValue())}else{const i=(0,a.Pt)(this.elevationInfo,f);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.s1)(e.x,e.y),i,0),(0,a.pC)(t)&&(t.z=void 0)}else t=this.view.toMap(e),(0,a.pC)(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t}};(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],u.prototype,"interactiveUndoDisabled",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"history",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"redoHistory",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"snapToScene",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"elevationInfo",void 0),(0,r._)([(0,s.Cb)({nonNullable:!0})],u.prototype,"defaultZ",void 0),(0,r._)([(0,s.Cb)({dependsOn:["view"]})],u.prototype,"hasZ",null),u=(0,r._)([(0,n.j)("esri.views.draw.DrawAction")],u);const v={mode:"absolute-height",offset:0},f={mode:"on-the-ground",offset:0};const g=u;class m{constructor(e,t,i,r){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class _{constructor(e,t,i,r){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.defaultPrevented=!1,this.type="vertex-update"}preventDefault(){this.defaultPrevented=!0}}class x{constructor(e,t,i,r){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class y{constructor(e,t,i,r,s=null){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.mapPoint=s,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===r.length?r[0]:null}preventDefault(){this.defaultPrevented=!0}}class w{constructor(e,t){this.native=e,this.vertices=t,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===t.length?t[0]:null}preventDefault(){this.defaultPrevented=!0}}const b="c",P="r",S="z",C="f",T=" ";let O=class extends g{constructor(e){super(e),this._cursorMoved=!1,this._cursorScreenPoint=null,this._dragEnabled=!0,this._pointerDownEvent=null,this._viewHandles=new l.Z,this.vertices=[]}initialize(){this._addViewHandles()}destroy(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")}addVertex(e,t){isNaN(t)?(t=this.vertices.length,this.vertices.push(e)):this.vertices.splice(t,0,e);const i={vertex:e,vertexIndex:t,undo:()=>this._undoVertexAdd(null,t),redo:()=>this._redoVertexAdd(null,e,t)};this.history.push(i),this._set("redoHistory",[]);const r=new m(this.view,null,t,this.vertices);this.emit("vertex-add",r),r.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())}removeVertex(e){const t=this.vertices.splice(e,1)[0],i={vertex:t,vertexIndex:e,undo:()=>this._undoVertexRemove(null,t,e),redo:()=>this._redoVertexRemove(null,e)};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new x(this.view,null,e,this.vertices))}updateVertex(e,t){const i=this.vertices[t];this.vertices[t]=e;const r={vertex:e,vertexIndex:t,undo:()=>this._undoVertexUpdate(null,i,t),redo:()=>this._redoVertexUpdate(null,e,t)};this.history.push(r),this._set("redoHistory",[]),this.emit("vertex-update",new _(this.view,null,t,this.vertices))}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._cursorMoved&&this.vertices.pop(),this._pointerDownEvent=e,this._cursorMoved=!1,this._cursorScreenPoint=(0,h.vT)(e)}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._cursorMoved&&this.vertices.pop(),this._cursorMoved=!0,this._cursorScreenPoint=(0,h.vT)(e),this._cursorUpdateHandler(e)}),c.f.TOOL),this.view.on("pointer-up",(e=>{if(this._pointerDownEvent){if(this._cursorMoved)return this.vertices.pop(),void(this._cursorMoved=!1);this._pointerDownEvent=null,this._vertexAddHandler(e)}}),c.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&this._pointerDownEvent&&e.stopPropagation()}),c.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("key-down",(e=>{e.key===C&&!e.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(e)):e.key===b&&!e.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key!==S||this.interactiveUndoDisabled||e.repeat?e.key!==P||this.interactiveUndoDisabled||e.repeat||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())}),c.f.TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addVertex(e,t){this.vertices.push(e);const i=this.vertices.indexOf(e),r={vertex:e,vertexIndex:i,undo:()=>this._undoVertexAdd(t,i),redo:()=>this._redoVertexAdd(t,e,i)};this.history.push(r),this._set("redoHistory",[]);const s=new m(this.view,t,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())}_updateCursor(e,t){this.vertices.push(e);const i=this.vertices.indexOf(e),r=new y(this.view,t,i,this.vertices);this.emit("cursor-update",r)}_completeDrawing(e){if(this._cursorMoved=!1,this._pointerDownEvent=null,this.vertices.length<1)return;const t=new w(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented?this._cursorMoved=!0:this._removeViewHandles()}_undoVertexAdd(e,t){this.vertices.splice(t,1),this.emit("undo",new x(this.view,e,t,this.vertices))}_redoVertexAdd(e,t,i){this.vertices.splice(i,0,t),this.emit("redo",new m(this.view,e,i,this.vertices))}_undoVertexRemove(e,t,i){this.vertices.splice(i,0,t),this.emit("undo",new m(this.view,e,i,this.vertices))}_redoVertexRemove(e,t){this.vertices.splice(t,1),this.emit("redo",new x(this.view,e,t,this.vertices))}_undoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("undo",new _(this.view,e,i,this.vertices))}_redoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("redo",new _(this.view,e,i,this.vertices))}_vertexAddHandler(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&this._addVertex(t,e.native)}_cursorUpdateHandler(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&this._updateCursor(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};(0,r._)([(0,s.Cb)({readOnly:!0})],O.prototype,"vertices",void 0),O=(0,r._)([(0,n.j)("esri.views.draw.MultipointDrawAction")],O);Object.freeze({__proto__:null,get MultipointDrawAction(){return O}});var V=i(94535),E=i(84678),H=i(88958),A=i(76916),z=i(9434);let D=class extends(d.Z.EventedMixin(A.m)){constructor(e){super(e),this.drawOperation=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=null,this.snappingOptions=new z.g,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=(0,a.Pt)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this.drawOperation=new H.w({view:this.view,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new E.i(this.view,e),hasM:!1,elevationInfo:e,snappingOptions:this.snappingOptions}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onComplete(e){this.emit("complete",e)}};(0,r._)([(0,s.Cb)({constructOnly:!0,nonNullable:!0})],D.prototype,"view",void 0),(0,r._)([(0,s.Cb)({value:!0})],D.prototype,"enabled",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],D.prototype,"hasZ",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0,nonNullable:!0})],D.prototype,"defaultZ",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],D.prototype,"elevationInfo",void 0),(0,r._)([(0,s.Cb)()],D.prototype,"snapToScene",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],D.prototype,"snappingOptions",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],D.prototype,"mode",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],D.prototype,"geometryType",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],D.prototype,"type",void 0),D=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.draw.DrawTool")],D);let I=class extends g{constructor(e){super(e),this._clickDelay=V.M.maximumClickDelay,this._cursorMoved=!1,this._cursorScreenPoint=null,this._pointerDownEvent=null,this._viewHandles=new l.Z,this.coordinates=[]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")):(this._removeDrawTool(),this.emit("destroy"))}complete(){if("2d"===this.view.type){if(this._cursorScreenPoint){const e=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(e)&&(this._set("coordinates",e),this._completeDrawing())}}else this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation();const t=this.getCoordsFromScreenPoint(e.screenPoint);(0,a.pC)(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._pointerDownEvent=e,this._cursorMoved=!1}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._cursorMoved=!0,this._cursorScreenPoint=(0,h.vT)(e),this._cursorUpdateHandler(e)}),c.f.TOOL),this.view.on("pointer-up",(e=>{if(this._pointerDownEvent&&!this._cursorMoved&&e.timestamp-this._pointerDownEvent.timestamp>this._clickDelay){this._cursorScreenPoint=(0,h.vT)(e);const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}}),c.f.TOOL),this.view.on("key-down",(e=>{if(e.key===b&&this._cursorScreenPoint){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}}),c.f.TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new D({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new y(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new w(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){(0,a.pC)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_updateCursor(e,t){(0,a.pC)(e)?this.emit("cursor-update",new y(this.view,t,0,[e])):this.emit("cursor-update",new y(this.view,t,null,null))}_completeDrawing(e){this._cursorMoved=!1,this._pointerDownEvent=null;const t=new w(e,[this.coordinates]);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_cursorUpdateHandler(e){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};(0,r._)([(0,s.Cb)({readOnly:!0})],I.prototype,"coordinates",void 0),I=(0,r._)([(0,n.j)("esri.views.draw.PointDrawAction")],I);var M=i(636);let R=class extends g{constructor(e){super(e),this._cursorScreenPoint=null,this._panEnabled=!1,this._cursorVertexAdded=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new l.Z,this.mode=M.n,this.vertices=[]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}addVertex(e,t){this.vertices.splice(t,0,e);const i={vertex:e,vertexIndex:t,undo:()=>this._undoVertexAdd(null,t),redo:()=>this._redoVertexAdd(null,e,t)};this.history.push(i),this._set("redoHistory",[]);const r=new m(this.view,null,t,this.vertices);this.emit("vertex-add",r),r.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())}removeVertex(e){const t=this.vertices.splice(e,1)[0],i={vertex:t,vertexIndex:e,undo:()=>this._undoVertexRemove(null,t,e),redo:()=>this._redoVertexRemove(null,e)};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new x(this.view,null,e,this.vertices))}updateVertex(e,t){const i=this.vertices[t];this.vertices[t]=e;const r={vertex:e,vertexIndex:t,undo:()=>this._undoVertexUpdate(null,i,t),redo:()=>this._redoVertexUpdate(null,e,t)};this.history.push(r),this._set("redoHistory",[]),this.emit("vertex-update",new _(this.view,null,t,this.vertices))}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._panEnabled||(this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,h.vT)(e),"touch"===e.pointerType&&this._updateCursor(e.native)))}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.vertices.pop(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,h.vT)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),c.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._cursorScreenPoint=(0,h.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),c.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),c.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&(0,a.pC)(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()}),c.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===C&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._vertexAddHandler(e)):t===b&&!i&&this._cursorScreenPoint&&this.vertices.length>2?(e.stopPropagation(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==S||this.interactiveUndoDisabled||i?t!==P||this.interactiveUndoDisabled||i?t!==T||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())}),c.f.TOOL),this.view.on("key-up",(e=>{e.key===T&&(e.stopPropagation(),this._panEnabled=!1)}),c.f.TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new D({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new m(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new y(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new w(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){(0,a.pC)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){if(this._popCursorVertex(),this.isDuplicateVertex(this.vertices,e))return;const i=this.vertices.length;this.vertices.push(e);const r={vertex:e,vertexIndex:i,undo:()=>this._undoVertexAdd(t,i),redo:()=>this._redoVertexAdd(t,e,i)};this.history.push(r),this._set("redoHistory",[]);const s=new m(this.view,t,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;let i=null,r=null;const s=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(s)&&(i=s.mapPoint,t||(r=this._pushCursorVertex(s.vertex)));const n=new y(this.view,e,r,this.vertices,i);this.emit("cursor-update",n)}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this.vertices.length<3)return;const t=new w(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_undoVertexAdd(e,t){this.vertices.splice(t,1),this.emit("undo",new x(this.view,e,t,this.vertices))}_redoVertexAdd(e,t,i){this.vertices.splice(i,0,t),this.emit("redo",new m(this.view,e,i,this.vertices))}_undoVertexRemove(e,t,i){this.vertices.splice(i,0,t),this.emit("undo",new m(this.view,e,i,this.vertices))}_redoVertexRemove(e,t){this.vertices.splice(t,1),this.emit("redo",new x(this.view,e,t,this.vertices))}_undoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("undo",new _(this.view,e,i,this.vertices))}_redoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("redo",new _(this.view,e,i,this.vertices))}_pushCursorVertex(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1}_popCursorVertex(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,a.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){if(this._cursorVertexAdded){const t=this.vertices[this.vertices.length-1];this._addVertex(t,e.native)}else{const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&this._addVertex(t,e.native)}}_drawCompleteHandler(e){this._completeDrawing(e.native)}};(0,r._)([(0,s.Cb)({dependsOn:["mode"]})],R.prototype,"_clickEnabled",null),(0,r._)([(0,s.Cb)({dependsOn:["mode"]})],R.prototype,"_dragEnabled",null),(0,r._)([(0,s.Cb)({type:M.A})],R.prototype,"mode",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],R.prototype,"vertices",void 0),R=(0,r._)([(0,n.j)("esri.views.draw.PolygonDrawAction")],R);let U=class extends g{constructor(e){super(e),this._cursorScreenPoint=null,this._panEnabled=!1,this._cursorVertexAdded=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new l.Z,this.mode=M.n,this.vertices=[]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}addVertex(e,t){this.vertices.splice(t,0,e);const i={vertex:e,vertexIndex:t,undo:()=>this._undoVertexAdd(null,t),redo:()=>this._redoVertexAdd(null,e,t)};this.history.push(i),this._set("redoHistory",[]);const r=new m(this.view,null,t,this.vertices);this.emit("vertex-add",r),r.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())}removeVertex(e){const t=this.vertices.splice(e,1)[0],i={vertex:t,vertexIndex:e,undo:()=>this._undoVertexRemove(null,t,e),redo:()=>this._redoVertexRemove(null,e)};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new x(this.view,null,e,this.vertices))}updateVertex(e,t){const i=this.vertices[t];this.vertices[t]=e;const r={vertex:e,vertexIndex:t,undo:()=>this._undoVertexUpdate(null,i,t),redo:()=>this._redoVertexUpdate(null,e,t)};this.history.push(r),this._set("redoHistory",[]),this.emit("vertex-update",new _(this.view,null,t,this.vertices))}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._panEnabled||(this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,h.vT)(e),"touch"===e.pointerType&&this._updateCursor(e.native)))}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.vertices.pop(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,h.vT)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),c.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._cursorScreenPoint=(0,h.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),c.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),c.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&(0,a.pC)(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()}),c.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),c.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===C&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._vertexAddHandler(e)):t===b&&!i&&this._cursorScreenPoint&&this.vertices.length>1?(e.stopPropagation(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==S||this.interactiveUndoDisabled||i?t!==P||this.interactiveUndoDisabled||i?t!==T||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())}),c.f.TOOL),this.view.on("key-up",(e=>{e.key===T&&(e.stopPropagation(),this._panEnabled=!1)}),c.f.TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new D({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new m(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new y(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new w(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){(0,a.pC)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool=(0,a.SC)(this._drawTool))}_addVertex(e,t){if(this._popCursorVertex(),this.isDuplicateVertex(this.vertices,e))return;this.vertices.push(e);const i=this.vertices.length-1,r={vertex:e,vertexIndex:i,undo:()=>this._undoVertexAdd(t,i),redo:()=>this._redoVertexAdd(t,e,i)};this.history.push(r),this._set("redoHistory",[]);const s=new m(this.view,t,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;let i=null,r=null;const s=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(s)&&(i=s.mapPoint,t||(r=this._pushCursorVertex(s.vertex)));const n=new y(this.view,e,r,this.vertices,i);this.emit("cursor-update",n)}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this.vertices.length<2)return;const t=new w(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_undoVertexAdd(e,t){this.vertices.splice(t,1),this.emit("undo",new x(this.view,e,t,this.vertices))}_redoVertexAdd(e,t,i){this.vertices.splice(i,0,t),this.emit("redo",new m(this.view,e,i,this.vertices))}_undoVertexRemove(e,t,i){this.vertices.splice(i,0,t),this.emit("undo",new m(this.view,e,i,this.vertices))}_redoVertexRemove(e,t){this.vertices.splice(t,1),this.emit("redo",new x(this.view,e,t,this.vertices))}_undoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("undo",new _(this.view,e,i,this.vertices))}_redoVertexUpdate(e,t,i){this.vertices[i]=t,this.emit("redo",new _(this.view,e,i,this.vertices))}_pushCursorVertex(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1}_popCursorVertex(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,a.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){if(this._cursorVertexAdded){const t=this.vertices[this.vertices.length-1];this._addVertex(t,e.native)}else{const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&this._addVertex(t,e.native)}}_drawCompleteHandler(e){this._completeDrawing(e.native)}};(0,r._)([(0,s.Cb)({dependsOn:["mode"]})],U.prototype,"_clickEnabled",null),(0,r._)([(0,s.Cb)({dependsOn:["mode"]})],U.prototype,"_dragEnabled",null),(0,r._)([(0,s.Cb)({type:M.A})],U.prototype,"mode",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],U.prototype,"vertices",void 0),U=(0,r._)([(0,n.j)("esri.views.draw.PolylineDrawAction")],U);var L=i(48016);let F=class extends g{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._cursorScreenPoint=null,this._viewHandles=new l.Z,this._cursorVertexAdded=!1,this._activePointerId=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand",this.vertices=[]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{if(e.stopPropagation(),e.mapPoint&&!this._panEnabled){const t=this.getCoordsFromScreenPoint((0,h.vT)(e));(0,a.pC)(t)&&(this._set("vertices",[t]),this._drawCompleteHandler(e))}}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._panEnabled||(this._cursorScreenPoint=(0,h.vT)(e),this._set("vertices",[]),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._cursorUpdateHandler(e)))}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._cursorScreenPoint=(0,h.vT)(e),(0,a.Wi)(this._activePointerId)&&"touch"!==e.pointerType&&0===this.vertices.length&&this._cursorUpdateHandler(e)}),c.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._isDragging=!0,this._cursorScreenPoint=(0,h.vT)(e),this._cursorUpdateHandler(e))}),c.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._activePointerId=null,this._popCursorVertex(),this._isDragging&&!this._panEnabled&&(this._vertexAddHandler(e),this._drawCompleteHandler(e)),this._isDragging=!1)}),c.f.TOOL),this.view.on("key-down",(e=>{e.key===b&&this._cursorScreenPoint?this._drawCompleteHandler(e):e.key===T&&(this._panEnabled=!0)}),c.f.TOOL),this.view.on("key-up",(e=>{e.key===T&&(this._panEnabled=!1)}),c.f.TOOL),this.view.on("drag",(e=>{(0,a.pC)(this._activePointerId)&&e.stopPropagation()}),c.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),c.f.TOOL)]}_getClickModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation()}),c.f.TOOL),this.view.on("pointer-down",(e=>{this._cursorScreenPoint=(0,h.vT)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._cursorUpdateHandler(e)}),c.f.TOOL),this.view.on("pointer-move",(e=>{this._cursorScreenPoint=(0,h.vT)(e),(0,a.Wi)(this._activePointerId)&&"touch"!==e.pointerType&&this._cursorUpdateHandler(e)}),c.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._isDragging=!0)}),c.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._activePointerId=null,this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),c.f.TOOL),this.view.on("key-down",(e=>{e.key===C&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===b&&this._cursorScreenPoint&&2===this.vertices.length&&this._drawCompleteHandler(e)}),c.f.TOOL)]}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new D({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new m(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new y(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new w(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){(0,a.pC)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){if(this._popCursorVertex(),this.isDuplicateVertex(this.vertices,e))return;this.vertices.push(e),1===this.vertices.length&&(this.viewAlignedCoordinateSystem=(0,L.Gn)(this.view,this.vertices[0]));const i=this.vertices.indexOf(e),r=new m(this.view,t,i,this.vertices);this.emit("vertex-add",r)}_updateCursor(e,t){let i=null;(0,a.pC)(e)&&(i=this._pushCursorVertex(e));const r=new y(this.view,t,i,this.vertices);this.emit("cursor-update",r)}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._isDragging=!1,this._cursorScreenPoint=null,this.vertices.length<1)return;const t=new w(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_pushCursorVertex(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1}_popCursorVertex(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,a.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,a.pC)(t)&&this._addVertex(t,e.native)}_cursorUpdateHandler(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);this._updateCursor(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};(0,r._)([(0,s.Cb)({type:["freehand","click"]})],F.prototype,"mode",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],F.prototype,"vertices",void 0),F=(0,r._)([(0,n.j)("esri/views/2d/engine/markup/SegmentDrawAction")],F);let k=class extends o.default{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i={view:this.view,...t};switch(e){case"point":this.activeAction=new I(i);break;case"polygon":this.activeAction=new R(i);break;case"polyline":this.activeAction=new U(i);break;case"multipoint":this.activeAction=new O(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":this.activeAction=new F(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,r._)([(0,s.Cb)()],k.prototype,"activeAction",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],k.prototype,"type",void 0),(0,r._)([(0,s.Cb)()],k.prototype,"view",void 0),k=(0,r._)([(0,n.j)("esri.views.draw.Draw")],k);const Z=k},636:(e,t,i)=>{"use strict";i.d(t,{n:()=>s,A:()=>r});const r=["freehand","hybrid","click"],s="click"},48016:(e,t,i)=>{"use strict";i.d(t,{y:()=>D,n_:()=>I,Nv:()=>V,p:()=>H,DF:()=>E,MC:()=>z,yL:()=>A,Gn:()=>T,Q8:()=>b});var r=i(82550),s=i(59472),n=i(19677),o=i(27780),a=i(61106),l=i(3470),c=i(92232),h=i(53817),d=i(93833),p=(i(36348),i(77625)),u=i(17387),v=i(93533),f=i(32232),g=i(7646),m=i(2847),_=i(70642),x=i(42738),y=i(75384);function w(e,t,i=null){return(0,s.pC)(i)?[e,t,i]:[e,t]}function b(e,t,i=null){return(0,s.pC)(i)?{x:e,y:t,z:i}:{x:e,y:t}}class P{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e)))}get doUnnormalization(){return!1}}class S extends P{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=(0,y.c)(),this.transformInv=(0,y.c)(),this.transform=(0,y.a)(e),(0,x.a)(this.transformInv,this.transform)}makeMapPoint(e,t){return w(e,t,this.defaultZ)}mapToLocal(e){return b(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return w(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class C extends P{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,p.c)(),this.tangentFrameUpWS=(0,p.c)(),this.tangentFrameRightWS=(0,p.c)(),this.tangentFrameForwardWS=(0,p.c)(),this.localFrameRightWS=(0,p.c)(),this.localFrameUpWS=(0,p.c)(),this.worldToLocalTransform=(0,f.a)(),this.localToWorldTransform=(0,f.a)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const r=(0,p.c)();(0,u.a)(r,this.tangentFrameForwardWS,(0,u.d)(i,this.tangentFrameForwardWS)),(0,u.f)(this.localFrameRightWS,i,r),(0,u.n)(this.localFrameRightWS,this.localFrameRightWS),(0,u.c)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,m.r)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,m.i)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return w(e,t,this.defaultZ)}mapToLocal(e){const t=(0,p.c)();this.view.renderCoordsHelper.toRenderCoords(new a.Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,u.q)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return b(i.x/this.scale,i.y/this.scale)}localToMap(e){const t=(0,p.c)();this.view.renderCoordsHelper.toRenderCoords(new a.Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,u.q)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return w(i.x,i.y,this.defaultZ)}}function T(e,t){if("2d"===e.type)return new S(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new a.Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new a.Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new C(e,i)}return null}function O(e,t){const i=new a.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function V(e,t){return new l.Z({points:e,spatialReference:t})}function E(e,t,i){const r=new d.Z({paths:e,spatialReference:t});return i&&(0,c.nc)(r),r}function H(e,t,i,s=!0){const a=(0,r.d9)(e);a.forEach((e=>{const t=e[0],i=e[e.length-1];(0,n.fS)(t,i)&&1!==e.length||e.push(e[0])}));let l=new h.Z({rings:a,spatialReference:t});return l.rings.forEach((e=>{(0,c.bu)(e,!1,!1)||e.reverse()})),i&&(0,c.nc)(l),s&&l.isSelfIntersecting&&(0,o.JY)(t)&&(l=(0,_.simplify)(l)),l}function A(e,t,i){const r=t.mapToLocalMultiple(e),s=[],n={x:r[0].x,y:r[0].y},o=r[1].x,a=r[1].y,l=Math.round(o-n.x),c=Math.round(a-n.y),h=Math.max(Math.abs(l),Math.abs(c));if(i){const e={x:n.x+h,y:n.y+h},t={x:n.x-h,y:n.y-h};s.push(b(e.x,t.y),b(t.x,t.y),b(t.x,e.y),b(e.x,e.y))}else{const e={x:l>0?n.x+h:n.x-h,y:c>0?n.y+h:n.y-h};s.push(b(n.x,n.y),b(e.x,n.y),b(e.x,e.y),b(n.x,e.y))}return H([s.map((e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function z(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[b(t.x-e,t.y+e),b(t.x+e,t.y-e),b(t.x+e,t.y-e),b(t.x-e,t.y+e)]}const s=[],n={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y};if(i){const e=Math.round(o.x-n.x),t=Math.round(o.y-n.y);s.push(b(n.x-e,n.y-t),b(o.x,n.y-t),b(o.x,o.y),b(n.x-e,o.y))}else s.push(b(n.x,n.y),b(o.x,n.y),b(o.x,o.y),b(n.x,o.y));return H([s.map((e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function D(e,t,i,r){const s=t.mapToLocalMultiple(e);let n=null,a=null;if(i)n=s[0],a=s[1];else{const e=s[0],t=s[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(r));n=b(i>0?e.x+o/2:e.x-o/2,r>0?e.y+o/2:e.y-o/2),a=b(Math.abs(i)>Math.abs(r)?n.x-o/2:n.x,Math.abs(i)>Math.abs(r)?n.y:n.y-o/2)}const l=t.localToMap(n),h=t.localToMap(a);t.doUnnormalization&&(0,c.Sq)([[l,h]],t.spatialReference);const d=O(l,t.spatialReference),p=O(h,t.spatialReference),u=(0,v.c9)(t.spatialReference);let f=0;if((0,o.JY)(t.spatialReference))f=u*(0,_.distance)(d,p,null);else{const e=n.x-a.x,t=n.y-a.y;f=u*Math.sqrt(e*e+t*t)*(r||1)}const m=new g.Z({center:d,radius:f,radiusUnit:"meters",spatialReference:t.spatialReference});return H(m.rings,m.spatialReference,!1)}function I(e,t,i){const r=t.mapToLocalMultiple(e),s=r[0],n=r[1],o=Math.round(n.x-s.x),a=Math.round(n.y-s.y),l=b(i?s.x:s.x+o/2,i?s.y:s.y+a/2),c=i?o:o/2,h=i?a:a/2,d=[],p=2*Math.PI/60;for(let e=0;e<60;e++){const t=Math.cos(e*p),i=Math.sin(e*p),r=b(c*t+l.x,h*i+l.y);d.push(r)}return d.push(d[0]),H([d.map((e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!1)}},94535:(e,t,i)=>{"use strict";i.d(t,{M:()=>o,e:()=>a});var r=i(2992),s=i(46539),n=i(16853);const o={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class a extends s.a{constructor(e=o.maximumClickDelay,t=o.movementUntilMouseDrag,i=o.movementUntilPenDrag,s=o.movementUntilTouchDrag,n=o.holdDelay,a=r.Z){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}_createPointerDragData(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,r=this._pointerState.get(i);r&&(r.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",r,t),void 0,r.modifiers):(0,n.WI)(t,r.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),r.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}}startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((r=>{null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",r,t)):this._pointerDrag.emit(this._createPointerDragData("start",r,r.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,"pointer-up"===t?i:s.previousEvent),void 0,s.modifiers):"pointer-up"===t&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(r),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}},16853:(e,t,i)=>{"use strict";i.d(t,{WI:()=>n,y_:()=>o,nk:()=>s});var r=i(96071);function s(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function n(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function o(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,r.vW)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,r]=e,[s,n]=[r.x-i.x,r.y-i.y];return t.radius=Math.sqrt(s*s+n*n)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}let i=0,s=0;for(let t=0;t<e.length;t++)i+=e[t].x,s+=e[t].y;i/=e.length,s/=e.length;const n=e.map((e=>e.x-i)),o=e.map((e=>e.y-s));let a=0,l=0,c=0,h=0,d=0,p=0,u=0;for(let e=0;e<n.length;e++){const t=n[e],i=o[e],r=t*t,s=i*i;a+=r,l+=s,c+=t*i,h+=r*t,d+=s*i,p+=t*s,u+=i*r}const v=.5*(h+p),f=.5*(d+u),g=a*l-c*c,m=(v*l-f*c)/g,_=(a*f-c*v)/g,x=(0,r.vW)(m+i,_+s);return{radius:Math.sqrt(m*m+_*_+(a+l)/e.length),center:x}}},74239:(e,t,i)=>{"use strict";i.d(t,{c:()=>u});var r=i(56140),s=i(79881),n=i(87566),o=i(58385),a=i(78745);let l=class extends o.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,s.Cb)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.snapping.Settings.LineSnapperDefaults")],l);let c=class extends o.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,s.Cb)({type:Boolean})],c.prototype,"enabled",void 0),c=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.snapping.Settings.ParallelLineSnapperDefaults")],c);let h=class extends o.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,s.Cb)({type:Boolean})],h.prototype,"enabled",void 0),h=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.snapping.Settings.RightAngleSnapperDefaults")],h);let d=class extends o.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,s.Cb)({type:Boolean})],d.prototype,"enabled",void 0),d=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.snapping.Settings.RightAngleTriangleSnapperDefaults")],d);let p=class extends o.wq{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new c,this.rightAngleSnapper=new h,this.rightAngleTriangleSnapper=new d,this.shortLineThreshold=15,this.lineProximityThreshold=5,this.circleProximityThreshold=5,this.pointProximityThreshold=5,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new a.default([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,r._)([(0,s.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],p.prototype,"lineSnapper",void 0),(0,r._)([(0,s.Cb)({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],p.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,s.Cb)({type:h,constructOnly:!0,nonNullable:!0,json:{write:!0}})],p.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,s.Cb)({type:d,constructOnly:!0,nonNullable:!0,json:{write:!0}})],p.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],p.prototype,"shortLineThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],p.prototype,"lineProximityThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],p.prototype,"circleProximityThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:1,max:50,step:1},json:{write:!0}})],p.prototype,"pointProximityThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],p.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],p.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],p.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],p.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,s.Cb)({type:a.default,nonNullable:!0})],p.prototype,"orange",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],p.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],p.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],p.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],p.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],p.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],p.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],p.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],p.prototype,"rightAngleHintOutlineSize",void 0),p=(0,r._)([(0,n.j)("esri.views.3d.interactive.editingTools.snapping.Settings.Defaults")],p);const u=new p},87008:(e,t,i)=>{"use strict";i.d(t,{L:()=>o,N:()=>a});var r=i(59472),s=i(74239),n=i(7344);class o{constructor({proximityThreshold:e,enabled:t=!0,shortLineThreshold:i=s.c.shortLineThreshold}){this.enabled=t,this.squaredShortLineThreshold=i*i;const r=e*s.c.touchSensitivityMultiplier;this._squaredTouchProximityThreshold=r*r,this._squaredMouseProximityTreshold=e*e}snap(e,t){return this.enabled?(0,r.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t):[]}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.left.pos,e.right.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,view:r,geometry:s}){const o=s.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,n.tp)((0,n.a7)(t,o,i,r),(0,n.a7)(e,o,i,r))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}}class a{constructor(e,t,i,r,s=null){this.geometry=e,this.view=t,this.elevationInfo=i,this.pointer=r,this.vertexHandle=s}}},69470:(e,t,i)=>{"use strict";i.d(t,{r:()=>se});var r=i(59472),s=i(5632),n=i(83477),o=i(80621),a=i(55735),l=i(14286),c=i(74239),h=i(7344);function d(e,t){return e[0]*t[1]-e[1]*t[0]}function p(e,t,i){const r=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(r)/(0,l.i)(t,i)}function u(e,t,i,r,s=i){return(0,l.d)(v,r,i),(0,l.d)(f,t,s),function(e,t,i){const r=(0,l.g)(i,t)/(0,l.q)(i);(0,l.a)(e,i,r)}(g,f,v),(0,l.h)(e,s,g)}const v=(0,a.a)(),f=(0,a.a)(),g=(0,a.a)();class m{}class _ extends m{constructor(e,t){super(),this.start=e,this.end=t}objectEqual(e){return e instanceof _&&(0,h.Xv)(this.start,e.start)&&(0,h.Xv)(this.end,e.end)}}class x extends _{constructor(e,t){super(e,t),this.dir=(0,a.a)(),this.p=(0,a.a)()}objectEqual(e){return e instanceof x&&super.objectEqual(e)}check(e){return(0,l.d)(this.dir,this.end,this.start),(0,l.d)(this.p,e,this.start),(0,l.g)(this.dir,this.p)>=0&&p(e,this.start,this.end)<c.c.pointOnLineThreshold}}class y extends _{constructor(e,t){super(e,t)}objectEqual(e){return e instanceof y&&super.objectEqual(e)}check(e){return p(e,this.start,this.end)<c.c.pointOnLineThreshold}}class w extends m{constructor(e,t){super(),this.left=e,this.right=t}objectEqual(e){return e instanceof w&&this.left.objectEqual(e.left)&&this.right.objectEqual(e.right)}check(){return!1}}class b extends m{constructor(e,t){super(),this.point1=e,this.point2=t}objectEqual(e){return e instanceof b&&(0,h.Xv)(this.point1,e.point1)&&(0,h.Xv)(this.point2,e.point2)}check(){return!1}}var P=i(78745),S=i(84845);class C{constructor(e,t,i){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i}visualize(e,t,i){return(0,s.AL)([this.visualizeTargetHints(e,t,i),this.visualizeReferenceHints(e,t,i)])}}class T extends C{constructor(e,t,i,r){super(e,t,new w(i.constraint,r.constraint)),this.left=i,this.right=r}visualizeTargetHints(e,t,i){return(0,s.AL)([this.left.visualize(e,t,i),this.right.visualize(e,t,i)])}visualizeReferenceHints(e,t,i){return(0,s.ed)(new S.L({view:e,primitive:"circle",geometry:this.coordinateHelper.createPoint(i),elevationInfo:t,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:P.default.toUnitRGBA(c.c.orange),pixelSnappingEnabled:!1}))}}var O=i(87008),V=i(33655);class E extends C{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:r}){super(e,r,new y(t,i))}visualizeReferenceHints(e,t){return(0,s.ed)((0,h.jX)(3,this.lineStart(),this.lineEnd(),this.coordinateHelper,t,e))}visualizeTargetHints(e,t,i){return(0,s.ed)((0,h.jX)(0,this.lineEndClosestToTarget(),i,this.coordinateHelper,t,e))}lineEndClosestToTarget(){const e=this.lineStart(),t=this.lineEnd();return(0,V.Xx)((0,l.g)((0,l.d)(A,t,e),(0,l.d)(H,this.targetPoint,e)))>0?t:e}lineStart(){return this.constraint.start}lineEnd(){return this.constraint.end}}const H=(0,a.a)(),A=(0,a.a)();class z extends O.L{constructor({enabled:e=c.c.lineSnapper.enabled,proximityThreshold:t=c.c.lineProximityThreshold,shortLineThreshold:i=c.c.shortLineThreshold}={}){super({enabled:e,proximityThreshold:t,shortLineThreshold:i})}snapNewVertex(e,t){const i=t.geometry.data.components[0],r=i.edges.length,s=[];if(r<1)return s;const n=t.geometry.data.coordinateHelper,o=n.fromPoint(e),a=(0,h.a7)(o,n,t.elevationInfo,t.view),l=i.edges[r-1];let c=l;do{this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.left.pos,c.right.pos,e,a,t,s),c=c.left.left}while(c&&c!==l);return s}snapExistingVertex(e,t){const i=[],s=(0,r.Wg)(t.vertexHandle),n=s.component;if(n.edges.length<2)return i;const o=t.geometry.data.coordinateHelper,a=o.fromPoint(e),l=(0,h.a7)(a,o,t.elevationInfo,t.view),c=s.left,d=s.right;c&&d&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal(c.left.pos,d.right.pos,e,l,t,i);const p=n.edges[0];let u=p;do{u!==s.left&&u!==s.right&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(u.left.pos,u.right.pos,e,l,t,i),u=u.right.right}while(u&&u!==p);return i}_processCandidateProposal(e,t,i,r,s,n){const o=u((0,a.a)(),(0,a.f)(i.x,i.y),e,t),l=s.geometry.data.coordinateHelper,c=l.fromXYZ(o,i.hasZ?i.z:0);(0,h.tp)(r,(0,h.a7)(c,l,s.elevationInfo,s.view))<this.squaredProximityTreshold(s.pointer)&&n.push(new E({coordinateHelper:s.geometry.data.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:c}))}}var D=i(17387),I=i(96071),M=i(77625),R=i(59691),U=i(12811),L=i(34353),F=i(39746),k=i(68500),Z=i(43965),j=i(57511),W=i(70189),q=i(71702);class G extends q._{constructor(e){super(e),this._handles=new R.Z,this._location=(0,M.c)(),this._direction=(0,M.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,W.f)(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){(0,D.m)(this._location,e)||((0,D.g)(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){(0,D.m)(this._direction,e)||((0,D.g)(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){(0,D.n)(this._direction,(0,D.f)(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){(0,L.g)(e,this._color)||((0,L.c)(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new j.U(this.materialParameters,"parallelLineVisualElement");this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=new k.Z(F.Z.createPolylineGeometry([(0,M.c)(),(0,M.c)()]),"parallelLineVisualElement"),i=new k.Z(F.Z.createPolylineGeometry([(0,M.c)(),(0,M.c)()]),"parallelLineVisualElement"),s=(0,r.Wg)(this._externalResources).material;e.addGeometry(t,s,U.I),e.addGeometry(i,s,U.I),this.updateVertices(e)}forEachExternalResource(e){(0,r.pC)(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){(0,r.Wi)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;(0,r.Wi)(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,X),(0,D.b)(N,this.location,this.direction),t.projectToScreen(N,B),(0,l.e)(B,(0,l.d)(B,B,X)),this.updateVertexAttributes(t,e,0,X,B,1),this.updateVertexAttributes(t,e,1,X,B,-1)}updateVertexAttributes(e,t,i,r,s,n){const o=t.geometryRecords[i].geometry.data.getVertexAttr()[Z._A.POSITION].data,a=(0,l.a)($,(0,l.s)($,s[1]*n,s[0]*-n),this.offset+this.width/2),c=(0,l.h)(Y,(0,l.h)(Y,(0,l.h)(Y,r,(0,l.a)(Y,s,this.length/2)),a),a),h=(0,l.h)(K,c,(0,l.a)(K,s,-this.length));e.unprojectFromScreen(c,N),o[0]=N[0],o[1]=N[1],o[2]=N[2],e.unprojectFromScreen(h,N),o[3]=N[0],o[4]=N[1],o[5]=N[2],t.geometryVertexAttrsUpdated(i)}}const N=(0,M.c)(),X=(0,I.s1)(),B=(0,I.s1)(),$=(0,I.s1)(),Y=(0,I.s1)(),K=(0,I.s1)();class Q extends C{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:r}){const s=e.clone(i);(0,l.d)(s,(0,l.h)(s,s,t.right.pos),t.left.pos),super(e,r,new y(i,s)),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}visualizeReferenceHints(e,t,i){return(0,s.AL)([...this._referenceLines.map((i=>(0,s.ed)((0,h.IM)(1,i.edge,this.coordinateHelper,t,e,i.fadeLeft,i.fadeRight)))),(0,s.ed)(this.createParallelLineVisualElement(e,t,this.constraint.start,i))])}visualizeTargetHints(e,t,i){return(0,s.AL)([(0,s.ed)((0,h.jX)(0,this.constraint.start,i,this.coordinateHelper,t,e))])}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{e.right.right===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.left.left===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}createParallelLineVisualElement(e,t,i,r){const s=(0,h.$r)(i,this.coordinateHelper,t,e),n=(0,h.$r)(r,this.coordinateHelper,t,e),o=(0,D.e)(n,s,n,.5),a=new G({view:e,attached:!1,offset:c.c.parallelLineHintOffset,length:c.c.parallelLineHintLength,width:c.c.parallelLineHintWidth,color:P.default.toUnitRGBA(c.c.orange),location:o,renderOccluded:16});return a.setDirectionFromPoints(s,o),a.attached=!0,a}}class J extends O.L{constructor({enabled:e=c.c.lineSnapper.enabled,proximityThreshold:t=c.c.lineProximityThreshold,shortLineThreshold:i=c.c.shortLineThreshold}={}){super({enabled:e,proximityThreshold:t,shortLineThreshold:i}),this._tmpProjection=(0,a.a)()}snapNewVertex(e,t){const i=t.geometry.data.components[0],r=i.edges.length,s=i.vertices.length,n=[];if(r<2)return n;const o=t.geometry.data.coordinateHelper.fromPoint(e),a=(0,h.a7)(o,t.geometry.data.coordinateHelper,t.elevationInfo,t.view),l=i.vertices[s-1],c=i.vertices[0],d=i.edges[r-1];let p=d;do{this.edgeExceedsShortLineThreshold(p,t)&&(this._checkEdgeForParalleLines(p,l.pos,e,a,t,n),this._checkEdgeForParalleLines(p,c.pos,e,a,t,n)),p=p.left.left}while(p&&p!==d);return n}snapExistingVertex(e,t){const i=[],s=(0,r.Wg)(t.vertexHandle),n=s.component;if(n.edges.length<3)return i;const o=t.geometry.data.coordinateHelper.fromPoint(e),a=(0,h.a7)(o,t.geometry.data.coordinateHelper,t.elevationInfo,t.view),l=s.left,c=s.right,d=n.vertices[0],p=n.vertices.length,u=n.vertices[p-1],v=n.edges[0];let f=v;do{f!==l&&f!==c&&this.edgeExceedsShortLineThreshold(f,t)&&(l&&this._checkEdgeForParalleLines(f,l.left.pos,e,a,t,i),c&&this._checkEdgeForParalleLines(f,c.right.pos,e,a,t,i),s===d?this._checkEdgeForParalleLines(f,u.pos,e,a,t,i):s===u&&this._checkEdgeForParalleLines(f,d.pos,e,a,t,i)),f=f.right.right}while(f&&f!==v);return i}_checkEdgeForParalleLines(e,t,i,r,s,n){const o=e.left.pos,d=e.right.pos;if(u(this._tmpProjection,t,o,d),(0,l.j)(this._tmpProjection,t)<c.c.parallelLineThreshold)return;u(this._tmpProjection,(0,a.f)(i.x,i.y),o,d,t);const p=s.geometry.data.coordinateHelper,v=p.fromXYZ(this._tmpProjection,i.hasZ?i.z:0);if((0,h.tp)(r,(0,h.a7)(v,p,s.elevationInfo,s.view))<this.squaredProximityTreshold(s.pointer)){if(this.parallelToPreviousCandidate(e,n))return;n.push(new Q({coordinateHelper:p,referenceLine:e,lineStart:t,targetPoint:v}))}}parallelToPreviousCandidate(e,t){const i=e.left.pos,r=e.right.pos;for(const s of t)if(u(this._tmpProjection,r,s.constraint.start,s.constraint.end,i),(0,l.j)(this._tmpProjection,r)<c.c.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}class ee extends C{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:r,centerVertex:s}){super(e,t,i),this._previousVertex=r,this._centerVertex=s}visualizeTargetHints(e,t,i){return(0,s.ed)((0,h.jX)(0,this.constraint.start,i,this.coordinateHelper,t,e))}visualizeReferenceHints(e,t,i){return(0,s.AL)([(0,s.ed)((0,h.jX)(2,this._previousVertex,this.constraint.start,this.coordinateHelper,t,e)),(0,s.ed)((0,h.ey)(this._previousVertex,this._centerVertex,i,this.coordinateHelper,t,e))])}}class te extends O.L{constructor({enabled:e=c.c.lineSnapper.enabled,proximityThreshold:t=c.c.lineProximityThreshold,shortLineThreshold:i=c.c.shortLineThreshold}={}){super({enabled:e,proximityThreshold:t,shortLineThreshold:i}),this._tmp=(0,a.a)()}snapNewVertex(e,t){const i=t.geometry.data.components[0],r=i.vertices.length,s=[];if(r<2)return s;const n=t.geometry.data.coordinateHelper,o=n.fromPoint(e),a=(0,h.a7)(o,t.geometry.data.coordinateHelper,t.elevationInfo,t.view),l=i.vertices[r-1];this._checkForSnappingCandidate(s,l.left,l.pos,n.fromPoint(e),l.left.left.pos,l.pos,t,e,a);const c=i.vertices[0];return this._checkForSnappingCandidate(s,c.right,c.pos,n.fromPoint(e),c.right.right.pos,c.pos,t,e,a),s}snapExistingVertex(e,t){const i=[],s=(0,r.Wg)(t.vertexHandle),n=s.component,o=n.vertices.length;if(o<3)return i;const a=t.geometry.data.coordinateHelper.fromPoint(e),l=(0,h.a7)(a,t.geometry.data.coordinateHelper,t.elevationInfo,t.view),c=s.left,d=s.right,p=n.vertices[0],u=n.vertices[o-1];if(!c)return this._checkForSnappingCandidate(i,p.right.right.right,p.right.right.pos,a,p.right.right.right.right.pos,p.right.right.pos,t,e,l),i;if(!d)return this._checkForSnappingCandidate(i,u.left.left.left,u.left.left.pos,a,u.left.left.left.left.pos,u.left.left.pos,t,e,l),i;if(c&&c.left.left){const r=c.left.left;this._checkForSnappingCandidate(i,r,c.left.pos,a,r.left.pos,c.left.pos,t,e,l)}if(d&&d.right.right){const r=d.right.right;this._checkForSnappingCandidate(i,r,d.right.pos,a,r.right.pos,d.right.pos,t,e,l)}return i}_checkForSnappingCandidate(e,t,i,r,s,n,o,c,d){if(!this.edgeExceedsShortLineThreshold(t,o))return;(0,l.d)(this._tmp,t.right.pos,t.left.pos);const p=(0,a.f)(this._tmp[1],-this._tmp[0]),u=(0,l.g)(p,(0,l.d)(this._tmp,r,i))/(0,l.q)(p),v=o.geometry.data.coordinateHelper,f=v.fromXYZ((0,l.p)((0,a.a)(),n,p,u),c.hasZ?c.z:0);(0,h.tp)(d,(0,h.a7)(f,v,o.elevationInfo,o.view))<this.squaredProximityTreshold(o.pointer)&&e.push(new ee({coordinateHelper:v,targetPoint:f,constraint:new x(n,(0,l.p)(v.createNew(),n,p,(0,V.Xx)(u))),previousVertex:s,centerVertex:n}))}}class ie extends C{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:r}){super(e,t,new b(i,r))}visualizeTargetHints(){return(0,s.ed)(null)}visualizeReferenceHints(e,t,i){return(0,s.AL)([(0,s.ed)((0,h.jX)(2,i,this.constraint.point1,this.coordinateHelper,t,e)),(0,s.ed)((0,h.jX)(2,i,this.constraint.point2,this.coordinateHelper,t,e)),(0,s.ed)((0,h.ey)(this.constraint.point1,i,this.constraint.point2,this.coordinateHelper,t,e))])}}class re extends O.L{constructor({enabled:e=c.c.lineSnapper.enabled,proximityThreshold:t=c.c.lineProximityThreshold,shortLineThreshold:i=c.c.shortLineThreshold}={}){super({enabled:e,proximityThreshold:t,shortLineThreshold:i})}snapNewVertex(e,t){const i=t.geometry.data.components[0],r=[],s=i.vertices.length;if("polygon"!==t.geometry.type||s<2)return r;const n=i.vertices[0],o=i.vertices[s-1];return this._processCandidateProposal(n.pos,o.pos,e,t,r),r}snapExistingVertex(e,t){const i=[],s=(0,r.Wg)(t.vertexHandle),n=s.component;return n.edges.length<2?i:"polyline"!==t.geometry.type||0!==s.index&&s.index!==n.vertices.length-1?(this._processCandidateProposal(s.left.left.pos,s.right.right.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,r,s){if(!this.exceedsShortLineThreshold(e,t,r))return;const n=(0,l.m)((0,a.a)(),e,t,.5),o=.5*(0,l.i)(e,t),c=function(e,t,i,r){(0,l.d)(v,t,i);const s=r/(0,l.l)(v);return(0,l.p)(e,i,v,s)}((0,a.a)(),[i.x,i.y],n,o),d=r.geometry.data.coordinateHelper,p=d.fromXYZ(c,i.hasZ?i.z:0),u=d.fromPoint(i),f=(0,h.a7)(u,d,r.elevationInfo,r.view);(0,h.tp)(f,(0,h.a7)(p,d,r.elevationInfo,r.view))<this.squaredProximityTreshold(r.pointer)&&s.push(new ie({coordinateHelper:d,targetPoint:p,point1:e,point2:t}))}}class se{constructor(e){this._snapper=new n.Z,this._currentSnappingCandidate=null,this._visualElementHandles=(0,s.kB)(),this._optionsHandle=(0,s.kB)(),this._squaredMouseProximityTreshold=c.c.pointProximityThreshold*c.c.pointProximityThreshold,this._squaredTouchProximityThreshold=c.c.pointProximityThreshold*c.c.pointProximityThreshold*c.c.touchSensitivityMultiplier*c.c.touchSensitivityMultiplier,this._snapper.push(new J({enabled:e.effectiveSelfEnabled})),this._snapper.push(new z({enabled:e.effectiveSelfEnabled})),this._snapper.push(new te({enabled:e.effectiveSelfEnabled})),this._snapper.push(new re({enabled:e.effectiveSelfEnabled})),this._optionsHandle=(0,o.watch)(e,"effectiveSelfEnabled",(()=>{for(const t of this._snapper)t.enabled=e.effectiveSelfEnabled;this.doneSnapping()}))}snap(e,t){const i=[];for(const r of this._snapper.items)i.push(...r.snap(e,t));return this._aggregateSnappingCandidates(i,e,t)}destroy(){this.doneSnapping(),this._optionsHandle.remove()}doneSnapping(){this._visualElementHandles.remove(),this._currentSnappingCandidate=null}_aggregateSnappingCandidates(e,t,i){const s=e.length,n=i.geometry.data.coordinateHelper.fromPoint(t);if((0,r.pC)(this._currentSnappingCandidate)){if(this.isCurrentIntersectionConstraintStillActive(e)&&(0,l.i)(n,this._currentSnappingCandidate.targetPoint)<this.squaredPointProximityThreshold(i.pointer))return i.geometry.data.coordinateHelper.createDehydratedPoint(this._currentSnappingCandidate.targetPoint);const t=ne(e,this._currentSnappingCandidate);if(this.doneSnapping(),t>=0){const o=e[t],a=[];if(o.constraint instanceof _){for(let l=0;l<s;++l){if(l===t)continue;const s=e[l];if(s.constraint instanceof _){const e=this._intersectRaysAndLines(o,s,i);if((0,r.pC)(e)){const t=(0,h.tp)((0,h.a7)(n,i.geometry.data.coordinateHelper,i.elevationInfo,i.view),(0,h.a7)(e.targetPoint,i.geometry.data.coordinateHelper,i.elevationInfo,i.view));a.push([e,t])}}}if(a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this.squaredPointProximityThreshold(i.pointer)))return this.updateSnappingCandidate(a[0][0],e,i)}return this.updateSnappingCandidate(o,e,i)}}if(s>0){let t=0,r=(0,l.i)(n,e[0].targetPoint);for(let i=1;i<s;++i){const s=(0,l.i)(n,e[i].targetPoint);s<r&&(r=s,t=i)}return this.updateSnappingCandidate(e[t],e,i)}return t}_intersectRaysAndLines(e,t,i){const r=e.constraint.start,s=e.constraint.end,n=t.constraint.start,o=t.constraint.end,h=(0,l.d)((0,a.a)(),s,r),p=(0,l.d)((0,a.a)(),o,n),u=d(h,p);if(Math.abs(u)<=c.c.intersectionParallelLineThreshold)return null;const v=(0,l.d)((0,a.a)(),r,n),f=d(p,v)/u,g=d(h,v)/u,m=i.geometry.data.coordinateHelper;if(f>=0){if(g>=0||t.constraint instanceof y){const i=m.clone(e.targetPoint);return(0,l.p)(i,r,h,f),new T(m,i,e,t)}}else if(e.constraint instanceof y&&(g>=0||t.constraint instanceof y)){const i=m.clone(e.targetPoint);return(0,l.p)(i,r,h,f),new T(m,i,e,t)}return null}isCurrentIntersectionConstraintStillActive(e){if(this._currentSnappingCandidate instanceof T){const t=this._currentSnappingCandidate.left,i=this._currentSnappingCandidate.right,r=ne(e,t),s=ne(e,i);return r>=0&&s>=0}return!1}updateSnappingCandidate(e,t,i){this._currentSnappingCandidate=e;const r=this._currentSnappingCandidate.targetPoint,n=[e.visualize(i.view,i.elevationInfo,r)];for(const s of t){if(e instanceof T){if(s.constraint.objectEqual(e.left.constraint)||s.constraint.objectEqual(e.right.constraint))continue}else if(s.constraint.objectEqual(e.constraint))continue;s.constraint.check(r)&&n.push(s.visualizeReferenceHints(i.view,i.elevationInfo,r))}return this._visualElementHandles=(0,s.AL)(n),i.geometry.data.coordinateHelper.createDehydratedPoint(r)}squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}}function ne(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.objectEqual(e[r].constraint)){i=r;break}return i}},9434:(e,t,i)=>{"use strict";i.d(t,{g:()=>a});var r=i(56140),s=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(82677));let a=class extends o.default{constructor(){super(...arguments),this.selfEnabled=!1,this.selfEnabledToggled=!1}get effectiveSelfEnabled(){return this.selfEnabledToggled?!this.selfEnabled:this.selfEnabled}};(0,r._)([(0,s.Cb)()],a.prototype,"selfEnabled",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"selfEnabledToggled",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],a.prototype,"effectiveSelfEnabled",null),a=(0,r._)([(0,n.j)("esri.views.interactive.snapping.SnappingOptions")],a)},7344:(e,t,i)=>{"use strict";i.d(t,{$r:()=>u,a7:()=>p,IM:()=>v,jX:()=>f,ey:()=>m,Xv:()=>d,tp:()=>h});i(95830);var r=i(78745),s=i(96071),n=i(77625),o=i(46970),a=i(74239),l=i(44263),c=i(18795);function h(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function d(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function p(e,t,i,r){return u(e,t,i,r,_),r.state.camera.projectToScreen(_,x),(0,s.vW)(x[0],x[1])}function u(e,t,i,r,s=(0,n.c)()){const a=t.toXYZ(e);return a[2]=(0,o.vx)(r,a,t.spatialReference,i),r.renderCoordsHelper.toRenderCoords(a,t.spatialReference,s),s}function v(e,t,i,r,s,n=!0,o=!0){return g(e,s,u(t.left.pos,i,r,s),u(t.right.pos,i,r,s),n,o)}function f(e,t,i,r,s,n){return g(e,n,u(t,r,s,n),u(i,r,s,n))}function g(e,t,i,s,n=!0,o=!0){const c=new l.V({view:t,extensionType:3,start:i,end:s,color:r.default.toUnitRGBA(a.c.orange),renderOccluded:16});switch(e){case 0:c.width=a.c.lineHintWidthTarget,c.fadedExtensions={start:0,end:a.c.lineHintFadedExtensions};break;case 3:c.width=a.c.lineHintWidthReference,c.fadedExtensions={start:0,end:0};break;case 1:case 2:c.width=a.c.lineHintWidthReference,c.fadedExtensions={start:n?a.c.lineHintFadedExtensions:0,end:o?a.c.lineHintFadedExtensions:0}}return c.attached=!0,c}function m(e,t,i,s,n,o){return new c.R({view:o,attached:!0,color:r.default.toUnitRGBA(a.c.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:r.default.toUnitRGBA(a.c.orange),outlineSize:a.c.rightAngleHintOutlineSize,size:a.c.rightAngleHintSize,geometry:{previous:u(e,s,n,o),center:u(t,s,n,o),next:u(i,s,n,o)}})}const _=(0,n.c)(),x=(0,s.s1)()}}]);
//# sourceMappingURL=7551.js.map