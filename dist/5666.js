(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[5666],{64345:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(59472);const s=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete((0,n.j0)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},23672:(e,t,i)=>{"use strict";i.d(t,{f:()=>be,t:()=>Ce});var n=i(56140),s=(i(95830),i(36544)),o=(i(68055),i(79881)),r=i(87566),a=(i(10923),i(57002),i(86035),i(74386)),l=i(80621),d=i(77827),u=i(82677),c=i(83477),h=i(45671),p=(i(38836),i(79618));let g=class extends u.default{constructor(){super(...arguments),this.items=new c.Z,this._watchUpdatingTracking=new h.t,this._callbacks=new Map,this._projector=(0,p.E)(),this._hiddenProjector=(0,p.E)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n=null;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const e=n.domNode.getBoundingClientRect();o.left=e.left,o.top=e.top,o.right=e.right,o.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return o}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"surface",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"items",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["items.length"]})],g.prototype,"needsRender",null),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"_watchUpdatingTracking",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],g.prototype,"updating",void 0),g=(0,n._)([(0,r.j)("esri.views.overlay.ViewOverlay")],g);const _=g;var v=i(51894),m=i(60263),f=i(87765),y=i(10180),w=i(61398),b=(i(89771),i(59691)),C=i(69065),M=i(40450),k=i(24258),E=i(9200),F=i(90846),P=i(52243),A=i(19401),I=i(90806),O=i(22020),x=i(22292),T=i(39105),S=i(35470);let N=class extends S.Z.EventedAccessor{constructor(...e){super(...e),this._anchorHandles=new b.Z,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([(0,l.watch)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),(0,l.watch)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",n=(0,l.pausable)(t,i,(()=>this._viewpointChange()));this._anchorHandles.add(n,e),this._viewpointHandle=n,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,n=this.get("view.ready"),s=i&&e&&n?t.toScreen(e):null;this._set("screenLocation",s)}};(0,n._)([(0,o.Cb)()],N.prototype,"location",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],N.prototype,"screenLocation",void 0),(0,n._)([(0,o.Cb)()],N.prototype,"screenLocationEnabled",void 0),(0,n._)([(0,o.Cb)()],N.prototype,"view",void 0),N=(0,n._)([(0,r.j)("esri.widgets.support.AnchorElementViewModel")],N);const B=N;let L=class extends B{constructor(e){super(e),this.visible=!1}};(0,n._)([(0,o.Cb)()],L.prototype,"visible",void 0),L=(0,n._)([(0,r.j)("esri.widgets.CompassViewModel")],L);const H=L;let V=class extends I.default{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new H,this.visible=!1}initialize(){this.own([(0,l.watch)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,n={"esri-spinner--start":e&&i,"esri-spinner--finish":!e&&i},s=this._getPositionStyles();return(0,A.j)("div",{class:this.classes("esri-spinner",n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,T.after)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||!e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,n._)([(0,v.B)("viewModel.location")],V.prototype,"location",void 0),(0,n._)([(0,v.B)("viewModel.view")],V.prototype,"view",void 0),(0,n._)([(0,o.Cb)({type:H}),(0,F.G)(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],V.prototype,"viewModel",void 0),(0,n._)([(0,v.B)("viewModel.visible")],V.prototype,"visible",void 0),V=(0,n._)([(0,r.j)("esri.widgets.Spinner")],V);const j=V;var R=i(59472),D=i(32656),z=i(41241),G=i(61106),U=(i(36348),i(89350)),W=i(73186),Z=i(59359),K=i(56700),$=i(69948),q=i(45598),Y=i(69829);const X=new W.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),J=new W.Z({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"});var Q=i(4338);const ee=c.Z.ofType({key:"type",defaultKeyValue:"button",base:U.Z,typeMap:{button:W.Z,toggle:Z.Z}}),te=s.Z.getLogger("esri.widgets.Popup.PopupViewModel");let ie=class extends((0,Q._)(B)){constructor(e){super(e),this._handles=new b.Z,this._pendingPromises=new Set,this._zoomToLocation=null,this._fetchFeaturesController=null,this.actions=new ee([X.clone()]),this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.content=null,this.featureViewModels=[],this.highlightEnabled=!0,this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4}initialize(){this._handles.add([(0,l.init)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),(0,l.watch)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),(0,l.watch)(this,"view.animation.state",(e=>this._animationStateChange(e))),(0,l.watch)(this,"location",(e=>this._locationChange(e))),(0,l.watch)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),this.on("trigger-action",(e=>function(e){const{event:t,view:i}=e,{action:n}=t,s=i&&i.popup;if(!n)return(0,T.reject)(new D.Z("trigger-action:missing-arguments","Event has no action"));if(!s)return(0,T.reject)(new D.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:o,id:r}=n;if(!r)return(0,T.reject)(new D.Z("trigger-action:invalid-action","action.id is missing"));if(o)return(0,T.reject)(new D.Z("trigger-action:invalid-action","Action is disabled"));if(r===X.id)return s.viewModel.zoomToLocation();if(r===J.id){s.close();const{selectedFeature:e}=s;if(!e)return(0,T.reject)(new D.Z(`trigger-action:${J.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),(0,T.resolve)()}return(0,T.resolve)()}({event:e,view:this.view}))),(0,l.whenFalse)(this,"waitingForResult",(()=>this._waitingForResultChange())),(0,l.watch)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new ee;e.removeAll();const t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),i=t&&t.actions,n=t&&t.overwriteActions?i:i?i.concat(this.actions):this.actions;return n&&n.filter(Boolean).forEach((t=>e.add(t))),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&t.length;o&&i&&-1===s?this.selectedFeatureIndex=0:o&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,z.$)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e),e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=this._getSelectedTarget();if(!t){const i=new D.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return te.error(i),(0,T.reject)(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new D.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return te.error(t),(0,T.reject)(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}zoomToLocation(){const{location:e,selectedFeature:t,view:i,zoomFactor:n}=this,s=this._getSelectedTarget();if(!s){const e=new D.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});return te.error(e),(0,T.reject)(e)}const o=i.scale/n,r=this.get("selectedFeature.geometry")||e,a=r&&"point"===r.type&&this._isZoomScreenSize(t);X.active=!0,X.disabled=!0;const l=this.callGoTo({target:{target:s,scale:a?o:void 0}}).catch((()=>{X.active=!1,X.disabled=!1,this._zoomToLocation=null})).then((()=>{a&&(this.location=r)}));return this._zoomToLocation=l,l}_animationStateChange(e){this._zoomToLocation||(X.disabled="waiting-for-target"===e)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=(0,R.Wg)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,n=(0,T.resolve)(t),s=i.map((e=>e.promise));this.promises=[n,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{features:e,featureViewModels:t}=this;if(this._destroyFeatureVMs(),!e||!e.length)return;const i=t.slice(0),n=[];e.forEach(((e,t)=>{if(!e)return;let s=null;if(i.some(((t,n)=>(t&&t.graphic===e&&(s=t,i.splice(n,1)),!!s))),s)n[t]=s;else{var o,r;const i=new q.Z({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,graphic:e,spatialReference:null==(o=this.view)?void 0:o.spatialReference,map:null==(r=this.view)?void 0:r.map});n[t]=i}})),i.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_getSelectedTarget(){const{selectedFeature:e,location:t,view:i}=this;return i?"3d"===i.type?e||t:this.get("selectedFeature.geometry")||t:null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),$.f.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=(0,T.createAbortController)(),{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:o}=e,r=[(0,T.resolve)(t),...s.map((e=>e.promise))];return n.popup.open({location:o||i,promises:r}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_isZoomScreenSize(e){const{view:t}=this;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new D.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});te.error(t)})),t}return!0}_getPointFromGeometry(e){return(0,R.Wi)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;const{layer:o}=t;if(!(o&&o instanceof K.Z))return;const r=this._getLayerView(n,o);this._highlightPromise=r;const a=await r;if(!(a&&(0,Y.tl)(a)&&this._highlightPromise===r&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l="objectIdField"in o&&o.objectIdField,d=t.attributes,u=d&&l&&d[l],c=a.highlight(u||t);this._handles.add(c,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};(0,n._)([(0,o.Cb)({type:ee})],ie.prototype,"actions",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["visible","waitingForResult"]})],ie.prototype,"active",null),(0,n._)([(0,o.Cb)({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],ie.prototype,"allActions",null),(0,n._)([(0,o.Cb)({type:Boolean})],ie.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"content",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["features"]})],ie.prototype,"featureCount",null),(0,n._)([(0,o.Cb)()],ie.prototype,"features",null),(0,n._)([(0,o.Cb)({readOnly:!0})],ie.prototype,"featureViewModels",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"highlightEnabled",void 0),(0,n._)([(0,o.Cb)({type:G.Z})],ie.prototype,"location",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["promises"]})],ie.prototype,"pendingPromisesCount",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],ie.prototype,"waitingForResult",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["promises"]})],ie.prototype,"promiseCount",null),(0,n._)([(0,o.Cb)()],ie.prototype,"promises",null),(0,n._)([(0,o.Cb)({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],ie.prototype,"selectedFeature",null),(0,n._)([(0,o.Cb)({value:-1})],ie.prototype,"selectedFeatureIndex",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["featureViewModels","selectedFeatureIndex"]})],ie.prototype,"selectedFeatureViewModel",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["view.ready"]})],ie.prototype,"state",null),(0,n._)([(0,o.Cb)()],ie.prototype,"title",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"view",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"visible",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"zoomFactor",void 0),(0,n._)([(0,o.Cb)()],ie.prototype,"centerAtLocation",null),(0,n._)([(0,o.Cb)()],ie.prototype,"zoomToLocation",null),ie=(0,n._)([(0,r.j)("esri.widgets.Popup.PopupViewModel")],ie);const ne=ie,se="esri-icon-left-triangle-arrow",oe="esri-icon-right-triangle-arrow",re="esri-icon-loading-indicator",ae="esri-rotating",le="esri-popup--shadow",de="esri-popup__header-container",ue="esri-popup__button",ce="esri-popup__icon",he={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function pe(e,t){return void 0===t?`esri-popup__${e}`:`esri-popup__${e}-${t}`}const ge=s.Z.getLogger("esri.widgets.Popup"),_e={closeButton:!0,featureNavigation:!0};let ve=class extends((0,O.q)(I.default)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new b.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._displaySpinnerThrottled=(0,C.P)((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new ne,this.visible=null,this.visibleElements={..._e},this._addSelectedFeatureIndexHandle(),this.own([(0,l.watch)(this,"viewModel.screenLocation",(()=>this._positionContainer())),(0,l.watch)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),(0,l.watch)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),(0,l.watch)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),(0,l.watch)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),(0,l.watch)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,l.watch)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),(0,l.watch)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),(0,l.watch)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,l.watch)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),(0,l.watch)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),(0,l.whenFalse)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),(0,l.on)(this,"viewModel.allActions","change",(()=>this._watchActions())),(0,l.init)(this,"viewModel.allActions",(()=>this._watchActions()))])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,n,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(n=i.viewModel)?void 0:n.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||he}set dockOptions(e){const t={...he},i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},o={...t.breakpoint,...n},{breakpoint:r}=s;!0===r?s.breakpoint=o:"object"==typeof r&&(s.breakpoint={...o,...r}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}set featureNavigationEnabled(e){(0,f.Mr)(ge,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements={...this.visibleElements,featureNavigation:e}}get selectedFeatureWidget(){const{_feature:e,visibleElements:t}=this,{selectedFeatureViewModel:i}=this.viewModel,n={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=n):this._feature=new x.default({viewModel:i,visibleElements:n}),this._feature):null}castVisibleElements(e){return{..._e,...e}}blur(){const{active:e}=this.viewModel;e||ge.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||ge.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove("selected-index");const n=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:n};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,n;const{actionsMenuOpen:s,dockEnabled:o,featureMenuVisible:r,dividedActions:a,currentAlignment:l,currentDockPosition:d}=this,{active:u}=this.viewModel,{menuActions:c}=a,h=u&&c.length>1&&s,p=u&&o,g=u&&!o,_=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,v=null==(i=this.selectedFeature)||null==(n=i.layer)?void 0:n.id,m={"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":p,[le]:g,"esri-popup--is-docked-top-left":"top-left"===d,"esri-popup--is-docked-top-center":"top-center"===d,"esri-popup--is-docked-top-right":"top-right"===d,"esri-popup--is-docked-bottom-left":"bottom-left"===d,"esri-popup--is-docked-bottom-center":"bottom-center"===d,"esri-popup--is-docked-bottom-right":"bottom-right"===d,"esri-popup--feature-menu-open":r,"esri-popup--actions-menu-open":h};return(0,A.j)("div",{class:this.classes("esri-popup",m),role:"presentation","data-layer-title":_,"data-layer-id":v,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},u?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,A.j)("span",{"aria-hidden":"true",class:this.classes(ce,re,ae)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?(0,A.j)("div",{key:pe("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=(0,M.dZ)(),t={[oe]:e,"esri-popup__pagination-previous-icon--rtl":e,[se]:!e,"esri-popup__pagination-previous-icon":!e};return(0,A.j)("span",{"aria-hidden":"true",class:this.classes(ce,t)})}renderPreviousButton(){const{messages:e}=this;return(0,A.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ue,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=(0,M.dZ)(),t={[se]:e,"esri-popup__pagination-next-icon--rtl":e,[oe]:!e,"esri-popup__pagination-next-icon":!e};return(0,A.j)("span",{"aria-hidden":"true",class:this.classes(ce,t)})}renderNextButton(){const{messages:e}=this;return(0,A.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ue,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return(0,A.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ue,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e,"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={"esri-icon-minimize":e,"esri-popup__icon--dock-icon":!e,"esri-icon-dock-right":!e&&("top-right"===t||"bottom-right"===t),"esri-icon-dock-left":!e&&("top-left"===t||"bottom-left"===t),"esri-icon-maximize":!e&&"top-center"===t,"esri-icon-dock-bottom":!e&&"bottom-center"===t};return(0,A.j)("span",{"aria-hidden":"true",class:this.classes(i,ce)})}renderDockButton(){var e,t,i;const{dockEnabled:n,messages:s}=this,o=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,r=n?s.undock:s.dock;return"xsmall"!==o&&null!=(i=this.dockOptions)&&i.buttonEnabled?(0,A.j)("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ue,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={"esri-popup__header-container--button":i},r=(0,A.j)("h2",{class:"esri-popup__header-title",innerHTML:e}),a=i?(0,A.j)("button",{key:`${e}--collapsible`,id:t,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(de,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed},r):(0,A.j)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(de,o)},r);return e?a:null}renderCloseIcon(){return(0,A.j)("span",{"aria-hidden":"true",class:this.classes(ce,"esri-icon-close")})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?(0,A.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ue,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,A.j)("header",{class:"esri-popup__header"},this.renderTitle(),(0,A.j)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:n}=this.viewModel;return t&&!i?(0,A.j)("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:r}=n;return r.length?(0,A.j)("div",{key:pe("actions-menu-button"),class:this.classes(ue,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},(0,A.j)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s,inlineActions:o}=n;return s.length&&i?(0,A.j)("ul",{id:e,role:"menu","aria-labelledby":t,key:pe("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+o.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,n=!!t.length;return i||n?(0,A.j)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,A.j)("section",{key:pe("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:n}=t,s=!!i.length,o={"esri-popup__footer--has-pagination":e,"esri-popup__footer--has-actions":s,"esri-popup__footer--has-actions-menu":!!n.length};return e||s?(0,A.j)("div",{key:pe("feature-buttons"),class:this.classes("esri-popup__footer",o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t}=this.viewModel,i=(0,w.n)(e.selectedFeatures,{total:t.length});return(0,A.j)("section",{key:pe("menu"),class:"esri-popup__feature-menu"},(0,A.j)("h2",{class:"esri-popup__feature-menu-header"},i),(0,A.j)("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu()))}renderPointer(){return this.dockEnabled?null:(0,A.j)("div",{key:pe("pointer"),class:"esri-popup__pointer",role:"presentation"},(0,A.j)("div",{class:this.classes("esri-popup__pointer-direction",le)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:r,contentCollapsed:a,visibleElements:l}=this,{title:d}=this.viewModel,u="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,c="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,h={[le]:e,"esri-popup--is-collapsible":o,"esri-popup--is-collapsed":a};return(0,A.j)("div",{class:this.classes("esri-popup__main-container","esri-widget",h),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":d?n:"","aria-describedby":r&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?(0,A.j)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return(0,A.j)("span",{key:"text",class:"esri-popup__action-text"},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),n={[re]:e.active,[ae]:e.active,[ce]:!!t,"esri-popup__action-image":!e.active&&!!i};return t&&(n[t]=!e.active),(0,A.j)("span",{key:"icon","aria-hidden":"true",class:this.classes(ce,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:n}=e,s=this._getActionTitle(t),o={"esri-popup__action":"toggle"!==t.type,"esri-popup__action-toggle":"toggle"===t.type,"esri-popup__action-toggle--on":"toggle"===t.type&&t.value,"esri-popup__button--disabled":t.disabled},r=[this.renderActionIcon(t),this.renderActionText(s)],a="menu-item"===n?(0,A.j)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(ue,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r):(0,A.j)("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(ue,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,r=e===o,a={"esri-popup__feature-menu-item--selected":r},l=r?(0,A.j)("span",{key:pe(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,d=(0,A.j)("span",{innerHTML:e.title||n.untitled});return(0,A.j)("li",{role:"menuitem",tabIndex:-1,key:pe(`feature-menu-feature-${s}`),class:this.classes(a,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},(0,A.j)("span",{class:"esri-popup__feature-menu-title"},d,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?(0,A.j)("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=null==i?void 0:i.attributes,r="zoom-to-feature"===s?(0,w.n)(e.title,{messages:t}):"remove-selected-feature"===s?(0,w.n)(e.title,{messages:n}):e.title;return r&&o?(0,w.n)(r,o):r}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:n,image:s}=e,o=s||n?n:"esri-icon-default-action";return o&&i?(0,w.n)(o,i):o}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:n}=e;return n&&i?(0,w.n)(n,i):n}_createFeatureUpdatedAnimation(){return(0,M.vU)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add((0,l.watch)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,n=0===t;return{inlineActions:i?e.slice(0):n?new c.Z:e.slice(0,t),menuActions:i?new c.Z:n?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_handleFeatureMenuKeyup(e){"Escape"===(0,y.kK)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===(0,y.kK)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=(0,y.kK)(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const t=(0,y.kK)(e),{_actionsMenuNode:i}=this,n=e.currentTarget["data-action-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleMainKeyup(e){const t=(0,y.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=(0,l.watch)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,"selected-index")}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!n)return!1;const r=o.padding;return"right"===s&&n.x+i/2>o.width-r.right||"left"===s&&n.x-i/2<r.left||"top"===s&&n.y-t<r.top||"bottom"===s&&n.y+t>o.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:r}=s;if(!o||!r||!i)return"top-center";if(!this._isScreenLocationWithinView(o,r))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=n?window.getComputedStyle(n,null):null,d=l?a(l.getPropertyValue("max-height")):0,u=l?a(l.getPropertyValue("height")):0,{height:c,width:h}=i.getBoundingClientRect(),p=h+t,g=Math.max(c,d,u)+t,_=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"right",view:r}),v=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"left",view:r}),m=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"top",view:r}),f=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"bottom",view:r});return v?m?"bottom-right":"top-right":_?m?"bottom-left":"top-left":m?f?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,M.dZ)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,n=(0,M.dZ)()?"top-left":"top-right";if(!i)return n;const s=i.padding||{left:0,right:0,top:0,bottom:0},o=i.width-s.left-s.right,{breakpoints:r}=i;return r&&o<=r.xsmall?"bottom-center":n}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this,r=n/2,a=i.height-t,l=i.width-e,{padding:d}=this.view;return"bottom-center"===s?{top:t+o-d.top,left:e-r-d.left}:"top-left"===s?{bottom:a+o-d.bottom,right:l+o-d.right}:"bottom-left"===s?{top:t+o-d.top,right:l+o-d.right}:"top-right"===s?{bottom:a+o-d.bottom,left:e+o-d.left}:"bottom-right"===s?{top:t+o-d.top,left:e+o-d.left}:"top-center"===s?{bottom:a+o-d.bottom,left:e-r-d.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(!e||!t)return;const s=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:void 0!==o.top?`${o.top}px`:"auto",left:void 0!==o.left?`${o.left}px`:"auto",bottom:void 0!==o.bottom?`${o.bottom}px`:"auto",right:void 0!==o.right?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[o,r]=t,{width:a,height:l}=i;return n<=a&&o>a||n>a&&o<=a||s<=l&&r>l||s>l&&r<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=e[0]-n,o[1]=e[1]-s,r[0]=t[0]-n,r[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(o,r,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportNodeUpdated(e){e&&(e.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const n=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:o,height:r}=s;if(isNaN(o)||isNaN(r))return!1;const a=n.hasOwnProperty("width")&&o<=n.width,l=n.hasOwnProperty("height")&&r<=n.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?(0,w.n)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new j({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["id"]}),(0,F.G)()],ve.prototype,"actionsMenuId",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["id"]}),(0,F.G)()],ve.prototype,"actionsMenuButtonId",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["id"]}),(0,F.G)()],ve.prototype,"featureMenuId",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["id"]}),(0,F.G)()],ve.prototype,"titleId",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["id"]}),(0,F.G)()],ve.prototype,"contentId",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),(0,F.G)()],ve.prototype,"hasContent",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["viewModel.active","viewModel.featureCount","visibleElements.featureNavigation"]}),(0,F.G)()],ve.prototype,"featureNavigationVisible",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),(0,F.G)()],ve.prototype,"collapsible",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen"]}),(0,F.G)()],ve.prototype,"featureMenuVisible",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),(0,F.G)()],ve.prototype,"contentCollapsed",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),(0,F.G)()],ve.prototype,"dividedActions",null),(0,n._)([(0,v.B)("viewModel.actions"),(0,F.G)()],ve.prototype,"actions",void 0),(0,n._)([(0,o.Cb)({dependsOn:["viewModel.active"]}),(0,F.G)()],ve.prototype,"actionsMenuOpen",null),(0,n._)([(0,o.Cb)()],ve.prototype,"alignment",void 0),(0,n._)([(0,v.B)("viewModel.autoCloseEnabled")],ve.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,v.B)("viewModel.autoOpenEnabled")],ve.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,v.B)("viewModel.defaultPopupTemplateEnabled")],ve.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,v.B)("viewModel.content"),(0,F.G)()],ve.prototype,"content",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"collapsed",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"collapseEnabled",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["dockEnabled","alignment","viewModel.active"]}),(0,F.G)()],ve.prototype,"currentAlignment",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","viewModel.active"]}),(0,F.G)()],ve.prototype,"currentDockPosition",null),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"dockOptions",null),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"dockEnabled",void 0),(0,n._)([(0,v.B)("viewModel.featureCount"),(0,F.G)()],ve.prototype,"featureCount",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"featureMenuOpen",void 0),(0,n._)([(0,v.B)("viewModel.features"),(0,F.G)()],ve.prototype,"features",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"featureNavigationEnabled",null),(0,n._)([(0,v.B)("viewModel.goToOverride")],ve.prototype,"goToOverride",void 0),(0,n._)([(0,v.B)("viewModel.highlightEnabled")],ve.prototype,"highlightEnabled",void 0),(0,n._)([(0,v.B)("viewModel.location"),(0,F.G)()],ve.prototype,"location",void 0),(0,n._)([(0,o.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ve.prototype,"label",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"maxInlineActions",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)(),(0,E.H)("esri/widgets/Popup/t9n/Popup")],ve.prototype,"messages",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)(),(0,E.H)("esri/t9n/common")],ve.prototype,"messagesCommon",void 0),(0,n._)([(0,v.B)("viewModel.promises")],ve.prototype,"promises",void 0),(0,n._)([(0,v.B)("viewModel.selectedFeature"),(0,F.G)()],ve.prototype,"selectedFeature",void 0),(0,n._)([(0,v.B)("viewModel.selectedFeatureIndex"),(0,F.G)()],ve.prototype,"selectedFeatureIndex",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["viewModel.selectedFeatureViewModel","visibleElements"]}),(0,F.G)()],ve.prototype,"selectedFeatureWidget",null),(0,n._)([(0,o.Cb)()],ve.prototype,"spinnerEnabled",void 0),(0,n._)([(0,v.B)("viewModel.title"),(0,F.G)()],ve.prototype,"title",void 0),(0,n._)([(0,v.B)("viewModel.updateLocationEnabled")],ve.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,v.B)("viewModel.view")],ve.prototype,"view",void 0),(0,n._)([(0,o.Cb)({type:ne}),(0,F.G)(["viewModel.active","viewModel.view.widthBreakpoint","viewModel.allActions","viewModel.screenLocation","viewModel.screenLocationEnabled","viewModel.state","viewModel.pendingPromisesCount","viewModel.promiseCount","viewModel.waitingForResult"]),(0,P.s)(["triggerAction","trigger-action"])],ve.prototype,"viewModel",void 0),(0,n._)([(0,v.B)("viewModel.visible"),(0,F.G)()],ve.prototype,"visible",void 0),(0,n._)([(0,o.Cb)(),(0,F.G)()],ve.prototype,"visibleElements",void 0),(0,n._)([(0,m.p)("visibleElements")],ve.prototype,"castVisibleElements",null),(0,n._)([(0,k.h)()],ve.prototype,"_close",null),(0,n._)([(0,k.h)()],ve.prototype,"_toggleDockEnabled",null),(0,n._)([(0,k.h)()],ve.prototype,"_toggleFeatureMenu",null),(0,n._)([(0,k.h)()],ve.prototype,"_toggleActionsMenu",null),(0,n._)([(0,k.h)()],ve.prototype,"_triggerAction",null),(0,n._)([(0,k.h)()],ve.prototype,"_selectFeature",null),(0,n._)([(0,k.h)()],ve.prototype,"_next",null),(0,n._)([(0,k.h)()],ve.prototype,"_previous",null),ve=(0,n._)([(0,r.j)("esri.widgets.Popup")],ve);const me=ve,fe=[0,0];function ye(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return fe[0]=i.left+t.pageXOffset,fe[1]=i.top+t.pageYOffset,fe}function we(e){e&&((0,d.cS)(e),e.parentNode&&e.parentNode.removeChild(e))}const be=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:750},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),we(this.root),this._set("root",null),(0,d.YD)(this.userContent,t),we(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",(0,d.YD)(e,t),e.appendChild(t),this._set("userContent",t);const n=document.createElement("div");n.className="esri-view-root",e.insertBefore(n,e.firstChild),this._set("root",n);const s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,n.appendChild(s),this._set("surface",s);const o=new _;n.appendChild(o.surface),this._set("overlay",o),o.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,a.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,l.init)(this,"size",(e=>{const[t,i]=e,n="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?s.classList.add(n):s.classList.remove(n)})),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new me({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const n=this.position;return e-=n[0],t-=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const n=this.position;return e+=n[0],t+=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,l.init)(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),(0,l.init)(this,"popup",((t,i)=>{const n="popup";i&&e.remove(i,n),t&&(t.view=e.view,e.add(t,{key:n,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=750,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=750};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),(0,a.A)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const n=this._position();i.freq=n||t?16:Math.min(750,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const n=this.width,s=this.height;return t===n&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=ye(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return(0,n._)([(0,o.Cb)({value:null,cast:e=>(0,d.L7)(e)})],t.prototype,"container",null),(0,n._)([(0,o.Cb)({readOnly:!0,dependsOn:["surface"]})],t.prototype,"focused",null),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,n._)([(0,o.Cb)({type:me})],t.prototype,"popup",null),(0,n._)([(0,o.Cb)({type:_})],t.prototype,"overlay",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,n._)([(0,o.Cb)({value:null,dependsOn:["width","height"],readOnly:!0})],t.prototype,"size",null),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,n._)([(0,o.Cb)()],t.prototype,"ui",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,n._)([(0,o.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,n._)([(0,r.j)("esri.views.DOMContainer")],t),t};function Ce(e){return e&&"focus"in e}},46539:(e,t,i)=>{"use strict";i.d(t,{a:()=>r});var n=i(36544);class s{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const o=n.Z.getLogger("esri.views.input.InputHandler");class r{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?o.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const o="string"==typeof e?new s(e,n):e,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},d=new a(o,i,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),r(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[o.eventType];return u||(u=[],this._incoming[o.eventType]=u),u.push(d),r(),this._manager&&this._manager.updateDependencies(),d}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new l(e,{onEmit:(e,t,i,n)=>{this._manager.emit(e.eventType,t,i,n)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):o.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class a{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class l{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}},69948:(e,t,i)=>{"use strict";i.d(t,{$:()=>p,f:()=>_});var n=i(56140),s=(i(95830),i(36544)),o=(i(68055),i(79881)),r=i(87566),a=(i(10923),i(57002),i(86035),i(82677)),l=i(64345),d=i(63345),u=i(46539);class c extends u.a{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const h=s.Z.getLogger("esri.views.input.InputManager");let p=class extends a.default{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=d.CK,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=_.INTERNAL){if(this._nameToGroup[e])return void h.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void h.error("Can't register a group of zero handlers");const n={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=n;for(let e=n.handlers.length-1;e>=0;e--){const t=n.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,n,s,o)=>{this._emitInputEvent(t.priorityIndex+1,e,i,n,o,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(n,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):h.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s)for(const t of n.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of n.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)(0,d.wj)(e)||t.add(e)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(n(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(n(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const o=t.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new c((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,_.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],_.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),0===o.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,o){const r=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new g(t,i,r,o||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new l.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),n=t.data&&t.data.eventId;if(null==n||!this._stoppedPropagationEventIds.has(n))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=n&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}}_pausePropagation(e){const t=new l.Z;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};(0,n._)([(0,o.Cb)({readOnly:!0})],p.prototype,"hasPendingInputs",null),(0,n._)([(0,o.Cb)()],p.prototype,"eventSource",void 0),(0,n._)([(0,o.Cb)()],p.prototype,"recognizers",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],p.prototype,"latestPointerType",void 0),p=(0,n._)([(0,r.j)("esri.views.input.InputManager")],p);class g{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const _={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3}},63345:(e,t,i)=>{"use strict";i.d(t,{kK:()=>a,wj:()=>l,CK:()=>o});var n=i(95830),s=i(10180);const o=(0,n.Z)("mac")?"Meta":"Ctrl",r={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)r[e]=String.fromCharCode(e);for(let e=1;e<25;e++)r[111+e]=`F${e}`;for(let e=65;e<91;e++)r[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function a(e){if(void 0!==e.key)return(0,s.kK)(e);const t=r[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function l(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},17519:(e,t,i)=>{"use strict";i.d(t,{a6:()=>d,J1:()=>u,To:()=>l,Iv:()=>r,LF:()=>a});var n=i(59472),s=i(83477),o=i(23672);function r(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,(0,o.t)(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function a(e,t,i){const s=e.activeTool;t!==s&&((0,n.pC)(s)&&s.deactivate&&s.deactivate(),i(t),(0,n.pC)(t)&&t.activate&&t.activate())}function l(){const e=new s.Z;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;r(t,!1),t.destroyed||t.detach()})),e}function d(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function u(e){return(0,n.Wi)(e)?{}:"function"==typeof e?e():e}},2887:(e,t,i)=>{"use strict";i.d(t,{vT:()=>s,Eu:()=>o,s6:()=>r,Rw:()=>a});i(95830);var n=i(96071);function s(e){return(0,n.vW)(e.x,e.y)}function o(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,n.vW)(t.clientX-i.left,t.clientY-i.top)}function r(e,t){return t instanceof Event?o(e,t):s(t)}function a(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}}}]);
//# sourceMappingURL=5666.js.map