(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[7483],{41178:(e,t,i)=>{"use strict";i.d(t,{C:()=>o,b:()=>a});var s=i(85461),n=i(51219),r=i(63230);function a(e){const t=new n.kG;return t.extensions.add("GL_OES_standard_derivatives"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.varyings.add("vUV","vec2"),t.vertex.code.add(s.H`
    void main(void) {
      vUV = uv0;
      gl_Position = proj * view * vec4(position.xyz, 1.0);
    }
  `),t.fragment.uniforms.add("size","vec2").add("color1","vec4").add("color2","vec4"),t.fragment.include(r.Y),t.fragment.code.add(s.H`
    void main() {
      vec2 uvScaled = vUV / (2.0 * size);

      vec2 uv = fract(uvScaled - 0.25);
      vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);
      float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));
      float t = mix(abs(ab.x + ab.y), 0.5, fade);

      gl_FragColor = mix(color2, color1, t);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
  `),t}var o=Object.freeze({__proto__:null,build:a})},27202:(e,t,i)=>{"use strict";function s(e,t,i){const s=t&&t.length,o=s?t[0]*i:e.length;let h=n(e,0,o,i,!0);const l=new Array;if(!h||h.next===h.prev)return l;let d,p,m,g,_;if(s&&(h=function(e,t,i,s){const a=new Array;for(let i=0,r=t.length;i<r;i++){const o=n(e,t[i]*s,i<r-1?t[i+1]*s:e.length,s,!1);o===o.next&&(o.steiner=!0),a.push(c(o))}a.sort(x);for(const e of a)u(e,i),i=r(i,i.next);return i}(e,t,h,i)),e.length>80*i){d=m=e[0],p=g=e[1];for(let t=i;t<o;t+=i){const i=e[t],s=e[t+1];d=Math.min(d,i),p=Math.min(p,s),m=Math.max(m,i),g=Math.max(g,s)}_=Math.max(m-d,g-p),_=0!==_?1/_:0}return a(h,l,i,d,p,_),l}function n(e,t,i,s,n){let r;if(n===v(e,t,i,s)>0)for(let n=t;n<i;n+=s)r=l(n,e[n],e[n+1],r);else for(let n=i-s;n>=t;n-=s)r=l(n,e[n],e[n+1],r);return r&&L(r,r.next)&&(d(r),r=r.next),r}function r(e,t=e){if(!e)return e;let i,s=e;do{if(i=!1,s.steiner||!L(s,s.next)&&0!==g(s.prev,s,s.next))s=s.next;else{if(d(s),s=t=s.prev,s===s.next)break;i=!0}}while(i||s!==t);return t}function a(e,t,i,s,n,l,c=0){if(!e)return;!c&&l&&(e=p(e,s,n,l));let u=e;for(;e.prev!==e.next;){const p=e.prev,m=e.next;if(l?h(e,s,n,l):o(e))t.push(p.index/i),t.push(e.index/i),t.push(m.index/i),d(e),e=m.next,u=m.next;else if((e=m)===u){c?1===c?a(e=w(e,t,i),t,i,s,n,l,2):2===c&&C(e,t,i,s,n,l):a(r(e),t,i,s,n,l,1);break}}}function o(e){const t=e.prev,i=e,s=e.next;if(g(t,i,s)>=0)return!1;let n=e.next.next;const r=n;let a=0;for(;n!==e.prev&&(0===a||n!==r);){if(a++,f(t.x,t.y,i.x,i.y,s.x,s.y,n.x,n.y)&&g(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function h(e,t,i,s){const n=e.prev,r=e,a=e.next;if(g(n,r,a)>=0)return!1;const o=n.x<r.x?n.x<a.x?n.x:a.x:r.x<a.x?r.x:a.x,h=n.y<r.y?n.y<a.y?n.y:a.y:r.y<a.y?r.y:a.y,l=n.x>r.x?n.x>a.x?n.x:a.x:r.x>a.x?r.x:a.x,d=n.y>r.y?n.y>a.y?n.y:a.y:r.y>a.y?r.y:a.y,c=y(o,h,t,i,s),u=y(l,d,t,i,s);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=c&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(e,t,i,s){const n=new M(e,t,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function d(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function u(e,t){if(t=function(e,t){let i=t;const s=e.x,n=e.y;let r,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>a){if(a=e,e===s){if(n===i.y)return i;if(n===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(s===a)return r.prev;const o=r,h=r.x,l=r.y;let d,c=1/0;for(i=r.next;i!==o;)s>=i.x&&i.x>=h&&s!==i.x&&f(n<l?s:a,n,h,l,n<l?a:s,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(s-i.x),(d<c||d===c&&i.x>r.x)&&b(i,e)&&(r=i,c=d)),i=i.next;return r}(e,t)){const i=P(t,e);r(i,i.next)}}function p(e,t,i,s){for(let n;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=y(n.x,n.y,t,i,s)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,p(e,t,i,s);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,i=1;for(;;){let s,n=e;e=null,t=null;let r=0;for(;n;){r++,s=n;let a=0;for(;a<i&&s;a++)s=s.nextZ;let o=i;for(;a>0||o>0&&s;){let i;0===a?(i=s,s=s.nextZ,o--):0!==o&&s?n.z<=s.z?(i=n,n=n.nextZ,a--):(i=s,s=s.nextZ,o--):(i=n,n=n.nextZ,a--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}n=s}if(t.nextZ=null,i*=2,r<2)return e}}(e)}function m(e,t,i,s){const n=t&&t.length,r=n?t[0]*i:e.length;let a=Math.abs(v(e,0,r,i));if(n)for(let s=0,n=t.length;s<n;s++){const r=t[s]*i,o=s<n-1?t[s+1]*i:e.length;a-=Math.abs(v(e,r,o,i))}let o=0;for(let t=0;t<s.length;t+=3){const n=s[t]*i,r=s[t+1]*i,a=s[t+2]*i;o+=Math.abs((e[n]-e[a])*(e[r+1]-e[n+1])-(e[n]-e[r])*(e[a+1]-e[n+1]))}return 0===a&&0===o?0:Math.abs((o-a)/a)}function g(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t,i,s){return!!(L(e,t)&&L(i,s)||L(e,s)&&L(i,t))||g(e,t,i)>0!=g(e,t,s)>0&&g(i,s,e)>0!=g(i,s,t)>0}function v(e,t,i,s){let n=0;for(let r=t,a=i-s;r<i;r+=s)n+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return n}function f(e,t,i,s,n,r,a,o){return(n-a)*(t-o)-(e-a)*(r-o)>=0&&(e-a)*(s-o)-(i-a)*(t-o)>=0&&(i-a)*(r-o)-(n-a)*(s-o)>=0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function y(e,t,i,s,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function L(e,t){return e.x===t.x&&e.y===t.y}function x(e,t){return e.x-t.x}function w(e,t,i){let s=e;do{const n=s.prev,r=s.next.next;!L(n,r)&&_(n,s,s.next,r)&&b(n,r)&&b(r,n)&&(t.push(n.index/i),t.push(s.index/i),t.push(r.index/i),d(s),d(s.next),s=e=r),s=s.next}while(s!==e);return s}function C(e,t,i,s,n,o){let h=e;do{let e=h.next.next;for(;e!==h.prev;){if(h.index!==e.index&&S(h,e)){let l=P(h,e);return h=r(h,h.next),l=r(l,l.next),a(h,t,i,s,n,o),void a(l,t,i,s,n,o)}e=e.next}h=h.next}while(h!==e)}function S(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){let i=e,s=!1;const n=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&n<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)}function P(e,t){const i=new M(e.index,e.x,e.y),s=new M(t.index,t.x,t.y),n=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,s.next=i,i.prev=s,r.next=s,s.prev=r,s}i.d(t,{P:()=>m,O:()=>s});class M{constructor(e,t,i){this.index=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},17483:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ct});var s=i(56140),n=(i(95830),i(36544)),r=(i(68055),i(79881)),a=i(51894),o=i(87566),h=(i(10923),i(57002),i(86035),i(39105)),l=i(93533),d=(i(40450),i(24258)),c=i(9200),u=i(90846),p=i(19401),m=i(90806),g=i(59691),_=i(80621),v=i(65867),f=i(19539),b=i(76916),y=i(59472),L=i(96071),x=i(77625),w=i(17387),C=i(89333),S=i(67128),P=i(17333),M=i(12811),O=i(8344),D=i(69534),A=i(39746),V=i(88909),j=i(67134),R=i(68500),U=i(89852),k=i(57511),I=i(48430),T=i(86509),G=i(73103),z=i(34937),Z=i(50777),E=i(88089),W=i(41233);const H=class{constructor(e){this._textItem=new W.Z({visible:!1}),this._calloutItem=new E.Z({visible:!1,width:2}),this._visible=!1,this._calloutVisible=!0,e&&(this.fontSize=e)}get textItem(){return this._textItem}get calloutItem(){return this._calloutItem}set text(e){this._textItem.text=e}get text(){return this._textItem.text}set fontSize(e){this._textItem.fontSize=e}get fontSize(){return this._textItem.fontSize}set visible(e){this._visible=e,this._updateVisibility()}get visible(){return this._visible}addToView(e){e.overlay.items.addMany([this._textItem,this._calloutItem])}removeFromView(e){e.overlay&&!e.overlay.destroyed&&e.overlay.items.removeMany([this._textItem,this._calloutItem])}updatePosition(e,t){if(t){const i=t[0]-e[0],s=t[1]-e[1];this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(s)?i>0?"left":"right":s>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],this._calloutVisible=!0}else this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",this._calloutVisible=!1}_updateVisibility(){this._textItem.visible=this._visible,this._calloutItem.visible=this._visible&&this._calloutVisible}};var F=i(39160);const q=class{constructor(){this.origin=(0,x.c)(),this.start=(0,x.c)(),this.end=(0,x.c)()}update(e,t,i){if((0,w.g)(this.start,e),(0,w.g)(this.end,t),i)switch(i){case"start":(0,w.g)(this.origin,this.start);break;case"center":(0,F.H2)([e,t],this.origin);break;case"end":(0,w.g)(this.origin,this.end);break;default:(0,w.g)(this.origin,i)}else(0,F.H2)([e,t],this.origin)}};var B,$=i(16358),K=i(17154);!function(e){e.Linear=class{constructor(e,t){this._startPosition=(0,x.c)(),this._endPosition=(0,x.c)(),(0,w.g)(this._startPosition,e),(0,w.g)(this._endPosition,t)}eval(e,t){(0,w.e)(t,this._startPosition,this._endPosition,e)}},e.Spherical=class{constructor(e,t,i,s){this._startPosition=(0,x.c)(),this._endPosition=(0,x.c)();const n=(0,C.rS)(i);(0,P.SH)(e,i,this._startPosition,n),(0,P.SH)(t,i,this._endPosition,n),this._destSR=s}eval(e,t){(0,K.ZA)(this._startPosition,this._endPosition,e,t),(0,P.SH)(t,(0,C.rS)(this._destSR),t,this._destSR)}}}(B||(B={}));const N=B;var Y=i(26701),J=i(30090),Q=i(10762),X=i(6048),ee=i(23240),te=i(97853),ie=i(44801),se=i(11379),ne=i(51007),re=i(36904),ae=i(89553),oe=i(66704),he=i(41178);class le extends te.A{initializeProgram(e){const t=le.shader.get(),i=this.configuration,s=t.build({OITEnabled:0===i.transparencyPassType});return new ne.Z(e.rctx,s.generateSource("vertex"),s.generateSource("fragment"),se.i)}bindPass(e,t,i){ae.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform2fv("size",t.size),this.program.setUniform4fv("color1",t.color1),this.program.setUniform4fv("color2",t.color2)}bindDraw(e){ae.G.bindView(this.program,e)}setPipelineState(e){const t=this.configuration,i=3===e,s=2===e;return(0,re.sm)({blending:t.transparent?i?ce:(0,oe.$L)(e):null,depthTest:{func:(0,oe.$x)(e)},depthWrite:i?t.writeDepth&&re.LZ:(0,oe.Vc)(e),colorWrite:re.BK,polygonOffset:i||s?t.polygonOffset&&de:{factor:-1,units:-25}})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}le.shader=new ee.J(he.C,(()=>i.e(6606).then(i.bind(i,76606))));const de={factor:0,units:-25},ce=(0,re.wK)(770,1,771,771);class ue extends ie.m{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.transparencyPassType=3}}(0,s._)([(0,ie.o)()],ue.prototype,"transparent",void 0),(0,s._)([(0,ie.o)()],ue.prototype,"writeDepth",void 0),(0,s._)([(0,ie.o)()],ue.prototype,"polygonOffset",void 0),(0,s._)([(0,ie.o)({count:4})],ue.prototype,"transparencyPassType",void 0);class pe extends Q.F5{constructor(e,t){super(t,e,ge),this.techniqueConfig=new ue}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e){return this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig}intersect(e,t,i,s,n,r,a){return(0,J.Bw)(e,t,s,n,r,void 0,a)}getGLMaterial(e){return 0===e.output||7===e.output?new me(e):void 0}createBufferWriter(){return new X.G_(X.W1)}}class me extends Y.Z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(le,this.material.getTechniqueConfig(e),this.technique)}beginSlot(e){let t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const ge={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,writeDepth:!0,polygonOffset:!1,...Q.zh},_e={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};class ve{constructor(e,t=new G.D,i={}){this._model=e,this._manipulators=t,this.vertexManipulators=[],this._visible=!1,this._laserLineRenderer=null,this._cursorManipulator=null,this._pathSegmentObjects=[],this._perimeterSegmentObjects=[],this._projectionLineObjects=[],this._areaLabel=new H(16),this._pathLengthLabel=new H(12),this._cursorSegmentLengthLabel=new H(12),this._perimeterLengthLabel=new H(12),this._pathLabelSegments=[],this._perimeterLabelSegments=[],this._cursorSegmentLengthLabelSegment=new q,this._listenerHandles=null,this._origin=(0,x.c)(),this._originTransform=(0,M.a)(),this._tempStartPosition=(0,x.c)(),this._tempEndPosition=(0,x.c)(),this._tempHandlePosition=(0,x.c)(),this._sceneView=this._model.sceneView,this._params=(0,F.gh)(_e,i),this._layer=new U.Z("path-measurement-tool",{isPickable:!1}),this._createMaterials(),this._createObjects(),this._intersector=new j.r(this._sceneView.state.mode),this._intersector.options.store=0;const s=(0,Z.aD)(this._sceneView,this._params.handleColor,this._params.handleOpacity);s.available=!1,s.radius=this._params.handleRadius,s.interactive=!1,this._manipulators.add(s),this._cursorManipulator=s}destroy(){this.hide()}get requiresCursorPoint(){return("initial"===this._model.state||"drawing"===this._model.state)&&this._model.active}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){return{labels:{area:this._areaLabel,pathLength:this._pathLengthLabel,cursorSegmentLength:this._cursorSegmentLengthLabel,perimeterLength:this._perimeterLengthLabel},laserLineRenderer:this._laserLineRenderer}}show(){if(this._visible)return;this._visible=!0;const e=this._sceneView._stage,t={glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,globalAlpha:this._params.laserLineGlobalAlpha};this._laserLineRenderer=new T.J(this._sceneView.renderCoordsHelper,t),e.addRenderPlugin(this._laserLineRenderer.renderSlots,this._laserLineRenderer),this._addToStage(e),this._areaLabel.addToView(this._sceneView),this._pathLengthLabel.addToView(this._sceneView),this._cursorSegmentLengthLabel.addToView(this._sceneView),this._perimeterLengthLabel.addToView(this._sceneView),this._initializeListeners(),this._updateAll(this._model.viewData)}hide(){if(!this._visible)return;this._visible=!1;const e=this._sceneView._stage;e.removeRenderPlugin(this._laserLineRenderer),this._laserLineRenderer=null,this._destroyListeners(),this._updatePathLength(0),this._removeFromStage(e),this._areaLabel.removeFromView(this._sceneView),this._pathLengthLabel.removeFromView(this._sceneView),this._cursorSegmentLengthLabel.removeFromView(this._sceneView),this._perimeterLengthLabel.removeFromView(this._sceneView),this._sceneView.cursor=null}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return(0,y.pC)(i)?this.manipulatorIdToVertexId(i):null}manipulatorIdToVertexId(e){for(let t=0;t<this.vertexManipulators.length;t++){const{id:i}=this.vertexManipulators[t];if(e===i)return t}return null}pick(e){const t=this._sceneView.spatialReference,i=(0,L.md)(e.screenPoint);this._sceneView.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,n=(0,x.c)();if(!s.getIntersectionPoint(n))return new ve.PickResult;const r=this._sceneView.renderCoordsHelper.fromRenderCoords(n,t),a="TerrainRenderer"===s.intersector?"surface":"feature";return new ve.PickResult(a,n,r)}overlappingHandles(e,t){return(0,F.Vl)(e,t,this._sceneView)<=this._params.handleRadius}screenToMap3D(){return(0,z.gv)(this._sceneView)}_createMaterials(){this._pathLineMaterial=new k.U({width:this._params.pathLineWidth,color:this._params.pathLineColor,polygonOffset:!0,renderOccluded:4},"path-line"),this._intersectingPathLineMaterial=new k.U({width:this._params.pathLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4},"intersecting-path-line"),this._perimeterLineMaterial=new k.U({width:this._params.perimeterLineWidth,color:this._params.perimeterLineColor,polygonOffset:!0,renderOccluded:4},"perimeter-line"),this._intersectingPerimeterLineMaterial=new k.U({width:this._params.perimeterLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4},"intersecting-perimeter-line"),this._projectionLineMaterial=new k.U({width:this._params.projectionLineWidth,color:this._params.projectionLineColor,polygonOffset:!0,stipplePattern:(0,I.z5)(this._params.projectionLineStippleSize),stippleIntegerRepeats:!1,renderOccluded:4},"projection-line"),this._checkerBoardMaterial=new pe({color1:this._params.areaColor1,color2:this._params.areaColor2,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:4},"checker-board")}_createObjects(){this._cursorSegmentObject=new V.Z,this._areaObject=new V.Z}_addToStage(e){e.add(0,this._layer),e.add(3,this._pathLineMaterial),e.add(3,this._intersectingPathLineMaterial),e.add(3,this._perimeterLineMaterial),e.add(3,this._intersectingPerimeterLineMaterial),e.add(3,this._projectionLineMaterial),e.add(3,this._checkerBoardMaterial),e.addToViewContent([this._layer.id])}_removeFromStage(e){e.removeFromViewContent([this._layer.id]),e.remove(0,this._layer.id),e.remove(3,this._pathLineMaterial.id),e.remove(3,this._intersectingPathLineMaterial.id),e.remove(3,this._perimeterLineMaterial.id),e.remove(3,this._intersectingPerimeterLineMaterial.id),e.remove(3,this._projectionLineMaterial.id),e.remove(3,this._checkerBoardMaterial.id)}_syncViewData(e){if(!this._visible)return"none";const t=e.pathChanges;"full"===t.change?this._updateAll(e):"incremental"===t.change&&(t.updatedVertices.forEach((t=>{const i=(t-1+this._model.path.length)%this._model.path.length;this._updatePathSegment(e,t),this._updatePathSegment(e,i),this._updateVertexHandle(e,t),this._updateArea(e),this._updatePerimeterSegments(e),this._updateProjectionLines(e),this._updateLaserLine(),this._updateLabels(e)})),t.updatedVertices.has(this._model.path.length-1)&&this._updateCursorSegment());const i=t.change;return t.clear(),i}_updateAfterSyncViewData(e){const t=this._model.viewData;"full"!==this._syncViewData(t)&&e&&e(t)}_updateOrigin(e){(0,F.H2)(e.positionsRenderCoords,this._origin),(0,S.i)(this._originTransform),(0,S.t)(this._originTransform,this._originTransform,this._origin)}_updateAll(e){this._updateOrigin(e),this._updatePathLength(e.path.length),this._updatePathSegments(e),this._updatePerimeterSegments(e),this._updateHandles(e),this._updateArea(e),this._updateProjectionLines(e),this._updateLabels(e),this._updateLaserLine()}_updateCameraDependent(e){this._updateHandles(e),this._updateProjectionLines(e),this._updateLabels(e)}_updatePathLength(e){this._resizeObject3DArray(this._pathSegmentObjects,e),this._resizeObject3DArray(this._perimeterSegmentObjects,e),this._resizeManipulatorArray(this.vertexManipulators,e),(0,F.B$)(this._pathLabelSegments,e,(()=>new q)),(0,F.B$)(this._perimeterLabelSegments,e,(()=>new q))}_updatePathSegments(e){for(let t=0;t<this._pathSegmentObjects.length;++t)this._updatePathSegment(e,t);this._updateCursorSegment()}_updatePathSegment(e,t){const i=e.path,s=this._pathSegmentObjects[t];e.validMeasurement||t<i.length-1?(this._createInterpolatedLineGeometry(s,e.intersectingSegments.has(t)?this._intersectingPathLineMaterial:this._pathLineMaterial,"path-segment",e.positionsRenderCoords[t],e.positionsRenderCoords[(t+1)%i.length],this._origin,this._originTransform,this._model.measurementMode,this._pathLabelSegments[t],e.validMeasurement?"center":"end"),this._addObject3D(s)):(s.removeAllGeometries(),this._removeObject3D(s))}_updateCursorSegment(){const e=this._sceneView.renderCoordsHelper,t=this._model.path,i=this._cursorSegmentObject;t.length>0&&"drawing"===this._model.state&&this._model.cursorPoint?(e.toRenderCoords(t.back,this._tempStartPosition),e.toRenderCoords(this._model.cursorPoint,this._tempEndPosition),this._createInterpolatedLineGeometry(i,this._pathLineMaterial,"path-segment",this._tempStartPosition,this._tempEndPosition,this._origin,this._originTransform,this._model.measurementMode,this._cursorSegmentLengthLabelSegment,"end"),this._addObject3D(i)):(i.removeAllGeometries(),this._removeObject3D(i))}_updatePerimeterSegments(e){for(let t=0;t<this._perimeterSegmentObjects.length;++t)this._updatePerimeterSegment(e,t)}_updatePerimeterSegment(e,t){const i=e.path,s=this._perimeterSegmentObjects[t];e.validMeasurement&&"geodesic"!==this._model.measurementMode?(this._updatePerimeterSegmentObject(s,e.positionsFittedRenderCoords[t],e.positionsFittedRenderCoords[(t+1)%i.length],this._origin,this._originTransform,e.intersectingSegments.has(t),this._perimeterLabelSegments[t]),this._addObject3D(s)):(s.removeAllGeometries(),this._removeObject3D(s))}_updatePerimeterSegmentObject(e,t,i,s,n,r,a){this._createInterpolatedLineGeometry(e,r?this._intersectingPerimeterLineMaterial:this._perimeterLineMaterial,"perimeter-segment",t,i,s,n,this._model.measurementMode,a)}_updateHandles(e){for(let t=0;t<this.vertexManipulators.length;++t)this._updateVertexHandle(e,t);this._updateCursorHandle()}_updateVertexHandle(e,t){const{manipulator:i}=this.vertexManipulators[t];i.renderLocation=e.positionsRenderCoords[t]}_updateCursorHandle(){const e=this._cursorManipulator;"drawing"===this._model.state&&this._model.cursorPoint?(e.available=!0,e.location=this._model.cursorPoint):e.available=!1}_updateArea(e){switch(this._model.measurementMode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this._areaObject;if(e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices){const i=[],s=(0,x.c)();e.positionsFittedRenderCoords.forEach((e=>{(0,w.f)(s,e,this._origin),i.push(s[0],s[1],s[2])}));const n=[];e.positionsProjected.forEach((e=>{n.push(e[0],e[1])}));const r=new D.b({position:{size:3,data:i},uv0:{size:2,data:n}},{position:e.triangleIndices,uv0:e.triangleIndices}),a=new R.Z(r,"area");t.removeAllGeometries(),t.addGeometry(a,this._checkerBoardMaterial,this._originTransform),this._addObject3D(t),this._checkerBoardMaterial.setParameterValues({size:[e.checkerSize,e.checkerSize]})}else t.removeAllGeometries(),this._removeObject3D(t)}_updateAreaGeodesic(){const e=this._areaObject;e.removeAllGeometries(),this._removeObject3D(e)}_updateProjectionLines(e){const t=e.path;this._resizeObject3DArray(this._projectionLineObjects,t.length);for(let i=0;i<t.length;++i)this._updateProjectionLine(e,i)}_updateProjectionLine(e,t){const i=this._projectionLineObjects[t];if(i.removeAllGeometries(),e.validMeasurement&&"euclidean"===this._model.measurementMode){const e=(0,x.c)();(0,w.f)(e,this._model.viewData.positionsRenderCoords[t],this._origin);const s=(0,x.c)();(0,w.f)(s,this._model.viewData.positionsFittedRenderCoords[t],this._origin);const n=new R.Z(A.Z.createPolylineGeometry([e,s]),"projected-line");i.addGeometry(n,this._projectionLineMaterial,this._originTransform),this._addObject3D(i)}else this._removeObject3D(i)}_updateLabels(e){const t=this._sceneView.state.camera,i=this._params.labelDistance,s=this._model,n="geodesic"===s.measurementMode,r="drawing"===s.state,a=(e,t)=>e.visible&&t.visible&&this._sceneView.overlay.overlaps(e.textItem,t.textItem);{const i=this._areaLabel,n=(0,$.D7)(i,e.areaCentroid,t);i.text=s.areaLabel,i.visible=n&&e.validMeasurement&&0===e.intersectingSegments.size&&null!=s.areaLabel}{const n=this._pathLengthLabel,a=this._pathLabelSegments[e.pathLengthLabelSegmentIndex],o=this._cursorSegmentLengthLabelSegment,h=(0,$.L1)(n,a,o,i,t);n.text=s.pathLengthLabel,n.visible=h&&r&&s.path.length>0}{const e=this._cursorSegmentLengthLabel,n=this._cursorSegmentLengthLabelSegment,a=(0,$._n)(e,n,i,"bottom",t);e.text=s.cursorSegmentLengthLabel,e.visible=a&&r&&s.cursorSegmentLength&&0!==s.cursorSegmentLength.value}a(this._cursorSegmentLengthLabel,this._pathLengthLabel)&&(this._cursorSegmentLengthLabel.visible=!1),a(this._pathLengthLabel,this._areaLabel)&&(this._pathLengthLabel.visible=!1);{const r=this._perimeterLengthLabel;if(s.validMeasurement&&0===e.intersectingSegments.size)for(let o=0;o<e.path.length;++o){const h=(e.perimeterLengthLabelSegmentIndex+o)%e.path.length,l=n?this._pathLabelSegments[h]:this._perimeterLabelSegments[h],d=(0,$._n)(r,l,i,"top",t);if(r.text=s.perimeterLengthLabel,r.visible=d,!a(r,this._areaLabel))break;r.visible=!1}else r.visible=!1}}_getFocusPoint(){const e=this._model,t=this._model.lastDraggedVertex;switch(e.state){case"drawing":return e.cursorPoint?e.cursorPoint:e.path.vertex((0,y.pC)(t)?t:e.path.length-1);case"editing":return(0,y.pC)(t)?e.path.vertex(t):null;default:return e.cursorPoint}}_updateLaserLine(){const e=this._model,t=this._params.laserLineEnabled&&"measured"!==e.state&&e.active;this._laserLineRenderer.pointDistanceEnabled=!1,this._laserLineRenderer.lineVerticalPlaneEnabled=!1;const i=this._getFocusPoint();if(t&&i){const e=this._tempHandlePosition;this._sceneView.renderCoordsHelper.toRenderCoords(i,e),this._laserLineRenderer.heightManifoldTarget=e,this._laserLineRenderer.heightManifoldEnabled=!0}else this._laserLineRenderer.heightManifoldEnabled=!1}_addObject3D(e){e.parentLayer||(this._layer.addObject(e),this._sceneView._stage.add(1,e))}_removeObject3D(e){e.parentLayer&&(this._layer.removeObject(e),this._sceneView._stage.remove(1,e.id))}_resizeObject3DArray(e,t){(0,F.B$)(e,t,(()=>new V.Z),(e=>{this._removeObject3D(e)}))}_resizeManipulatorArray(e,t){(0,F.B$)(e,t,(()=>{const e=(0,Z.aD)(this._sceneView,this._params.handleColor,this._params.handleOpacity);return e.radius=this._params.handleRadius,{id:this._manipulators.add(e),manipulator:e}}),(({manipulator:e})=>{this._manipulators.remove(e)}))}_createInterpolatedLineGeometry(e,t,i,s,n,r,a,o,h,l){const d=this._sceneView.renderCoordsHelper,c=[],u=[],p=(e,t)=>{const i=O.WM.get();(0,w.f)(i,e,r),c.push(i),u.push(t)};if("euclidean"===o){const e=O.WM.get();(0,F.H2)([s,n],e);const t=O.WM.get();d.worldUpAtPosition(e,t),p(s,t),p(n,t),h&&h.update(s,n,l)}else{const e=this._getSegmentInterpolator(s,n),t=this._params.lineSubdivisions+1&-2;let i=null,r=null,a=t/2-1,o=t/2;"start"===l?(a=0,o=1):"end"===l&&(a=t-2,o=t-1);for(let s=0;s<t;++s){const n=s/(t-1),h=O.WM.get(),l=O.WM.get();e.eval(n,h),d.worldUpAtPosition(h,l),s===a&&(i=h),s===o&&(r=h),p(h,l)}h&&h.update(i,r,l)}const m=new R.Z(A.Z.createPolylineGeometry(c,u),i);e.removeAllGeometries(),e.addGeometry(m,t,a)}_getSegmentInterpolator(e,t){const i=this._sceneView.spatialReference;if((0,P.Up)(i,(0,C.rS)(i))){const i=this._sceneView.renderCoordsHelper.spatialReference;return new N.Spherical(e,t,i,i)}return new N.Linear(e,t)}_initializeListeners(){this._listenerHandles=new g.Z,this._listenerHandles.add([this._model.watch(["state","lastDraggedVertex"],(()=>this._updateLaserLine())),this._model.watch("cursorPoint",(()=>this._updateAfterSyncViewData((e=>{this._updateCursorSegment(),this._updateCursorHandle(),"drawing"===this._model.state&&this._updateLabels(e),this._updateLaserLine()})))),this._sceneView.state.watch("camera",(()=>this._updateAfterSyncViewData((()=>this._updateCameraDependent(this._model.viewData))))),this._model.watch(["unit","measurementMode"],(()=>this._updateAll(this._model.viewData))),this._model.watch(["areaLabel","cursorSegmentLengthLabel","pathLengthLabel","perimeterLengthLabel"],(()=>{this._updateLabels(this._model.viewData)})),this._model.watch(["active"],(()=>{this._updateLaserLine(),this._syncViewData(this._model.viewData)})),this._model.watch("viewData",(e=>this._syncViewData(e)))])}_destroyListeners(){this._listenerHandles.destroy(),this._listenerHandles=null}}ve._handleGeometry=new R.Z(A.Z.createSphereGeometry(1,32,32),"handle"),function(e){e.PickRequest=class{},e.PickResult=class{constructor(e=null,t=null,i=null){this.type=e,this.scenePoint=t,this.mapPoint=i}}}(ve||(ve={}));const fe=ve;var be=i(2887),ye=i(58722),Le=i(53640);function xe(e){return"mouse"!==e.pointerType||0===e.button}var we=i(82677),Ce=i(3766),Se=i(33655),Pe=i(14071),Me=(i(89771),i(32811)),Oe=i(58508);let De=class extends we.default{constructor(){super(...arguments),this.result=null}destroy(){this.result=null}set geometry(e){this.result=null,this._set("geometry",(0,y.pC)(e)?e.clone():null)}};(0,s._)([(0,r.Cb)({value:null})],De.prototype,"geometry",null),(0,s._)([(0,r.Cb)()],De.prototype,"result",void 0),De=(0,s._)([(0,o.j)("esri.views.3d.interactive.graphics.AreaMeasurement3D")],De);var Ae,Ve=i(73032),je=i(53817),Re=i(98675),Ue=i(70642);!function(e){e.boundingSphere=function(e,t){const i=t.center;(0,w.s)(i,0,0,0);for(let t=0;t<e.length;++t)(0,w.b)(i,i,e[t]);(0,w.a)(i,i,1/e.length);let s=0;for(let t=0;t<e.length;++t)s=Math.max(s,(0,w.h)(i,e[t]));t.radius=Math.sqrt(s)},e.bestFitPlane=function(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,K.pG)(e[0],e[1],e[2],t)},e.planePointDistance=function(e,t){return(0,w.d)(e,t)+e[3]},e.segmentLengthEuclidean=function(e,t,i){return(0,P.KC)(e,ke,i)&&(0,P.KC)(t,Ie,i)?(0,w.k)(ke,Ie):0},e.segmentLengthGeodesic=function(e,t){if(!(0,P.UY)(e,ke)||!(0,P.UY)(t,Ie))return 0;const i={distance:null};return(0,Re.inverseGeodeticSolver)(i,[ke[0],ke[1]],[Ie[0],Ie[1]]),i.distance},e.segmentLengthGeodesicVector=function(e,t,i){const s={distance:null};return(0,Re.inverseGeodeticSolver)(s,[e[0],e[1]],[t[0],t[1]],i),s.distance},e.triangleAreaEuclidean=function(e,t,i){const s=t[0]-e[0],n=t[1]-e[1],r=i[0]-e[0],a=i[1]-e[1];return.5*Math.abs(s*a-n*r)},e.triangleAreaGeodesic=function(e,t,i,s){const n=Ge;return(0,P.ke)(e,s,ke)&&(0,P.ke)(t,s,Ie)&&(0,P.ke)(i,s,Te)?(n.setPoint(0,0,ke),n.setPoint(0,1,Ie),n.setPoint(0,2,Te),Math.abs((0,Ue.geodesicArea)(n,"square-meters"))):0},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,w.s)(t,0,1,0):(0,w.s)(t,1,0,0),(0,w.c)(i,e,t),(0,w.n)(t,t),(0,w.c)(t,i,e),(0,w.n)(i,i)},e.fitHemisphere=function(e,t=null,i=!0){const s=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,w.d)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,w.g)(t,e[0]),!0;(0,w.s)(ze,0,0,0);for(let t=0;t<e.length;++t)(0,w.b)(ze,ze,e[t]);if((0,w.n)(ze,ze),s(e,ze))return t&&(0,w.g)(t,ze),!0;if(!i)return!1;for(let i=0;i<e.length;++i)for(let n=0;n<e.length;++n)if(i!==n&&((0,w.c)(ze,e[i],e[n]),(0,w.n)(ze,ze),s(e,ze)))return t&&(0,w.g)(t,ze),!0;return!1},e.compareSets=function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(let i=0;i<e.size;++i)if(!t.has(e[i]))return!1;return!0}}(Ae||(Ae={}));const ke=(0,x.c)(),Ie=(0,x.c)(),Te=(0,x.c)(),Ge=new je.Z({rings:[[ke,Ie,Te]],spatialReference:Ve.Z.WGS84}),ze=(0,x.c)();const Ze=Ae;var Ee=i(80685),We=i(55735),He=i(38256),Fe=i(27202),qe=i(14286);function Be(e,t){const i=new Float64Array(e.length*t);for(let s=0;s<e.length;++s){const n=e[s];for(let e=0;e<t;++e)i[s*t+e]=n[e]}return i}function $e(e){const t=new Set;return e.forEach((e=>{t.add(e)})),t}const Ke=class{constructor(){this.change="none",this.updatedVertices=new Set}fullChange(){this.change="full"}incrementalChange(e){"none"===this.change&&(this.change="incremental"),this.updatedVertices.add(e)}clear(){this.change="none",this.updatedVertices.clear()}assign(e){this.change=e.change,this.updatedVertices=$e(e.updatedVertices)}merge(e){switch(this.change){case"none":this.assign(e);break;case"full":break;case"incremental":"incremental"===e.change?e.updatedVertices.forEach((e=>{this.updatedVertices.add(e)})):"full"===e.change&&(this.change="full")}}};var Ne=i(35470),Ye=i(83477);let Je=class extends(Ne.Z.EventedMixin(we.default)){constructor(){super(...arguments),this.vertices=new Ye.Z}get front(){return this.vertices.items[0]||null}get back(){return this.vertices.items[this.vertices.length-1]||null}clear(){this.vertices.removeAll(),this.emit("cleared",{}),this._notifyFrontBack()}vertex(e){return this.vertices.items[e]}add(e){this.vertices.add(e);const t=this.vertices.length-1;return this._notifyFrontBack(),this.emit("vertex-added",{index:t}),t}remove(e){this.vertices.removeAt(e),this._notifyFrontBack(),this.emit("vertex-removed",{index:e})}update(e,t){null!=t&&(this.vertices.splice(e,1,t),this._notifyFrontBack()),this.emit("vertex-updated",{index:e})}_notifyFrontBack(){this.notifyChange("front"),this.notifyChange("back")}toPolygon(){const e=[];if(0===this.vertices.length)return null;this.vertices.forEach((t=>{e.push(t.hasZ?[t.x,t.y,t.z]:[t.x,t.y])}));const t=this.vertices.getItemAt(0);return e.push(t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]),new je.Z({rings:[e],spatialReference:t.spatialReference})}};(0,s._)([(0,r.Cb)({readOnly:!0})],Je.prototype,"vertices",void 0),(0,s._)([(0,r.Cb)({aliasOf:"vertices.length"})],Je.prototype,"length",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],Je.prototype,"front",null),(0,s._)([(0,r.Cb)({readOnly:!0})],Je.prototype,"back",null),Je=(0,s._)([(0,o.j)("esri.views.3d.interactive.measurementTools.support.Path")],Je);const Qe=Je;var Xe=i(84397);let et=class extends we.default{constructor(){super(...arguments),this._unitNormalizer=new Xe.Z,this._measurementData=new class{constructor(){this.positionsWorldCoords=[],this.positionsRenderCoords=[],this.positionsProjectedWorldCoords=[],this.positionsFittedRenderCoords=[],this.positionsGeographic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.areaCentroidWorldCoords=(0,x.c)(),this.areaCentroidRenderCoords=(0,x.c)(),this.geodesicAreaCentroidRenderCoords=(0,x.c)(),this._length=0,this._centroidRenderCoords=(0,x.c)(),this._planeWorldCoords=(0,He.a)(),this._worldUp=(0,x.c)(),this._worldTangent=(0,x.c)(),this._frame=[(0,x.c)(),(0,x.c)(),(0,x.c)()],this._tempU=(0,x.c)(),this._tempV=(0,x.c)(),this._tempVec3=(0,x.c)(),this._tempSphere={center:(0,x.c)(),radius:0}}update(e,t,i,s,n,r,a){this._resize(e.length);const o=(0,C.rS)(t.spatialReference),h=(0,P.Up)(t.spatialReference,o)&&(0,P.jF)(t.spatialReference),l=this.positionsGeographic,d=this.positionsWorldCoords,c=this.positionsRenderCoords,u=this.positionsSpherical;for(let t=0;t<e.length;++t){const i=e.vertex(t);(0,P.KC)(i,d[t],r),(0,P.KC)(i,c[t],n),h&&((0,P.UY)(i,l[t]),(0,P.KC)(i,u[t],o),(0,w.n)(u[t],u[t]))}const p=this._updatePathLengths(s);if(this.pathLength=this._length>0?new Me.Z(i.normalizeDistance(p),"meters"):null,h){const e=this._updateGeodesicPathLengths(s,r);this.geodesicPathLength=this._length>0?new Me.Z(e,"meters"):null}else this.geodesicPathLength=null;if(!s)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),void this.geodesicIntersectingSegments.clear();this._updateArea(t,i,n,r,a),h&&this._updateGeodesicArea(t)}_resize(e){for(e<this._length&&(this.positionsWorldCoords.length=e,this.positionsRenderCoords.length=e,this.positionsProjectedWorldCoords.length=e,this.positionsFittedRenderCoords.length=e,this.positionsGeographic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorldCoords.push((0,x.c)()),this.positionsRenderCoords.push((0,x.c)()),this.positionsProjectedWorldCoords.push((0,We.a)()),this.positionsFittedRenderCoords.push((0,x.c)()),this.positionsGeographic.push((0,x.c)()),this.positionsSpherical.push((0,x.c)()),this.positionsStereographic.push((0,We.a)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorldCoords,i=this.pathSegmentLengths;let s=0;for(let n=0;n<this._length;++n){const r=i[n]=(0,w.k)(t[n],t[(n+1)%this._length]);(n<this._length-1||e)&&(s+=r)}return s}_updateGeodesicPathLengths(e,t){const i=this.positionsGeographic,s=this.geodesicPathSegmentLengths;let n=0;for(let r=0;r<this._length;++r){const a=s[r]=Ze.segmentLengthGeodesicVector(i[r],i[(r+1)%this._length],t);(r<this._length-1||e)&&(n+=a)}return n}_updateArea(e,t,i,s,n){const r=e.renderCoordsHelper,a=this.positionsWorldCoords,o=this.positionsRenderCoords,h=this.positionsProjectedWorldCoords,l=this.positionsFittedRenderCoords,d=this._planeWorldCoords,c=this._centroidRenderCoords;(0,F.H2)(o,c),r.worldUpAtPosition(c,this._worldUp),r.worldBasisAtPosition(c,0,this._worldTangent),(0,P.Qr)(c,this._worldUp,i,this._worldUp,s),(0,P.Qr)(c,this._worldTangent,i,this._worldTangent,s),a.length>2&&Ze.bestFitPlane(a,d),this.fittingMode=this._selectFittingMode(d,a,this._worldUp,n);let u=0;if("horizontal"===this.fittingMode){let e=-1/0;o.forEach(((t,i)=>{const s=r.getAltitude(o[i]);s>e&&(e=s,u=i)}))}const p=a[u];let m=d,g=this._worldTangent;"horizontal"===this.fittingMode?m=this._worldUp:"vertical"===this.fittingMode&&(m=this._tempVec3,g=this._worldUp,(0,K.T)(d,this._worldUp,m)),(0,w.g)(this._frame[2],m),(0,K.T)(g,m,this._frame[0]),(0,w.c)(this._frame[1],this._frame[0],this._frame[2]),(0,w.p)(this._frame[1],this._frame[1]);const _=this._tempVec3,v=this._tempU,f=this._tempV;for(let e=0;e<this._length;++e){const t=h[e],n=l[e];(0,w.f)(_,a[e],p),(0,qe.s)(t,(0,w.d)(this._frame[0],_),(0,w.d)(this._frame[1],_)),(0,w.a)(v,this._frame[0],t[0]),(0,w.a)(f,this._frame[1],t[1]),(0,w.b)(_,v,f),(0,w.b)(_,_,p),(0,P.SH)(_,s,n,i)}this.perimeterLength=this._length>0?new Me.Z(t.normalizeDistance(this._updatePerimeterLengths()),"meters"):null,(0,F.H2)(l,this.areaCentroidRenderCoords),(0,P.SH)(this.areaCentroidRenderCoords,i,this.areaCentroidWorldCoords,s),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?new Me.Z(t.normalizeArea(this._computeArea()),"square-meters"):null}_updateGeodesicArea(e){const t=e.renderCoordsHelper,i=this.positionsSpherical,s=this.positionsStereographic,n=this._tempVec3,r=Ze.fitHemisphere(i,n);if(!r)return void(this.geodesicArea=null);const a=this._tempU,o=this._tempV;(0,K._F)(n,a,o);for(let e=0;e<this._length;++e){const t=(0,w.d)(i[e],a),r=(0,w.d)(i[e],o),h=(0,w.d)(i[e],n);(0,qe.s)(s[e],t/h,r/h)}(0,w.a)(n,n,(0,C.Iu)(e.spatialReference).radius),t.toRenderCoords(n,(0,C.rS)(e.spatialReference),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=r&&0===this.geodesicIntersectingSegments.size?new Me.Z(this._computeGeodesicArea(),"square-meters"):null}_updatePerimeterLengths(){const e=this.positionsProjectedWorldCoords,t=this.perimeterSegmentLengths;let i=0;for(let s=0;s<this._length;++s)i+=t[s]=(0,qe.i)(e[s],e[(s+1)%this._length]);return i}_updateIntersectingSegments(){const e=this.positionsProjectedWorldCoords,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,Ee.UT)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeArea(){const e=this.positionsProjectedWorldCoords,t=Be(e,2),i=this.triangleIndices=new Uint32Array((0,Fe.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Ze.triangleAreaEuclidean(e[i[t]],e[i[t+1]],e[i[t+2]]);return s}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,Ee.UT)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeGeodesicArea(){const e=this.positionsGeographic,t=Be(this.positionsStereographic,2),i=this.geodesicTriangleIndices=new Uint32Array((0,Fe.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Ze.triangleAreaGeodesic(e[i[t]],e[i[t+1]],e[i[t+2]],Ve.Z.WGS84);return s}_selectFittingMode(e,t,i,s){const n=t.map((t=>Math.abs(Ze.planePointDistance(e,t)))).reduce(((e,t)=>Math.max(e,t)),0);Ze.boundingSphere(t,this._tempSphere);const r=n/(2*this._tempSphere.radius),a=r<s.maxRelativeErrorCoplanar,o=r<s.maxRelativeErrorAlmostCoplanar;let h="horizontal";return a?h="oblique":o&&(h=Math.abs((0,w.d)(i,e))>Math.cos((0,Se.Vl)(s.verticalAngleThreshold))?"horizontal":"vertical"),h}},this._measurementDataChanges=new Ke,this._viewDataChanges=new Ke,this._handles=new g.Z,this.dataObject=new De,this.path=new Qe,this.pathVersion=0,this.cursorPoint=null,this.state="initial",this.lastDraggedVertex=null,this.mode="auto",this.unit="metric",this.active=!1,this.maxRelativeErrorCoplanar=.005,this.maxRelativeErrorAlmostCoplanar=.01,this.verticalAngleThreshold=80,this.geodesicMeasurementDistanceThreshold=1e5}initialize(){(0,Pe.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})),this._handles.add((0,Ce.qe)((async()=>{this.messages=await(0,Pe.ME)("esri/core/t9n/Units")}))),this._handles.add((0,_.whenTrue)(this.sceneView,"ready",(()=>{const{spatialReference:e}=this.sceneView,t=(0,C.rS)(e),i=t===C.GG?C.wY:t,s=!e||(0,P.Up)(e,i)?i:e;this._worldSpatialReference=s,this._unitNormalizer.spatialReference=s})),"scene-view"),this.reset();const e=()=>{this._set("pathVersion",this.pathVersion+1)};this._handles.add(this.path.on("cleared",(()=>{this._measurementDataChanges.fullChange(),this._set("pathVersion",0),this.dataObject.geometry=null}))),this._handles.add(this.path.on("vertex-added",(()=>{this._measurementDataChanges.fullChange(),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.path.on("vertex-removed",(()=>{this._measurementDataChanges.fullChange(),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.path.on("vertex-updated",(t=>{this._measurementDataChanges.incrementalChange(t.index),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.dataObject.watch("geometry",(()=>{const e=this.measurementData;this.dataObject.result={area:e.area,geodesicArea:e.geodesicArea,pathLength:e.pathLength,geodesicPathLength:e.geodesicPathLength,perimeterLength:e.perimeterLength}})))}destroy(){this._handles.destroy(),this._handles=null}get validMeasurement(){return this.path.length>=3&&"measured"===this.state||"editing"===this.state}get isMeasuring(){return this.path.length>=1}get measurementData(){this._viewDataChanges.merge(this._measurementDataChanges),this._measurementDataChanges.clear();const e=$e(this._measurementData.intersectingSegments),t=$e(this._measurementData.geodesicIntersectingSegments);return this._measurementData.update(this.path,this.sceneView,this._unitNormalizer,this.validMeasurement,this.sceneView.renderSpatialReference,this._worldSpatialReference,{maxRelativeErrorCoplanar:this.maxRelativeErrorCoplanar,maxRelativeErrorAlmostCoplanar:this.maxRelativeErrorAlmostCoplanar,verticalAngleThreshold:this.verticalAngleThreshold}),Ze.compareSets(this._measurementData.intersectingSegments,e)||this._viewDataChanges.fullChange(),Ze.compareSets(this._measurementData.geodesicIntersectingSegments,t)||this._viewDataChanges.fullChange(),this._measurementData}get area(){return this.measurementData.area}get geodesicArea(){return this.measurementData.geodesicArea}get areaLabel(){return this._formatAreaLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicArea:this.measurementData.area,this.unit)}get pathLength(){return this.measurementData.pathLength}get geodesicPathLength(){return this.measurementData.geodesicPathLength}get pathLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.pathLength,this.unit)}get perimeterLength(){return this.measurementData.perimeterLength}get geodesicPerimeterLength(){return this.measurementData.geodesicPathLength}get perimeterLengthLabel(){return this.measurementData.perimeterLength&&this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.perimeterLength,this.unit)}get cursorSegmentLength(){return this.path.back&&this.cursorPoint&&new Me.Z(this._unitNormalizer.normalizeDistance(Ze.segmentLengthEuclidean(this.path.back,this.cursorPoint,this._worldSpatialReference)),"meters")}get geodesicCursorSegmentLength(){return this.path.back&&this.cursorPoint&&new Me.Z(Ze.segmentLengthGeodesic(this.path.back,this.cursorPoint),"meters")}get cursorSegmentLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.geodesicCursorSegmentLength:this.cursorSegmentLength,this.unit)}get viewData(){const e=this.measurementData,t="geodesic"===this.measurementMode,i=t?this.geodesicArea:this.area;let s=1;if(i){const e=this._toPreferredAreaUnit(i,this.unit);s=(0,Se.sk)(Math.sqrt(e.value)/Math.sqrt(300)),s*=Math.sqrt((0,l.En)(1,e.unit,"square-meters")),s/=this._unitNormalizer.normalizeDistance(1)}return{validMeasurement:this.validMeasurement,path:this.path,pathChanges:this._viewDataChanges,positionsGeographic:e.positionsGeographic,positionsRenderCoords:e.positionsRenderCoords,positionsProjected:e.positionsProjectedWorldCoords,positionsFittedRenderCoords:e.positionsFittedRenderCoords,intersectingSegments:t?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:t?e.geodesicTriangleIndices:e.triangleIndices,fittingMode:e.fittingMode,areaCentroid:t?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,pathLengthLabelSegmentIndex:this.validMeasurement?0:this.path.length-2,perimeterLengthLabelSegmentIndex:0,checkerSize:s}}get measurementMode(){let e=this.mode;return"auto"===e&&(e="euclidean",(this.geodesicPathLength?this.geodesicPathLength.value:0)+(!this.validMeasurement&&this.geodesicCursorSegmentLength?this.geodesicCursorSegmentLength.value:0)>this.geodesicMeasurementDistanceThreshold&&(e="geodesic")),null==this.geodesicPathLength&&(e="euclidean"),e}reset(){this.clearMeasurement()}clearMeasurement(){this.path.clear(),this.state="initial",this.cursorPoint=null}finishMeasurement(){this.path.length<3?this.clearMeasurement():(this._measurementDataChanges.fullChange(),this.state="measured")}_preferredAreaUnit(e,t){switch(t){case"metric":return(0,l.tQ)(e.value,e.unit);case"imperial":return(0,l.Yl)(e.value,e.unit);default:return t}}_preferredLengthUnit(e,t){const i=this._deriveLengthUnitFromAreaUnit(t);switch(i){case"metric":return(0,l.KU)(e.value,e.unit);case"imperial":return(0,l.FN)(e.value,e.unit);default:return i}}_toPreferredAreaUnit(e,t){return e.toUnit(this._preferredAreaUnit(e,t))}_toPreferredLengthUnit(e,t){return e.toUnit(this._preferredLengthUnit(e,t))}_formatAreaLabel(e,t,i){return e&&t&&(0,Oe.VG)(e,t,this._preferredAreaUnit(t,i))}_formatLengthLabel(e,t,i){return e&&t&&(0,Oe.VG)(e,t,this._preferredLengthUnit(t,i))}_deriveLengthUnitFromAreaUnit(e){switch(e){case"metric":return"metric";case"imperial":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"acres":return"imperial";case"ares":case"hectares":return"metric"}throw new Error("unhandled area unit")}};(0,s._)([(0,r.Cb)()],et.prototype,"messages",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"dataObject",void 0),(0,s._)([(0,r.Cb)({constructOnly:!0})],et.prototype,"sceneView",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],et.prototype,"path",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],et.prototype,"pathVersion",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"cursorPoint",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"state",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"lastDraggedVertex",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"mode",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"unit",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"active",void 0),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["path.length","state"]})],et.prototype,"validMeasurement",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["path.length"]})],et.prototype,"isMeasuring",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["pathVersion","validMeasurement","maxRelativeErrorCoplanar","maxRelativeErrorAlmostCoplanar","verticalAngleThreshold"],autoTracked:!1})],et.prototype,"measurementData",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"area",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicArea",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"areaLabel",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"pathLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicPathLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"pathLengthLabel",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"perimeterLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicPerimeterLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"perimeterLengthLabel",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],et.prototype,"cursorSegmentLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],et.prototype,"geodesicCursorSegmentLength",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["messages","unit","measurementMode","cursorSegmentLength","geodesicCursorSegmentLength"]})],et.prototype,"cursorSegmentLengthLabel",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["unit","measurementMode","measurementData"]})],et.prototype,"viewData",null),(0,s._)([(0,r.Cb)()],et.prototype,"maxRelativeErrorCoplanar",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"maxRelativeErrorAlmostCoplanar",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"verticalAngleThreshold",void 0),(0,s._)([(0,r.Cb)()],et.prototype,"geodesicMeasurementDistanceThreshold",void 0),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["mode","validMeasurement","geodesicPathLength","geodesicCursorSegmentLength","geodesicMeasurementDistanceThreshold"]})],et.prototype,"measurementMode",null),et=(0,s._)([(0,o.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DModel")],et);const tt=et;let it=class extends b.m{constructor(e){super(e),this._handles=new g.Z,this.deferCreation=!0,this.model=new tt({sceneView:e.view})}initialize(){this._view=new fe(this.model,this.manipulators),this._controller=new class{constructor(e,t,i){this._manipulators=i,this._handles=new g.Z,this._tempPickRequest=new fe.PickRequest,this.model=e,this.view=t,this.model.reset(),this._setupManipulators()}destroy(){this._handles.destroy(),this._handles=null}handleInputEvent(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>`manipulator-${e}`;let t=0;const i=e=>i=>("start"===i.action&&(t++,this.model.lastDraggedVertex=(0,y.Wg)(this.view.manipulatorIdToVertexId(e)),"measured"===this.model.state&&(this.model.state="editing")),i),s=()=>e=>"end"===e.action?(t--,0===t&&"editing"===this.model.state&&(this.model.state="measured"),null):e,n=(t,n)=>{this._handles.add([(0,Le.Xd)(n,((e,n,r)=>{const a=(0,z.J4)(e),o=(0,y.Wg)(this.view.manipulatorIdToVertexId(t));n.next(i(t)).next(a).next(s()).next(this.view.screenToMap3D()).next((t=>{e.location=t.mapEnd,this.model.path.update(o,(0,ye.WG)(t.mapEnd))}));const h=(0,ye.WG)(this.model.path.vertex(o));r.next(a).next((()=>{this.model.path.update(o,h),e.location=h}))})),n.events.on("double-click",(e=>{xe(e)&&("drawing"===this.model.state&&this.model.finishMeasurement(),e.stopPropagation())}))],e(t))},r=t=>{this._handles.remove(e(t))};this._manipulators.forEach((({id:e,manipulator:t})=>{n(e,t)})),this._handles.add([this._manipulators.on("after-add",(({item:{id:e,manipulator:t}})=>{n(e,t)})),this._manipulators.on("after-remove",(({item:{id:e}})=>{r(e)}))])}_handleDrag(e){"editing"===this.model.state&&e.stopPropagation()}_handleImmediateClick(e){if(!xe(e))return;const t=(0,be.vT)(e);if(this.model.active)switch(this.model.state){case"initial":this._addVertexAt(t)&&(this.model.state="drawing",e.stopPropagation());break;case"drawing":{const i=this.view.vertexHandleAt(t,e.pointerType);if((0,y.Wi)(i)){if(this._addVertexAt(t))return}else 0===i&&(this.model.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,be.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){"Enter"===e.key&&"drawing"===this.model.state&&(this.model.finishMeasurement(),e.stopPropagation())}_hoverAt(e){if(this.view.requiresCursorPoint){const t=this._pick(e);t.mapPoint&&(this.model.cursorPoint=t.mapPoint)}else this.model.cursorPoint=null}_addVertexAt(e){const t=this._pick(e);return!!t.mapPoint&&(this.model.path.add(t.mapPoint),!0)}_pick(e){const t=this._tempPickRequest;return t.screenPoint=e,this.view.pick(t)}}(this.model,this._view,this.manipulators),this._handles.add((0,_.init)(this,"state",(e=>{switch(e){case"measured":return this.complete();case"ready":return;default:return this.create()}}),!0))}destroy(){this.detach(),this._view.destroy(),this._view=null,this._controller.destroy(),this._controller=null,this._handles.destroy(),this._handles=null}get state(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"}get isSupported(){return"3d"===this.get("view.type")}get cursor(){return!this.model.active||"initial"!==this.model.state&&"drawing"!==this.model.state?null:"crosshair"}activate(){this.model.active=!0}deactivate(){this.model.active=!1}onShow(){this._view.show()}onHide(){this._view.hide()}onDetach(){this.model.reset()}onInputEvent(e){this._controller.handleInputEvent(e)}};(0,s._)([(0,r.Cb)({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],it.prototype,"state",null),(0,s._)([(0,r.Cb)({dependsOn:["view.type"],readOnly:!0})],it.prototype,"isSupported",null),(0,s._)([(0,r.Cb)({dependsOn:["model.active","state"],readOnly:!0})],it.prototype,"cursor",null),(0,s._)([(0,r.Cb)({constructOnly:!0})],it.prototype,"model",void 0),(0,s._)([(0,a.B)("model.mode")],it.prototype,"mode",void 0),(0,s._)([(0,a.B)("model.unit")],it.prototype,"unit",void 0),(0,s._)([(0,a.B)("model.areaLabel")],it.prototype,"areaLabel",void 0),(0,s._)([(0,a.B)("model.area")],it.prototype,"area",void 0),(0,s._)([(0,a.B)("model.geodesicArea")],it.prototype,"geodesicArea",void 0),(0,s._)([(0,a.B)("model.pathLengthLabel")],it.prototype,"pathLengthLabel",void 0),(0,s._)([(0,a.B)("model.pathLength")],it.prototype,"pathLength",void 0),(0,s._)([(0,a.B)("model.geodesicPathLength")],it.prototype,"geodesicPathLength",void 0),(0,s._)([(0,a.B)("model.perimeterLengthLabel")],it.prototype,"perimeterLengthLabel",void 0),(0,s._)([(0,a.B)("model.perimeterLength")],it.prototype,"perimeterLength",void 0),(0,s._)([(0,a.B)("model.geodesicPerimeterLength")],it.prototype,"geodesicPerimeterLength",void 0),(0,s._)([(0,a.B)("model.validMeasurement")],it.prototype,"validMeasurement",void 0),(0,s._)([(0,a.B)("model.viewData")],it.prototype,"viewData",void 0),it=(0,s._)([(0,o.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],it);const st=it,nt=n.Z.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let rt=class extends f.V{constructor(e){super(e),this.supportedViewType="3d",this._handles=new g.Z,this._userUnitOptions=null,this._userUnit=null,this.tool=null}initialize(){this._handles.add([(0,_.init)(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool||this.isDisabled)return null;const e=this.tool.model,t=e.measurementMode,i=e.measurementData,s=e.validMeasurement,n=0===("euclidean"===t?i.intersectingSegments:i.geodesicIntersectingSegments).size,r=n?s?"available":"unavailable":"invalid";return{mode:t,area:{text:n&&s?e.areaLabel:null,state:r},perimeterLength:{text:n&&s?e.perimeterLengthLabel:null,state:r}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}newMeasurement(){(0,h.ignoreAbortErrors)(this.start())}clearMeasurement(){this.clear()}createToolParams(){return{toolConstructor:st,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){nt.error("AreaMeasurement3D widget is not implemented for MapView")}logError(...e){nt.error(...e)}_findSelectableUnit(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if(!e)return l.fN.slice();const t=e.filter((e=>-1!==l.fN.indexOf(e)));return 0===t.length?l.fN.slice():t}};(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["isDisabled","tool.state"]})],rt.prototype,"state",null),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["view.ready","tool.model.area","tool.model.geodesicArea","tool.model.areaLabel","tool.model.perimeterLength","tool.model.geodesicPerimeterLength","tool.model.perimeterLengthLabel","tool.model.measurementMode","tool.model.measurementData"]})],rt.prototype,"measurement",null),(0,s._)([(0,r.Cb)({constructOnly:!0})],rt.prototype,"tool",void 0),(0,s._)([(0,r.Cb)(v.Y)],rt.prototype,"defaultUnit",void 0),(0,s._)([(0,r.Cb)({dependsOn:["view.spatialReference"]})],rt.prototype,"unitOptions",null),(0,s._)([(0,r.Cb)({dependsOn:["unitOptions","defaultUnit"]})],rt.prototype,"unit",null),(0,s._)([(0,r.Cb)()],rt.prototype,"clearMeasurement",null),rt=(0,s._)([(0,o.j)("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],rt);const at=rt,ot="esri-area-measurement-3d__measurement-item",ht="esri-area-measurement-3d__measurement-item-title",lt="esri-area-measurement-3d__measurement-item-value";let dt=class extends m.default{constructor(e,t){super(e,t),this.view=null,this.visible=null,this.iconClass="esri-icon-measure-area",this.label=void 0,this.messages=null,this.messagesUnits=null,this.viewModel=new at,this.unitOptions=null,this.unit=null}render(){const{isSupported:e,active:t,measurement:i,state:s,unit:n}=this.viewModel,r="disabled"===s,a="ready"===s,o="measuring"===s||"measured"===s,{messages:h,messagesUnits:d}=this,c=t&&a?(0,p.j)("section",{key:"esri-area-measurement-3d__hint",class:"esri-area-measurement-3d__hint"},(0,p.j)("p",{class:"esri-area-measurement-3d__hint-text"},h.hint)):null,u=e?null:(0,p.j)("section",{key:"esri-area-measurement-3d__unsupported",class:"esri-area-measurement-3d__panel--error"},(0,p.j)("p",null,h.unsupported)),m=(e,t,i)=>{switch(t.state){case"available":return(0,p.j)("div",{key:`${i}-enabled`,class:ot},(0,p.j)("span",{class:ht},e),(0,p.j)("span",{class:lt},t.text));case"unavailable":return(0,p.j)("div",{key:`${i}-disabled`,class:this.classes(ot,"esri-area-measurement-3d__measurement-item--disabled")},(0,p.j)("span",{class:ht},e));case"invalid":return(0,p.j)("div",{key:`${i}-enabled`,class:ot},(0,p.j)("span",{class:ht},e),(0,p.j)("span",{class:lt},h.notApplicable))}},g=o?(0,p.j)("section",{key:"esri-area-measurement-3d__measurement",class:"esri-area-measurement-3d__measurement"},m(h.area,i.area,"area"),m(h.perimeterLength,i.perimeterLength,"perimeter-length")):null,_=`${this.id}__units`,v=(0,p.j)("label",{class:"esri-area-measurement-3d__units-label",for:_},h.unit),f=(0,p.j)("div",{class:"esri-area-measurement-3d__units-select-wrapper"},(0,p.j)("select",{class:"esri-area-measurement-3d__units-select esri-select",id:_,onchange:this._changeUnit,bind:this,value:n},this.viewModel.unitOptions.map((e=>{var t;return(0,p.j)("option",{key:e,value:e},(0,l.ZO)(e)?d.systems[e]:null==(t=d.units[e])?void 0:t.pluralCapitalized)})))),b=o?(0,p.j)("section",{key:"esri-area-measurement-3d__units",class:"esri-area-measurement-3d__units"},v,f):null,y=o?(0,p.j)("div",{key:"settings",class:"esri-area-measurement-3d__settings"},b):null,L=!e||t&&!o?null:(0,p.j)("div",{class:"esri-area-measurement-3d__actions"},(0,p.j)("button",{disabled:r,class:this.classes("esri-button esri-button--secondary","esri-area-measurement-3d__clear-button",r&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement,type:"button"},h.newMeasurement)),x=this.visible?(0,p.j)("div",{class:"esri-area-measurement-3d__container"},u,c,y,g,L):null;return(0,p.j)("div",{key:"",class:this.classes("esri-area-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},x)}_newMeasurement(){(0,h.ignoreAbortErrors)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,a.B)("viewModel.view")],dt.prototype,"view",void 0),(0,s._)([(0,a.B)("viewModel.visible"),(0,u.G)()],dt.prototype,"visible",void 0),(0,s._)([(0,a.B)("viewModel.active"),(0,u.G)()],dt.prototype,"active",void 0),(0,s._)([(0,r.Cb)()],dt.prototype,"iconClass",void 0),(0,s._)([(0,r.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dt.prototype,"label",void 0),(0,s._)([(0,r.Cb)(),(0,u.G)(),(0,c.H)("esri/widgets/AreaMeasurement3D/t9n/AreaMeasurement3D")],dt.prototype,"messages",void 0),(0,s._)([(0,r.Cb)(),(0,u.G)(),(0,c.H)("esri/core/t9n/Units")],dt.prototype,"messagesUnits",void 0),(0,s._)([(0,r.Cb)({type:at}),(0,u.G)(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],dt.prototype,"viewModel",void 0),(0,s._)([(0,a.B)("viewModel.unitOptions")],dt.prototype,"unitOptions",void 0),(0,s._)([(0,a.B)("viewModel.unit")],dt.prototype,"unit",void 0),(0,s._)([(0,d.h)()],dt.prototype,"_newMeasurement",null),(0,s._)([(0,d.h)()],dt.prototype,"_changeUnit",null),dt=(0,s._)([(0,o.j)("esri.widgets.AreaMeasurement3D")],dt);const ct=dt}}]);
//# sourceMappingURL=7483.js.map