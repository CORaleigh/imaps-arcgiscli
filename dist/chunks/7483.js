(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[7483],{41178:(e,t,i)=>{"use strict";i.d(t,{C:()=>a,b:()=>o});var s=i(85461),r=i(51219),n=i(63230);function o(e){const t=new r.kG;return t.extensions.add("GL_OES_standard_derivatives"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.varyings.add("vUV","vec2"),t.vertex.code.add(s.H`
    void main(void) {
      vUV = uv0;
      gl_Position = proj * view * vec4(position.xyz, 1.0);
    }
  `),t.fragment.uniforms.add("size","vec2").add("color1","vec4").add("color2","vec4"),t.fragment.include(n.Y),t.fragment.code.add(s.H`
    void main() {
      vec2 uvScaled = vUV / (2.0 * size);

      vec2 uv = fract(uvScaled - 0.25);
      vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);
      float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));
      float t = mix(abs(ab.x + ab.y), 0.5, fade);

      gl_FragColor = mix(color2, color1, t);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
  `),t}var a=Object.freeze({__proto__:null,build:o})},32811:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(93533);class r{constructor(e,t){this.measure=(0,s.j3)(t),this.value=e,this.unit=t}get isBaseUnit(){return(0,s.YH)(this.unit)}toUnit(e){return new r((0,s.En)(this.value,this.unit,e),e)}toBaseUnit(){return this.toUnit((0,s.WB)(this.unit))}}const n=r},27202:(e,t,i)=>{"use strict";function s(e,t,i){const s=t&&t.length,a=s?t[0]*i:e.length;let h=r(e,0,a,i,!0);const l=new Array;if(!h||h.next===h.prev)return l;let d,p,m,g,_;if(s&&(h=function(e,t,i,s){const o=new Array;for(let i=0,n=t.length;i<n;i++){const a=r(e,t[i]*s,i<n-1?t[i+1]*s:e.length,s,!1);a===a.next&&(a.steiner=!0),o.push(c(a))}o.sort(w);for(const e of o)u(e,i),i=n(i,i.next);return i}(e,t,h,i)),e.length>80*i){d=m=e[0],p=g=e[1];for(let t=i;t<a;t+=i){const i=e[t],s=e[t+1];d=Math.min(d,i),p=Math.min(p,s),m=Math.max(m,i),g=Math.max(g,s)}_=Math.max(m-d,g-p),_=0!==_?1/_:0}return o(h,l,i,d,p,_),l}function r(e,t,i,s,r){let n;if(r===v(e,t,i,s)>0)for(let r=t;r<i;r+=s)n=l(r,e[r],e[r+1],n);else for(let r=i-s;r>=t;r-=s)n=l(r,e[r],e[r+1],n);return n&&x(n,n.next)&&(d(n),n=n.next),n}function n(e,t=e){if(!e)return e;let i,s=e;do{if(i=!1,s.steiner||!x(s,s.next)&&0!==g(s.prev,s,s.next))s=s.next;else{if(d(s),s=t=s.prev,s===s.next)break;i=!0}}while(i||s!==t);return t}function o(e,t,i,s,r,l,c=0){if(!e)return;!c&&l&&(e=p(e,s,r,l));let u=e;for(;e.prev!==e.next;){const p=e.prev,m=e.next;if(l?h(e,s,r,l):a(e))t.push(p.index/i),t.push(e.index/i),t.push(m.index/i),d(e),e=m.next,u=m.next;else if((e=m)===u){c?1===c?o(e=L(e,t,i),t,i,s,r,l,2):2===c&&C(e,t,i,s,r,l):o(n(e),t,i,s,r,l,1);break}}}function a(e){const t=e.prev,i=e,s=e.next;if(g(t,i,s)>=0)return!1;let r=e.next.next;const n=r;let o=0;for(;r!==e.prev&&(0===o||r!==n);){if(o++,f(t.x,t.y,i.x,i.y,s.x,s.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function h(e,t,i,s){const r=e.prev,n=e,o=e.next;if(g(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,h=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,l=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,d=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,c=y(a,h,t,i,s),u=y(l,d,t,i,s);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=c&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&f(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&f(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&f(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(e,t,i,s){const r=new M(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function d(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function u(e,t){if(t=function(e,t){let i=t;const s=e.x,r=e.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>o){if(o=e,e===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(s===o)return n.prev;const a=n,h=n.x,l=n.y;let d,c=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=h&&s!==i.x&&f(r<l?s:o,r,h,l,r<l?o:s,r,i.x,i.y)&&(d=Math.abs(r-i.y)/(s-i.x),(d<c||d===c&&i.x>n.x)&&b(i,e)&&(n=i,c=d)),i=i.next;return n}(e,t)){const i=P(t,e);n(i,i.next)}}function p(e,t,i,s){for(let r;r!==e;r=r.next){if(r=r||e,null===r.z&&(r.z=y(r.x,r.y,t,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,p(e,t,i,s);r.prevZ=r.prev,r.nextZ=r.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,i=1;for(;;){let s,r=e;e=null,t=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}r=s}if(t.nextZ=null,i*=2,n<2)return e}}(e)}function m(e,t,i,s){const r=t&&t.length,n=r?t[0]*i:e.length;let o=Math.abs(v(e,0,n,i));if(r)for(let s=0,r=t.length;s<r;s++){const n=t[s]*i,a=s<r-1?t[s+1]*i:e.length;o-=Math.abs(v(e,n,a,i))}let a=0;for(let t=0;t<s.length;t+=3){const r=s[t]*i,n=s[t+1]*i,o=s[t+2]*i;a+=Math.abs((e[r]-e[o])*(e[n+1]-e[r+1])-(e[r]-e[n])*(e[o+1]-e[r+1]))}return 0===o&&0===a?0:Math.abs((a-o)/o)}function g(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t,i,s){return!!(x(e,t)&&x(i,s)||x(e,s)&&x(i,t))||g(e,t,i)>0!=g(e,t,s)>0&&g(i,s,e)>0!=g(i,s,t)>0}function v(e,t,i,s){let r=0;for(let n=t,o=i-s;n<i;n+=s)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}function f(e,t,i,s,r,n,o,a){return(r-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(i-o)*(t-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function y(e,t,i,s,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x(e,t){return e.x===t.x&&e.y===t.y}function w(e,t){return e.x-t.x}function L(e,t,i){let s=e;do{const r=s.prev,n=s.next.next;!x(r,n)&&_(r,s,s.next,n)&&b(r,n)&&b(n,r)&&(t.push(r.index/i),t.push(s.index/i),t.push(n.index/i),d(s),d(s.next),s=e=n),s=s.next}while(s!==e);return s}function C(e,t,i,s,r,a){let h=e;do{let e=h.next.next;for(;e!==h.prev;){if(h.index!==e.index&&S(h,e)){let l=P(h,e);return h=n(h,h.next),l=n(l,l.next),o(h,t,i,s,r,a),void o(l,t,i,s,r,a)}e=e.next}h=h.next}while(h!==e)}function S(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){let i=e,s=!1;const r=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)}function P(e,t){const i=new M(e.index,e.x,e.y),s=new M(t.index,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}i.d(t,{P:()=>m,O:()=>s});class M{constructor(e,t,i){this.index=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},58508:(e,t,i)=>{"use strict";i.d(t,{Bs:()=>l,VG:()=>r,Ud:()=>a,Zv:()=>h,Rd:()=>n,Wv:()=>o});var s=i(56888);function r(e,t,i,r=2,n="abbr"){return(0,s.VG)(e,t.toUnit(i).value,i,r,n)}function n(e,t,i=2,r="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,s.Rd)(e,t.value,t.unit,i,r)}function o(e,t,i=2,r="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,s.Wv)(e,t.value,t.unit,i,r)}function a(e,t,i=2,r="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,s.Ud)(e,t.value,t.unit,i,r)}function h(e,t,i=2,r="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,s.Zv)(e,t.value,t.unit,i,r)}function l(e){if("angle"!==e.measure)throw new Error("quantity is not an angle");return(0,s.Bs)(e.value,e.unit)}},17729:(e,t,i)=>{"use strict";i.d(t,{h:()=>r});const s=(e,t,i)=>{for(let r=0,n=t.length;r<n;r++){let n=t[r];Array.isArray(n)?s(e,n,i):null!=n&&!1!==n&&("string"==typeof n&&(n={vnodeSelector:"",properties:void 0,children:void 0,text:n.toString(),domNode:null}),i.push(n))}};function r(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let r,n;return i&&1===i.length&&"string"==typeof i[0]?r=i[0]:i&&(n=[],s(e,i,n),0===n.length&&(n=void 0)),{vnodeSelector:e,properties:t,children:n,text:""===r?void 0:r,domNode:null}}},84397:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var s=i(93533);const r=class{constructor(e=null){this.spatialReference=e,this._updateNormalizationFactors}get spatialReference(){return this._spatialReference}set spatialReference(e){e!==this._spatialReference&&(this._spatialReference=e,this._updateNormalizationFactors())}normalizeDistance(e){return e*this._metersPerDistanceUnit}normalizeElevation(e){return e*this._metersPerElevationUnit}normalizeArea(e){return e*this._squareMetersPerAreaUnit}_updateNormalizationFactors(){this._metersPerDistanceUnit=(0,s.c9)(this._spatialReference,1),this._metersPerElevationUnit=(0,s.c9)(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}}},16358:(e,t,i)=>{"use strict";i.d(t,{jB:()=>a,L1:()=>d,D7:()=>h,_n:()=>l});var s=i(96071),r=i(77625),n=(i(17387),i(14286)),o=i(39160);function a(e){switch(e){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}function h(e,t,i){const s=function(e,t,i){return e.projectToRenderScreen(t,m),!(m[2]<0||m[2]>1||(e.renderToScreen(m,i),0))}(i,t,g);return s&&e.updatePosition(g,null),s}function l(e,t,i,s,r){const a=function(e,t,i,s,r,a){if(!t)return!1;(0,o.cT)(t.start,t.end,c,e),(0,n.s)(p,-c[1],c[0]);let h=!1;switch(s){case"top":h=p[1]<0;break;case"bottom":h=p[1]>0;break;case"left":h=p[0]>0;break;case"right":h=p[0]<0}if(h&&(0,n.n)(p,p),0===(0,n.l)(p))switch(s){case"top":p[1]=1;break;case"bottom":p[1]=-1;break;case"left":p[0]=-1;break;case"right":p[0]=1}return e.projectToRenderScreen(t.origin,m),!(m[2]<0||m[2]>1||(e.renderToScreen(m,r),(0,n.a)(p,p,i*e.pixelRatio),(0,n.h)(p,p,m),e.renderToScreen(p,a),0))}(r,t,i,s,g,_);return a&&e.updatePosition(g,_),a}function d(e,t,i,s,r){const a=function(e,t,i,s,r,a){return!(!t||!i||((0,o.cT)(t.end,t.start,c,e),(0,o.cT)(i.start,i.end,u,e),(0,n.h)(p,c,u),(0,n.n)(p,p),(0,n.e)(p,p),e.projectToRenderScreen(t.end,m),m[2]<0||m[2]>1||(e.renderToScreen(m,r),(0,n.a)(p,p,s*e.pixelRatio),(0,n.h)(p,p,m),e.renderToScreen(p,a),0)))}(r,t,i,s,g,_);return a&&e.updatePosition(g,_),a}const c=(0,s.gX)(),u=(0,s.gX)(),p=(0,s.gX)(),m=(0,s.J$)(),g=((0,s.J$)(),(0,r.c)(),(0,s.s1)()),_=(0,s.s1)()},39160:(e,t,i)=>{"use strict";i.d(t,{gh:()=>h,H2:()=>d,Vl:()=>p,B$:()=>l,cT:()=>c});var s=i(82550),r=i(96071),n=i(77625),o=i(17387),a=(i(67128),i(14286));(0,n.c)();function h(e,t){const i=(0,s.jB)({},e),r=(0,s.d9)(t);return(0,s.jB)(i,r),i}function l(e,t,i,s){for(;e.length<t;)e.push(i());if(s)for(;e.length>t;)s(e.pop());else e.length=t}function d(e,t){if((0,o.s)(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)(0,o.b)(t,t,e[i]);(0,o.a)(t,t,1/e.length)}}function c(e,t,i,s){s.projectToRenderScreen(e,_),s.projectToRenderScreen(t,f),(0,a.d)(i,b,v),(0,a.e)(i,i)}function u(e,t,i){const s=i.state.camera;i.renderCoordsHelper.toRenderCoords(e,m),s.projectToRenderScreen(m,g),i.state.camera.renderToScreen(g,t)}function p(e,t,i){return u(e,y,i),u(t,x,i),(0,a.i)(y,x)}const m=(0,n.c)(),g=(0,r.J$)(),_=(0,r.J$)(),v=_,f=(0,r.J$)(),b=f,y=((0,r.s1)(),(0,r.s1)()),x=(0,r.s1)()},88089:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(82677)),a=(i(38836),i(17729));i(79618);let h=class extends o.default{constructor(e){super(e),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(e){this._set("startX",e[0]),this._set("startY",e[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(e){this._set("endX",e[0]),this._set("endY",e[1])}get strokeStyle(){const e=this.color;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get lineCap(){return"round"}render(){const{height:e,left:t,top:i,width:s,x1:r,x2:n,y1:o,y2:h}=this.calculateCoordinates(l),d=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return(0,a.h)("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:i+"px",width:s+"px",height:e+"px",visibility:this.visible?"visible":"hidden"}},[(0,a.h)("svg",{width:s,height:e},[(0,a.h)("line",{x1:r,y1:o,x2:n,y2:h,style:d})])])}renderCanvas(e){if(!this.visible)return;e.strokeStyle=this.strokeStyle,e.lineWidth=this.width,e.lineCap=this.lineCap;const t=this.calculateCoordinates(l);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}calculateCoordinates(e){const t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),s=Math.min(this.startY,this.endY),r=Math.max(this.startY,this.endY),n=this.width;return e.left=t-n,e.top=s-n,e.width=i-t+2*n,e.height=Math.max(20,r-s+2*n),e.x1=this.startX-t+n,e.y1=this.startY-s+n,e.x2=this.endX-t+n,e.y2=this.endY-s+n,e}};(0,s._)([(0,r.Cb)()],h.prototype,"startX",void 0),(0,s._)([(0,r.Cb)()],h.prototype,"startY",void 0),(0,s._)([(0,r.Cb)()],h.prototype,"endX",void 0),(0,s._)([(0,r.Cb)()],h.prototype,"endY",void 0),(0,s._)([(0,r.Cb)({dependsOn:["startX","startY"]})],h.prototype,"startPosition",null),(0,s._)([(0,r.Cb)({dependsOn:["endX","endY"]})],h.prototype,"endPosition",null),(0,s._)([(0,r.Cb)()],h.prototype,"width",void 0),(0,s._)([(0,r.Cb)()],h.prototype,"color",void 0),(0,s._)([(0,r.Cb)()],h.prototype,"visible",void 0),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["color"]})],h.prototype,"strokeStyle",null),h=(0,s._)([(0,n.j)("esri.views.overlay.LineOverlayItem")],h);const l={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};const d=h},41233:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=(i(10923),i(57002),i(86035),i(82677)),a=(i(38836),i(17729));i(79618);const h={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let l=class extends o.default{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor="rgba(0, 0, 0, 0.6)",this.textColor="white",this.textShadowColor=[0,0,0],this.textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get padding(){return.5*this.fontSize}render(){return(0,a.h)("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:`0 0 ${this.textShadowSize}px rgb(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]})`}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this.padding,s=this.padding,r=e.measureText(this.text).width,n=this.fontSize,o=d[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=r+2*i,h=n+2*i,l=this.x+o.x*a,c=this.y+o.y*h;this.roundedRect(e,l,c,a,h,s),e.fillStyle=this.backgroundColor,e.fill();const u=this.x+(o.x+.5)*a,p=this.y+(o.y+.5)*h;this._renderTextShadow(e,this.text,u,p),e.fillStyle=this.textColor,e.fillText(this.text,u,p)}_renderTextShadow(e,t,i,s){e.lineJoin="miter",e.fillStyle=`rgba(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]}, ${1/c.length})`;const r=this.textShadowSize;for(const[n,o]of c)e.fillText(t,i+r*n,s+r*o)}roundedRect(e,t,i,s,r,n){e.beginPath(),e.moveTo(t,i+n),e.arcTo(t,i,t+n,i,n),e.lineTo(t+s-n,i),e.arcTo(t+s,i,t+s,i+n,n),e.lineTo(t+s,i+r-n),e.arcTo(t+s,i+r,t+s-n,i+r,n),e.lineTo(t+n,i+r),e.arcTo(t,i+r,t,i+r-n,n),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in h)e[h[t]]=this.anchor===t;return e}};(0,s._)([(0,r.Cb)()],l.prototype,"x",void 0),(0,s._)([(0,r.Cb)()],l.prototype,"y",void 0),(0,s._)([(0,r.Cb)({dependsOn:["x","y"]})],l.prototype,"position",null),(0,s._)([(0,r.Cb)()],l.prototype,"text",void 0),(0,s._)([(0,r.Cb)()],l.prototype,"fontSize",void 0),(0,s._)([(0,r.Cb)()],l.prototype,"anchor",void 0),(0,s._)([(0,r.Cb)()],l.prototype,"visible",void 0),(0,s._)([(0,r.Cb)({dependsOn:["fontSize"]})],l.prototype,"padding",null),l=(0,s._)([(0,n.j)("esri.views.overlay.TextOverlayItem")],l);const d={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},c=[];{const e=16;for(let t=0;t<360;t+=360/e)c.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const u=l},17483:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ct});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),o=i(51894),a=i(87566),h=(i(10923),i(57002),i(86035),i(39105)),l=i(93533),d=(i(40450),i(24258)),c=i(9200),u=i(90846),p=i(19401),m=i(90806),g=i(59691),_=i(80621),v=i(65867),f=i(19539),b=i(76916),y=i(59472),x=i(96071),w=i(77625),L=i(17387),C=i(89333),S=i(67128),P=i(17333),M=i(12811),O=i(8344),A=i(69534),D=i(39746),j=i(88909),R=i(67134),V=i(68500),T=i(89852),U=i(57511),k=i(48430),z=i(86509),I=i(73103),Z=i(34937),G=i(50777),E=i(88089),B=i(41233);const H=class{constructor(e){this._textItem=new B.Z({visible:!1}),this._calloutItem=new E.Z({visible:!1,width:2}),this._visible=!1,this._calloutVisible=!0,e&&(this.fontSize=e)}get textItem(){return this._textItem}get calloutItem(){return this._calloutItem}set text(e){this._textItem.text=e}get text(){return this._textItem.text}set fontSize(e){this._textItem.fontSize=e}get fontSize(){return this._textItem.fontSize}set visible(e){this._visible=e,this._updateVisibility()}get visible(){return this._visible}addToView(e){e.overlay.items.addMany([this._textItem,this._calloutItem])}removeFromView(e){e.overlay&&!e.overlay.destroyed&&e.overlay.items.removeMany([this._textItem,this._calloutItem])}updatePosition(e,t){if(t){const i=t[0]-e[0],s=t[1]-e[1];this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(s)?i>0?"left":"right":s>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],this._calloutVisible=!0}else this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",this._calloutVisible=!1}_updateVisibility(){this._textItem.visible=this._visible,this._calloutItem.visible=this._visible&&this._calloutVisible}};var W=i(39160);const q=class{constructor(){this.origin=(0,w.c)(),this.start=(0,w.c)(),this.end=(0,w.c)()}update(e,t,i){if((0,L.g)(this.start,e),(0,L.g)(this.end,t),i)switch(i){case"start":(0,L.g)(this.origin,this.start);break;case"center":(0,W.H2)([e,t],this.origin);break;case"end":(0,L.g)(this.origin,this.end);break;default:(0,L.g)(this.origin,i)}else(0,W.H2)([e,t],this.origin)}};var F,$=i(16358),Y=i(17154);!function(e){e.Linear=class{constructor(e,t){this._startPosition=(0,w.c)(),this._endPosition=(0,w.c)(),(0,L.g)(this._startPosition,e),(0,L.g)(this._endPosition,t)}eval(e,t){(0,L.e)(t,this._startPosition,this._endPosition,e)}},e.Spherical=class{constructor(e,t,i,s){this._startPosition=(0,w.c)(),this._endPosition=(0,w.c)();const r=(0,C.rS)(i);(0,P.SH)(e,i,this._startPosition,r),(0,P.SH)(t,i,this._endPosition,r),this._destSR=s}eval(e,t){(0,Y.ZA)(this._startPosition,this._endPosition,e,t),(0,P.SH)(t,(0,C.rS)(this._destSR),t,this._destSR)}}}(F||(F={}));const X=F;var N=i(26701),J=i(30090),K=i(10762),Q=i(6048),ee=i(23240),te=i(97853),ie=i(44801),se=i(11379),re=i(51007),ne=i(36904),oe=i(89553),ae=i(66704),he=i(41178);class le extends te.A{initializeProgram(e){const t=le.shader.get(),i=this.configuration,s=t.build({OITEnabled:0===i.transparencyPassType});return new re.Z(e.rctx,s.generateSource("vertex"),s.generateSource("fragment"),se.i)}bindPass(e,t,i){oe.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform2fv("size",t.size),this.program.setUniform4fv("color1",t.color1),this.program.setUniform4fv("color2",t.color2)}bindDraw(e){oe.G.bindView(this.program,e)}setPipelineState(e){const t=this.configuration,i=3===e,s=2===e;return(0,ne.sm)({blending:t.transparent?i?ce:(0,ae.$L)(e):null,depthTest:{func:(0,ae.$x)(e)},depthWrite:i?t.writeDepth&&ne.LZ:(0,ae.Vc)(e),colorWrite:ne.BK,polygonOffset:i||s?t.polygonOffset&&de:{factor:-1,units:-25}})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}le.shader=new ee.J(he.C,(()=>i.e(6606).then(i.bind(i,76606))));const de={factor:0,units:-25},ce=(0,ne.wK)(770,1,771,771);class ue extends ie.m{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.transparencyPassType=3}}(0,s._)([(0,ie.o)()],ue.prototype,"transparent",void 0),(0,s._)([(0,ie.o)()],ue.prototype,"writeDepth",void 0),(0,s._)([(0,ie.o)()],ue.prototype,"polygonOffset",void 0),(0,s._)([(0,ie.o)({count:4})],ue.prototype,"transparencyPassType",void 0);class pe extends K.F5{constructor(e,t){super(t,e,ge),this.techniqueConfig=new ue}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e){return this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig}intersect(e,t,i,s,r,n,o){return(0,J.Bw)(e,t,s,r,n,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output?new me(e):void 0}createBufferWriter(){return new Q.G_(Q.W1)}}class me extends N.Z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(le,this.material.getTechniqueConfig(e),this.technique)}beginSlot(e){let t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const ge={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,writeDepth:!0,polygonOffset:!1,...K.zh},_e={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};class ve{constructor(e,t=new I.D,i={}){this._model=e,this._manipulators=t,this.vertexManipulators=[],this._visible=!1,this._laserLineRenderer=null,this._cursorManipulator=null,this._pathSegmentObjects=[],this._perimeterSegmentObjects=[],this._projectionLineObjects=[],this._areaLabel=new H(16),this._pathLengthLabel=new H(12),this._cursorSegmentLengthLabel=new H(12),this._perimeterLengthLabel=new H(12),this._pathLabelSegments=[],this._perimeterLabelSegments=[],this._cursorSegmentLengthLabelSegment=new q,this._listenerHandles=null,this._origin=(0,w.c)(),this._originTransform=(0,M.a)(),this._tempStartPosition=(0,w.c)(),this._tempEndPosition=(0,w.c)(),this._tempHandlePosition=(0,w.c)(),this._sceneView=this._model.sceneView,this._params=(0,W.gh)(_e,i),this._layer=new T.Z("path-measurement-tool",{isPickable:!1}),this._createMaterials(),this._createObjects(),this._intersector=new R.r(this._sceneView.state.mode),this._intersector.options.store=0;const s=(0,G.aD)(this._sceneView,this._params.handleColor,this._params.handleOpacity);s.available=!1,s.radius=this._params.handleRadius,s.interactive=!1,this._manipulators.add(s),this._cursorManipulator=s}destroy(){this.hide()}get requiresCursorPoint(){return("initial"===this._model.state||"drawing"===this._model.state)&&this._model.active}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){return{labels:{area:this._areaLabel,pathLength:this._pathLengthLabel,cursorSegmentLength:this._cursorSegmentLengthLabel,perimeterLength:this._perimeterLengthLabel},laserLineRenderer:this._laserLineRenderer}}show(){if(this._visible)return;this._visible=!0;const e=this._sceneView._stage,t={glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,globalAlpha:this._params.laserLineGlobalAlpha};this._laserLineRenderer=new z.J(this._sceneView.renderCoordsHelper,t),e.addRenderPlugin(this._laserLineRenderer.renderSlots,this._laserLineRenderer),this._addToStage(e),this._areaLabel.addToView(this._sceneView),this._pathLengthLabel.addToView(this._sceneView),this._cursorSegmentLengthLabel.addToView(this._sceneView),this._perimeterLengthLabel.addToView(this._sceneView),this._initializeListeners(),this._updateAll(this._model.viewData)}hide(){if(!this._visible)return;this._visible=!1;const e=this._sceneView._stage;e.removeRenderPlugin(this._laserLineRenderer),this._laserLineRenderer=null,this._destroyListeners(),this._updatePathLength(0),this._removeFromStage(e),this._areaLabel.removeFromView(this._sceneView),this._pathLengthLabel.removeFromView(this._sceneView),this._cursorSegmentLengthLabel.removeFromView(this._sceneView),this._perimeterLengthLabel.removeFromView(this._sceneView),this._sceneView.cursor=null}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return(0,y.pC)(i)?this.manipulatorIdToVertexId(i):null}manipulatorIdToVertexId(e){for(let t=0;t<this.vertexManipulators.length;t++){const{id:i}=this.vertexManipulators[t];if(e===i)return t}return null}pick(e){const t=this._sceneView.spatialReference,i=(0,x.md)(e.screenPoint);this._sceneView.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,r=(0,w.c)();if(!s.getIntersectionPoint(r))return new ve.PickResult;const n=this._sceneView.renderCoordsHelper.fromRenderCoords(r,t),o="TerrainRenderer"===s.intersector?"surface":"feature";return new ve.PickResult(o,r,n)}overlappingHandles(e,t){return(0,W.Vl)(e,t,this._sceneView)<=this._params.handleRadius}screenToMap3D(){return(0,Z.gv)(this._sceneView)}_createMaterials(){this._pathLineMaterial=new U.U({width:this._params.pathLineWidth,color:this._params.pathLineColor,polygonOffset:!0,renderOccluded:4},"path-line"),this._intersectingPathLineMaterial=new U.U({width:this._params.pathLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4},"intersecting-path-line"),this._perimeterLineMaterial=new U.U({width:this._params.perimeterLineWidth,color:this._params.perimeterLineColor,polygonOffset:!0,renderOccluded:4},"perimeter-line"),this._intersectingPerimeterLineMaterial=new U.U({width:this._params.perimeterLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4},"intersecting-perimeter-line"),this._projectionLineMaterial=new U.U({width:this._params.projectionLineWidth,color:this._params.projectionLineColor,polygonOffset:!0,stipplePattern:(0,k.z5)(this._params.projectionLineStippleSize),stippleIntegerRepeats:!1,renderOccluded:4},"projection-line"),this._checkerBoardMaterial=new pe({color1:this._params.areaColor1,color2:this._params.areaColor2,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:4},"checker-board")}_createObjects(){this._cursorSegmentObject=new j.Z,this._areaObject=new j.Z}_addToStage(e){e.add(0,this._layer),e.add(3,this._pathLineMaterial),e.add(3,this._intersectingPathLineMaterial),e.add(3,this._perimeterLineMaterial),e.add(3,this._intersectingPerimeterLineMaterial),e.add(3,this._projectionLineMaterial),e.add(3,this._checkerBoardMaterial),e.addToViewContent([this._layer.id])}_removeFromStage(e){e.removeFromViewContent([this._layer.id]),e.remove(0,this._layer.id),e.remove(3,this._pathLineMaterial.id),e.remove(3,this._intersectingPathLineMaterial.id),e.remove(3,this._perimeterLineMaterial.id),e.remove(3,this._intersectingPerimeterLineMaterial.id),e.remove(3,this._projectionLineMaterial.id),e.remove(3,this._checkerBoardMaterial.id)}_syncViewData(e){if(!this._visible)return"none";const t=e.pathChanges;"full"===t.change?this._updateAll(e):"incremental"===t.change&&(t.updatedVertices.forEach((t=>{const i=(t-1+this._model.path.length)%this._model.path.length;this._updatePathSegment(e,t),this._updatePathSegment(e,i),this._updateVertexHandle(e,t),this._updateArea(e),this._updatePerimeterSegments(e),this._updateProjectionLines(e),this._updateLaserLine(),this._updateLabels(e)})),t.updatedVertices.has(this._model.path.length-1)&&this._updateCursorSegment());const i=t.change;return t.clear(),i}_updateAfterSyncViewData(e){const t=this._model.viewData;"full"!==this._syncViewData(t)&&e&&e(t)}_updateOrigin(e){(0,W.H2)(e.positionsRenderCoords,this._origin),(0,S.i)(this._originTransform),(0,S.t)(this._originTransform,this._originTransform,this._origin)}_updateAll(e){this._updateOrigin(e),this._updatePathLength(e.path.length),this._updatePathSegments(e),this._updatePerimeterSegments(e),this._updateHandles(e),this._updateArea(e),this._updateProjectionLines(e),this._updateLabels(e),this._updateLaserLine()}_updateCameraDependent(e){this._updateHandles(e),this._updateProjectionLines(e),this._updateLabels(e)}_updatePathLength(e){this._resizeObject3DArray(this._pathSegmentObjects,e),this._resizeObject3DArray(this._perimeterSegmentObjects,e),this._resizeManipulatorArray(this.vertexManipulators,e),(0,W.B$)(this._pathLabelSegments,e,(()=>new q)),(0,W.B$)(this._perimeterLabelSegments,e,(()=>new q))}_updatePathSegments(e){for(let t=0;t<this._pathSegmentObjects.length;++t)this._updatePathSegment(e,t);this._updateCursorSegment()}_updatePathSegment(e,t){const i=e.path,s=this._pathSegmentObjects[t];e.validMeasurement||t<i.length-1?(this._createInterpolatedLineGeometry(s,e.intersectingSegments.has(t)?this._intersectingPathLineMaterial:this._pathLineMaterial,"path-segment",e.positionsRenderCoords[t],e.positionsRenderCoords[(t+1)%i.length],this._origin,this._originTransform,this._model.measurementMode,this._pathLabelSegments[t],e.validMeasurement?"center":"end"),this._addObject3D(s)):(s.removeAllGeometries(),this._removeObject3D(s))}_updateCursorSegment(){const e=this._sceneView.renderCoordsHelper,t=this._model.path,i=this._cursorSegmentObject;t.length>0&&"drawing"===this._model.state&&this._model.cursorPoint?(e.toRenderCoords(t.back,this._tempStartPosition),e.toRenderCoords(this._model.cursorPoint,this._tempEndPosition),this._createInterpolatedLineGeometry(i,this._pathLineMaterial,"path-segment",this._tempStartPosition,this._tempEndPosition,this._origin,this._originTransform,this._model.measurementMode,this._cursorSegmentLengthLabelSegment,"end"),this._addObject3D(i)):(i.removeAllGeometries(),this._removeObject3D(i))}_updatePerimeterSegments(e){for(let t=0;t<this._perimeterSegmentObjects.length;++t)this._updatePerimeterSegment(e,t)}_updatePerimeterSegment(e,t){const i=e.path,s=this._perimeterSegmentObjects[t];e.validMeasurement&&"geodesic"!==this._model.measurementMode?(this._updatePerimeterSegmentObject(s,e.positionsFittedRenderCoords[t],e.positionsFittedRenderCoords[(t+1)%i.length],this._origin,this._originTransform,e.intersectingSegments.has(t),this._perimeterLabelSegments[t]),this._addObject3D(s)):(s.removeAllGeometries(),this._removeObject3D(s))}_updatePerimeterSegmentObject(e,t,i,s,r,n,o){this._createInterpolatedLineGeometry(e,n?this._intersectingPerimeterLineMaterial:this._perimeterLineMaterial,"perimeter-segment",t,i,s,r,this._model.measurementMode,o)}_updateHandles(e){for(let t=0;t<this.vertexManipulators.length;++t)this._updateVertexHandle(e,t);this._updateCursorHandle()}_updateVertexHandle(e,t){const{manipulator:i}=this.vertexManipulators[t];i.renderLocation=e.positionsRenderCoords[t]}_updateCursorHandle(){const e=this._cursorManipulator;"drawing"===this._model.state&&this._model.cursorPoint?(e.available=!0,e.location=this._model.cursorPoint):e.available=!1}_updateArea(e){switch(this._model.measurementMode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this._areaObject;if(e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices){const i=[],s=(0,w.c)();e.positionsFittedRenderCoords.forEach((e=>{(0,L.f)(s,e,this._origin),i.push(s[0],s[1],s[2])}));const r=[];e.positionsProjected.forEach((e=>{r.push(e[0],e[1])}));const n=new A.b({position:{size:3,data:i},uv0:{size:2,data:r}},{position:e.triangleIndices,uv0:e.triangleIndices}),o=new V.Z(n,"area");t.removeAllGeometries(),t.addGeometry(o,this._checkerBoardMaterial,this._originTransform),this._addObject3D(t),this._checkerBoardMaterial.setParameterValues({size:[e.checkerSize,e.checkerSize]})}else t.removeAllGeometries(),this._removeObject3D(t)}_updateAreaGeodesic(){const e=this._areaObject;e.removeAllGeometries(),this._removeObject3D(e)}_updateProjectionLines(e){const t=e.path;this._resizeObject3DArray(this._projectionLineObjects,t.length);for(let i=0;i<t.length;++i)this._updateProjectionLine(e,i)}_updateProjectionLine(e,t){const i=this._projectionLineObjects[t];if(i.removeAllGeometries(),e.validMeasurement&&"euclidean"===this._model.measurementMode){const e=(0,w.c)();(0,L.f)(e,this._model.viewData.positionsRenderCoords[t],this._origin);const s=(0,w.c)();(0,L.f)(s,this._model.viewData.positionsFittedRenderCoords[t],this._origin);const r=new V.Z(D.Z.createPolylineGeometry([e,s]),"projected-line");i.addGeometry(r,this._projectionLineMaterial,this._originTransform),this._addObject3D(i)}else this._removeObject3D(i)}_updateLabels(e){const t=this._sceneView.state.camera,i=this._params.labelDistance,s=this._model,r="geodesic"===s.measurementMode,n="drawing"===s.state,o=(e,t)=>e.visible&&t.visible&&this._sceneView.overlay.overlaps(e.textItem,t.textItem);{const i=this._areaLabel,r=(0,$.D7)(i,e.areaCentroid,t);i.text=s.areaLabel,i.visible=r&&e.validMeasurement&&0===e.intersectingSegments.size&&null!=s.areaLabel}{const r=this._pathLengthLabel,o=this._pathLabelSegments[e.pathLengthLabelSegmentIndex],a=this._cursorSegmentLengthLabelSegment,h=(0,$.L1)(r,o,a,i,t);r.text=s.pathLengthLabel,r.visible=h&&n&&s.path.length>0}{const e=this._cursorSegmentLengthLabel,r=this._cursorSegmentLengthLabelSegment,o=(0,$._n)(e,r,i,"bottom",t);e.text=s.cursorSegmentLengthLabel,e.visible=o&&n&&s.cursorSegmentLength&&0!==s.cursorSegmentLength.value}o(this._cursorSegmentLengthLabel,this._pathLengthLabel)&&(this._cursorSegmentLengthLabel.visible=!1),o(this._pathLengthLabel,this._areaLabel)&&(this._pathLengthLabel.visible=!1);{const n=this._perimeterLengthLabel;if(s.validMeasurement&&0===e.intersectingSegments.size)for(let a=0;a<e.path.length;++a){const h=(e.perimeterLengthLabelSegmentIndex+a)%e.path.length,l=r?this._pathLabelSegments[h]:this._perimeterLabelSegments[h],d=(0,$._n)(n,l,i,"top",t);if(n.text=s.perimeterLengthLabel,n.visible=d,!o(n,this._areaLabel))break;n.visible=!1}else n.visible=!1}}_getFocusPoint(){const e=this._model,t=this._model.lastDraggedVertex;switch(e.state){case"drawing":return e.cursorPoint?e.cursorPoint:e.path.vertex((0,y.pC)(t)?t:e.path.length-1);case"editing":return(0,y.pC)(t)?e.path.vertex(t):null;default:return e.cursorPoint}}_updateLaserLine(){const e=this._model,t=this._params.laserLineEnabled&&"measured"!==e.state&&e.active;this._laserLineRenderer.pointDistanceEnabled=!1,this._laserLineRenderer.lineVerticalPlaneEnabled=!1;const i=this._getFocusPoint();if(t&&i){const e=this._tempHandlePosition;this._sceneView.renderCoordsHelper.toRenderCoords(i,e),this._laserLineRenderer.heightManifoldTarget=e,this._laserLineRenderer.heightManifoldEnabled=!0}else this._laserLineRenderer.heightManifoldEnabled=!1}_addObject3D(e){e.parentLayer||(this._layer.addObject(e),this._sceneView._stage.add(1,e))}_removeObject3D(e){e.parentLayer&&(this._layer.removeObject(e),this._sceneView._stage.remove(1,e.id))}_resizeObject3DArray(e,t){(0,W.B$)(e,t,(()=>new j.Z),(e=>{this._removeObject3D(e)}))}_resizeManipulatorArray(e,t){(0,W.B$)(e,t,(()=>{const e=(0,G.aD)(this._sceneView,this._params.handleColor,this._params.handleOpacity);return e.radius=this._params.handleRadius,{id:this._manipulators.add(e),manipulator:e}}),(({manipulator:e})=>{this._manipulators.remove(e)}))}_createInterpolatedLineGeometry(e,t,i,s,r,n,o,a,h,l){const d=this._sceneView.renderCoordsHelper,c=[],u=[],p=(e,t)=>{const i=O.WM.get();(0,L.f)(i,e,n),c.push(i),u.push(t)};if("euclidean"===a){const e=O.WM.get();(0,W.H2)([s,r],e);const t=O.WM.get();d.worldUpAtPosition(e,t),p(s,t),p(r,t),h&&h.update(s,r,l)}else{const e=this._getSegmentInterpolator(s,r),t=this._params.lineSubdivisions+1&-2;let i=null,n=null,o=t/2-1,a=t/2;"start"===l?(o=0,a=1):"end"===l&&(o=t-2,a=t-1);for(let s=0;s<t;++s){const r=s/(t-1),h=O.WM.get(),l=O.WM.get();e.eval(r,h),d.worldUpAtPosition(h,l),s===o&&(i=h),s===a&&(n=h),p(h,l)}h&&h.update(i,n,l)}const m=new V.Z(D.Z.createPolylineGeometry(c,u),i);e.removeAllGeometries(),e.addGeometry(m,t,o)}_getSegmentInterpolator(e,t){const i=this._sceneView.spatialReference;if((0,P.Up)(i,(0,C.rS)(i))){const i=this._sceneView.renderCoordsHelper.spatialReference;return new X.Spherical(e,t,i,i)}return new X.Linear(e,t)}_initializeListeners(){this._listenerHandles=new g.Z,this._listenerHandles.add([this._model.watch(["state","lastDraggedVertex"],(()=>this._updateLaserLine())),this._model.watch("cursorPoint",(()=>this._updateAfterSyncViewData((e=>{this._updateCursorSegment(),this._updateCursorHandle(),"drawing"===this._model.state&&this._updateLabels(e),this._updateLaserLine()})))),this._sceneView.state.watch("camera",(()=>this._updateAfterSyncViewData((()=>this._updateCameraDependent(this._model.viewData))))),this._model.watch(["unit","measurementMode"],(()=>this._updateAll(this._model.viewData))),this._model.watch(["areaLabel","cursorSegmentLengthLabel","pathLengthLabel","perimeterLengthLabel"],(()=>{this._updateLabels(this._model.viewData)})),this._model.watch(["active"],(()=>{this._updateLaserLine(),this._syncViewData(this._model.viewData)})),this._model.watch("viewData",(e=>this._syncViewData(e)))])}_destroyListeners(){this._listenerHandles.destroy(),this._listenerHandles=null}}ve._handleGeometry=new V.Z(D.Z.createSphereGeometry(1,32,32),"handle"),function(e){e.PickRequest=class{},e.PickResult=class{constructor(e=null,t=null,i=null){this.type=e,this.scenePoint=t,this.mapPoint=i}}}(ve||(ve={}));const fe=ve;var be=i(2887),ye=i(58722),xe=i(53640);function we(e){return"mouse"!==e.pointerType||0===e.button}var Le=i(82677),Ce=i(3766),Se=i(33655),Pe=i(14071),Me=(i(89771),i(32811)),Oe=i(58508);let Ae=class extends Le.default{constructor(){super(...arguments),this.result=null}destroy(){this.result=null}set geometry(e){this.result=null,this._set("geometry",(0,y.pC)(e)?e.clone():null)}};(0,s._)([(0,n.Cb)({value:null})],Ae.prototype,"geometry",null),(0,s._)([(0,n.Cb)()],Ae.prototype,"result",void 0),Ae=(0,s._)([(0,a.j)("esri.views.3d.interactive.graphics.AreaMeasurement3D")],Ae);var De,je=i(73032),Re=i(53817),Ve=i(98675),Te=i(70642);!function(e){e.boundingSphere=function(e,t){const i=t.center;(0,L.s)(i,0,0,0);for(let t=0;t<e.length;++t)(0,L.b)(i,i,e[t]);(0,L.a)(i,i,1/e.length);let s=0;for(let t=0;t<e.length;++t)s=Math.max(s,(0,L.h)(i,e[t]));t.radius=Math.sqrt(s)},e.bestFitPlane=function(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,Y.pG)(e[0],e[1],e[2],t)},e.planePointDistance=function(e,t){return(0,L.d)(e,t)+e[3]},e.segmentLengthEuclidean=function(e,t,i){return(0,P.KC)(e,Ue,i)&&(0,P.KC)(t,ke,i)?(0,L.k)(Ue,ke):0},e.segmentLengthGeodesic=function(e,t){if(!(0,P.UY)(e,Ue)||!(0,P.UY)(t,ke))return 0;const i={distance:null};return(0,Ve.inverseGeodeticSolver)(i,[Ue[0],Ue[1]],[ke[0],ke[1]]),i.distance},e.segmentLengthGeodesicVector=function(e,t,i){const s={distance:null};return(0,Ve.inverseGeodeticSolver)(s,[e[0],e[1]],[t[0],t[1]],i),s.distance},e.triangleAreaEuclidean=function(e,t,i){const s=t[0]-e[0],r=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return.5*Math.abs(s*o-r*n)},e.triangleAreaGeodesic=function(e,t,i,s){const r=Ie;return(0,P.ke)(e,s,Ue)&&(0,P.ke)(t,s,ke)&&(0,P.ke)(i,s,ze)?(r.setPoint(0,0,Ue),r.setPoint(0,1,ke),r.setPoint(0,2,ze),Math.abs((0,Te.geodesicArea)(r,"square-meters"))):0},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,L.s)(t,0,1,0):(0,L.s)(t,1,0,0),(0,L.c)(i,e,t),(0,L.n)(t,t),(0,L.c)(t,i,e),(0,L.n)(i,i)},e.fitHemisphere=function(e,t=null,i=!0){const s=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,L.d)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,L.g)(t,e[0]),!0;(0,L.s)(Ze,0,0,0);for(let t=0;t<e.length;++t)(0,L.b)(Ze,Ze,e[t]);if((0,L.n)(Ze,Ze),s(e,Ze))return t&&(0,L.g)(t,Ze),!0;if(!i)return!1;for(let i=0;i<e.length;++i)for(let r=0;r<e.length;++r)if(i!==r&&((0,L.c)(Ze,e[i],e[r]),(0,L.n)(Ze,Ze),s(e,Ze)))return t&&(0,L.g)(t,Ze),!0;return!1},e.compareSets=function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(let i=0;i<e.size;++i)if(!t.has(e[i]))return!1;return!0}}(De||(De={}));const Ue=(0,w.c)(),ke=(0,w.c)(),ze=(0,w.c)(),Ie=new Re.Z({rings:[[Ue,ke,ze]],spatialReference:je.Z.WGS84}),Ze=(0,w.c)();const Ge=De;var Ee=i(80685),Be=i(55735),He=i(38256),We=i(27202),qe=i(14286);function Fe(e,t){const i=new Float64Array(e.length*t);for(let s=0;s<e.length;++s){const r=e[s];for(let e=0;e<t;++e)i[s*t+e]=r[e]}return i}function $e(e){const t=new Set;return e.forEach((e=>{t.add(e)})),t}const Ye=class{constructor(){this.change="none",this.updatedVertices=new Set}fullChange(){this.change="full"}incrementalChange(e){"none"===this.change&&(this.change="incremental"),this.updatedVertices.add(e)}clear(){this.change="none",this.updatedVertices.clear()}assign(e){this.change=e.change,this.updatedVertices=$e(e.updatedVertices)}merge(e){switch(this.change){case"none":this.assign(e);break;case"full":break;case"incremental":"incremental"===e.change?e.updatedVertices.forEach((e=>{this.updatedVertices.add(e)})):"full"===e.change&&(this.change="full")}}};var Xe=i(35470),Ne=i(83477);let Je=class extends(Xe.Z.EventedMixin(Le.default)){constructor(){super(...arguments),this.vertices=new Ne.Z}get front(){return this.vertices.items[0]||null}get back(){return this.vertices.items[this.vertices.length-1]||null}clear(){this.vertices.removeAll(),this.emit("cleared",{}),this._notifyFrontBack()}vertex(e){return this.vertices.items[e]}add(e){this.vertices.add(e);const t=this.vertices.length-1;return this._notifyFrontBack(),this.emit("vertex-added",{index:t}),t}remove(e){this.vertices.removeAt(e),this._notifyFrontBack(),this.emit("vertex-removed",{index:e})}update(e,t){null!=t&&(this.vertices.splice(e,1,t),this._notifyFrontBack()),this.emit("vertex-updated",{index:e})}_notifyFrontBack(){this.notifyChange("front"),this.notifyChange("back")}toPolygon(){const e=[];if(0===this.vertices.length)return null;this.vertices.forEach((t=>{e.push(t.hasZ?[t.x,t.y,t.z]:[t.x,t.y])}));const t=this.vertices.getItemAt(0);return e.push(t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]),new Re.Z({rings:[e],spatialReference:t.spatialReference})}};(0,s._)([(0,n.Cb)({readOnly:!0})],Je.prototype,"vertices",void 0),(0,s._)([(0,n.Cb)({aliasOf:"vertices.length"})],Je.prototype,"length",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],Je.prototype,"front",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Je.prototype,"back",null),Je=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.support.Path")],Je);const Ke=Je;var Qe=i(84397);let et=class extends Le.default{constructor(){super(...arguments),this._unitNormalizer=new Qe.Z,this._measurementData=new class{constructor(){this.positionsWorldCoords=[],this.positionsRenderCoords=[],this.positionsProjectedWorldCoords=[],this.positionsFittedRenderCoords=[],this.positionsGeographic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.areaCentroidWorldCoords=(0,w.c)(),this.areaCentroidRenderCoords=(0,w.c)(),this.geodesicAreaCentroidRenderCoords=(0,w.c)(),this._length=0,this._centroidRenderCoords=(0,w.c)(),this._planeWorldCoords=(0,He.a)(),this._worldUp=(0,w.c)(),this._worldTangent=(0,w.c)(),this._frame=[(0,w.c)(),(0,w.c)(),(0,w.c)()],this._tempU=(0,w.c)(),this._tempV=(0,w.c)(),this._tempVec3=(0,w.c)(),this._tempSphere={center:(0,w.c)(),radius:0}}update(e,t,i,s,r,n,o){this._resize(e.length);const a=(0,C.rS)(t.spatialReference),h=(0,P.Up)(t.spatialReference,a)&&(0,P.jF)(t.spatialReference),l=this.positionsGeographic,d=this.positionsWorldCoords,c=this.positionsRenderCoords,u=this.positionsSpherical;for(let t=0;t<e.length;++t){const i=e.vertex(t);(0,P.KC)(i,d[t],n),(0,P.KC)(i,c[t],r),h&&((0,P.UY)(i,l[t]),(0,P.KC)(i,u[t],a),(0,L.n)(u[t],u[t]))}const p=this._updatePathLengths(s);if(this.pathLength=this._length>0?new Me.Z(i.normalizeDistance(p),"meters"):null,h){const e=this._updateGeodesicPathLengths(s,n);this.geodesicPathLength=this._length>0?new Me.Z(e,"meters"):null}else this.geodesicPathLength=null;if(!s)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),void this.geodesicIntersectingSegments.clear();this._updateArea(t,i,r,n,o),h&&this._updateGeodesicArea(t)}_resize(e){for(e<this._length&&(this.positionsWorldCoords.length=e,this.positionsRenderCoords.length=e,this.positionsProjectedWorldCoords.length=e,this.positionsFittedRenderCoords.length=e,this.positionsGeographic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorldCoords.push((0,w.c)()),this.positionsRenderCoords.push((0,w.c)()),this.positionsProjectedWorldCoords.push((0,Be.a)()),this.positionsFittedRenderCoords.push((0,w.c)()),this.positionsGeographic.push((0,w.c)()),this.positionsSpherical.push((0,w.c)()),this.positionsStereographic.push((0,Be.a)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorldCoords,i=this.pathSegmentLengths;let s=0;for(let r=0;r<this._length;++r){const n=i[r]=(0,L.k)(t[r],t[(r+1)%this._length]);(r<this._length-1||e)&&(s+=n)}return s}_updateGeodesicPathLengths(e,t){const i=this.positionsGeographic,s=this.geodesicPathSegmentLengths;let r=0;for(let n=0;n<this._length;++n){const o=s[n]=Ge.segmentLengthGeodesicVector(i[n],i[(n+1)%this._length],t);(n<this._length-1||e)&&(r+=o)}return r}_updateArea(e,t,i,s,r){const n=e.renderCoordsHelper,o=this.positionsWorldCoords,a=this.positionsRenderCoords,h=this.positionsProjectedWorldCoords,l=this.positionsFittedRenderCoords,d=this._planeWorldCoords,c=this._centroidRenderCoords;(0,W.H2)(a,c),n.worldUpAtPosition(c,this._worldUp),n.worldBasisAtPosition(c,0,this._worldTangent),(0,P.Qr)(c,this._worldUp,i,this._worldUp,s),(0,P.Qr)(c,this._worldTangent,i,this._worldTangent,s),o.length>2&&Ge.bestFitPlane(o,d),this.fittingMode=this._selectFittingMode(d,o,this._worldUp,r);let u=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach(((t,i)=>{const s=n.getAltitude(a[i]);s>e&&(e=s,u=i)}))}const p=o[u];let m=d,g=this._worldTangent;"horizontal"===this.fittingMode?m=this._worldUp:"vertical"===this.fittingMode&&(m=this._tempVec3,g=this._worldUp,(0,Y.T)(d,this._worldUp,m)),(0,L.g)(this._frame[2],m),(0,Y.T)(g,m,this._frame[0]),(0,L.c)(this._frame[1],this._frame[0],this._frame[2]),(0,L.p)(this._frame[1],this._frame[1]);const _=this._tempVec3,v=this._tempU,f=this._tempV;for(let e=0;e<this._length;++e){const t=h[e],r=l[e];(0,L.f)(_,o[e],p),(0,qe.s)(t,(0,L.d)(this._frame[0],_),(0,L.d)(this._frame[1],_)),(0,L.a)(v,this._frame[0],t[0]),(0,L.a)(f,this._frame[1],t[1]),(0,L.b)(_,v,f),(0,L.b)(_,_,p),(0,P.SH)(_,s,r,i)}this.perimeterLength=this._length>0?new Me.Z(t.normalizeDistance(this._updatePerimeterLengths()),"meters"):null,(0,W.H2)(l,this.areaCentroidRenderCoords),(0,P.SH)(this.areaCentroidRenderCoords,i,this.areaCentroidWorldCoords,s),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?new Me.Z(t.normalizeArea(this._computeArea()),"square-meters"):null}_updateGeodesicArea(e){const t=e.renderCoordsHelper,i=this.positionsSpherical,s=this.positionsStereographic,r=this._tempVec3,n=Ge.fitHemisphere(i,r);if(!n)return void(this.geodesicArea=null);const o=this._tempU,a=this._tempV;(0,Y._F)(r,o,a);for(let e=0;e<this._length;++e){const t=(0,L.d)(i[e],o),n=(0,L.d)(i[e],a),h=(0,L.d)(i[e],r);(0,qe.s)(s[e],t/h,n/h)}(0,L.a)(r,r,(0,C.Iu)(e.spatialReference).radius),t.toRenderCoords(r,(0,C.rS)(e.spatialReference),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=n&&0===this.geodesicIntersectingSegments.size?new Me.Z(this._computeGeodesicArea(),"square-meters"):null}_updatePerimeterLengths(){const e=this.positionsProjectedWorldCoords,t=this.perimeterSegmentLengths;let i=0;for(let s=0;s<this._length;++s)i+=t[s]=(0,qe.i)(e[s],e[(s+1)%this._length]);return i}_updateIntersectingSegments(){const e=this.positionsProjectedWorldCoords,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const r=e[i],n=e[(i+1)%this._length],o=e[s],a=e[(s+1)%this._length];(0,Ee.UT)(r,n,o,a)&&(t.add(i),t.add(s))}}_computeArea(){const e=this.positionsProjectedWorldCoords,t=Fe(e,2),i=this.triangleIndices=new Uint32Array((0,We.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Ge.triangleAreaEuclidean(e[i[t]],e[i[t+1]],e[i[t+2]]);return s}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const r=e[i],n=e[(i+1)%this._length],o=e[s],a=e[(s+1)%this._length];(0,Ee.UT)(r,n,o,a)&&(t.add(i),t.add(s))}}_computeGeodesicArea(){const e=this.positionsGeographic,t=Fe(this.positionsStereographic,2),i=this.geodesicTriangleIndices=new Uint32Array((0,We.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Ge.triangleAreaGeodesic(e[i[t]],e[i[t+1]],e[i[t+2]],je.Z.WGS84);return s}_selectFittingMode(e,t,i,s){const r=t.map((t=>Math.abs(Ge.planePointDistance(e,t)))).reduce(((e,t)=>Math.max(e,t)),0);Ge.boundingSphere(t,this._tempSphere);const n=r/(2*this._tempSphere.radius),o=n<s.maxRelativeErrorCoplanar,a=n<s.maxRelativeErrorAlmostCoplanar;let h="horizontal";return o?h="oblique":a&&(h=Math.abs((0,L.d)(i,e))>Math.cos((0,Se.Vl)(s.verticalAngleThreshold))?"horizontal":"vertical"),h}},this._measurementDataChanges=new Ye,this._viewDataChanges=new Ye,this._handles=new g.Z,this.dataObject=new Ae,this.path=new Ke,this.pathVersion=0,this.cursorPoint=null,this.state="initial",this.lastDraggedVertex=null,this.mode="auto",this.unit="metric",this.active=!1,this.maxRelativeErrorCoplanar=.005,this.maxRelativeErrorAlmostCoplanar=.01,this.verticalAngleThreshold=80,this.geodesicMeasurementDistanceThreshold=1e5}initialize(){(0,Pe.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})),this._handles.add((0,Ce.qe)((async()=>{this.messages=await(0,Pe.ME)("esri/core/t9n/Units")}))),this._handles.add((0,_.whenTrue)(this.sceneView,"ready",(()=>{const{spatialReference:e}=this.sceneView,t=(0,C.rS)(e),i=t===C.GG?C.wY:t,s=!e||(0,P.Up)(e,i)?i:e;this._worldSpatialReference=s,this._unitNormalizer.spatialReference=s})),"scene-view"),this.reset();const e=()=>{this._set("pathVersion",this.pathVersion+1)};this._handles.add(this.path.on("cleared",(()=>{this._measurementDataChanges.fullChange(),this._set("pathVersion",0),this.dataObject.geometry=null}))),this._handles.add(this.path.on("vertex-added",(()=>{this._measurementDataChanges.fullChange(),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.path.on("vertex-removed",(()=>{this._measurementDataChanges.fullChange(),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.path.on("vertex-updated",(t=>{this._measurementDataChanges.incrementalChange(t.index),e(),this.dataObject.geometry=this.path.toPolygon()}))),this._handles.add(this.dataObject.watch("geometry",(()=>{const e=this.measurementData;this.dataObject.result={area:e.area,geodesicArea:e.geodesicArea,pathLength:e.pathLength,geodesicPathLength:e.geodesicPathLength,perimeterLength:e.perimeterLength}})))}destroy(){this._handles.destroy(),this._handles=null}get validMeasurement(){return this.path.length>=3&&"measured"===this.state||"editing"===this.state}get isMeasuring(){return this.path.length>=1}get measurementData(){this._viewDataChanges.merge(this._measurementDataChanges),this._measurementDataChanges.clear();const e=$e(this._measurementData.intersectingSegments),t=$e(this._measurementData.geodesicIntersectingSegments);return this._measurementData.update(this.path,this.sceneView,this._unitNormalizer,this.validMeasurement,this.sceneView.renderSpatialReference,this._worldSpatialReference,{maxRelativeErrorCoplanar:this.maxRelativeErrorCoplanar,maxRelativeErrorAlmostCoplanar:this.maxRelativeErrorAlmostCoplanar,verticalAngleThreshold:this.verticalAngleThreshold}),Ge.compareSets(this._measurementData.intersectingSegments,e)||this._viewDataChanges.fullChange(),Ge.compareSets(this._measurementData.geodesicIntersectingSegments,t)||this._viewDataChanges.fullChange(),this._measurementData}get area(){return this.measurementData.area}get geodesicArea(){return this.measurementData.geodesicArea}get areaLabel(){return this._formatAreaLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicArea:this.measurementData.area,this.unit)}get pathLength(){return this.measurementData.pathLength}get geodesicPathLength(){return this.measurementData.geodesicPathLength}get pathLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.pathLength,this.unit)}get perimeterLength(){return this.measurementData.perimeterLength}get geodesicPerimeterLength(){return this.measurementData.geodesicPathLength}get perimeterLengthLabel(){return this.measurementData.perimeterLength&&this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.perimeterLength,this.unit)}get cursorSegmentLength(){return this.path.back&&this.cursorPoint&&new Me.Z(this._unitNormalizer.normalizeDistance(Ge.segmentLengthEuclidean(this.path.back,this.cursorPoint,this._worldSpatialReference)),"meters")}get geodesicCursorSegmentLength(){return this.path.back&&this.cursorPoint&&new Me.Z(Ge.segmentLengthGeodesic(this.path.back,this.cursorPoint),"meters")}get cursorSegmentLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.geodesicCursorSegmentLength:this.cursorSegmentLength,this.unit)}get viewData(){const e=this.measurementData,t="geodesic"===this.measurementMode,i=t?this.geodesicArea:this.area;let s=1;if(i){const e=this._toPreferredAreaUnit(i,this.unit);s=(0,Se.sk)(Math.sqrt(e.value)/Math.sqrt(300)),s*=Math.sqrt((0,l.En)(1,e.unit,"square-meters")),s/=this._unitNormalizer.normalizeDistance(1)}return{validMeasurement:this.validMeasurement,path:this.path,pathChanges:this._viewDataChanges,positionsGeographic:e.positionsGeographic,positionsRenderCoords:e.positionsRenderCoords,positionsProjected:e.positionsProjectedWorldCoords,positionsFittedRenderCoords:e.positionsFittedRenderCoords,intersectingSegments:t?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:t?e.geodesicTriangleIndices:e.triangleIndices,fittingMode:e.fittingMode,areaCentroid:t?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,pathLengthLabelSegmentIndex:this.validMeasurement?0:this.path.length-2,perimeterLengthLabelSegmentIndex:0,checkerSize:s}}get measurementMode(){let e=this.mode;return"auto"===e&&(e="euclidean",(this.geodesicPathLength?this.geodesicPathLength.value:0)+(!this.validMeasurement&&this.geodesicCursorSegmentLength?this.geodesicCursorSegmentLength.value:0)>this.geodesicMeasurementDistanceThreshold&&(e="geodesic")),null==this.geodesicPathLength&&(e="euclidean"),e}reset(){this.clearMeasurement()}clearMeasurement(){this.path.clear(),this.state="initial",this.cursorPoint=null}finishMeasurement(){this.path.length<3?this.clearMeasurement():(this._measurementDataChanges.fullChange(),this.state="measured")}_preferredAreaUnit(e,t){switch(t){case"metric":return(0,l.tQ)(e.value,e.unit);case"imperial":return(0,l.Yl)(e.value,e.unit);default:return t}}_preferredLengthUnit(e,t){const i=this._deriveLengthUnitFromAreaUnit(t);switch(i){case"metric":return(0,l.KU)(e.value,e.unit);case"imperial":return(0,l.FN)(e.value,e.unit);default:return i}}_toPreferredAreaUnit(e,t){return e.toUnit(this._preferredAreaUnit(e,t))}_toPreferredLengthUnit(e,t){return e.toUnit(this._preferredLengthUnit(e,t))}_formatAreaLabel(e,t,i){return e&&t&&(0,Oe.VG)(e,t,this._preferredAreaUnit(t,i))}_formatLengthLabel(e,t,i){return e&&t&&(0,Oe.VG)(e,t,this._preferredLengthUnit(t,i))}_deriveLengthUnitFromAreaUnit(e){switch(e){case"metric":return"metric";case"imperial":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"acres":return"imperial";case"ares":case"hectares":return"metric"}throw new Error("unhandled area unit")}};(0,s._)([(0,n.Cb)()],et.prototype,"messages",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"dataObject",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],et.prototype,"sceneView",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],et.prototype,"path",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],et.prototype,"pathVersion",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"cursorPoint",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"state",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"lastDraggedVertex",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"mode",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"unit",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"active",void 0),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["path.length","state"]})],et.prototype,"validMeasurement",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["path.length"]})],et.prototype,"isMeasuring",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["pathVersion","validMeasurement","maxRelativeErrorCoplanar","maxRelativeErrorAlmostCoplanar","verticalAngleThreshold"],autoTracked:!1})],et.prototype,"measurementData",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"area",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicArea",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"areaLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"pathLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicPathLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"pathLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"perimeterLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["measurementData"]})],et.prototype,"geodesicPerimeterLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["messages","measurementData","unit","measurementMode"]})],et.prototype,"perimeterLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],et.prototype,"cursorSegmentLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],et.prototype,"geodesicCursorSegmentLength",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["messages","unit","measurementMode","cursorSegmentLength","geodesicCursorSegmentLength"]})],et.prototype,"cursorSegmentLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["unit","measurementMode","measurementData"]})],et.prototype,"viewData",null),(0,s._)([(0,n.Cb)()],et.prototype,"maxRelativeErrorCoplanar",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"maxRelativeErrorAlmostCoplanar",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"verticalAngleThreshold",void 0),(0,s._)([(0,n.Cb)()],et.prototype,"geodesicMeasurementDistanceThreshold",void 0),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["mode","validMeasurement","geodesicPathLength","geodesicCursorSegmentLength","geodesicMeasurementDistanceThreshold"]})],et.prototype,"measurementMode",null),et=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DModel")],et);const tt=et;let it=class extends b.m{constructor(e){super(e),this._handles=new g.Z,this.deferCreation=!0,this.model=new tt({sceneView:e.view})}initialize(){this._view=new fe(this.model,this.manipulators),this._controller=new class{constructor(e,t,i){this._manipulators=i,this._handles=new g.Z,this._tempPickRequest=new fe.PickRequest,this.model=e,this.view=t,this.model.reset(),this._setupManipulators()}destroy(){this._handles.destroy(),this._handles=null}handleInputEvent(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>`manipulator-${e}`;let t=0;const i=e=>i=>("start"===i.action&&(t++,this.model.lastDraggedVertex=(0,y.Wg)(this.view.manipulatorIdToVertexId(e)),"measured"===this.model.state&&(this.model.state="editing")),i),s=()=>e=>"end"===e.action?(t--,0===t&&"editing"===this.model.state&&(this.model.state="measured"),null):e,r=(t,r)=>{this._handles.add([(0,xe.Xd)(r,((e,r,n)=>{const o=(0,Z.J4)(e),a=(0,y.Wg)(this.view.manipulatorIdToVertexId(t));r.next(i(t)).next(o).next(s()).next(this.view.screenToMap3D()).next((t=>{e.location=t.mapEnd,this.model.path.update(a,(0,ye.WG)(t.mapEnd))}));const h=(0,ye.WG)(this.model.path.vertex(a));n.next(o).next((()=>{this.model.path.update(a,h),e.location=h}))})),r.events.on("double-click",(e=>{we(e)&&("drawing"===this.model.state&&this.model.finishMeasurement(),e.stopPropagation())}))],e(t))},n=t=>{this._handles.remove(e(t))};this._manipulators.forEach((({id:e,manipulator:t})=>{r(e,t)})),this._handles.add([this._manipulators.on("after-add",(({item:{id:e,manipulator:t}})=>{r(e,t)})),this._manipulators.on("after-remove",(({item:{id:e}})=>{n(e)}))])}_handleDrag(e){"editing"===this.model.state&&e.stopPropagation()}_handleImmediateClick(e){if(!we(e))return;const t=(0,be.vT)(e);if(this.model.active)switch(this.model.state){case"initial":this._addVertexAt(t)&&(this.model.state="drawing",e.stopPropagation());break;case"drawing":{const i=this.view.vertexHandleAt(t,e.pointerType);if((0,y.Wi)(i)){if(this._addVertexAt(t))return}else 0===i&&(this.model.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,be.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){"Enter"===e.key&&"drawing"===this.model.state&&(this.model.finishMeasurement(),e.stopPropagation())}_hoverAt(e){if(this.view.requiresCursorPoint){const t=this._pick(e);t.mapPoint&&(this.model.cursorPoint=t.mapPoint)}else this.model.cursorPoint=null}_addVertexAt(e){const t=this._pick(e);return!!t.mapPoint&&(this.model.path.add(t.mapPoint),!0)}_pick(e){const t=this._tempPickRequest;return t.screenPoint=e,this.view.pick(t)}}(this.model,this._view,this.manipulators),this._handles.add((0,_.init)(this,"state",(e=>{switch(e){case"measured":return this.complete();case"ready":return;default:return this.create()}}),!0))}destroy(){this.detach(),this._view.destroy(),this._view=null,this._controller.destroy(),this._controller=null,this._handles.destroy(),this._handles=null}get state(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"}get isSupported(){return"3d"===this.get("view.type")}get cursor(){return!this.model.active||"initial"!==this.model.state&&"drawing"!==this.model.state?null:"crosshair"}activate(){this.model.active=!0}deactivate(){this.model.active=!1}onShow(){this._view.show()}onHide(){this._view.hide()}onDetach(){this.model.reset()}onInputEvent(e){this._controller.handleInputEvent(e)}};(0,s._)([(0,n.Cb)({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],it.prototype,"state",null),(0,s._)([(0,n.Cb)({dependsOn:["view.type"],readOnly:!0})],it.prototype,"isSupported",null),(0,s._)([(0,n.Cb)({dependsOn:["model.active","state"],readOnly:!0})],it.prototype,"cursor",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],it.prototype,"model",void 0),(0,s._)([(0,o.B)("model.mode")],it.prototype,"mode",void 0),(0,s._)([(0,o.B)("model.unit")],it.prototype,"unit",void 0),(0,s._)([(0,o.B)("model.areaLabel")],it.prototype,"areaLabel",void 0),(0,s._)([(0,o.B)("model.area")],it.prototype,"area",void 0),(0,s._)([(0,o.B)("model.geodesicArea")],it.prototype,"geodesicArea",void 0),(0,s._)([(0,o.B)("model.pathLengthLabel")],it.prototype,"pathLengthLabel",void 0),(0,s._)([(0,o.B)("model.pathLength")],it.prototype,"pathLength",void 0),(0,s._)([(0,o.B)("model.geodesicPathLength")],it.prototype,"geodesicPathLength",void 0),(0,s._)([(0,o.B)("model.perimeterLengthLabel")],it.prototype,"perimeterLengthLabel",void 0),(0,s._)([(0,o.B)("model.perimeterLength")],it.prototype,"perimeterLength",void 0),(0,s._)([(0,o.B)("model.geodesicPerimeterLength")],it.prototype,"geodesicPerimeterLength",void 0),(0,s._)([(0,o.B)("model.validMeasurement")],it.prototype,"validMeasurement",void 0),(0,s._)([(0,o.B)("model.viewData")],it.prototype,"viewData",void 0),it=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],it);const st=it,rt=r.Z.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let nt=class extends f.V{constructor(e){super(e),this.supportedViewType="3d",this._handles=new g.Z,this._userUnitOptions=null,this._userUnit=null,this.tool=null}initialize(){this._handles.add([(0,_.init)(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool||this.isDisabled)return null;const e=this.tool.model,t=e.measurementMode,i=e.measurementData,s=e.validMeasurement,r=0===("euclidean"===t?i.intersectingSegments:i.geodesicIntersectingSegments).size,n=r?s?"available":"unavailable":"invalid";return{mode:t,area:{text:r&&s?e.areaLabel:null,state:n},perimeterLength:{text:r&&s?e.perimeterLengthLabel:null,state:n}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}newMeasurement(){(0,h.ignoreAbortErrors)(this.start())}clearMeasurement(){this.clear()}createToolParams(){return{toolConstructor:st,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){rt.error("AreaMeasurement3D widget is not implemented for MapView")}logError(...e){rt.error(...e)}_findSelectableUnit(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if(!e)return l.fN.slice();const t=e.filter((e=>-1!==l.fN.indexOf(e)));return 0===t.length?l.fN.slice():t}};(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["isDisabled","tool.state"]})],nt.prototype,"state",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["view.ready","tool.model.area","tool.model.geodesicArea","tool.model.areaLabel","tool.model.perimeterLength","tool.model.geodesicPerimeterLength","tool.model.perimeterLengthLabel","tool.model.measurementMode","tool.model.measurementData"]})],nt.prototype,"measurement",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],nt.prototype,"tool",void 0),(0,s._)([(0,n.Cb)(v.Y)],nt.prototype,"defaultUnit",void 0),(0,s._)([(0,n.Cb)({dependsOn:["view.spatialReference"]})],nt.prototype,"unitOptions",null),(0,s._)([(0,n.Cb)({dependsOn:["unitOptions","defaultUnit"]})],nt.prototype,"unit",null),(0,s._)([(0,n.Cb)()],nt.prototype,"clearMeasurement",null),nt=(0,s._)([(0,a.j)("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],nt);const ot=nt,at="esri-area-measurement-3d__measurement-item",ht="esri-area-measurement-3d__measurement-item-title",lt="esri-area-measurement-3d__measurement-item-value";let dt=class extends m.default{constructor(e,t){super(e,t),this.view=null,this.visible=null,this.iconClass="esri-icon-measure-area",this.label=void 0,this.messages=null,this.messagesUnits=null,this.viewModel=new ot,this.unitOptions=null,this.unit=null}render(){const{isSupported:e,active:t,measurement:i,state:s,unit:r}=this.viewModel,n="disabled"===s,o="ready"===s,a="measuring"===s||"measured"===s,{messages:h,messagesUnits:d}=this,c=t&&o?(0,p.j)("section",{key:"esri-area-measurement-3d__hint",class:"esri-area-measurement-3d__hint"},(0,p.j)("p",{class:"esri-area-measurement-3d__hint-text"},h.hint)):null,u=e?null:(0,p.j)("section",{key:"esri-area-measurement-3d__unsupported",class:"esri-area-measurement-3d__panel--error"},(0,p.j)("p",null,h.unsupported)),m=(e,t,i)=>{switch(t.state){case"available":return(0,p.j)("div",{key:`${i}-enabled`,class:at},(0,p.j)("span",{class:ht},e),(0,p.j)("span",{class:lt},t.text));case"unavailable":return(0,p.j)("div",{key:`${i}-disabled`,class:this.classes(at,"esri-area-measurement-3d__measurement-item--disabled")},(0,p.j)("span",{class:ht},e));case"invalid":return(0,p.j)("div",{key:`${i}-enabled`,class:at},(0,p.j)("span",{class:ht},e),(0,p.j)("span",{class:lt},h.notApplicable))}},g=a?(0,p.j)("section",{key:"esri-area-measurement-3d__measurement",class:"esri-area-measurement-3d__measurement"},m(h.area,i.area,"area"),m(h.perimeterLength,i.perimeterLength,"perimeter-length")):null,_=`${this.id}__units`,v=(0,p.j)("label",{class:"esri-area-measurement-3d__units-label",for:_},h.unit),f=(0,p.j)("div",{class:"esri-area-measurement-3d__units-select-wrapper"},(0,p.j)("select",{class:"esri-area-measurement-3d__units-select esri-select",id:_,onchange:this._changeUnit,bind:this,value:r},this.viewModel.unitOptions.map((e=>{var t;return(0,p.j)("option",{key:e,value:e},(0,l.ZO)(e)?d.systems[e]:null==(t=d.units[e])?void 0:t.pluralCapitalized)})))),b=a?(0,p.j)("section",{key:"esri-area-measurement-3d__units",class:"esri-area-measurement-3d__units"},v,f):null,y=a?(0,p.j)("div",{key:"settings",class:"esri-area-measurement-3d__settings"},b):null,x=!e||t&&!a?null:(0,p.j)("div",{class:"esri-area-measurement-3d__actions"},(0,p.j)("button",{disabled:n,class:this.classes("esri-button esri-button--secondary","esri-area-measurement-3d__clear-button",n&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement,type:"button"},h.newMeasurement)),w=this.visible?(0,p.j)("div",{class:"esri-area-measurement-3d__container"},u,c,y,g,x):null;return(0,p.j)("div",{key:"",class:this.classes("esri-area-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},w)}_newMeasurement(){(0,h.ignoreAbortErrors)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,o.B)("viewModel.view")],dt.prototype,"view",void 0),(0,s._)([(0,o.B)("viewModel.visible"),(0,u.G)()],dt.prototype,"visible",void 0),(0,s._)([(0,o.B)("viewModel.active"),(0,u.G)()],dt.prototype,"active",void 0),(0,s._)([(0,n.Cb)()],dt.prototype,"iconClass",void 0),(0,s._)([(0,n.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dt.prototype,"label",void 0),(0,s._)([(0,n.Cb)(),(0,u.G)(),(0,c.H)("esri/widgets/AreaMeasurement3D/t9n/AreaMeasurement3D")],dt.prototype,"messages",void 0),(0,s._)([(0,n.Cb)(),(0,u.G)(),(0,c.H)("esri/core/t9n/Units")],dt.prototype,"messagesUnits",void 0),(0,s._)([(0,n.Cb)({type:ot}),(0,u.G)(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],dt.prototype,"viewModel",void 0),(0,s._)([(0,o.B)("viewModel.unitOptions")],dt.prototype,"unitOptions",void 0),(0,s._)([(0,o.B)("viewModel.unit")],dt.prototype,"unit",void 0),(0,s._)([(0,d.h)()],dt.prototype,"_newMeasurement",null),(0,s._)([(0,d.h)()],dt.prototype,"_changeUnit",null),dt=(0,s._)([(0,a.j)("esri.widgets.AreaMeasurement3D")],dt);const ct=dt},19539:(e,t,i)=>{"use strict";i.d(t,{V:()=>u});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),o=i(32656),a=(i(10923),i(57002),i(86035),i(39105)),h=i(82677),l=i(59691),d=i(80621),c=i(17519);let u=class extends h.default{constructor(e){super(e),this.tool=null,this._baseHandles=new l.Z,this._loggedUnsupportedErrorOnce=!1,this._creationAbortController=null,e&&null!=e.visible&&(this.visible=e.visible)}initialize(){this._baseHandles.add((0,d.init)(this,["view.ready","isSupported"],(()=>{this.view&&this.view.ready&&!this.isSupported?this._loggedUnsupportedErrorOnce||(this.logUnsupportedError(),this._loggedUnsupportedErrorOnce=!0):this._loggedUnsupportedErrorOnce=!1})))}destroy(){this.removeTool(),this.view=null,this._baseHandles.destroy(),this._baseHandles=null}get isSupported(){return!this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const t="tools";this._baseHandles.remove(t),e&&this._baseHandles.add(e.tools.on("change",(e=>{if(this.tool)for(const t of e.removed)if(this.tool===t){t.destroyed||t.destroy(),this._set("tool",null);break}})),t)}set visible(e){this._set("visible",e),this.tool&&(this.tool.visible=e),!e&&this._creationAbortController&&(this._creationAbortController.abort(),this._creationAbortController=null)}get active(){return null!=this._creationAbortController||null!=this.tool&&this.tool.active}get isDisabled(){return!this.view||!this.view.ready||!this.isSupported}get creatingTool(){return!!this._creationAbortController}async createTool(){if(this.removeTool(),!this.isSupported)return(0,a.reject)(new o.Z("tool:create","The view does not support the tool"));const e=this.createToolParams(),t=()=>{const t=(0,c.J1)(e.constructorArguments);return{visible:this.visible,...t}},i=new AbortController,s=i.signal;this._creationAbortController=i;const r=()=>{i===this._creationAbortController&&(this._creationAbortController=null)};try{const i=await this.view.createTool(e.toolConstructor,t,{signal:s});this._set("tool",i),r()}catch(e){throw r(),e}}removeTool(){this._creationAbortController&&this._creationAbortController.abort(),this._creationAbortController=null;const e=this.tool;e&&(this.view&&this.view.tools&&this.view.tools.remove(e),e.destroyed||e.destroy(),this._set("tool",null))}};(0,s._)([(0,r.Cb)({constructOnly:!0})],u.prototype,"tool",void 0),(0,s._)([(0,r.Cb)({dependsOn:["view.type"]})],u.prototype,"isSupported",null),(0,s._)([(0,r.Cb)({value:null})],u.prototype,"view",null),(0,s._)([(0,r.Cb)({type:Boolean,value:!0})],u.prototype,"visible",null),(0,s._)([(0,r.Cb)({dependsOn:["_creationAbortController","tool.active"]})],u.prototype,"active",null),(0,s._)([(0,r.Cb)({dependsOn:["view","view.ready","isSupported"]})],u.prototype,"isDisabled",null),(0,s._)([(0,r.Cb)()],u.prototype,"_creationAbortController",void 0),(0,s._)([(0,r.Cb)({readOnly:!0,dependsOn:["_creationAbortController"]})],u.prototype,"creatingTool",null),u=(0,s._)([(0,n.j)("esri.widgets.support.InteractiveToolViewModel")],u)}}]);
//# sourceMappingURL=7483.js.map