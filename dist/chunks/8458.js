(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[8458],{43019:(e,t,i)=>{"use strict";function a(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}function n(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,{_j:()=>f,_Y:()=>y,Y3:()=>v,xr:()=>_});const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const i=[];let a,r;if(e[0].length!==t.length)throw"dimensions do not match";const s=e.length,n=e[0].length;let o=0;for(a=0;a<s;a++){for(o=0,r=0;r<n;r++)o+=e[a][r]*t[r];i.push(o)}return i}function c(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))),i=h(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function p(e){const t=h(l,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function u(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function g(e){return u(c(e))}function m(e){return p(d(e))}function _(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:s(e)?function(e){return p(d(function(e){const t=e.l,i=e.c,a=e.h;return{l:t,a:i*Math.cos(a),b:i*Math.sin(a)}}(e)))}(e):r(e)?m(e):n(e)?p(e):a(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,r=a*i,s=r*(1-Math.abs(t%2-1));let n;switch(Math.floor(t)){case 0:n={r,g:s,b:0};break;case 1:n={r:s,g:r,b:0};break;case 2:n={r:0,g:r,b:s};break;case 3:n={r:0,g:s,b:r};break;case 4:n={r:s,g:0,b:r};break;case 5:case 6:n={r,g:0,b:s};break;default:n={r:0,g:0,b:0}}return n.r=Math.round(n.r+a-r),n.g=Math.round(n.g+a-r),n.b=Math.round(n.b+a-r),n}(e):e}function y(e){return a(e)?e:function(e){const t=e.r,i=e.g,a=e.b,r=Math.max(t,i,a),s=r-Math.min(t,i,a);let n=r,o=0===s?0:r===t?(i-a)/s%6:r===i?(a-t)/s+2:(t-i)/s+4,l=0===s?0:s/n;return o<0&&(o+=6),o*=60,l*=100,n*=100/255,{h:o,s:l,v:n}}(_(e))}function v(e){return r(e)?e:g(_(e))}function f(e,t){const i=g(e);return i.l*=1-t,m(i)}},83873:(e,t,i)=>{"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const r=e[a].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function s(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const s="visualVariables"in t?function(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2}));let a=0;const s=i.length;if(0===s)return e;for(let e=0;e<s;e++)a+=i[e];const n=Math.floor(a/s);return Math.max(n,e)}(i,t.visualVariables):i;if("simple"===t.type)return a(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return t.type,s}i.d(t,{k:()=>s})},5684:(e,t,i)=>{"use strict";i.d(t,{Rz:()=>u,G:()=>g,kD:()=>_,mW:()=>m,js:()=>d});i(95830);var a=i(59472),r=i(48142),s=i(5674),n=i(88083),o=i(44190),l=i(7767);const h=n.Z.fromJSON(l.I4),c=r.Z.fromJSON(l.ET),p=s.default.fromJSON(l.lF),u=o.Z.fromJSON(l.qP);function d(e){if((0,a.Wi)(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return h;case"polyline":return c;case"polygon":case"extent":return p}return null}const g=n.Z.fromJSON(l.eG),m=r.Z.fromJSON(l.wW),_=s.default.fromJSON(l.lj)},7767:(e,t,i)=>{"use strict";i.d(t,{I4:()=>r,lF:()=>n,ET:()=>s,qP:()=>o,eG:()=>l,lj:()=>c,wW:()=>h});const a=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:a,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:a},n={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},o={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},h={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},78458:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DrawGraphicTool:()=>be,DrawOperation:()=>a.w,GraphicMoveTool:()=>Pt,GraphicReshapeTool:()=>Yt,GraphicTransformTool:()=>ii});var a=i(88958),r=i(56140),s=i(95830),n=i(59472),o=(i(36544),i(68055),i(79881)),l=i(87566),h=(i(10923),i(57002),i(86035),i(35470)),c=i(15988),p=i(94394),u=i(46970),d=i(84678),g=i(76916),m=i(9434),_=i(48016),y=i(78745),v=i(43019),f=i(38256),M=i(48430);const b={main:new y.default([255,127,0]),selected:new y.default([255,255,255]),staged:new y.default([12,207,255]),outline:new y.default([0,0,0,.5]),selectedOutline:new y.default([255,255,255])};function w(e,t){const i=e.clone();return i.a*=t,i}function S(e,t){const i=e.clone(),a=(0,v._Y)(i);a.s*=t;const r=(0,v.xr)(a);return i.r=r.r,i.g=r.g,i.b=r.b,i}function x(e,t){if(t)for(const i in t)e[i]=t[i]}class C{constructor(e){this.color=b.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,x(this,e)}}class E{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=b.main,this.outlineColor=b.outline,this.renderOccluded=16,this.hoverOutlineColor=b.selectedOutline,x(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:T(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class O{constructor(e){this.vertex=new E({color:b.main,outlineColor:b.outline}),this.edge=new E({color:S(w(b.main,2/3),.5),outlineColor:w(b.outline,.5),size:8,collisionPadding:8}),this.selected=new E({color:b.selected,outlineColor:b.outline}),x(this,e)}}class D{constructor(e){this.color=b.selected,this.width=1.5,this.stipplePattern=(0,M.i2)([5,5]),this.stippleOffColor=b.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=b.selected,this.renderOccluded=4,x(this,e)}apply(e){e.color=T(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=T(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=T(this.innerColor),e.renderOccluded=this.renderOccluded}}class G{constructor(e){this.color=b.selected,this.size=4,this.outlineSize=1,this.outlineColor=b.outline,this.shape="square",x(this,e)}apply(e){e.color=T(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=T(this.outlineColor),e.primitive=this.shape}}class A{constructor(e){this.innerColor=b.selected,this.innerWidth=1,this.glowColor=b.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=b.main,x(this,e)}apply(e,t=1){const i={glowColor:y.default.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:y.default.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class R{constructor(e){this.outline=new D({color:b.outline,renderOccluded:8,stippleOffColor:b.selected,stipplePattern:(0,M.i2)([5,5]),width:1.5,innerWidth:0}),this.staged=new D({color:b.selected,renderOccluded:8,innerColor:b.staged,stippleOffColor:b.outline,stipplePattern:(0,M.i2)([5,5]),width:1.5}),this.shadowStyle=new A({globalAlpha:.3,glowColor:b.main,glowFalloff:8,glowWidth:8,innerColor:b.selected,innerWidth:1}),x(this,e)}}class P{constructor(e){this.outline=new G({color:b.selected,outlineColor:b.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new A({globalAlpha:.3,glowColor:b.main,glowFalloff:1.5,glowWidth:6,innerColor:b.selected,innerWidth:1,radius:2}),x(this,e)}}class V extends D{constructor(e){super(),this.extensionType=2,x(this,e)}}class I{constructor(e){this.lineGraphics=new R,this.pointGraphics=new P,this.heightPlane=new A({globalAlpha:.3,glowColor:b.main,glowFalloff:8,glowWidth:8,innerColor:b.selected,innerWidth:1}),this.heightBox=new A({globalAlpha:.3,glowColor:b.main,glowFalloff:8,glowWidth:8,innerColor:b.selected,innerWidth:0,heightFillColor:b.main}),this.zVerticalLine=new V({color:w(b.main,.5),falloff:2,innerColor:w(b.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,x(this,e)}}function T(e){return(0,f.f)(y.default.toUnitRGBA(e))}const k=new class{constructor(e){this.visualElements=new I,this.reshapeManipulators=new O,this.zManipulator=new C,x(this,e)}colorToVec4(e){return T(e)}};var z=i(77625),W=i(17387),Z=i(17333),L=i(34353),H=i(69996),F=i(1586),U=i(27898),N=i(55197),j=i(68500),Y=i(43965),X=i(57511),q=i(17154),B=i(67128),J=i(12811),K=i(56469),Q=i(8830),$=i(49366);const ee=class{constructor(e,t,i,a,r,s,n){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.boundingInfo=t,this.material=i,this.origin=null,this.center=(0,z.c)(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=r,a&&this.updateTransformation(a,s),this.castShadow=n,this.instanceParameters={highlights:null,occludees:null,visible:!0}}updateTransformation(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}getBoundingSphere(e,t,i){return t=t||(0,q.u1)(e),(0,W.i)(i,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t}get hasShaderTransformation(){return!!this.calculateShaderTransformation}getShaderTransformation(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=(0,J.a)()),(0,B.c)(this.shaderTransformation,this.calculateShaderTransformation((0,n.Pt)(this.transformation,J.I))),this.shaderTransformationDirty=!1),this.shaderTransformation):(0,n.Pt)(this.transformation,J.I)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&((0,n.pC)(this.transformation)&&(0,W.i)(e,e,this.transformation),!0);const t=this.getIndices(K.Xt.POSITION),i=this.getAttribute(K.Xt.POSITION);return!!(0,U.cM)(i,t,e)&&((0,n.pC)(this.transformation)&&(0,W.i)(e,e,this.transformation),!0)}getIndices(e){return"indices"in this.data?this.data.indices[e]:null}getAttribute(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null}addHighlight(){const e=(0,Q.K)(0),t=this.instanceParameters;return t.highlights=(0,$.lr)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=(0,$.U_)(t.highlights,e)}};var te=i(85736),ie=i(70189),ae=i(86184),re=i(82942),se=i(82677),ne=i(35326);class oe{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?(0,n.Wi)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,n.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new le({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if((0,n.Wi)(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!(0,n.Wi)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){(0,n.Wi)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let le=class extends((0,ne.I)(se.default)){constructor(e){super(e),this.drapeSourceType=1}};(0,r._)([(0,o.Cb)({constructOnly:!0})],le.prototype,"view",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],le.prototype,"drapeSourceType",void 0),le=(0,r._)([(0,l.j)("DrapedVisualElementLayerView")],le);class he{constructor(e){this.view=null,this._attachmentOrigin=(0,F.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new h.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,ie.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,ie.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new re.O({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new oe({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new ae.W({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&(0,n.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){(0,L.g)(e,this._color)||((0,L.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,L.g)(e,this._innerColor)||((0,L.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,n.pC)(e)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,L.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,ie.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,(0,n.pC)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(0,n.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;(0,W.s)(ue,0,0,0);const t=Y._A.POSITION;let i=0;for(const a of e){const e=a.getAttribute(t),r=a.getIndices(t),s=(0,n.Wg)(this.resources.resources).material.isClosed(e.data,r);(0,U.qZ)(e,r,s,pe)&&((0,W.b)(ue,ue,pe),i++)}return 0===i?null:((0,W.a)(ue,ue,1/i),this.view.renderCoordsHelper.fromRenderCoords(ue,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){(0,n.pC)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),(0,n.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return(0,n.pC)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const a=this.createRenderGeometries();for(const r of a)e.addGeometry(r,t),i.push(r);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new X.U(this.materialParameters,"lineVisualElement"),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new X.U(this.materialParameters,"lineVisualElement");return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if((0,n.Wi)(t))return[];const i=(0,te.rm)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:t}of i.lines){const i={attributeData:{position:t},removeDuplicateStartEnd:this.isClosed?1:0},r=new ee((0,te.Mk)(i));r.material=e;const s=(0,H.cS)(ce);(0,H.G1)(s,t),(0,W.s)(r.center,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0),r.bsRadius=.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1])),a.push(r)}return a}calculateMapBounds(e){if((0,n.Wi)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.data.getAttribute("position"),r=a.data,s=new Float64Array(r.length);(0,Z.CM)(a.data,t.spatialReference,0,s,this.view.spatialReference,0,r.length/3),(0,H.G1)(e,s)}return!0}createRenderGeometries(){const e=this.geometry;if((0,n.Wi)(e))return[];const t=(0,te.VP)(e,this.view.elevationProvider,this.view.renderCoordsHelper,N.o.fromElevationInfo(this.elevationInfo)),i=[],a=[];for(const{position:e,mapPosition:r}of t.lines){const t={attributeData:{position:e,mapPosition:r},removeDuplicateStartEnd:this.isClosed?1:0},s=(0,te.Mk)(t);i.push(new j.Z(s,"geometryOutlineVisualElement")),a.push(e)}return this._laserline.pathVerticalPlane=a,i}}const ce=(0,H.Ue)(),pe=(0,z.c)(),ue=(0,z.c)();var de=i(39746),ge=(i(92232),i(88909),i(74218),i(81718));(0,z.c)();var me=i(71702),_e=i(65148),ye=i(81016);class ve extends me._{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=k.colorToVec4(k.reshapeManipulators.vertex.color),this._size=k.reshapeManipulators.vertex.size,this._outlineColor=k.colorToVec4(k.reshapeManipulators.vertex.outlineColor),this._outlineSize=k.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,L.g)(e,this._color)||((0,L.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,L.g)(e,this._outlineColor)||((0,L.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if((0,n.Wi)(e)||0===e.length)return[];const t=function(e,t,i,a,r){const s=new Float64Array(3*e.length),n=new Float64Array(s.length);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const o=(0,ge.rR)(s,t,0,n,0,s,0,s.length/3,i,a,r),l=null!=o;return{numVertices:e.length,position:s,mapPosition:n,projectionSuccess:l,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,N.o.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,r=t.position;for(let e=0;e<a;++e){const t=(0,W.s)(fe,r[3*e+0],r[3*e+1],r[3*e+2]),a=new j.Z(Me(.5,16,16,t),"VerticesVisualElement-vertex"),s=new j.Z(Me(.5,16,16,t),"VerticesVisualElement-vertexOutline");i.push({vertexGeometry:a,vertexOutlineGeometry:s})}return i}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new ye.Q({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0},"manipulator"),this.vertexOutlineMaterial=new ye.Q({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1},"manipulator-outline")}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalResource(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const fe=(0,z.c)();function Me(e,t,i,a){const r=de.Z.createSphereGeometry(e,t,i,{attributes:{position:_e.YN.OFFSET,uv:null}});return r.indices[_e.YN.POSITION]=new Uint32Array(r.indexCount),r.vertexAttributes[_e.YN.POSITION]={size:3,data:Float64Array.from(a),offsetIdx:0,strideIdx:3},r}let be=class extends(h.Z.EventedMixin(g.m)){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._stagedVerticesVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingOptions=new m.g,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=(0,n.Pt)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new p.default({elevationInfo:e}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new a.w({view:this.view,manipulators:this.manipulators,geometryType:we(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new d.i(this.view,e,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:e,snappingOptions:this.snappingOptions}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e,t=!1){if(null==this.drawOperation)return null;const i=(0,n.pC)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,a=this.drawOperation.vertices;if(0===a.length)return null;const r=this.drawOperation.spatialReference,s=a,o=s.slice(),l=[];(0,n.pC)(i)&&(o.splice(i,1),l.push(s[i]));const h={regularVertices:null,stagedVertices:null,full:null,outline:null},c="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":h.regularVertices=o,h.stagedVertices=l,h.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":h.regularVertices=o,h.stagedVertices=l,s.length>0&&(h.full=(0,_.DF)([s],r,c));break;case"polygon":h.regularVertices=o,h.stagedVertices=l,s.length>0&&(h.full=(0,_.p)([s],r,c,!0));break;case"circle":if(s.length>0){const e=(0,_.Gn)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+Se*this.view.resolution,t[1]);h.full=(0,_.y)([t,i],e,!0)}else 2===s.length&&(h.full=this.forceUniformSize?(0,_.y)(a,e,this.centered):(0,_.n_)(a,e,this.centered))}break;case"rectangle":if(s.length>0){const e=(0,_.Gn)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+Se*this.view.resolution,t[1]);h.full=(0,_.yL)([t,i],e,!0)}else 2===s.length&&(h.full=this.forceUniformSize?(0,_.yL)(a,e,this.centered):(0,_.MC)(a,e,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":s.length>1&&(h.outline=(0,_.DF)([s],r,c));break;case"polygon":s.length>1&&(h.outline=(0,_.p)([s],r,c));break;case"circle":case"rectangle":(0,n.pC)(h.full)&&"polygon"===h.full.type&&(h.outline=(0,_.p)(h.full.rings,r,c))}return h}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){(0,n.pC)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)}_destroyOutlineVisualElement(){(0,n.pC)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}_destroyVerticesVisualElement(){(0,n.pC)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}_destroyStagedVerticesVisualElement(){(0,n.pC)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}_updateCreateGraphic(e=null){const t=this._getCreateGeometry(e);if((0,n.Wi)(t))return void this._destroyAllVisualisations();const i=this._internalGraphicsLayer.elevationInfo,a="on-the-ground"===(0,u.Zz)(this.hasZ,i);(0,n.pC)(t.outline)?(0,n.Wi)(this._outlineVisualElement)?(this._outlineVisualElement=new he({view:this.view,geometry:t.outline,elevationInfo:(0,n.Wg)(i),isDraped:a,attached:!1}),k.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),k.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),(0,n.pC)(t.regularVertices)?(0,n.Wi)(this._verticesVisualElement)?(this._verticesVisualElement=new ve({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:(0,n.Wg)(this._internalGraphicsLayer.elevationInfo),renderOccluded:k.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),(0,n.pC)(t.stagedVertices)?(0,n.Wi)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new ve({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:(0,n.Wg)(this._internalGraphicsLayer.elevationInfo),renderOccluded:k.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=k.colorToVec4(k.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),(0,n.pC)(t.full)?(0,n.Wi)(this._createGraphic)?(this._createGraphic=new c.Z({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry(null,!0);(0,n.pC)(e)&&(t=new c.Z({geometry:e.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:t,...e})}};function we(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],be.prototype,"view",void 0),(0,r._)([(0,o.Cb)()],be.prototype,"createGraphicSymbol",void 0),(0,r._)([(0,o.Cb)()],be.prototype,"createGraphic",null),(0,r._)([(0,o.Cb)({value:!0})],be.prototype,"enabled",null),(0,r._)([(0,o.Cb)({value:!0})],be.prototype,"centered",null),(0,r._)([(0,o.Cb)({value:!0})],be.prototype,"forceUniformSize",null),(0,r._)([(0,o.Cb)({constructOnly:!0})],be.prototype,"hasZ",void 0),(0,r._)([(0,o.Cb)({nonNullable:!0})],be.prototype,"defaultZ",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],be.prototype,"elevationInfo",void 0),(0,r._)([(0,o.Cb)()],be.prototype,"snapToScene",void 0),(0,r._)([(0,o.Cb)()],be.prototype,"snappingOptions",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],be.prototype,"mode",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],be.prototype,"geometryType",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],be.prototype,"type",void 0),be=(0,r._)([(0,l.j)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],be);const Se=48;var xe=i(5632),Ce=i(83477),Ee=i(59691),Oe=i(53640),De=i(50777),Ge=i(12217);function Ae(e,t=(0,u.RL)(e)){return"on-the-ground"!==t.mode&&!((0,n.Wi)(e.geometry)||!e.geometry.hasZ)}let Re=class extends h.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,r._)([(0,o.Cb)({constructOnly:!0})],Re.prototype,"graphic",void 0),(0,r._)([(0,o.Cb)()],Re.prototype,"tracking",void 0),(0,r._)([(0,o.Cb)()],Re.prototype,"displaying",void 0),(0,r._)([(0,o.Cb)()],Re.prototype,"isDraped",void 0),Re=(0,r._)([(0,l.j)("esri.views.3d.layers.graphics.GraphicState")],Re);var Pe=i(33655),Ve=i(44263),Ie=i(59492);class Te{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof Ie.Z&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),(0,n.Wi)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}function ke(e){const{view:t,graphic:i}=e,a=new Re({graphic:i}),r=function(e,t){const{view:i,graphic:a}=e,r=new he({view:i,geometry:ze(a)?a.geometry:null,elevationInfo:(0,u.RL)(a),attached:!1});k.visualElements.lineGraphics.shadowStyle.apply(r);const s=()=>{r.attached=t.displaying};k.visualElements.lineGraphics.outline.apply(r);const n=[t.watch("displaying",s),t.watch("isDraped",(e=>r.isDraped=e)),t.on("changed",(()=>r.geometry=ze(a)?a.geometry:null)),(0,xe.ed)(r)];return s(),{visualElement:r,remove:()=>(0,xe.AL)(n).remove()}}(e,a),s=[r,function(e,t,i){const{graphic:a,view:r}=e,s=[],o=(0,u.RL)(a),l="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,h=new Te,c=new Ve.V({view:r,extensionType:k.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});k.visualElements.pointGraphics.shadowStyle.apply(c);const p=(0,Pe.Vl)(k.visualElements.heightPlaneAngleCutoff),d=new ae.W({view:r,attached:!1,angleCutoff:p});k.visualElements.heightPlane.apply(d);let g=1,m=1;const _=()=>{if(h.update(e),!i.displaying||l&&(i.isDraped||!ze(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,c.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;{const e=4&h.grabbingState?k.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,k.visualElements.lineGraphics.shadowStyle.apply(t,e),k.visualElements.pointGraphics.shadowStyle.apply(c,e))}{const e=2&h.grabbingState?k.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,k.visualElements.heightPlane.apply(d,e))}!function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,n.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,n.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(c,h),function(e,t,i,a){if(a.numSelected>0){(0,W.s)(We,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{1===i&&e.selected&&e instanceof Ie.Z&&((0,W.b)(We,We,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,W.a)(We,We,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;(0,n.pC)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,We)?(i.heightManifoldTarget=We,i.attached=!0):i.attached=!1}}(e,t,d,h)};k.visualElements.zVerticalLine.apply(c),s.push(i.on("changed",_),i.watch("displaying",_),t.events.on("attachment-origin-changed",_),(0,xe.ed)(c),(0,xe.ed)(d));const y=[],v=()=>{(0,xe.AL)(y).remove(),y.length=0,e.forEachManipulator((e=>y.push(e.events.on("grab-changed",_)))),e.forEachManipulator((e=>y.push(e.events.on("select-changed",_)))),_()};return v(),s.push(e.onManipulatorsChanged(v),(0,xe.iU)((()=>(0,xe.AL)(y)))),(0,xe.AL)(s)}(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>(0,xe.AL)(s).remove()}}function ze(e){return(0,n.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const We=(0,z.c)();var Ze=i(80621),Le=i(50897),He=i(84845);function Fe(e){const{view:t,graphic:i}=e,a=new Re({graphic:i}),r=[],s=function(e,t,i){const{view:a,graphic:r}=e,s=new He.L({view:a,geometry:Ue(r)?r.geometry:null,elevationInfo:(0,u.RL)(r),attached:!1});return function(e,t,i,a){(function(e,t,i,a){const{view:r,graphic:s}=e;let o=null;const l=()=>{(0,n.pC)(o)&&(o.remove(),o=null),i.isDraped&&Ue(s)&&(o=function(e,t,i){const a=e.elevationProvider.spatialReference;(0,Z.KC)(t,Ne,a);const r=Ne[0],s=Ne[1];return e.elevationProvider.on("elevation-change",(e=>{(0,Le.jE)(e.extent,r,s)&&i()}))}(r,s.geometry,(()=>{t.geometry=s.geometry}))),t.geometry=Ue(s)?s.geometry:null};a.push(i.on("changed",l),(0,xe.iU)((()=>o))),l()})(e,t,i,a),k.visualElements.pointGraphics.outline.apply(t),a.push((0,Ze.init)(i,"displaying",(()=>t.attached=i.displaying)))}(e,s,t,i),i.push((0,xe.ed)(s)),s}(e,a,r);return function(e,t,i,a){const{view:r,graphic:s}=e,n=new Ve.V({view:r,extensionType:k.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});k.visualElements.zVerticalLine.apply(n);const o=new ae.W({view:r,intersectsLineInfinite:!0,attached:!1});k.visualElements.pointGraphics.shadowStyle.apply(o);const l=(0,Pe.Vl)(k.visualElements.heightPlaneAngleCutoff),h=new ae.W({view:r,attached:!1,angleCutoff:l});k.visualElements.heightPlane.apply(h);const c=(0,u.RL)(e.graphic),p=N.o.fromElevationInfo(c),d="on-the-ground"===c.mode||!c.offset&&"absolute-height"!==c.mode,g=new Te;let m=1,_=1;const y=()=>{g.update(e);const i=d&&(t.isDraped||!Ue(s)||!s.geometry.hasZ);let l=!0;if(!i&&Ue(s)){const e=s.geometry,t=(0,ge.w7)(s.geometry,r.elevationProvider,p,r.renderCoordsHelper);(0,W.s)(Ne,e.x,e.y,t),(0,Z.SH)(Ne,e.spatialReference,Ne,r.renderCoordsHelper.spatialReference),n.setStartEndFromWorldDownAtLocation(Ne),o.intersectsWorldUpAtLocation=Ne}else l=!1;{const e=2&g.grabbingState?k.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,k.visualElements.heightPlane.apply(h,e))}{const e=(0,H.cS)(je);!i&&t.displaying&&a.calculateMapBounds(e)&&(0,Z.SH)((0,H.KE)(e,Ne),r.spatialReference,Ne,r.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=Ne,h.attached=!0):h.attached=!1}{const e=4&g.grabbingState?k.visualElements.laserlineAlphaMultiplier:1;e!==_&&(_=e,k.visualElements.pointGraphics.shadowStyle.apply(o,e))}const c=l&&t.displaying&&!i;o.attached=c,n.attached=c};i.push(t.watch(["displaying","isDraped"],y),t.on("changed",y)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",y))})),i.push((0,xe.ed)(o)),i.push((0,xe.ed)(n)),i.push((0,xe.ed)(h)),y()}(e,a,r,s),r.push(t.trackGraphicState(a)),{visualElement:s,remove(){(0,xe.AL)(r).remove()}}}function Ue(e){return(0,n.pC)(e.geometry)&&"point"===e.geometry.type}const Ne=(0,z.c)(),je=(0,H.Ue)();function Ye(e){switch((0,n.Wg)(e.graphic.geometry).type){case"point":return Fe(e);case"polygon":case"polyline":return ke(e);default:return null}}const Xe=[1,.5,0],qe=70,Be=Math.ceil(70/3*2),Je=160,Ke=5*Math.PI/12,Qe=1*Math.PI/3;var $e=i(55735),et=i(14286),tt=i(70642),it=i(60418);function at(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=i[0],l=i[1],h=i[2],c=i[3];return e[0]=a*o+s*l,e[1]=r*o+n*l,e[2]=a*h+s*c,e[3]=r*h+n*c,e}function rt(e,t){const i=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=i,e[2]=-i,e[3]=a,e}function st(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}let nt=at,ot=st;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},set:function(e,t,i,a,r){return e[0]=t,e[1]=i,e[2]=a,e[3]=r,e},transpose:function(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){const i=t[0],a=t[1],r=t[2],s=t[3];let n=i*s-r*a;return n?(n=1/n,e[0]=s*n,e[1]=-a*n,e[2]=-r*n,e[3]=i*n,e):null},adjoint:function(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:at,rotate:function(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=Math.sin(i),l=Math.cos(i);return e[0]=a*l+s*o,e[1]=r*l+n*o,e[2]=a*-o+s*l,e[3]=r*-o+n*l,e},scale:function(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=i[0],l=i[1];return e[0]=a*o,e[1]=r*o,e[2]=s*l,e[3]=n*l,e},fromRotation:rt,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},LDU:function(e,t,i,a){return e[2]=a[2]/a[0],i[0]=a[0],i[1]=a[1],i[3]=a[3]-e[2]*i[1],[e,t,i]},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},subtract:st,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){const i=e[0],a=e[1],r=e[2],s=e[3],n=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-n)<=it.E*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(a-o)<=it.E*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(r-l)<=it.E*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=it.E*Math.max(1,Math.abs(s),Math.abs(h))},multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},multiplyScalarAndAdd:function(e,t,i,a){return e[0]=t[0]+i[0]*a,e[1]=t[1]+i[1]*a,e[2]=t[2]+i[2]*a,e[3]=t[3]+i[3]*a,e},mul:nt,sub:ot});function lt(){return[1,0,0,1]}Object.freeze({__proto__:null,create:lt,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,i,a){return[e,t,i,a]},createView:function(e,t){return new Float64Array(e,t,4)}});function ht(e,t,i){const a=e.graphic,r=(e,i)=>t({action:e,graphic:a,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{t.next((e=>("start"===e.action&&r("start",e),e))).next((0,Oe.a9)(a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e})),i.next((0,Oe.bD)(a)).next((()=>{r("end",{screenDeltaX:0,screenDeltaY:0})}))}))}function ct(e){if((0,n.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=(0,tt.convexHull)(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){let t=0,i=0;for(const a of e)t+=a[0],i+=a[1];t/=e.length,i/=e.length;for(const a of e)a[0]-=t,a[1]-=i}(i);const a=[];for(let e=0;e<i.length-1;e++){const t=Math.atan2(i[e+1][1]-i[e][1],i[e+1][0]-i[e][0]),r=q.c5.normalize(t)%(Math.PI/2);a.push(r)}const r=a.sort(((e,t)=>e-t));let s=null,o=0,l=Number.POSITIVE_INFINITY,h=0;for(const e of r){if(e===s)continue;s=e,rt(pt,e),(0,Le.cS)(ut);for(const e of i)(0,et.o)(dt,e,pt),(0,Le.Ho)(ut,dt);const t=(0,Le.SO)(ut);((t>l?l/t:t/l)>=.99&&e<o||t<l)&&(o=e,l=t),h=Math.max(h,t)}return l/h>=.95?0:o}const pt=[1,0,0,1],ut=(0,Le.Ue)(),dt=(0,$e.a)();class gt{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Ie.Z&&e(t,i)}))}}var mt=i(8344),_t=i(94589),yt=i(34937);class vt extends gt{constructor(e){super(),this._handles=new Ee.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=qe,this._updateAfterDrag=!1,this.events=new h.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t){const i=e.graphic,a=(0,u.RL)(i),r=(0,n.Wg)(i.geometry).spatialReference;return ht(e,t,(e=>this.createDragPipeline(e,a,r)))}createDragPipeline(e,t,i){return(0,xe.AL)(this._arrowManipulatorInfos.map((({manipulator:a},r)=>(0,Oe.Xd)(a,((a,s,n,o,l)=>{const h=s.next((e=>({...e,manipulatorType:1}))).next((0,Oe.kY)(this._view,a.elevationAlignedLocation)).next((0,yt.G)(this._view,a.elevationAlignedLocation,t,i)).next((0,Oe.M2)(a.location,this.angle+(r+1)*Math.PI*.5)).next((0,Oe.zh)());e(a,h,n,o,l)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/qe,r=54*a,s=Math.sqrt(r*r*3/4),n=de.Z.createExtrudedTriangle(s,r/2,r/2,.02);de.Z.transformInPlace(n,(0,B.w)(mt.MP.get(),(0,W.s)(mt.WM.get(),0,-s/3,0)));const o=new j.Z(n,"move-xy-axis-arrow");e.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:2},{geometry:o,material:this._transparentMaterial,stateMask:1}],e.radius=s/3*2*1.2;const l=(0,B.i)(mt.MP.get());(0,B.x)(l,i*Math.PI/2);const h=(0,B.i)(mt.MP.get());(0,B.w)(h,(0,W.s)(mt.WM.get(),0,100*a,0)),(0,B.m)(t,l,h)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,B.i)(mt.MP.get());(0,B.r)(t,t,e,(0,z.f)(0,0,1));const i=(0,B.p)(mt.MP.get(),(0,W.s)(mt.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,B.i)(mt.MP.get());(0,B.m)(a,i,t);for(const e of this._arrowManipulatorInfos){const t=(0,B.m)(mt.MP.get(),a,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new Ie.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,z.f)(0,0,1)}}),i={manipulator:t,transform:(0,J.a)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){const t=y.default.toUnitRGBA(b.main);return t[3]*=e,new _t.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2},"graphic-transform")}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class ft{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Oe.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,n.pC)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if((0,n.pC)(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){const t=(0,n.pC)(this.view)?this.view.toMap(e,{exclude:[]}):null;return(0,n.pC)(t)&&(0,n.pC)(this.view)&&(t.z=(0,u.Ou)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return(0,n.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class Mt extends gt{constructor(e){super(),this._handles=new Ee.Z,this._snapToScene=new ft,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=qe,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t){const i=e.graphic,a=(0,u.RL)(i),r=(0,n.Wg)(i.geometry).spatialReference;return ht(e,t,(e=>this.createDragPipeline(e,a,r)))}createDragPipeline(e,t,i){const a=this._view;return(0,Oe.Xd)(this._manipulator,((r,s,n,o,l)=>{const h=s.next((0,Oe.kY)(a,r.elevationAlignedLocation)).next((0,yt.G)(a,r.elevationAlignedLocation,t,i)).next(this._snapToScene.createDragEventPipelineStep(a,t),this._snapToScene.next).next((e=>({...e,manipulatorType:1}))).next((0,Oe.zh)());e(r,h,n,o,l)}))}_updateManipulatorTransform(){const e=(0,B.p)(mt.MP.get(),(0,W.s)(mt.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Ie.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,z.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=new j.Z(de.Z.createCylinderGeometry(.02,1,128,(0,z.f)(0,0,1),(0,z.f)(0,0,0)),"graphic-transform-disc"),t=(0,B.p)((0,J.a)(),(0,z.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/qe*80}_createMaterial(e=1){const t=y.default.toUnitRGBA(b.main);return t[3]*=e,new _t.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2},"move-xy-disc")}get test(){return{discManipulator:this._manipulator}}}class bt extends gt{constructor(e){super(),this._handles=new Ee.Z,this._radius=qe,this.events=new h.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t){const i=(0,n.Wg)(e.graphic.geometry).spatialReference;return ht(e,t,(e=>this.createDragPipeline(e,i)))}createDragPipeline(e,t){const i=this._view;return(0,Oe.Xd)(this._manipulator,((a,r,s,n,o)=>{const l=r.next((e=>({...e,manipulatorType:0}))).next((0,yt.Sp)(i,a.renderLocation,t)).next((0,Oe.zh)());e(a,l,s,n,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/qe,t=k.zManipulator.height*e,i=k.zManipulator.coneHeight*e,a=k.zManipulator.coneWidth*e,r=k.zManipulator.width*e,s=[(0,z.f)(0,0,0),(0,z.f)(0,0,t)],n=new j.Z(de.Z.createTubeGeometry(s,r/2,16,!1),"move-z"),o=de.Z.createConeGeometry(i,a/2,16,!1),l=new j.Z(o),h=[(0,z.f)(0,0,0),(0,z.f)(0,0,t+i)],c=(e=>{const i=(0,J.a)();return(0,B.t)(i,i,[0,0,t]),(0,B.e)(i,i,Math.PI/2),i})(),p=(e,t)=>{const i=(0,v._j)(k.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,k.zManipulator.color.a*e]},u=(0,De.EA)(p(1,.25),1),d=(0,De.EA)(p(1,0),1),g=(0,De.EA)(p(.7,0),k.zManipulator.renderOccluded),m=(0,De.EA)(p(.85,0),k.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:l,transform:c,material:u,stateMask:1},{geometry:n,material:u,stateMask:1},{geometry:l,transform:c,material:d,stateMask:2},{geometry:n,material:d,stateMask:2},{geometry:l,transform:c,material:g,stateMask:1},{geometry:n,material:g,stateMask:1},{geometry:l,transform:c,material:m,stateMask:2},{geometry:n,material:m,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[h]}}createManipulator(){const e=new Ie.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=wt;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,W.w)(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),s=(0,W.f)(St,i,t.eye);(0,W.n)(s,s);const n=xt;this._view.renderCoordsHelper.worldUpAtPosition(wt,n);const o=Math.abs((0,W.d)(s,n)),l=(0,W.c)(St,s,n),h=(0,W.c)(St,l,n),c=(0,Pe.uZ)(o,.01,1),p=1-Math.sqrt(1-c*c)/c/t.fullWidth,u=this._radius/qe,d=k.zManipulator.width*u;(0,W.a)(h,(0,W.n)(h,h),(1/p-1)*a+r*d),e[12]-=St[0],e[13]-=St[1],e[14]-=St[2]},this._manipulator=e,this.updateManipulator()}}const wt=(0,z.c)(),St=(0,z.c)(),xt=(0,z.c)();class Ct extends gt{constructor(e){super(),this._handles=new Ee.Z,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new Mt({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new vt({tool:t,view:i,radius:r}),this.zManipulation=new bt({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t){return(0,xe.AL)([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])}createDragPipeline(e,t,i){return(0,xe.AL)([this.xyManipulation.createDragPipeline(e,t,i),this.xyAxisManipulation.createDragPipeline(e,t,i),this.zManipulation.createDragPipeline(e,i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,s.Z)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this.xyAxisVisible?(0,n.pC)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Et),this._handles.add(t,Et)};for(const e of i)this._handles.add(e.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=(0,n.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?Be:qe}}const Et="disable-xy-axis-display";var Ot=i(65865);class Dt extends gt{constructor(e){super(),this._handles=new Ee.Z,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return ht(this._graphicState,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=(0,n.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,Oe.Xd)(this._manipulator,((r,s,n,o,l)=>{const h=s.next((0,yt._y)(l,t,i,a)).next((0,Oe.AN)()).next((0,Oe.zh)());e(r,h,n,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Ot.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}class Gt{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class At{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Rt{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let Pt=class extends(h.Z.EventedMixin(g.m)){constructor(e){super(e),this.graphics=new Ce.Z,this.enableZ=!0,this.type="move-3d",this._toolHandles=new Ee.Z,this._handles=new Ee.Z}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators()}destroy(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}reset(){}_refreshManipulators(){this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>0===(0,Ge.P)(e))).map((e=>new Vt(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this._handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Dt({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this._handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this._handles.add(t.manipulationXY.createDragPipeline(((t,i,a)=>this.buildDragEventPipeline(t,i,a,e))))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new Ct({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ct.radiusForSymbol(e[0].graphic.symbol):qe});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this._handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this.updateMoveManipulation(e);for(const t of e)this._handles.add([t.state.on("changed",i),t.state.watch("displaying",i)]);const a=e[e.length-1];this._handles.add(a.state.on("changed",(()=>this.updateMoveManipulationAngle(a)))),this._handles.add(t.createDragPipeline(((t,i,a)=>{this.buildDragEventPipeline(t,i,a,e)}),(0,u.RL)(a.graphic),(0,n.Wg)(a.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const i=t.graphic,a=Ye({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>(0,xe.kB)()});t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof he&&this._handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this.updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this.updateMoveManipulation(e)))]),this._handles.add(a)}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>ct(e.graphic.geometry)}updateMoveManipulation(e){const t=(0,F.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const r=this._moveManipulation;for(const r of e){if(!r.state.displaying)continue;const e=r.state.graphic;this.enableZ&&Ae(e)&&(a=!0);const s=r.geometryRepresentation instanceof he&&!r.state.isDraped?r.geometryRepresentation.attachmentOrigin:(0,De.du)(this.view,e);(0,n.pC)(s)&&(t.x+=s.x,t.y+=s.y,t.z+=s.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}buildDragEventPipeline(e,t,i,a){const r=[],s=[];let n=null,o=null;const l=()=>{for(const e of r)e.dragging=!1;r.length=0,s.length=0,n=null,o=null,this._moveManipulation.interactive=!0};t.next((t=>{if("start"===t.action){r.length=0,s.length=0;for(const t of a)t.dragging||!t.manipulationXY.hasManipulator(e)&&t.manipulationXY.grabbing||(r.push(t),s.push(t.graphic),t.dragging=!0);if(0!==s.length&&(this._moveManipulation.interactive=!1,n=(0,Oe.oq)(s),o=(0,Oe.QY)(s),this.emit("graphic-move-start",new Gt(s)),this.destroyed))return null}return 0!==s.length?t:null})).next((e=>n(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,r=i.y-t.y;if(this.emit("graphic-move",new At(a,r,s)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Rt(s)),this.destroyed)return null;l()}})),i.next((e=>o(e))).next((()=>{if(this.emit("graphic-move-stop",new Rt(s)),this.destroyed)return null;l()}))}};(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Pt.prototype,"view",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],Pt.prototype,"graphics",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Pt.prototype,"enableZ",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],Pt.prototype,"type",void 0),Pt=(0,r._)([(0,l.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Pt);class Vt{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Re({graphic:e})}get graphic(){return this.state.graphic}}var It=i(91700),Tt=i(37554),kt=i(3521),zt=i(87008),Wt=i(69470);let Zt=class extends h.Z.EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=(0,De.EA)(k.colorToVec4(k.reshapeManipulators.vertex.color),k.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,De.qJ)(k.colorToVec4(k.reshapeManipulators.vertex.outlineColor),k.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,De.qJ)(k.colorToVec4(k.reshapeManipulators.vertex.hoverOutlineColor),k.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,De.EA)(k.colorToVec4(k.reshapeManipulators.edge.color),k.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,De.qJ)(k.colorToVec4(k.reshapeManipulators.edge.outlineColor),k.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=(0,De.EA)(k.colorToVec4(k.reshapeManipulators.selected.color),k.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,De.qJ)(k.colorToVec4(k.reshapeManipulators.selected.outlineColor),k.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,De.qJ)(k.colorToVec4(k.reshapeManipulators.selected.hoverOutlineColor),k.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new Ee.Z,this._manipulatorHandles=new Ee.Z,this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null,this.snappingEngine=new Wt.r(e.tool.snappingOptions)}initialize(){const e=new Re({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy(),this.snappingEngine.destroy()}get inputGeometry(){return(0,n.pC)(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=(0,n.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,n.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),(0,n.Wi)(e))return;this._reshapeHelper=new jt(Tt.XE.fromGeometry(e,this.view.viewingMode),e.type);const t=(0,u.RL)(this.graphic);for(const e of this._reshapeHelper.data.components){for(const i of e.vertices)this._createPerVertexManipulator(i,t);for(const i of e.edges)this._createPerVertexManipulator(i,t)}this._createGraphicMoveManipulators(t)}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;const i=[],a=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),r=1===e&&a,s=(0,n.Wg)(this._reshapeHelper);for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&(e.manipulator.grabbing||r&&!e.manipulator.selected||((0,n.Wg)(s).moveVertices([e.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(e.handle.pos),this._updateManipulatorPosition(e)));if(0===i.length)return;let o=0;for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&o++;if(this.outputGeometry=s.geometry,i.length===o){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)Ht(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(!t&&!i&&!a)return;const r=[];for(const t of this._manipulatorInfos)Ht(t)&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&r.push(t);const s=(0,n.Wg)(this._reshapeHelper);for(const e of r)s.moveVertices([e.handle],t,i,a);this.outputGeometry=s.geometry;for(const e of r)this._updateManipulatorPosition(e);this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new Dt({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,t,i)=>{t.next((e=>this._trackNumDragging(e))).next((e=>{this._perGraphicManipulatorDragAction(0,e)})),i.next(this._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click"),e.stopPropagation()}))]))),this._moveManipulation=new Ct({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ae(this.graphic),snapToScene:!1,radius:Ct.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click"),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=(0,n.Wg)(this.graphic.geometry).spatialReference;let i=null;this._handles.add([this._moveManipulation.createDragPipeline(((t,a,r,s)=>{a.next((e=>this._trackNumDragging(e))).next((t=>{if("start"===t.action){const a=this._manipulatorInfos.filter((e=>Ht(e)&&e.manipulator.selected));if(1===t.manipulatorType&&1===a.length){const t=a[0].handle;i=new zt.N((0,n.Wg)(this._reshapeHelper),this.view,e,s,t)}}return(0,n.pC)(i)&&(t.mapEnd=this.snappingEngine.snap(t.mapEnd,i)),"end"===t.action&&(this.snappingEngine.doneSnapping(),i=null),t})).next((0,Oe.AN)()).next((e=>{this._perGraphicManipulatorDragAction(1,e)})),r.next(this._cancelDragOperation())}),e,t),(0,Ze.init)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),(0,Ze.init)(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this._handles.remove(e)}))]),this._updateMoveManipulationPosition();const a=Ye({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){(0,n.pC)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=a.visualElement instanceof he?a.visualElement:null,(0,n.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(a)}_createPerVertexManipulator(e,t=(0,u.RL)(this.graphic)){if((0,n.Wi)(this._vertexManipulatorGeometry)||(0,n.Wi)(this._vertexManipulatorOutlineGeometry)){const e=k.reshapeManipulators.vertex,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._vertexManipulatorGeometry=new j.Z(de.Z.createSphereGeometry(a,16,16),"reshape-manipulator");const r=(t+e.outlineSize)/i;this._vertexManipulatorOutlineGeometry=new j.Z(de.Z.createSphereGeometry(r,16,16),"reshape-manipulator-outline")}if((0,n.Wi)(this._edgeManipulatorGeometry)||(0,n.Wi)(this._edgeManipulatorOutlineGeometry)){const e=k.reshapeManipulators.edge,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._edgeManipulatorGeometry=new j.Z(de.Z.createSphereGeometry(a,16,16),"reshape-manipulator");const r=(t+e.outlineSize)/i;this._edgeManipulatorOutlineGeometry=new j.Z(de.Z.createSphereGeometry(r,16,16),"reshape-manipulator-outline")}const i=new Ie.Z({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Nt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Nt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Nt.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Nt.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Nt.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Nt.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Nt.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(i,e,t);const a="edge"===e.type?{manipulator:i,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:i,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(a),this.manipulators.add(i),this._updateManipulatorPosition(a),"edge"===a.type){const e=this._getManipulatorInfoFromHandle(a.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(a))),t=this._getManipulatorInfoFromHandle(a.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(a)));a.locationUpdateHandle=(0,xe.AL)([e,t]),this._manipulatorHandles.add(a.locationUpdateHandle,i)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(i,!0),i);const r=(0,Oe.Xd)(i,((e,i,r,s)=>{i.next((e=>this._trackNumDragging(e))).next((e=>Ft(a)?{...e,info:this._splitEdgeManipulator(a)}:{...e,info:a})).next((0,Oe.kY)(this.view,e.elevationAlignedLocation)).next((0,yt.VG)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(this._snapDrag(t,s)).next((0,Oe.AN)()).next((e=>{this._perVertexManipulatorDragAction(e)})),r.next(this._cancelDragOperation())}));return this._manipulatorHandles.add(r,i),this._manipulatorHandles.add([i.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,a))),i.events.on("select-changed",(()=>{a.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),i}_snapDrag(e,t){let i=null;const a=(0,n.Wg)(this._reshapeHelper);return r=>{if("start"===r.action&&(this.isMultiVertexSelection()||(i={context:new zt.N(a,this.view,e,t,r.info.handle),originalPos:a.data.coordinateHelper.createDehydratedPoint(r.info.handle.pos)})),(0,n.pC)(i)){const e={...i.originalPos};e.x+=r.mapEnd.x-r.mapStart.x,e.y+=r.mapEnd.y-r.mapStart.y;const t=this.snappingEngine.snap(e,i.context);r.mapEnd.x=t.x+(r.mapStart.x-i.originalPos.x),r.mapEnd.y=t.y+(r.mapStart.y-i.originalPos.y)}return"end"===r.action&&(this.snappingEngine.doneSnapping(),i=null),r}}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){const e=(0,n.pC)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,this.snappingEngine.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Nt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=k.reshapeManipulators.vertex.size/2+k.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=Nt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=k.reshapeManipulators.edge.size/2+k.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=(0,n.Wg)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.toPoint(e.handle.pos,Ut),e.manipulator.grabbing&&(0,n.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if((0,n.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=i.location,s=a.location,n=.5,o=r.x+n*(s.x-r.x),l=r.y+n*(s.y-r.y),h=r.hasZ&&s.hasZ?0:void 0;e.manipulator.location=(0,F.Tx)(o,l,h,t.geometry.spatialReference)}else{const r=i.elevationAlignedLocation,s=a.elevationAlignedLocation,n=.5,o=r.x+n*(s.x-r.x),l=r.y+n*(s.y-r.y),h=r.hasZ&&s.hasZ?r.z+n*(s.z-r.z):void 0;e.manipulator.elevationAlignedLocation=(0,F.Tx)(o,l,h,t.geometry.spatialReference)}}}_splitEdgeManipulator(e){const t=(0,n.Wg)(this._reshapeHelper),i=(0,n.Wg)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const a=e;a.handle=i,a.type="vertex";const r=(0,u.RL)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(a),this._updateSelection(e.manipulator);const s=this._updateEventState(2),o=t.data.coordinateHelper.toArray(a.handle.pos),l=t.data.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:(0,n.Wg)(i.index)}],added:o}),s&&this._updateEventState(0),a}_updateMoveManipulationPosition(){const e=mt.WM.get();(0,W.s)(e,0,0,0);let t=0,i=!1,a=null,r=null;for(const s of this._manipulatorInfos)Ht(s)&&(s.manipulator.selected?(t++,(0,W.b)(e,e,s.manipulator.renderLocation),(0,n.Wi)(a)||s.selectedIndex>a.selectedIndex?(r=a,a=s):((0,n.Wi)(r)||s.selectedIndex>r.selectedIndex)&&(r=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Ae(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Ae(this.graphic)}if(0!==t){let e=0;if((0,n.pC)(a)){const t=a.handle.pos,i=(0,n.pC)(r)?r.handle.pos:a.handle.left&&a.handle.left.left?a.handle.left.left.pos:null,s=!(0,n.pC)(r)&&a.handle.right&&a.handle.right.right?a.handle.right.right.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=Lt(i,t):s&&(e=Lt(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=Be}else this._moveManipulation.angleDeferred=()=>ct((0,n.Wg)(this.graphic.geometry)),this._moveManipulation.radius=Ct.radiusForSymbol(this.graphic.symbol);0!==t&&i?((0,W.a)(e,e,1/t),Ut.spatialReference=(0,n.Wg)(this._reshapeHelper).geometry.spatialReference,Ut.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Ut),this._moveManipulation.elevationAlignedLocation=Ut):(0,n.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,n.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,De.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=(0,n.Wg)(this._reshapeHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=(0,n.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createPerVertexManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:(0,n.Wg)(e.index)}}));this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Ft(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Lt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Ht(e){return"vertex"===e.handle.type}function Ft(e){return"edge"===e.handle.type}(0,r._)([(0,o.Cb)({constructOnly:!0})],Zt.prototype,"tool",void 0),(0,r._)([(0,o.Cb)()],Zt.prototype,"inputGeometry",null),(0,r._)([(0,o.Cb)()],Zt.prototype,"outputGeometry",void 0),Zt=(0,r._)([(0,l.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],Zt);const Ut=(0,F.Tx)(0,0,null,null);var Nt;!function(e){e.Vertex=16,e.Edge=32}(Nt||(Nt={}));class jt extends kt.hE{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}let Yt=class extends(h.Z.EventedMixin(g.m)){constructor(e){super(e),this._handles=new Ee.Z,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingOptions=new m.g}destroy(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;0!==(0,It.P)(this.graphic)||!(0,n.pC)(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==(0,It.P)(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){(0,n.Wi)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new Zt({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(()=>this.emit("immediate-click"))),(0,Ze.init)(this,"graphic",(()=>{this._updateGraphic()}),!0)])}beforeUndo(){this._reshapeOperation.snappingEngine.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}};(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"view",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],Yt.prototype,"graphic",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"enableZ",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"enableMoveGraphic",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],Yt.prototype,"type",void 0),(0,r._)([(0,o.Cb)()],Yt.prototype,"snappingOptions",void 0),Yt=(0,r._)([(0,l.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Yt);var Xt,qt=i(74386),Bt=i(96071),Jt=i(88);!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(Xt||(Xt={}));class Kt{constructor(e){this.mode=null,this._handles=new Ee.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new h.Z,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>(0,n.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._scaleRotateDragData.scale:1,this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}destroy(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,qt.A)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,2)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=(0,Oe.Xd)(e,((e,i,a)=>{this._scaleRotateDragData=null;const r=function(e,t){const i=e.allLayerViews.find((e=>e.layer===t.layer));if((0,n.Wi)(t.symbol))return null;const a=t.symbol;return{symbolLayers:a.symbolLayers.map((e=>{let t=null,r=null;return"object"===e.type&&(t=e.heading),r=i.getSymbolLayerSize(a,e),{heading:t,size:r}})).toArray()}}(this.tool.view,t);if((0,n.Wi)(r))return this.updateDragState(),null;const s={mode:"none",origin:(0,z.b)(e.renderLocation),angle:0,startAngle:this.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};this._scaleRotateDragData=s,this.updateDragState();const o=mt.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next((0,yt._N)(this.tool.view,Jt.yC.fromPositionAndNormal(e.renderLocation,o))).next((e=>{const i=Jt.yC.normal(e.plane),a=(0,De.Gd)(e.renderStart,e.renderEnd,s.origin,i),r=q.Q4.shortestSignedDiff(s.angle,a);s.angleDir=(0,Pe.uZ)(s.angleDir+r,-.3,.3),s.angle=a;const o=function(e,t){const i=(0,W.f)(mt.WM.get(),t.renderStart,e.origin),a=(0,W.f)(mt.WM.get(),t.renderEnd,e.origin),r=(0,W.l)(i),s=(0,W.l)(a);return 0===r?0:s/r}(s,e),l=o-s.scale;if(s.scaleDir=(0,Pe.uZ)(s.scaleDir+l,-.2,.2),s.scale=o,this.onScaleChanged(),"none"===s.mode){const i=this.mode||function(e,t,i,a){const{renderStart:r,renderEnd:s}=e,n=Qt(r,a,mt.WM.get()),o=Qt(s,a,mt.WM.get());if((0,W.h)(n,o)<100)return null;const l=(0,W.f)(mt.WM.get(),r,i),h=(0,W.c)(mt.WM.get(),l,t),c=r,p=(0,W.b)(mt.WM.get(),c,h),u=Qt(i,a,mt.WM.get()),d=n,g=Qt(p,a,mt.WM.get()),m=(0,W.f)(mt.WM.get(),g,d),_=(0,W.f)(mt.WM.get(),n,u),y=Jt.kx.wrap(d,m),v=Jt.kx.wrap(u,_);return Jt.kx.distance2(y,o)<Jt.kx.distance2(v,o)?"rotate":"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if((0,n.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,scale:s.scale})}s.mode=i}}if(this.updateDragState(),(0,n.pC)(t.symbol)){const e=t.symbol.clone();let i=0,a=1;switch(s.mode){default:case"none":break;case"scale":a=s.scale;break;case"rotate":i=s.angle}this.applySymbolData(e,s.startSymbolData,i,a),t.symbol=e,this.updateManipulatorTransform()}switch(e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,scale:s.scale})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,scale:s.scale});break;default:case"none":}}"end"===e.action&&(this.startAnimation($t(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),a.next((0,Oe.nh)(t)).next((()=>{if((0,n.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:this._scaleRotateDragData.startAngle});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}this.startAnimation($t(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,Ze.init)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e)),this.tool.graphicState.on("changed",(()=>(0,De.u2)(this.tool.view,this.ringManipulator,t)))]),(0,De.u2)(this.tool.view,this.ringManipulator,t)}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Xt.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Xt.Unlocked,!((0,n.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,n.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Xt.ScaleIn|Xt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Xt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Xt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Xt.RotateLeft|Xt.RotateRight,!1),this.ringManipulator.updateStateEnabled(Xt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Xt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Xt.ScaleIn|Xt.ScaleOut|Xt.RotateLeft|Xt.RotateRight,!1)}updateManipulatorTransform(){const e=(0,B.i)(mt.MP.get()),t=this.tool.symbolRotationAngle;(0,B.r)(e,e,t,(0,z.f)(0,0,1));const i=this.getScale(),a=(0,B.p)(mt.MP.get(),(0,W.s)(mt.WM.get(),i,i,i)),r=(0,B.i)(mt.MP.get());(0,B.m)(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){const e=(e,t,i)=>{const a=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<r+1;s++){const n=e+s*(t-e)/r;a.push((0,z.f)(i*Math.cos(n),i*Math.sin(n),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>new j.Z(de.Z.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),"graphic-transform-ring"),a=t(Je),r=i(a,24),s={left:[],right:[]},n=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-Ke,o=a+r,l=a+Math.PI/2-r,h=e(o,l,190),c=i(h,9);n.push(h),n.push(e(o,l,201)),s.left.push(c),s.right.push(c);for(let e=0;e<2;e++){const t=0===e,i=(0,J.a)();if(t){(0,B.s)(i,i,[1,-1,1]),(0,B.r)(i,i,-o,[0,0,1]);const e=Math.round(.2*(h.length-1));i[12]=h[e][0],i[13]=h[e][1],i[14]=h[e][2]}else{(0,B.r)(i,i,l,[0,0,1]);const e=Math.round(.8*(h.length-1));i[12]=h[e][0],i[13]=h[e][1],i[14]=h[e][2]}const a=de.Z.createExtrudedTriangle(60,0,23,.5);de.Z.transformInPlace(a,i);const r=new j.Z(a,"graphic-transform-ring-rotate");(t?s.left:s.right).push(r)}}const o=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-Qe,s=a+r,n=a+Math.PI/2-r,l=e(s,n,213);o.push(i(l,9))}const l=t(190),h=t(213),c=i(l,9),p=i(h,9),d=t(130),g=t(107),m=i(d,9),_=i(g,9),y=this.createMaterial(),v=this.createMaterial(.66),f=this.createMaterial(.5),M=this.createMaterial(.33);let b=[{geometry:r,material:y,stateMask:Xt.DelayedFocused},{geometry:r,material:f,stateMask:0}];this.mode&&"scale"!==this.mode||(b=b.concat([{geometry:o,material:y,stateMask:Xt.DelayedFocused|Xt.Unlocked},{geometry:c,material:v,stateMask:Xt.DelayedFocused|Xt.ScaleIn},{geometry:p,material:M,stateMask:Xt.DelayedFocused|Xt.ScaleIn},{geometry:m,material:v,stateMask:Xt.DelayedFocused|Xt.ScaleOut},{geometry:_,material:M,stateMask:Xt.DelayedFocused|Xt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(b=b.concat([{geometry:s.right,material:y,stateMask:Xt.DelayedFocused|Xt.Unlocked},{geometry:s.left,material:y,stateMask:Xt.DelayedFocused|Xt.RotateLeft},{geometry:s.right,material:y,stateMask:Xt.DelayedFocused|Xt.RotateRight}]));const w=[a,...n];return new Ie.Z({view:this.tool.view,renderObjects:b,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,u.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:w,direction:(0,z.f)(0,0,1)}})}createMaterial(e=1){const t=[...Xe,e];return new _t.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2},"graphic-transform")}applySymbolData(e,t,i,a){e.symbolLayers.forEach(((e,r)=>{const{heading:s,size:o}=t.symbolLayers[r];"object"===e.type&&(e.heading=((0,n.pC)(s)?s:0)-(0,it.a)(i),(0,n.pC)(o)&&"width"in o&&(o.width=this.enforceNonZeroSize(o.width),o.height=this.enforceNonZeroSize(o.height),o.depth=this.enforceNonZeroSize(o.depth),e.width=o.width*a,e.depth=o.depth*a,e.height=o.height*a))}))}enforceNonZeroSize(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}get test(){return{ringManipulator:this.ringManipulator}}}function Qt(e,t,i){const a=t.projectToRenderScreen(e,(0,Bt.So)(ei)),r=t.renderToScreen(a,ti);return(0,W.s)(i,r[0],r[1],0)}function $t(e,t){let i=null,a=1;const r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const ei=(0,z.c)(),ti=(0,Bt.s1)();let ii=class extends(h.Z.EventedMixin(g.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.handles=new Ee.Z,this.scaleRotate=null}initialize(){if(this.graphicState=new Re({graphic:this.graphic}),this.moveManipulation=new Ct({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ae(this.graphic),radius:Ct.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>e.stopPropagation()))))),this.moveManipulation.elevationInfo=(0,u.RL)(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,s={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",s);break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Kt({tool:this,mode:e}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([Ye({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>(0,xe.kB)()}),this.graphic.watch("symbol",(()=>this.updateMoveAngle())),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),(0,n.pC)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Ae(this.graphic)}))}destroy(){this.handles.destroy(),this.moveManipulation.destroy(),(0,n.pC)(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get symbolRotationAngle(){const e=this.graphic.symbol;if(e){const t=e.symbolLayers.find((e=>"object"===e.type)),i=t&&t.heading||0;return(0,it.t)(-i)}return 0}reset(){}onDetach(){(0,n.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){(0,n.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if((0,n.Wi)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}onGeometryChanged(){(0,De.u2)(this.view,this.moveManipulation,this.graphic)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:(0,n.pC)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ii.prototype,"view",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ii.prototype,"graphic",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ii.prototype,"enableZ",void 0),(0,r._)([(0,o.Cb)()],ii.prototype,"enableRotation",void 0),(0,r._)([(0,o.Cb)()],ii.prototype,"enableScaling",void 0),(0,r._)([(0,o.Cb)({value:!1})],ii.prototype,"snapToScene",null),(0,r._)([(0,o.Cb)({readOnly:!0})],ii.prototype,"type",void 0),ii=(0,r._)([(0,l.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ii)},65865:(e,t,i)=>{"use strict";i.d(t,{L:()=>M});var a=i(56140),r=(i(95830),i(59472)),s=i(36544),n=(i(68055),i(79881)),o=i(87566),l=(i(10923),i(57002),i(86035),i(82677)),h=i(35470),c=i(96071),p=i(77625),u=i(17387),d=i(17333),g=i(79710),m=i(5684),_=i(14286),y=i(46970),v=i(37694);const f=s.Z.getLogger("esri.views.interactive.GraphicManipulator");let M=class extends l.default{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new h.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){"mesh"!==(0,r.U2)(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):f.error("Mesh geometries are not supported")}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,y.vu)(this.graphic),i=e?e.offset:0;return new g.Z({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this._get("graphic");if(!1===t.visible)return null;const i=this._get("focusedSymbol"),a=(0,r.pC)(i)?i:t.symbol,s=t.geometry;return(0,r.Wi)(s)?null:"2d"===this.view.type?this._intersectDistance2D(this.view,e,s,a):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),(0,r.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,r.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{(0,r.pC)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&(0,r.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){(0,r.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,r.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||(0,m.js)(i),(0,r.Wi)(a))return null;let s=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,v.D)(t,i,e)?1:null;if((0,r.Wi)(s)||!s.originalPoint.equals(i)){const t=i,r=e.spatialReference;if((0,d.Up)(t.spatialReference,r)){const e=(0,d.iV)(t,r);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,c.F2)(a.size)},this._circleCollisionCache=s}}if((0,r.pC)(s)){const i=(0,c.md)(t,w),r=e.toScreen(s.mapPoint),n=s.radiusPx,o=r.x+(0,c.F2)(a.xoffset),l=r.y-(0,c.F2)(a.yoffset);return(0,_.j)(i,[o,l])<n*n?1:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&(0,d.KC)(a,b,e.renderSpatialReference)?(0,u.k)(b,e.state.camera.eye):null}};(0,a._)([(0,n.Cb)({constructOnly:!0,nonNullable:!0})],M.prototype,"graphic",null),(0,a._)([(0,n.Cb)({readOnly:!0,dependsOn:["graphic"]})],M.prototype,"elevationInfo",null),(0,a._)([(0,n.Cb)({constructOnly:!0,nonNullable:!0})],M.prototype,"view",void 0),(0,a._)([(0,n.Cb)({value:null})],M.prototype,"focusedSymbol",null),(0,a._)([(0,n.Cb)({constructOnly:!0})],M.prototype,"layer",void 0),(0,a._)([(0,n.Cb)()],M.prototype,"interactive",void 0),(0,a._)([(0,n.Cb)()],M.prototype,"selectable",void 0),(0,a._)([(0,n.Cb)()],M.prototype,"grabbable",void 0),(0,a._)([(0,n.Cb)({value:!1})],M.prototype,"grabbing",null),(0,a._)([(0,n.Cb)()],M.prototype,"dragging",void 0),(0,a._)([(0,n.Cb)()],M.prototype,"hovering",null),(0,a._)([(0,n.Cb)({value:!1})],M.prototype,"selected",null),(0,a._)([(0,n.Cb)()],M.prototype,"cursor",void 0),M=(0,a._)([(0,o.j)("esri.views.interactive.GraphicManipulator")],M);const b=(0,p.c)(),w=(0,c.s1)()},37694:(e,t,i)=>{"use strict";i.d(t,{K:()=>o,D:()=>l});var a=i(59472),r=i(52937),s=(i(36348),i(93533)),n=i(83873);function o(e,t,i,n=new r.Z){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),n=i.basemapSpatialReference;o=(0,a.pC)(n)&&!n.equals(i.spatialReference)?(0,s.c9)(n)/(0,s.c9)(i.spatialReference):t*r}const l=e.x-o,h=e.y-o,c=e.x+o,p=e.y+o,{spatialReference:u}=i;return n.xmin=Math.min(l,c),n.ymin=Math.min(h,p),n.xmax=Math.max(l,c),n.ymax=Math.max(h,p),n.spatialReference=u,n}function l(e,t,i){const r=i.toMap(e);return!(0,a.Wi)(r)&&o(r,(0,n.k)(),i,h).intersects(t)}const h=new r.Z}}]);
//# sourceMappingURL=8458.js.map