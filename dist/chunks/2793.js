(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2793],{25654:(e,t,i)=>{"use strict";i.d(t,{M:()=>o,b:()=>n});var s=i(85461),r=i(51219);function n(){const e=new r.kG;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(s.H`
    void main(void) {
      vec3 bitangent = normal;

      vtc = uv0;
      vlength = auxpos1;
      vradius = 0.5 * width;

      vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
      gl_Position = proj * pos;
    }
  `),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(s.H`
    const float INV_SQRT2 = ${s.H.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}var o=Object.freeze({__proto__:null,build:n})},32793:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>yt});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),o=i(51894),a=i(87566),l=(i(10923),i(57002),i(86035),i(39105)),h=i(93533),d=(i(40450),i(24258)),c=i(9200),u=i(90846),_=i(19401),m=i(90806),p=i(59472),g=i(59691),v=i(80621),w=i(65867),b=i(19539),f=i(61106),y=(i(36348),i(2887)),P=i(58722),L=i(53640),C=i(76916),S=i(34937),M=i(82677),D=i(93833),O=i(3766),x=i(33655),z=i(14071),R=(i(89771),i(77625)),T=i(17387),A=i(89333),G=i(17333),E=i(32811),V=i(98675),k=i(70642),H=i(89785),j=i(92630);class W{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const t in e){const i=e[t],s=new H.e(i,null,null,2,2);this.properties[t]={pool:s,acquired:[]}}this.afterDispatchHandle=(0,j.Fs)((()=>this.release()))}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)(0,j.NC)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),i=this.properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===t;)i.acquired.push(s),s=i.pool.acquire();return s}release(){for(const e in this.properties){const t=this.properties[e];let i=0;for(const e of t.acquired)(0,j.NC)(e)?t.acquired[i++]=e:t.pool.release(e);t.acquired.length=i}}}var U=i(84397);let I=class extends M.default{constructor(){super(...arguments),this.settings=new q,this.measurement=null}destroy(){this.settings.destroy()}set startPoint(e){this.measurement=null,this._set("startPoint",(0,p.pC)(e)?e.clone():null)}set endPoint(e){this.measurement=null,this._set("endPoint",(0,p.pC)(e)?e.clone():null)}};(0,s._)([(0,n.Cb)()],I.prototype,"settings",void 0),(0,s._)([(0,n.Cb)({value:null})],I.prototype,"startPoint",null),(0,s._)([(0,n.Cb)({value:null})],I.prototype,"endPoint",null),(0,s._)([(0,n.Cb)()],I.prototype,"measurement",void 0),I=(0,s._)([(0,a.j)("esri.views.3d.interactive.graphics.DirectLineMeasurement3D")],I);let q=class extends M.default{constructor(){super(...arguments),this.unit="metric"}};(0,s._)([(0,n.Cb)({value:"metric"})],q.prototype,"unit",void 0),q=(0,s._)([(0,a.j)("esri.views.3d.interactive.graphics.directLineMeasurement3D.Settings")],q);let F=class extends M.default{constructor(){super(...arguments),this._tempStartPosition=(0,R.c)(),this._tempEndPosition=(0,R.c)(),this._tempCornerPosition=(0,R.c)(),this._unitNormalizer=new U.Z,this._handles=new g.Z,this._propertiesPool=new W({startPoint:f.Z,endPoint:f.Z},this),this.model=new I,this.cursorPoint=null,this.state="initial",this.mode="auto",this.active=!1,this.geodesicMeasurementDistanceThreshold=1e5}initialize(){this._handles.add([this.model.watch("startPoint",(()=>this._updateMeasurement()),!0),this.model.watch("endPoint",(()=>this._updateMeasurement()),!0),this.model.watch("settings",(()=>this._updateMeasurement()),!0)],"model"),(0,z.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})),this._handles.add((0,O.qe)((async()=>{this.messages=await(0,z.ME)("esri/core/t9n/Units")}))),this._handles.add((0,v.init)(this.sceneView,"spatialReference",(e=>{const t=(0,A.rS)(e),i=t===A.GG?A.wY:t;this._sphericalPCPF=i;const s=(0,G.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e})),"scene-view"),this.reset()}destroy(){this._handles.destroy(),this._handles=null,this._propertiesPool.destroy(),this._propertiesPool=null,this.model.destroy()}set startPointSurfaceLocation(e){this._set("startPointSurfaceLocation",e),this._updateMeasurement()}set endPointSurfaceLocation(e){this._set("endPointSurfaceLocation",e),this._updateMeasurement()}get measurementSurfaceLocation(){const e=this.startPointSurfaceLocation,t=this.endPointSurfaceLocation;return null==e||null==t||"above-the-surface"===e&&"below-the-surface"===t||"below-the-surface"===e&&"above-the-surface"===t||"on-the-surface"===e&&"on-the-surface"===t?"camera-dependent":"above-the-surface"===e||"above-the-surface"===t?"above-the-surface":"below-the-surface"}get validMeasurement(){return(0,p.pC)(this.model.startPoint)&&(0,p.pC)(this.model.endPoint)}get isMeasuring(){return!!this.startPoint}get geodesicDistanceExceeded(){return(0,p.pC)(this.model.measurement)&&this.model.measurement.horizontalDistance&&this.model.measurement.horizontalDistance.value>this.geodesicMeasurementDistanceThreshold}get measurementMode(){let e=this.mode;return"auto"===e&&(e="euclidean","degrees"!==this.unit&&"degrees-minutes-seconds"!==this.unit||(e="geodesic"),this.geodesicDistanceExceeded&&(e="geodesic")),e}reset(){this.clearMeasurement()}clearMeasurement(){this.state="initial",this.startPoint=null,this.endPoint=null,this.cursorPoint=null,this._clearOverride("measurementSurfaceLocation"),this._updateMeasurement()}finishMeasurement(){if(!this._isOverridden("measurementSurfaceLocation")){const e=this.measurementSurfaceLocation,t="camera-dependent"===e?this.sceneView.state.camera.aboveGround?"above-the-surface":"below-the-surface":e;this._override("measurementSurfaceLocation",t)}this.state="measured"}_fallbackGeodesicAngle(e,t){return e/(0,A.Iu)(t).metersPerDegree}_fallbackGeodesicDistance(e,t,i){if((0,G.UY)(e,Z)){(0,G.UY)(t,B);const e=(0,x.Vl)(Z[0]),i=(0,x.Vl)(Z[1]),s=(0,x.Vl)(B[0]),r=(0,x.Vl)(B[1]),n=Math.abs(s-e),o=(0,x.ZF)(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(n)),a=(0,x.BV)(o),l={distance:0};return(0,V.inverseGeodeticSolver)(l,[Z[0],Z[1]],[B[0],B[1]]),{distance:l.distance,angle:a}}{const t=e.spatialReference,s=i;return{distance:s,angle:this._fallbackGeodesicAngle(s,t)}}}_exactGeodesicDistanceAndAngle(e,t,i){const s=e.spatialReference,r=new D.Z({paths:[e,t],spatialReference:s}),n=s.isGeographic&&(0,V.isSupported)(s)?(0,V.geodesicLengths)([r],"meters")[0]:s.isWebMercator?(0,k.geodesicLength)(r,"meters"):void 0,{distance:o,angle:a}=n?{distance:n,angle:this._fallbackGeodesicAngle(n,s)}:this._fallbackGeodesicDistance(e,t,i);return{distance:new E.Z(o,"meters"),angle:new E.Z(a,"degrees")}}_euclideanDistances(e,t){e.z>t.z&&(e=[e,e=t][0]);const i=e.clone();i.z=t.z;const s=this._tempStartPosition,r=this._tempEndPosition,n=this._tempCornerPosition,o=this.sceneView.spatialReference,a=this._sphericalPCPF,l=(0,G.Up)(o,a)?a:o;(0,G.KC)(e,s,l),(0,G.KC)(t,r,l),(0,G.KC)(i,n,l);const h=(0,T.k)(s,r),d=(0,T.k)(n,r),c=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),_=u(h),m=u(d),p=u(c);return{direct:new E.Z(_,"meters"),horizontal:new E.Z(m,"meters"),vertical:new E.Z(p,"meters")}}_updateMeasurement(){if((0,p.Wi)(this.startPoint)||(0,p.Wi)(this.endPoint))return void(this.model.measurement=null);const e=this._euclideanDistances(this.startPoint,this.endPoint),t=this._exactGeodesicDistanceAndAngle(this.startPoint,this.endPoint,e.horizontal.value);this.model.measurement={directDistance:e.direct,horizontalDistance:e.horizontal,verticalDistance:e.vertical,geodesicDistance:t.distance,geodesicAngle:t.angle}}};(0,s._)([(0,n.Cb)()],F.prototype,"messages",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],F.prototype,"sceneView",void 0),(0,s._)([(0,n.Cb)()],F.prototype,"model",void 0),(0,s._)([(0,o.B)("model.startPoint")],F.prototype,"startPoint",void 0),(0,s._)([(0,n.Cb)({value:null})],F.prototype,"startPointSurfaceLocation",null),(0,s._)([(0,o.B)("model.endPoint")],F.prototype,"endPoint",void 0),(0,s._)([(0,n.Cb)({value:null})],F.prototype,"endPointSurfaceLocation",null),(0,s._)([(0,n.Cb)({dependsOn:["startPointSurfaceLocation","endPointSurfaceLocation"]})],F.prototype,"measurementSurfaceLocation",null),(0,s._)([(0,n.Cb)()],F.prototype,"cursorPoint",void 0),(0,s._)([(0,n.Cb)()],F.prototype,"state",void 0),(0,s._)([(0,n.Cb)()],F.prototype,"mode",void 0),(0,s._)([(0,o.B)("model.settings.unit")],F.prototype,"unit",void 0),(0,s._)([(0,n.Cb)()],F.prototype,"active",void 0),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["model.startPoint","model.endPoint"]})],F.prototype,"validMeasurement",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["startPoint"]})],F.prototype,"isMeasuring",null),(0,s._)([(0,n.Cb)()],F.prototype,"geodesicMeasurementDistanceThreshold",void 0),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["model.measurement","geodesicMeasurementDistanceThreshold"]})],F.prototype,"geodesicDistanceExceeded",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["unit","geodesicDistanceExceeded"]})],F.prototype,"measurementMode",null),F=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DModel")],F);const Z=(0,R.c)(),B=(0,R.c)();const N=F;var X=i(96071),Q=i(67128),K=i(12811),$=i(58508),Y=i(14286),J=i(19132),ee=i(8344),te=i(88),ie=i(67134),se=i(48430),re=i(70189),ne=i(86184),oe=i(18795),ae=i(50777),le=i(39160),he=i(16358),de=i(74808),ce=i(88089),ue=i(41233);class _e extends de.l{constructor(e){super(e.view),this._handles=new g.Z,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text=null,this._fontSize=14,this._distance=25,this._anchor="right",this.applyProps(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(e){this._text=e,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(e){this._distance!==e&&(this._distance=e,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(e){this._anchor!==e&&(this._anchor=e,this._updateLabelPosition())}_updateLabelPosition(){if(this.attached&&(0,p.pC)(this.geometry)&&this.view._stage)switch(this.geometry.type){case"point":this._computeLabelPositionFromPoint(this.geometry,we)?(this._textItem.position=[we[0],we[1]],this._textItem.anchor="center",this._showText=!0):this._showText=!1,this._showCallout=!1;break;case"euclidean":case"geodesic":if(this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,we,be)){const e=be[0]-we[0],t=be[1]-we[1];this._textItem.position=[be[0],be[1]],this._textItem.anchor=Math.abs(e)>Math.abs(t)?e>0?"left":"right":t>0?"top":"bottom",this._textItem.visible=this.visible,this._calloutItem.startPosition=[we[0],we[1]],this._calloutItem.endPosition=[be[0],be[1]],this._showText=!0,this._showCallout=!0}else this._showText=!1,this._showCallout=!1}this.updateVisibility(this.visible)}_computeLabelPositionFromPoint(e,t){this.view.renderCoordsHelper.toRenderCoords(e,ge);const i=this.view._stage.getCamera();return i.projectToRenderScreen(ge,ve),!(ve[2]<0||ve[2]>1||(i.renderToScreen(ve,t),0))}_computeLabelPositionFromSegment(e,t,i,s,r){if(!e)return!1;const n=this.view._stage.getCamera();(0,le.cT)(e.startRenderSpace,e.endRenderSpace,me,n),(0,Y.s)(pe,-me[1],me[0]);let o=!1;switch(i){case"top":o=pe[1]<0;break;case"bottom":o=pe[1]>0;break;case"left":o=pe[0]>0;break;case"right":o=pe[0]<0}if(o&&(0,Y.n)(pe,pe),0===(0,Y.l)(pe))switch(i){case"top":pe[1]=1;break;case"bottom":pe[1]=-1;break;case"left":pe[0]=-1;break;case"right":pe[0]=1}return e.eval(.5,ge),n.projectToRenderScreen(ge,ve),!(ve[2]<0||ve[2]>1||(n.renderToScreen(ve,s),(0,Y.a)(pe,pe,t*n.pixelRatio),(0,Y.h)(pe,pe,ve),n.renderToScreen(pe,r),0))}createResources(){this._textItem=new ue.Z({visible:!0}),this._textItem.text=(0,p.Wg)(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new ce.Z({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch("camera",(()=>{this._updateLabelPosition()})))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}}const me=(0,X.gX)(),pe=(0,X.gX)(),ge=(0,R.c)(),ve=(0,X.J$)(),we=(0,X.s1)(),be=(0,X.s1)();var fe=i(34353),ye=i(68500),Pe=i(57511),Le=i(85736),Ce=i(71702);class Se extends Ce._{constructor(e){super(e),this._origin=(0,R.c)(),this._renderOccluded=4,this._width=1,this._color=(0,re.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,R.c)(),s=(0,R.c)(),r=100,n=[];(0,T.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,T.s)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,T.s)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,T.s)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,T.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,T.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),this.geometry=[n]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromSegment(e){const{points:t}=e.createRenderGeometry(this._origin,this.view.renderCoordsHelper);this.geometry=[t]}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,fe.g)(e,this._color)||((0,fe.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,fe.g)(e,this._innerColor)||(this._innerColor=(0,fe.c)((0,re.c)(),e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,p.pC)(e)!==(0,p.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,p.Wi)(e)||(0,p.Wi)(this._stippleOffColor)||!(0,fe.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,p.pC)(e)?(0,re.a)(e):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new Pe.U(this.materialParameters,"lineVisualElement")}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const s=(0,Le.Mk)(t[i]),r=new ye.Z(s,"lineVisualElement");e.addGeometry(r,this._material)}}forEachExternalResource(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if((0,p.Wi)(e))return[];const t=[];return e.forEach((e=>{const i=e.length,s=new Float64Array(3*i);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const r={attributeData:{position:s},removeDuplicateStartEnd:0};t.push(r)})),t}}var Me=i(39746),De=i(80905),Oe=i(56469),xe=i(26701),ze=i(10762),Re=i(23240),Te=i(97853),Ae=i(44801),Ge=i(11379),Ee=i(51007),Ve=i(36904),ke=i(89553),He=i(25654);class je extends Te.A{constructor(e,t){super(e,t)}initializeProgram(e){const t=je.shader.get().build();return new Ee.Z(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Ge.i)}bindPass(e,t,i){ke.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("width",t.width),this.program.setUniform1f("outlineSize",t.outlineSize),this.program.setUniform4fv("outlineColor",t.outlineColor),this.program.setUniform1f("stripeLength",t.stripeLength),this.program.setUniform4fv("stripeEvenColor",t.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",t.stripeOddColor)}bindDraw(e){ke.G.bindView(this.program,e)}initializePipeline(){return(0,Ve.sm)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:Ve.LZ,colorWrite:Ve.BK})}get primitiveType(){return 5}}je.shader=new Re.J(He.M,(()=>i.e(7039).then(i.bind(i,77039))));class We extends Ae.m{constructor(){super(...arguments),this.polygonOffsetEnabled=!1}}(0,s._)([(0,Ae.o)()],We.prototype,"polygonOffsetEnabled",void 0);class Ue extends ze.F5{constructor(e,t){super(t,e,qe),this.techniqueConfig=new We}getTechniqueConfig(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}dispose(){}getPassParameters(){return this.params}intersect(){}createBufferWriter(){return new Ke}getGLMaterial(e){return 0===e.output?new Ie(e):void 0}}class Ie extends xe.Z{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(je,this.material.getTechniqueConfig(),this.technique)}beginSlot(e){return 3===e}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const qe={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...ze.zh},Fe=(0,De.U$)().vec3f(Oe.Xt.POSITION).vec3f(Oe.Xt.NORMAL).vec2f(Oe.Xt.UV0).f32(Oe.Xt.AUXPOS1),Ze=(0,R.c)(),Be=(0,R.c)(),Ne=(0,R.c)(),Xe=(0,R.c)(),Qe=(0,R.c)();class Ke{constructor(){this.vertexBufferLayout=Fe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices[Oe.Xt.POSITION].length/2+1)}write(e,t,i,s){const r=t.vertexAttr[Oe.Xt.POSITION].data,n=t.vertexAttr[Oe.Xt.NORMAL].data,o=r.length/3,a=t&&t.indices&&t.indices.position;a&&a.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=Ze,h=Be,d=Ne,c=Xe,u=Qe,_=e.transformation,m=e.invTranspTransformation,p=i.position,g=i.normal,v=i.uv0;let w=0;for(let e=0;e<o;++e){const t=3*e;if((0,T.s)(l,r[t],r[t+1],r[t+2]),e<o-1){const t=3*(e+1);(0,T.s)(h,r[t],r[t+1],r[t+2]),(0,T.s)(u,n[t],n[t+1],n[t+2]),(0,T.n)(u,u),(0,T.f)(d,h,l),(0,T.n)(d,d),(0,T.c)(c,u,d),(0,T.n)(c,c)}const i=(0,T.k)(l,h);_&&m&&((0,T.i)(l,l,_),(0,T.i)(h,h,_),(0,T.i)(c,c,m));const a=s+2*e,b=a+1;p.setVec(a,l),p.setVec(b,l),g.setVec(a,c),g.setVec(b,c),v.set(a,0,w),v.set(a,1,-1),v.set(b,0,w),v.set(b,1,1),e<o-1&&(w+=i)}const b=i.auxpos1;for(let e=0;e<2*o;++e)b.set(s+e,w)}}class $e extends Ce._{constructor(e){super(e),this._parameters=Ye,this._handles=null,this._origin=(0,R.c)(),this._originTransform=(0,K.a)(),this._arrowCenter=(0,R.c)(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}createExternalResources(){this._arrowMaterial=new Ue({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:this._parameters.arrowStripeEvenColor,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0},"arrow"),this._handles=new g.Z,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalResource(e){e(this._arrowMaterial)}createGeometries(e){if((0,p.Wi)(this._geometry)||(0,p.Wi)(this._geometry.startRenderSpace)||(0,p.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,t,i,s){const r=this.view.renderCoordsHelper,n=[],o=[],a=(e,t)=>{const s=ee.WM.get();(0,T.f)(s,e,i),n.push(s),o.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=ee.WM.get();r.worldUpAtPosition(this._arrowCenter,i),a(e,i),a(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),n=ee.WM.get(),o=ee.WM.get();s.eval(i,n),r.worldUpAtPosition(n,o),a(n,o)}}return new ye.Z(Me.Z.createPolylineGeometry(n,o),"arrow")}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&(0,p.pC)(this._geometry)){const e=this.view._stage.getCamera().computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const Ye={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};var Je=i(17154);class et{constructor(e=(0,R.c)(),t=(0,R.c)()){this.startRenderSpace=e,this.endRenderSpace=t,this.type="euclidean"}eval(e,t){return(0,T.e)(t,this.startRenderSpace,this.endRenderSpace,e)}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const n=st;(0,T.f)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([r[0],r[1],r[2]])},n=t.worldUpAtPosition(this.eval(.5,it),ee.WM.get());return r(this.startRenderSpace,n),r(this.endRenderSpace,n),{points:i,normals:s}}}class tt{constructor(e,t,i){this.startRenderSpace=e,this.endRenderSpace=t,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,R.c)(),this._end=(0,R.c)(),this._pcpf=(0,A.rS)(i),this._project=(0,G.Up)(i,this._pcpf),this._projectIn(e,this._start),this._projectIn(t,this._end)}_projectIn(e,t){this._project?(0,G.SH)(e,this.renderSpatialReference,t,this._pcpf):(0,T.g)(t,e)}eval(e,t){return this._project?((0,Je.ZA)(this._start,this._end,e,t),(0,G.SH)(t,this._pcpf,t,this.renderSpatialReference)):(0,T.e)(t,this._start,this._end,e),t}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const n=rt;(0,T.f)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([r[0],r[1],r[2]])};for(let e=0;e<128;++e){const i=e/127,s=it,n=st;this.eval(i,s),t.worldUpAtPosition(s,n),r(s,n)}return{points:i,normals:s}}}const it=(0,R.c)(),st=(0,R.c)(),rt=(0,R.c)(),nt=(0,re.f)(1,.5,0,.75),ot={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:nt,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:nt,guideLineWidth:2,guideLineColor:nt,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12};class at{constructor(e,t={}){this._visible=!1,this._measurementArrow=null,this._horizontalAndVerticalSegmentLines=null,this._rightAngleQuad=null,this._directSegmentLabel=null,this._verticalSegmentLabel=null,this._horizontalSegmentLabel=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._laserLine=null,this._directSegmentLabelMeasurement="directDistance",this._horizontalSegmentLabelMeasurement="horizontalDistance",this._verticalSegmentLabelMeasurement="verticalDistance",this._handles=new g.Z,this._listenerHandles=null,this._cursorPosition=(0,R.c)(),this._startPosition=(0,R.c)(),this._endPosition=(0,R.c)(),this._cornerPosition=(0,R.c)(),this._origin=(0,R.c)(),this._originTransform=(0,K.a)(),this._lastDraggedHandle=null,this._viewMode=lt.None,this._viewModeDirty=!0,this._triangleCollapseRatioThreshold=.03,this._model=e,this._view=e.sceneView,this._params=(0,le.gh)(ot,t),this._measurementArrow=new $e({attached:!0,view:this._view,geometry:null,renderOccluded:4}),this._horizontalAndVerticalSegmentLines=new Se({attached:!0,view:this._view,width:this._params.triangleLineWidth,color:this._params.triangleColor,renderOccluded:4}),this._rightAngleQuad=new oe.R({attached:!0,view:this._view,color:nt,renderOccluded:4}),this._directSegmentLabel=new _e({attached:!0,view:this._view,fontSize:this._params.direcLabelFontSize}),this._verticalSegmentLabel=new _e({attached:!0,view:this._view,fontSize:this._params.verticalLabelFontSize}),this._horizontalSegmentLabel=new _e({attached:!0,view:this._view,fontSize:this._params.horizontalLabelFontSize}),this._projectedGeodesicLine=new Se({attached:!0,view:this._view,width:this._params.geodesicProjectionLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,se.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicStartHint=new Se({attached:!0,view:this._view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,se.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicEndHint=new Se({attached:!0,view:this._view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,se.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._laserLine=new ne.W({view:this._view,attached:!0}),this._intersector=new ie.r(this._view.state.mode),this._intersector.options.store=0,this._initializeListeners()}destroy(){this.hide(),this._destroyListeners(),this._handles.destroy(),this._handles=null,this._measurementArrow.destroy(),this._measurementArrow=null,this._horizontalAndVerticalSegmentLines.destroy(),this._horizontalAndVerticalSegmentLines=null,this._rightAngleQuad.destroy(),this._rightAngleQuad=null,this._directSegmentLabel.destroy(),this._directSegmentLabel=null,this._verticalSegmentLabel.destroy(),this._verticalSegmentLabel=null,this._horizontalSegmentLabel.destroy(),this._horizontalSegmentLabel=null,this._projectedGeodesicLine.destroy(),this._projectedGeodesicLine=null,this._geodesicStartHint.destroy(),this._geodesicStartHint=null,this._geodesicEndHint.destroy(),this._geodesicEndHint=null}get requiresCursorPoint(){return"initial"===this._model.state&&this._model.active}get cameraAboveGround(){return this._view.state.camera.aboveGround}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get viewMode(){return this._viewModeDirty&&(this._viewMode=this._computeViewMode()),this._viewMode}_computeViewMode(){this._viewModeDirty=!1;const e=this._model,t=e.model,i=t.measurement,s="geodesic"===e.measurementMode;if((0,p.Wi)(t.startPoint)||(0,p.Wi)(t.endPoint)||t.startPoint.equals(t.endPoint))return lt.None;if(s){if(!this._model.geodesicDistanceExceeded)return lt.Direct;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return lt.ProjectedGeodesic}return(0,p.Wi)(i)||Math.min(i.verticalDistance.value/i.horizontalDistance.value,i.horizontalDistance.value/i.verticalDistance.value)<this.triangleCollapseRatioThreshold?lt.Direct:lt.Triangle}get triangleCollapseRatioThreshold(){return this._triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._triangleCollapseRatioThreshold=e,this._viewModeDirty=!0,this._geometryChanged()}get testData(){const e=this._laserLine.testData,t="geodesic"===this._model.measurementMode;return{labels:{direct:t?this._horizontalSegmentLabel:this._directSegmentLabel,horizontal:t?this._directSegmentLabel:this._horizontalSegmentLabel,vertical:this._verticalSegmentLabel},laserLineRenderer:{heightManifoldEnabled:!!(0,p.pC)(e)&&e.heightManifoldEnabled,heightManifoldTarget:(0,p.pC)(e)?e.heightManifoldTarget:null,pointDistanceEnabled:!!(0,p.pC)(e)&&e.pointDistanceEnabled,pointDistanceOrigin:(0,p.pC)(e)?e.pointDistanceOrigin:null,pointDistanceTarget:(0,p.pC)(e)?e.pointDistanceTarget:null,lineVerticalPlaneEnabled:!!(0,p.pC)(e)&&e.lineVerticalPlaneEnabled},stripeLength:this._computeMeasurementArrowStripeLength(this._model.model)}}get directLabelText(){return this._directSegmentLabel.text}get horizontalLabelText(){return this._horizontalSegmentLabel.text}get verticalLabelText(){return this._verticalSegmentLabel.text}createManipulators(){const e=()=>{const e=(0,ae.aD)(this._view,this._params.handleColor,this._params.handleOpacity);return e.available=!1,e.radius=this._params.handleRadius,e},t=e(),i=e();this._model.startPoint&&(t.location=(0,p.Wg)(this._model.startPoint),t.available=!0),this._model.endPoint&&(i.location=(0,p.Wg)(this._model.endPoint),i.available=!0);const s=()=>{let e=this._lastDraggedHandle;t.grabbing&&!i.grabbing&&(e="start"),i.grabbing&&!t.grabbing&&(e="end"),t.grabbing||i.grabbing||(e=null);const s=e!==this._lastDraggedHandle;this._lastDraggedHandle=e,s&&this.visible&&this._updateLaserLine()};return this._handles.add([t.events.on("grab-changed",(()=>{s()})),i.events.on("grab-changed",(()=>{s()}))]),{start:t,end:i}}show(){this._visible||(this._visible=!0,this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha},this._laserLine.visible=!0,this._viewModeDirty=!0,this._updateCursorPosition(),this._updateStartPosition(),this._updateEndPosition(),this._updateLaserLine(),this._geometryChanged())}hide(){this._visible&&(this._visible=!1,this._measurementArrow.visible=!1,this._horizontalAndVerticalSegmentLines.visible=!1,this._rightAngleQuad.visible=!1,this._directSegmentLabel.visible=!1,this._verticalSegmentLabel.visible=!1,this._horizontalSegmentLabel.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this._laserLine.visible=!1,this._view.cursor=null)}pick(e){const t=this._view.spatialReference,i=(0,X.md)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,r=(0,R.c)();if(!s.getIntersectionPoint(r))return new at.PickResult;const n=this._view.renderCoordsHelper.fromRenderCoords(r,t),o="TerrainRenderer"===s.intersector?"ground":"feature";return new at.PickResult(o,r,n)}getElevation(e){return this._view.basemapTerrain.ready&&(0,J.KO)(this._view.elevationProvider,e)||0}overlappingHandles(e,t){return(0,le.Vl)(e,t,this._view)<=this._params.handleRadius}_getLabelPositions(e,t,i,s,r){const n=this._viewMode!==lt.Triangle,o=(0,X.Wv)(ee.WM.get()),a=(0,X.Wv)(ee.WM.get());r.projectToRenderScreen(i,o),r.projectToRenderScreen(t,a);const l={direct:n?"top":"bottom",horizontal:"top",vertical:o[0]<a[0]?"left":"right"};if(!n){const s=ee.qW.get(),n=ee.qW.get();if((0,le.cT)(e,i,s,r),(0,le.cT)(e,t,n,r),(0,Y.g)(s,n)>=dt)l.direct=(0,x.Xx)(s[1])===(0,x.Xx)(n[1])?(0,he.jB)(l.vertical):l.vertical;else{const e=(0,X.So)(ee.qW.get());(0,le.cT)(i,t,e,r),(0,Y.g)(e,n)>=dt&&(l.direct=(0,x.Xx)(e[0])===(0,x.Xx)(n[0])?(0,he.jB)(l.horizontal):l.horizontal)}}if("below-the-surface"===s){const e=e=>"top"===e?"bottom":"top";l.direct=e(l.direct),l.horizontal=e(l.horizontal),l.vertical=e(l.vertical)}return l}_updateLabelText(){const e=this._model.model.measurement;if((0,p.Wi)(e)||!this._model.messages)return;const t={verticalDistance:"",horizontalDistance:"",directDistance:"",geodesicDistance:""},i=this._model.messages,s=e.directDistance,r=e.horizontalDistance,n=e.verticalDistance,o=e.geodesicDistance,a=e.geodesicAngle;switch(this._model.unit){case"metric":t.directDistance=s&&(0,$.Rd)(i,s),t.horizontalDistance=r&&(0,$.Rd)(i,r),t.verticalDistance=n&&(0,$.Wv)(i,n),t.geodesicDistance=o&&(0,$.Rd)(i,o);break;case"imperial":t.directDistance=s&&(0,$.Ud)(i,s),t.horizontalDistance=r&&(0,$.Ud)(i,r),t.verticalDistance=n&&(0,$.Zv)(i,n),t.geodesicDistance=o&&(0,$.Ud)(i,o);break;case"degrees":{const e=a&&(0,$.VG)(i,a,"degrees");t.directDistance=e,t.horizontalDistance=e,t.geodesicDistance=e;break}case"degrees-minutes-seconds":t.horizontalDistanceText=a&&(0,$.Bs)(a);break;default:t.directDistance=s&&(0,$.VG)(i,s,this._model.unit),t.horizontalDistance=r&&(0,$.VG)(i,r,this._model.unit),t.verticalDistance=n&&(0,$.VG)(i,n,this._model.unit),t.geodesicDistance=o&&(0,$.VG)(i,o,this._model.unit)}this._directSegmentLabel.text=t[this._directSegmentLabelMeasurement],this._horizontalSegmentLabel.text=t[this._horizontalSegmentLabelMeasurement],this._verticalSegmentLabel.text=t[this._verticalSegmentLabelMeasurement]}_geometryChanged(){const e=this._view,t=e.state.camera,i=this._model,s=i.measurementMode,r=e.renderCoordsHelper,n=this.viewMode;if(n===lt.None)return this._rightAngleQuad.visible=!1,this._horizontalAndVerticalSegmentLines.visible=!1,this._directSegmentLabel.visible=!1,this._horizontalSegmentLabel.visible=!1,this._verticalSegmentLabel.visible=!1,this._measurementArrow.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,void(this._geodesicEndHint.visible=!1);let o=this._startPosition,a=this._endPosition;const l="camera-dependent"===i.measurementSurfaceLocation?this._view.state.camera.aboveGround?"above-the-surface":"below-the-surface":i.measurementSurfaceLocation,h="above-the-surface"===l?1:-1,d=h*(e.renderCoordsHelper.getAltitude(a)-e.renderCoordsHelper.getAltitude(o));d<0&&(o=this._endPosition,a=this._startPosition);const c=this._cornerPosition;e.renderCoordsHelper.worldUpAtPosition(o,c),(0,T.a)(c,c,h*Math.abs(d)),(0,T.b)(c,c,o);const u="geodesic"===s,_=u?new tt(this._startPosition,this._endPosition,this._view.renderCoordsHelper.spatialReference):new et(this._startPosition,this._endPosition),m=this._getLabelPositions(o,a,c,l,t);switch((0,le.H2)([o,a,c],this._origin),(0,Q.i)(this._originTransform),(0,Q.t)(this._originTransform,this._originTransform,this._origin),this._measurementArrow.geometry=_,this._measurementArrow.stripeLength=this._computeMeasurementArrowStripeLength(this._model.model),this._measurementArrow.visible=!0,this._directSegmentLabel.anchor=m.direct,this._directSegmentLabel.geometry=_,this._directSegmentLabel.visible=!0,this._directSegmentLabelMeasurement="geodesic"===s?"geodesicDistance":"directDistance",n){case lt.Direct:this._horizontalSegmentLabelMeasurement=u?"geodesicDistance":"horizontalDistance",this._rightAngleQuad.visible=!1,this._horizontalAndVerticalSegmentLines.visible=!1,this._horizontalSegmentLabel.visible=!1,this._verticalSegmentLabel.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case lt.ProjectedGeodesic:{const e=(0,T.g)(ee.WM.get(),this._startPosition),t=(0,T.g)(ee.WM.get(),this._endPosition);r.setAltitude(0,e),r.setAltitude(0,t);const i=new tt(e,t,this._view.renderCoordsHelper.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.setGeometryFromSegment(new et(e,this._startPosition)),this._geodesicStartHint.visible=!0,this._geodesicEndHint.setGeometryFromSegment(new et(t,this._endPosition)),this._geodesicEndHint.visible=!0,this._directSegmentLabel.geometry=i,this._directSegmentLabelMeasurement="geodesicDistance",this._rightAngleQuad.visible=!1,this._horizontalAndVerticalSegmentLines.visible=!1,this._horizontalSegmentLabel.visible=!1,this._verticalSegmentLabel.visible=!1;break}case lt.Triangle:{this._horizontalAndVerticalSegmentLines.geometry=[[[o[0],o[1],o[2]],[c[0],c[1],c[2]],[a[0],a[1],a[2]]]],this._horizontalAndVerticalSegmentLines.visible=!0;const e=new et(o,c);this._verticalSegmentLabel.visible=!0,this._verticalSegmentLabel.geometry=e,this._verticalSegmentLabel.anchor=m.vertical,this._verticalSegmentLabelMeasurement="verticalDistance";const t=new et(c,a);this._horizontalSegmentLabel.visible=!0,this._horizontalSegmentLabel.geometry=t,this._horizontalSegmentLabel.anchor=m.horizontal,this._horizontalSegmentLabelMeasurement="horizontalDistance",this._rightAngleQuad.geometry={previous:o,center:c,next:a},this._rightAngleQuad.visible=!0,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break}}this._updateLabelText()}_computeMeasurementArrowStripeLength(e){let t=null;if((0,p.pC)(e.measurement)){const i=e.measurement.directDistance;switch(this._model.model.settings.unit){case"metric":t=i&&i.toUnit("meters");break;case"imperial":t=i&&i.toUnit((0,h.FN)(i.value,i.unit));break;case"degrees":case"degrees-minutes-seconds":{const i=e.measurement.geodesicAngle;t=i&&i.toUnit("degrees");break}default:t=i&&i.toUnit(this._model.model.settings.unit)}}let i=1;return t&&(i=(0,x.sk)(t.value/30),i*="degrees"===t.unit?(0,A.Iu)(this._view.spatialReference).metersPerDegree:(0,h.En)(1,t.unit,"meters")),i}_requiresGeodesicGuideAt(e){if(!this._view.state)return!1;const t=this._view.state.camera,i=this._view.renderCoordsHelper,s=t.computeScreenPixelSizeAt(e);return i.getAltitude(e)/s>=10}_updateCursorPosition(){this._model.cursorPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.cursorPoint,this._cursorPosition)}_updateStartPosition(){(0,p.pC)(this._model.startPoint)&&this._view.renderCoordsHelper.toRenderCoords(this._model.startPoint,this._startPosition)}_updateEndPosition(){(0,p.pC)(this._model.endPoint)&&this._view.renderCoordsHelper.toRenderCoords(this._model.endPoint,this._endPosition)}_getFocusPosition(){const e=this._model,t=this.viewMode===lt.Direct&&"euclidean"===e.measurementMode;switch(e.state){case"drawing":return t?this._startPosition:e.endPoint?this._endPosition:this._startPosition;case"editing":return t?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return e.cursorPoint?this._cursorPosition:null}}_getFocusSpherePosition(){return"drawing"===this._model.state||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition}_updateLaserLine(){const e=this._model,t=this._getFocusPosition(),i=this.viewMode,s=this._params.laserLineEnabled&&!!t&&"measured"!==e.state&&e.active;if(s){const r=s&&"euclidean"===e.measurementMode;this._laserLine.heightManifoldTarget=r?t:null;const n=s&&!!e.startPoint&&"geodesic"===e.measurementMode;this._laserLine.pointDistanceLine=n?{origin:this._getFocusSpherePosition(),target:t}:null;const o=s&&i===lt.Triangle;this._laserLine.lineVerticalPlaneSegment=o?te.KD.fromPoints(this._startPosition,this._endPosition,ct):null}else this._laserLine.heightManifoldTarget=null,this._laserLine.pointDistanceLine=null,this._laserLine.lineVerticalPlaneSegment=null}_initializeListeners(){this._listenerHandles=new g.Z,this._listenerHandles.add([this._model.watch("state",(()=>{this._visible&&this._updateLaserLine()}),!0),this._model.watch("measurementMode",(()=>{this._viewModeDirty=!0,this._visible&&this._updateLaserLine()}),!0),this._model.watch("hoveredHandle",(()=>{this._visible&&this._geometryChanged()}),!0),this._model.watch("cursorPoint",(()=>{this._updateCursorPosition(),this._visible&&this._updateLaserLine()}),!0),this._model.model.watch("startPoint",(()=>{this._updateStartPosition(),this._viewModeDirty=!0,this._visible&&(this._updateLaserLine(),this._geometryChanged())}),!0),this._model.model.watch("endPoint",(()=>{this._updateEndPosition(),this._viewModeDirty=!0,this._visible&&(this._updateLaserLine(),this._geometryChanged())}),!0),this._model.watch("messages",(()=>{this._viewModeDirty=!0,this._visible&&this._geometryChanged(),this._updateLabelText()}),!0),this._model.watch("unit",(()=>{this._viewModeDirty=!0,this._visible&&this._geometryChanged()}),!0),this._model.watch("active",(()=>{this._visible&&(this._updateLaserLine(),this._geometryChanged())}),!0),this._view.state.watch("camera",(()=>{this._visible&&this._geometryChanged()}),!0),this._model.model.watch("measurement",(()=>{this._viewModeDirty=!0,this._visible?this._geometryChanged():this._updateLabelText()}),!0)])}_destroyListeners(){this._listenerHandles.destroy(),this._listenerHandles=null}}var lt,ht;(ht=at||(at={})).PickRequest=class{},ht.PickResult=class{constructor(e=null,t=null,i=null){this.type=e,this.scenePoint=t,this.mapPoint=i}},function(e){e[e.Triangle=0]="Triangle",e[e.ProjectedGeodesic=1]="ProjectedGeodesic",e[e.Direct=2]="Direct",e[e.None=3]="None"}(lt||(lt={}));const dt=Math.cos((0,x.Vl)(12)),ct=te.KD.create();let ut=class extends C.m{constructor(e){super(e),this._handles=new g.Z,this._cachedPickRequest=new at.PickRequest,this._cachedPickResult=new at.PickResult,this._isAnyPointerDown=!1,this.deferCreation=!0,this.startManipulator=null,this.endManipulator=null,this.model=new N({sceneView:e.view})}initialize(){this._set("directLineMeasurementView",new at(this.model));const e=(0,v.init)(this,"state",(e=>{"ready"!==e&&this.create(),"measured"===e&&this.complete()}),!0);this._handles.add(e);const{start:t,end:i}=this.directLineMeasurementView.createManipulators(),s=(e,t,i)=>(0,L.Xd)(e,((e,s,r)=>{const n=(0,S.J4)(e);s.next(n).next((0,S.gv)(this.view)).next((e=>"start"!==e.action?e:null)).next((s=>{const r=(0,P.WG)(s.mapEnd,_t);this.model[t]=r,e.location=r,this.model[i]=this._surfaceLocation(r,s.surfaceType)})),r.next(n).next((0,L.di)(this.model,[t,i])).next((()=>{e.location=(0,p.Wg)(this.model[t])}))}));this._handles.add([s(t,"startPoint","startPointSurfaceLocation"),s(i,"endPoint","endPointSurfaceLocation")]),[t,i].forEach((e=>{this._handles.add([e.events.on("grab-changed",(()=>{const e=t.grabbing||i.grabbing;e&&"measured"===this.model.state&&(this.model.state="editing"),e||(this.model.finishMeasurement(),"editing"===this.model.state&&(this.model.state="measured"))}))])})),this.manipulators.add(t),this.manipulators.add(i),this.startManipulator=t,this.endManipulator=i}destroy(){this.directLineMeasurementView.destroy(),this._set("directLineMeasurementView",null),this.model.destroy(),this._set("model",null),this._handles.destroy(),this._handles=null}get state(){var e;return null!=(e=this.model)&&e.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"}get creating(){return"initial"===this.model.state||"drawing"===this.model.state}get isSupported(){return"3d"===this.get("view.type")}get cursor(){var e;return null==(e=this.model)||!e.active||"drawing"!==this.model.state&&"initial"!==this.model.state?null:"crosshair"}activate(){this.model.active=!0}deactivate(){this.model.active=!1}onDetach(){this.model.reset()}onShow(){this.directLineMeasurementView.show(),this._updateManipulatorVisibility()}onHide(){this.directLineMeasurementView.hide()}onInputEvent(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"pointer-down":this._handlePointerDown();break;case"pointer-up":this._handlePointerUp()}this._updateManipulatorVisibility()}_handlePointerMove(e){this._clearCachedPickRequest();const t=(0,y.vT)(e);"mouse"===e.pointerType&&(this._hoverAt(t),"drawing"===this.model.state&&(this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),e.stopPropagation()))}_handlePointerDown(){this._isAnyPointerDown=!0}_handlePointerUp(){this._isAnyPointerDown=!1}_handleImmediateClick(e){if(this._clearCachedPickRequest(),!function(e){return"mouse"!==e.pointerType||0===e.button}(e))return;const t=(0,y.vT)(e),i=e.pointerType;let s=!1;if(this.model.active)switch(this.model.state){case"initial":this.startManipulator.events.emit("drag",{action:"start",pointerType:i,start:t,screenPoint:t}),this.startManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.model.startPoint&&(this.startManipulator.interactive=!1,this.endManipulator.interactive=!1,this.model.state="drawing",this.endManipulator.events.emit("drag",{action:"start",pointerType:i,start:t,screenPoint:t}),s=!0);break;case"drawing":this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),null!=this.model.endPoint&&(this.endManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.startManipulator.interactive=!0,this.endManipulator.interactive=!0,this.model.finishMeasurement(),s=!0)}s&&e.stopPropagation(),"mouse"===e.pointerType&&this._hoverAt(t)}_hoverAt(e){const t=this._isAnyPointerDown&&"drawing"!==this.model.state&&"editing"!==this.model.state;if(this.directLineMeasurementView.requiresCursorPoint&&!t){const t=this._pick(e);t.mapPoint&&(this.model.cursorPoint=t.mapPoint)}else this.model.cursorPoint=null}_pick(e){const t=this._cachedPickRequest.screenPoint;return t&&t.x===e.x&&t.y===e.y||(this._cachedPickRequest.screenPoint=e,this._cachedPickResult=this.directLineMeasurementView.pick(this._cachedPickRequest)),this._cachedPickResult}_clearCachedPickRequest(){this._cachedPickRequest.screenPoint=null}_surfaceLocation(e,t){return 0===t?"on-the-surface":e.z>=this.directLineMeasurementView.getElevation(e)?"above-the-surface":"below-the-surface"}_updateManipulatorVisibility(){this.startManipulator.available=null!=this.model.startPoint,this.endManipulator.available=null!=this.model.endPoint}};(0,s._)([(0,n.Cb)({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],ut.prototype,"state",null),(0,s._)([(0,n.Cb)({dependsOn:["model.state"],readOnly:!0})],ut.prototype,"creating",null),(0,s._)([(0,n.Cb)({dependsOn:["view.type"],readOnly:!0})],ut.prototype,"isSupported",null),(0,s._)([(0,n.Cb)({dependsOn:["model.active","model.state"],readOnly:!0})],ut.prototype,"cursor",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],ut.prototype,"model",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],ut.prototype,"directLineMeasurementView",void 0),(0,s._)([(0,o.B)("model.mode")],ut.prototype,"mode",void 0),(0,s._)([(0,o.B)("model.unit")],ut.prototype,"unit",void 0),(0,s._)([(0,o.B)("model.validMeasurement")],ut.prototype,"validMeasurement",void 0),ut=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],ut);const _t=new f.Z;const mt=ut,pt=r.Z.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel");let gt=class extends b.V{constructor(e){super(e),this.supportedViewType="3d",this._handles=new g.Z,this._userUnitOptions=null,this._userUnit=null}initialize(){this._handles.add([(0,v.init)(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles.destroy(),this._handles=null}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool)return null;const e=this.tool.model,t=e.measurementMode,i="geodesic"===t,s=(0,p.pC)(e.model.measurement),r=this.tool.directLineMeasurementView;return{mode:t,directDistance:{text:i?null:r.directLabelText,state:s&&!i?"available":"unavailable"},horizontalDistance:{text:r.horizontalLabelText,state:s?"available":"unavailable"},verticalDistance:{text:r.verticalLabelText,state:s?"available":"unavailable"}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}newMeasurement(){(0,l.ignoreAbortErrors)(this.start())}clearMeasurement(){this.clear()}createToolParams(){return{toolConstructor:mt,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){pt.error("DirectLineMeasurement3D widget is not implemented for MapView")}logError(...e){pt.error(...e)}_findSelectableUnit(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if(!e)return h.oD.slice();const t=e.filter((e=>-1!==h.oD.indexOf(e)));return 0===t.length?h.oD.slice():t}};(0,s._)([(0,n.Cb)({dependsOn:["isDisabled","tool.state"],readOnly:!0})],gt.prototype,"state",null),(0,s._)([(0,n.Cb)({dependsOn:["view.ready","unit","tool.model.messages","tool.model.startPoint","tool.model.endPoint","tool.directLineMeasurementView.triangleCollapseRatioThreshold","tool.model.model.measurement","tool.model.measurementMode"],readOnly:!0})],gt.prototype,"measurement",null),(0,s._)([(0,n.Cb)()],gt.prototype,"tool",void 0),(0,s._)([(0,n.Cb)(w.Y)],gt.prototype,"defaultUnit",void 0),(0,s._)([(0,n.Cb)({dependsOn:["view.spatialReference"]})],gt.prototype,"unitOptions",null),(0,s._)([(0,n.Cb)({dependsOn:["unitOptions","defaultUnit"]})],gt.prototype,"unit",null),gt=(0,s._)([(0,a.j)("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],gt);const vt=gt,wt="esri-direct-line-measurement-3d__measurement-item",bt="esri-direct-line-measurement-3d__measurement-item-title";let ft=class extends m.default{constructor(e,t){super(e,t),this.view=null,this.visible=null,this.iconClass="esri-icon-measure-line",this.label=void 0,this.messages=null,this.messagesUnits=null,this.viewModel=new vt,this.unitOptions=null,this.unit=null}render(){const{isSupported:e,active:t,state:i,measurement:s,unit:r}=this.viewModel,n="disabled"===i,o="ready"===i,a="measuring"===i||"measured"===i,{messages:l,messagesUnits:d}=this,c=t&&o?(0,_.j)("section",{key:"esri-direct-line-measurement-3d__hint",class:"esri-direct-line-measurement-3d__hint"},(0,_.j)("p",{class:"esri-direct-line-measurement-3d__hint-text"},l.hint)):null,u=e?null:(0,_.j)("section",{key:"esri-direct-line-measurement-3d__unsupported",class:"esri-direct-line-measurement-3d__panel--error"},(0,_.j)("p",null,l.unsupported)),m=(e,t,i)=>{switch(t.state){case"available":return(0,_.j)("div",{key:`${i}-enabled`,class:wt},(0,_.j)("span",{class:bt},e),(0,_.j)("span",{class:"esri-direct-line-measurement-3d__measurement-item-value"},t.text));case"unavailable":return(0,_.j)("div",{key:`${i}-disabled`,class:this.classes(wt,"esri-direct-line-measurement-3d__measurement-item--disabled")},(0,_.j)("span",{class:bt},e))}},p=a?(0,_.j)("section",{key:"esri-direct-line-measurement-3d__measurement",class:"esri-direct-line-measurement-3d__measurement"},m(l.direct,s.directDistance,"direct"),m(l.horizontal,s.horizontalDistance,"horizontal"),m(l.vertical,s.verticalDistance,"vertical")):null,g=`${this.id}__units`,v=(0,_.j)("label",{class:"esri-direct-line-measurement-3d__units-label",for:g},l.unit),w=(0,_.j)("div",{class:"esri-direct-line-measurement-3d__units-select-wrapper"},(0,_.j)("select",{class:"esri-direct-line-measurement-3d__units-select esri-select",id:g,onchange:this._changeUnit,bind:this,value:r},this.viewModel.unitOptions.map((e=>{var t;return(0,_.j)("option",{key:e,value:e},(0,h.ZO)(e)?d.systems[e]:null==(t=d.units[e])?void 0:t.pluralCapitalized)})))),b=(0,_.j)("section",{key:"esri-direct-line-measurement-3d__units",class:"esri-direct-line-measurement-3d__units"},v,w),f=a?(0,_.j)("div",{key:"settings",class:"esri-direct-line-measurement-3d__settings"},b):null,y=!e||t&&!a?null:(0,_.j)("div",{class:"esri-direct-line-measurement-3d__actions"},(0,_.j)("button",{disabled:n,class:this.classes("esri-button esri-button--secondary","esri-direct-line-measurement-3d__clear-button",n&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement,type:"button"},l.newMeasurement)),P=this.visible?(0,_.j)("div",{class:"esri-direct-line-measurement-3d__container"},u,c,f,p,y):null;return(0,_.j)("div",{key:"",class:this.classes("esri-direct-line-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},P)}_newMeasurement(){(0,l.ignoreAbortErrors)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,o.B)("viewModel.view")],ft.prototype,"view",void 0),(0,s._)([(0,o.B)("viewModel.visible"),(0,u.G)()],ft.prototype,"visible",void 0),(0,s._)([(0,o.B)("viewModel.active"),(0,u.G)()],ft.prototype,"active",void 0),(0,s._)([(0,n.Cb)()],ft.prototype,"iconClass",void 0),(0,s._)([(0,n.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ft.prototype,"label",void 0),(0,s._)([(0,n.Cb)(),(0,u.G)(),(0,c.H)("esri/widgets/DirectLineMeasurement3D/t9n/DirectLineMeasurement3D")],ft.prototype,"messages",void 0),(0,s._)([(0,n.Cb)(),(0,u.G)(),(0,c.H)("esri/core/t9n/Units")],ft.prototype,"messagesUnits",void 0),(0,s._)([(0,n.Cb)({type:vt}),(0,u.G)(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],ft.prototype,"viewModel",void 0),(0,s._)([(0,o.B)("viewModel.unitOptions")],ft.prototype,"unitOptions",void 0),(0,s._)([(0,o.B)("viewModel.unit")],ft.prototype,"unit",void 0),(0,s._)([(0,d.h)()],ft.prototype,"_newMeasurement",null),(0,s._)([(0,d.h)()],ft.prototype,"_changeUnit",null),ft=(0,s._)([(0,a.j)("esri.widgets.DirectLineMeasurement3D")],ft);const yt=ft}}]);
//# sourceMappingURL=2793.js.map