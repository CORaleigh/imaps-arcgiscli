(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[456],{96540:(t,e,s)=>{"use strict";s.d(e,{vX:()=>h,s5:()=>l,k3:()=>c,Or:()=>o});Number.POSITIVE_INFINITY;const i=Math.PI,r=128/i,a=1/Math.LN2;function n(t,e){return(t%=e)>=0?t:t+e}function o(t){return n(t*r,256)}function l(t){return n(.7111111111111111*t,256)}function c(t){return Math.log(t)*a}function h(t,e,s){return t>=e&&t<=s||t>=s&&t<=e}},9709:(t,e,s)=>{"use strict";s.d(e,{dk:()=>p,Gq:()=>m,a:()=>g,mE:()=>S,m2:()=>c,qr:()=>y,jj:()=>o,hF:()=>l});var i=s(32656),r=s(31514),a=s(49269);function n(t,e=!1){const s=r.X.SIZE_FIELD_STOPS|r.X.SIZE_MINMAX_VALUE|r.X.SIZE_SCALE_STOPS|r.X.SIZE_UNIT_VALUE,i=(t&(r.mf.FIELD_TARGETS_OUTLINE|r.mf.MINMAX_TARGETS_OUTLINE|r.mf.SCALE_TARGETS_OUTLINE|r.mf.UNIT_TARGETS_OUTLINE))>>>4;return e?s&i:s&~i}function o(t,e,s,i,a){switch(t){case r.LW.FILL:return p.from(e,i);case r.LW.LINE:return g.from(e,s);case r.LW.MARKER:return S.from(e);case r.LW.TEXT:return y.from(e);case r.LW.LABEL:return m.from(e,a);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function l(t){switch(c.load(t).geometryType){case r.LW.MARKER:return new S(t);case r.LW.FILL:return new p(t);case r.LW.LINE:return new g(t);case r.LW.TEXT:return new y(t);case r.LW.LABEL:return new m(t)}}class c{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case r.LW.FILL:return"fill";case r.LW.MARKER:return"marker";case r.LW.LINE:return"line";case r.LW.TEXT:return"text";case r.LW.LABEL:return"label";default:throw new i.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const s=1<<t;e?this._data|=s:this._data&=~s}bit(t){return(this._data&1<<t)>>t}setBits(t,e,s){for(let i=e,r=0;i<s;i++,r++)this.setBit(i,0!=(t&1<<r))}bits(t,e){let s=0;for(let i=t,r=0;i<e;i++,r++)s|=this.bit(i)<<r;return s}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}c.shared=new c(0);const h=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,e){super.setVV(t,e);const s=n(t,e)&t;this.vvSizeMinMaxValue=!!(s&r.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&r.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&r.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&r.X.SIZE_SCALE_STOPS)}},u=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,e){super.setVV(t,e),this.vvRotation=!e&&!!(t&r.X.ROTATION)}},d=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,e){super.setVV(t,e),this.vvColor=!e&&!!(t&r.X.COLOR)}},v=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,e){super.setVV(t,e),this.vvOpacity=!e&&!!(t&r.X.OPACITY)}};class p extends(d(v(c))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.LW.FILL,e?s.dotDensity=!0:s.setVV(t,!1),s.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}}p.shared=new p(0);class S extends(d(v(u(h(c))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=r.LW.MARKER,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}S.shared=new S(0);class g extends(d(v(h(c)))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.LW.LINE,s.setVV(t,e),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class y extends(d(v(u(h(c))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(t);return e.geometryType=r.LW.TEXT,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class m extends(h(c)){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.LW.LABEL,s.setVV(t,!1),s.mapAligned=!!(0,a.N)(e),s.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0)},49269:(t,e,s)=>{"use strict";function i(t){switch(t){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}s.d(e,{N:()=>i})},31887:(t,e,s)=>{"use strict";s.d(e,{Z:()=>l});var i=s(56140),r=(s(95830),s(36544),s(68055),s(79881)),a=s(87566),n=(s(10923),s(57002),s(86035),s(77204));let o=class extends n.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const t=this.get("tileStore.tileScheme.spatialReference");return t&&t.toJSON()||null}};(0,i._)([(0,r.Cb)({readOnly:!0})],o.prototype,"supportsTileUpdates",null),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"remoteClient",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"service",void 0),(0,i._)([(0,r.Cb)({dependsOn:["tileStore.tileScheme.spatialReference"]})],o.prototype,"spatialReference",null),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"tileInfo",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"tileStore",void 0),o=(0,i._)([(0,a.j)("esri.views.2d.layers.features.processors.BaseProcessor")],o);const l=o},81239:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>V});var i=s(56140),r=s(95830),a=s(59472),n=s(36544),o=(s(68055),s(79881),s(87566)),l=(s(32656),s(10923),s(57002),s(86035),s(39105)),c=s(73032),h=s(23229),u=s(71286),d=s(84767),v=s(44055),p=s(44840),S=s(10321),g=s(29342),y=s(28487);class m{constructor(t,e=2){this._bucketSize=t,this._rowsLength=u.I_/t,this._colsLength=u.I_/t,this._elementsPerBucket=e,this._grid=this._initGrid()}checkOverlap(t,e){const s=Math.floor(t/this._bucketSize),i=Math.floor(e/this._bucketSize);return s<0||s>=this._rowsLength||i<0||i>=this._colsLength||this._grid[i*this._colsLength+s]>=this._elementsPerBucket}markUsed(t,e){const s=Math.floor(t/this._bucketSize),i=Math.floor(e/this._bucketSize);this._grid[i*this._colsLength+s]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}var _=s(31887);n.Z.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let f=class extends _.Z{constructor(){super(...arguments),this.type="symbol"}destroy(){}get supportsTileUpdates(){return!0}async update(t,e){const s=e.schema.processors[0];if("symbol"!==s.type)return;const i=(0,h.Hg)(this._schema,s);(0,h.uD)(i,"mesh")&&((0,r.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=s,this._factory=this._createFactory(s),this._factory.update(s,this.tileStore.tileScheme.tileInfo))}onTileData(t,e,s){return(0,l.throwIfAborted)(s),this._onTileData(t,e,s)}onTileError(t,e,s){const i=s.signal,r={tileKey:t.id,error:e};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:i})}_createFactory(t){const{geometryType:e,objectIdField:s,fields:i}=this.service,r={geometryType:e,fields:i,spatialReference:c.Z.fromJSON(this.spatialReference)},a=new S.W(((t,e)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",t,e)),!1);return this._store=a,this._matcher=(0,v.f)(t.mesh.matcher,a,r),new g.j(e,s,a)}async _onTileData(t,e,s){const{type:i,addOrUpdate:r,remove:n,end:o}=e;if(!r){const e={type:i,addOrUpdate:null,remove:n,clear:!1,end:o};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:e},s)}const c=this._processFeatures(t,r,s),h=s.signal;try{const e=await c,s=(0,a.Po)(e,(t=>t.message)),r=(0,a.Po)(e,(t=>t.transferList))||[],u={type:i,addOrUpdate:s,remove:n,clear:!1,end:o},d={transferList:(0,a.Wg)(r)||[],signal:h};return(0,l.throwIfAborted)(d),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:u},d)}catch(e){this._handleError(t,e,s)}}async _processFeatures(t,e,s){if((0,a.Wi)(e)||!e.hasFeatures)return null;const i={transform:t.transform,hasZ:!1,hasM:!1},r=this._factory,n={viewingMode:"",scale:t.scale},o=await this._matcher;(0,l.throwIfAborted)(s);const c=this._getLabelInfos(t,e);return await r.analyze(e.getCursor(),o,i,n),(0,l.throwIfAborted)(s),this._writeFeatureSet(t,e,i,c,r)}_writeFeatureSet(t,e,s,i,r){const n=r.createMeshData(e.getApproximateSize()),o={viewingMode:"",scale:t.scale},l=e.getCursor();for(;l.next();)try{const e=l.getDisplayId(),c=(0,a.pC)(i)?i.get(e):null;r.writeCursor(n,l,s,o,t.level,c)}catch(t){}return this._encodeDisplayData(n)}_encodeDisplayData(t){const e={},s=new Array;return t.encode(e,s),{message:e,transferList:s}}_handleError(t,e,s){if(!(0,l.isAbortError)(e)){const i={tileKey:t.id,error:e.message};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s.signal})}}_shouldDiscard(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const s=e.readLegacyPointGeometry();return!s||t.checkOverlap(s.x,s.y)}case"esriGeometryPolygon":{const s=e.readLegacyCentroid();return!s||t.checkOverlap(s.x,s.y)}default:return!1}}_markUsed(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const{x:s,y:i}=e.readLegacyPointGeometry();return t.markUsed(s,i)}case"esriGeometryPolygon":{const{x:s,y:i}=e.readLegacyCentroid();return t.markUsed(s,i)}}}_getLabelInfos(t,e){const s=this._schema.mesh.labels,i=(0,a.Po)(s,(e=>e.filter((e=>function(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}(e,t.scale)))));if((0,a.Wi)(i)||0===i.length)return null;const r=new Map,n=new m(u.wz),o=e.getCursor();for(;o.next();){const t=o.getDisplayId();if(this._shouldDiscard(n,o)){r.has(t)||r.set(t,null);continue}let e=!1;const s=[],a=(0,y.nE)(t),l=a&&1!==o.readAttribute("cluster_count")?"aggregate":"feature";for(const r of i){if(r.target!==l)continue;const i=o.getStorage(),n=a&&"feature"===l?i.getComputedStringAtIndex(o.readAttribute("referenceId"),r.fieldIndex):i.getComputedStringAtIndex(t,r.fieldIndex);if(!n)continue;const c=(0,d.E)(n.toString()),h=c[0],u=c[1];this._store.getMosaicItem(r.symbol,(0,p._)(h)).then((t=>{s[r.index]={glyphs:t.glyphMosaicItems,rtl:u,index:r.index}})),e=!0}r.set(t,s),e&&this._markUsed(n,o)}return r}};f=(0,i._)([(0,o.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],f);const V=f}}]);
//# sourceMappingURL=456.js.map