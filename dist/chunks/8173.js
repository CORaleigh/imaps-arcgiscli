(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[8173],{91535:(e,t,r)=>{"use strict";r.d(t,{aX:()=>_,or:()=>T,hR:()=>Z});var s=r(34926),n=r(59472),o=r(36544),a=r(32656),i=r(39105),l=r(27780),u=r(73032),c=r(41241),h=r(53817),d=r(93833),f=r(10923),y=r(56885),p=(r(36348),r(54721));async function g(e,t,r){const s="string"==typeof e?(0,f.mN)(e):e,n=t[0].spatialReference,o=(0,y.Ji)(t[0]),a={...r,query:{...s.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify((i=t,{geometryType:(0,y.Ji)(i[0]),geometries:i.map((e=>e.toJSON()))}))}};var i;return function(e,t,r){const s=(0,y.q9)(t);return e.map((e=>{const t=s.fromJSON(e);return t.spatialReference=r,t}))}((await(0,p.default)(s.path+"/simplify",a)).data,o,n)}const m=o.Z.getLogger("esri.geometry.support.normalizeUtils"),b={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new d.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.Z.WebMercator}),minus180Line:new d.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new d.Z({paths:[[[180,-180],[180,180]]],spatialReference:u.Z.WGS84}),minus180Line:new d.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:u.Z.WGS84})}};function I(e){return"polygon"===e.type}function w(e){return"polyline"===e[0].type}function F(e){return I(e)?e.rings:e.paths}function R(e,t){return Math.ceil((e-t)/(2*t))}function q(e,t){const r=F(e);for(const e of r)for(const r of e)r[0]+=t;return e}function Z(e,t){if(!(e instanceof d.Z||e instanceof h.Z)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw m.error(e),new a.Z(e)}const r=F(e),s=[];for(const e of r){const r=[];s.push(r),r.push([e[0][0],e[0][1]]);for(let s=0;s<e.length-1;s++){const n=e[s][0],o=e[s][1],a=e[s+1][0],i=e[s+1][1],l=Math.sqrt((a-n)*(a-n)+(i-o)*(i-o)),u=(i-o)/l,c=(a-n)/l,h=l/t;if(h>1){for(let e=1;e<=h-1;e++){const s=e*t,a=c*s+n,i=u*s+o;r.push([a,i])}const e=(l+Math.floor(h-1)*t)/2,s=c*e+n,a=u*e+o;r.push([s,a])}r.push([a,i])}}return I(e)?new h.Z({rings:s,spatialReference:e.spatialReference}):new d.Z({paths:s,spatialReference:e.spatialReference})}function x(e,t,r){if(t){const t=Z(e,1e6);e=(0,c.Sx)(t,!0)}return r&&(e=q(e,r)),e}function N(e,t,r){if(Array.isArray(e)){const s=e[0];if(s>t){const r=R(s,t);e[0]=s+r*(-2*t)}else if(s<r){const t=R(s,r);e[0]=s+t*(-2*r)}}else{const s=e.x;if(s>t){const r=R(s,t);e=e.clone().offset(r*(-2*t),0)}else if(s<r){const t=R(s,r);e=e.clone().offset(t*(-2*r),0)}}return e}async function _(e,t,r){if(!Array.isArray(e))return _([e],t);const o=t?t.url:s.Z.geometryServiceUrl;let a,u,m,I,Z,T,S,O,v=0;const G=[],A=[];for(const t of e)if((0,n.Wi)(t))A.push(t);else if(a||(a=t.spatialReference,u=(0,l.C5)(a),m=a.isWebMercator,T=m?102100:4326,I=b[T].maxX,Z=b[T].minX,S=b[T].plus180Line,O=b[T].minus180Line),u)if("mesh"===t.type)A.push(t);else if("point"===t.type)A.push(N(t.clone(),I,Z));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>N(e,I,Z))),A.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,u);A.push(e.rings?new h.Z(e):e)}else if(t.extent){const e=t.extent,r=R(e.xmin,Z)*(2*I);let s=0===r?t.clone():q(t.clone(),r);e.offset(r,0),e.intersects(S)&&e.xmax!==I?(v=e.xmax>v?e.xmax:v,s=x(s,m),G.push(s),A.push("cut")):e.intersects(O)&&e.xmin!==Z?(v=e.xmax*(2*I)>v?e.xmax*(2*I):v,s=x(s,m,360),G.push(s),A.push("cut")):A.push(s)}else A.push(t.clone());else A.push(t);let k=R(v,I),P=-90;const M=k,j=new d.Z;for(;k>0;){const e=360*k-180;j.addPath([[e,P],[e,-1*P]]),P*=-1,k--}if(G.length>0&&M>0){const t=function(e,t){let r=-1;for(let s=0;s<t.cutIndexes.length;s++){const n=t.cutIndexes[s],o=t.geometries[s],a=F(o);for(let e=0;e<a.length;e++){const t=a[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const s=t[e][0];r=s>r?s:r}r=Number(r.toFixed(9));const s=-360*R(r,180);for(let r=0;r<t.length;r++){const t=o.getPoint(e,r);o.setPoint(e,r,t.clone().offset(s,0))}return!0}}))}if(n===r){if("polygon"===e[0].type)for(const t of F(o))e[n]=e[n].addRing(t);else if(w(e))for(const t of F(o))e[n]=e[n].addPath(t)}else r=n,e[n]=o}return e}(G,await async function(e,t,r,s){const n="string"==typeof e?(0,f.mN)(e):e,o=t[0].spatialReference,a={...s,query:{...n.query,f:"json",sr:JSON.stringify(o),target:JSON.stringify({geometryType:(0,y.Ji)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},i=await(0,p.default)(n.path+"/cut",a),{cutIndexes:l,geometries:u=[]}=i.data;return{cutIndexes:l,geometries:u.map((e=>{const t=(0,y.im)(e);return t.spatialReference=o,t}))}}(o,G,j,r)),s=[],a=[];for(let r=0;r<A.length;r++){const o=A[r];if("cut"!==o)a.push(o);else{const o=t.shift(),i=e[r];(0,n.pC)(i)&&"polygon"===i.type&&i.rings&&i.rings.length>1&&o.rings.length>=i.rings.length?(s.push(o),a.push("simplify")):a.push(m?(0,c.$)(o):o)}}if(!s.length)return a;const i=await g(o,s,r),l=[];for(let e=0;e<a.length;e++){const t=a[e];"simplify"!==t?l.push(t):l.push(m?(0,c.$)(i.shift()):i.shift())}return l}const E=[];for(let e=0;e<A.length;e++){const t=A[e];if("cut"!==t)E.push(t);else{const e=G.shift();E.push(!0===m?(0,c.$)(e):e)}}return(0,i.resolve)(E)}function T(e,t){const r=(0,l.C5)(t);if(r){const[t,s]=r.valid,n=s-t;if(e<t)for(;e<t;)e+=n;if(e>s)for(;e>s;)e-=n}return e}},44195:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class s{constructor(e=null,t={},r,s){this.displayId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),r&&(this.centroid=r),null!=s&&(this.objectId=s)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new s(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashIndexed=this.geohashIndexed,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}const n=s},60151:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class s{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new s;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}const n=s},73127:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class s{constructor(e=[],t=[],r=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=r}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let r=0;r<s;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=s}}clone(){return new s(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}const n=s},31036:(e,t,r)=>{"use strict";r.d(t,{XA:()=>$,h_:()=>H,Yn:()=>D,GH:()=>Y,E7:()=>V,ks:()=>U,Uy:()=>L,u0:()=>j,EI:()=>X,cn:()=>B,di:()=>W,Iv:()=>G,fQ:()=>F,eG:()=>E,J6:()=>P,oB:()=>ue,zj:()=>te,$:()=>ne,lz:()=>le,RZ:()=>K,Nh:()=>ee,Jd:()=>m,IN:()=>b,hY:()=>ae,$g:()=>oe});var s=r(36544),n=r(32656),o=r(56885),a=r(44195),i=r(60151),l=r(73127);function u(e,t){return e?t?4:3:t?3:2}const c=s.Z.getLogger("esri.tasks.support.optimizedFeatureSet"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},d=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o},f=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+2]},y=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+3]},p=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+2],e[r+3]=t[s+3]};function g(e,t,r,s){if(e){if(r)return t&&s?p:f;if(t&&s)return y}else if(t&&s)return f;return d}function m({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function b({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function I({scale:e,translate:t},r){return r*e[0]+t[0]}function w({scale:e,translate:t},r){return t[1]-r*e[1]}function F(e,t,r){return e?t?r?T(e):Z(e):r?N(e):R(e):null}function R(e){const t=e.coords;return{x:t[0],y:t[1]}}function q(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function Z(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function N(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function _(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function T(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t){return e&&t?S:e?x:t?_:q}function v(e,t,r,s,n){const o=O(r,s);for(const r of t){const{geometry:t,attributes:s}=r;let i;t&&(i=o(new l.Z,t)),e.push(new a.Z(i,s,null,s[n]))}return e}function G(e,t,r){if(!e)return null;const s=u(t,r),n=[];for(let t=0;t<e.coords.length;t+=s){const r=[];for(let n=0;n<s;n++)r.push(e.coords[t+n]);n.push(r)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function A(e,t,r,s,n){const o=u(r,s);for(const r of t){const t=r.geometry,s=r.attributes;let i;t&&(i=k(new l.Z,t,o)),e.push(new a.Z(i,s,null,s[n]))}return e}function k(e,t,r=u(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const s=e.coords;let n=0;for(const e of t.points)for(let t=0;t<r;t++)s[n++]=e[t];return e}function P(e,t,r){if(!e)return null;const s=u(t,r),{coords:n,lengths:o}=e,a=[];let i=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(n[i++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function M(e,t,r,s,n){const o=u(r,s);for(const r of t){const t=r.geometry,s=r.attributes;let i;t&&(i=j(new l.Z,t,o)),e.push(new a.Z(i,s,null,s[n]))}return e}function j(e,t,r=u(t.hasZ,t.hasM)){const{lengths:s,coords:n}=e;let o=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)n[o++]=t[e];s.push(e.length)}return e}function E(e,t,r){if(!e)return null;const s=u(t,r),{coords:n,lengths:o}=e,a=[];let i=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(n[i++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function J(e,t,r,s,n){for(const o of t){const t=o.geometry,i=o.centroid,u=o.attributes;let c;t&&(c=L(new l.Z,t,r,s)),i?e.push(new a.Z(c,u,q(new l.Z,i),u[n])):e.push(new a.Z(c,u,null,u[n]))}return e}function L(e,t,r=t.hasZ,s=t.hasM){return U(e,t.rings,r,s),e}function U(e,t,r,s){const n=u(r,s),{lengths:o,coords:a}=e;let i=0;o.length=a.length=0;for(const e of t){for(const t of e)for(let e=0;e<n;e++)a[i++]=t[e];o.push(e.length)}return e}const C=[],z=[];function $(e,t,r,s,n){C[0]=e;const[o]=D(z,C,t,r,s,n);return C.length=z.length=0,o}function D(e,t,r,s,o,i){if(e.length=0,!r){for(const r of t){const t=r.attributes[i];e.push(new a.Z(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return v(e,t,s,o,i);case"esriGeometryMultipoint":return A(e,t,s,o,i);case"esriGeometryPolyline":return M(e,t,s,o,i);case"esriGeometryPolygon":return J(e,t,s,o,i);default:c.error("convertToFeatureSet:unknown-geometry",new n.Z(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function V(e,t,r,s,o,a){const i=e.length;switch(r){case"esriGeometryPoint":v(e,t,s,o,a);break;case"esriGeometryMultipoint":A(e,t,s,o,a);break;case"esriGeometryPolyline":M(e,t,s,o,a);break;case"esriGeometryPolygon":J(e,t,s,o,a);break;default:c.error("convertToFeatureSet:unknown-geometry",new n.Z(`Unable to parse unknown geometry type '${r}'`))}for(let s=0;s<t.length;s++)e[s+i].geometryType=r,e[s+i].insertAfter=t[s].insertAfter,e[s+i].groupId=t[s].groupId;return e}function X(e,t,r,s){z[0]=e,Q(C,z,t,r,s);const n=C[0];return C.length=z.length=0,n}function Y(e,t,r){if(!e)return null;const s=new l.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,o.wp)(e)?O(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(s,e):(0,o.oU)(e)?L(s,e,t,r):(0,o.l9)(e)?j(s,e,u(t,r)):(0,o.aW)(e)?k(s,e,u(t,r)):void c.error("convertFromGeometry:unknown-geometry",new n.Z(`Unable to parse unknown geometry type '${e}'`))}function W(e,t,r,s){const o=e&&("coords"in e?e:e.geometry);if(!o)return null;switch(t){case"esriGeometryPoint":{let e=R;return r&&s?e=T:r?e=Z:s&&(e=N),e(o)}case"esriGeometryMultipoint":return G(o,r,s);case"esriGeometryPolyline":return P(o,r,s);case"esriGeometryPolygon":return E(o,r,s);default:return void c.error("convertToGeometry:unknown-geometry",new n.Z(`Unable to parse unknown geometry type '${t}'`))}}function Q(e,t,r,s,o){switch(e.length=0,r){case"esriGeometryPoint":return function(e,t,r,s){let n=R;r&&s?n=T:r?n=Z:s&&(n=N);for(const r of t){const{geometry:t,attributes:s}=r,o=t?n(t):null;e.push({attributes:s,geometry:o})}return e}(e,t,s,o);case"esriGeometryMultipoint":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:o}=n;let a;t&&(a=G(t,r,s)),e.push({attributes:o,geometry:a})}return e}(e,t,s,o);case"esriGeometryPolyline":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:o}=n;let a;t&&(a=P(t,r,s)),e.push({attributes:o,geometry:a})}return e}(e,t,s,o);case"esriGeometryPolygon":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:o,centroid:a}=n;let i;if(t&&(i=E(t,r,s)),a){const t=R(a);e.push({attributes:o,centroid:t,geometry:i})}else e.push({attributes:o,geometry:i})}return e}(e,t,s,o);default:c.error("convertToFeatureSet:unknown-geometry",new n.Z(`Unable to parse unknown geometry type '${r}'`))}return e}function B(e){const{objectIdFieldName:t,spatialReference:r,transform:s,fields:n,hasM:o,hasZ:a,features:i,geometryType:l,exceededTransferLimit:u,uniqueIdField:c,queryGeometry:h,queryGeometryType:d}=e,f={features:Q([],i,l,a,o),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:c,queryGeometry:W(h,d,!1,!1)};return s&&(f.transform=s),u&&(f.exceededTransferLimit=u),o&&(f.hasM=o),a&&(f.hasZ=a),f}function H(e,t){const r=new i.Z,{hasM:s,hasZ:o,features:a,objectIdFieldName:l,spatialReference:u,geometryType:h,exceededTransferLimit:d,transform:f,fields:y}=e;return y&&(r.fields=y),r.geometryType=h,r.objectIdFieldName=l||t,r.spatialReference=u,r.objectIdFieldName?(a&&D(r.features,a,h,o,s,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),s&&(r.hasM=s),o&&(r.hasZ=o),f&&(r.transform=f),r):(c.error(new n.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function K(e,t){const{geometryType:r,features:s,hasM:n,hasZ:o}=t;if(!e)return t;for(let t=0;t<s.length;t++){const a=s[t],i=a.weakClone();i.geometry=new l.Z,ee(i.geometry,a.geometry,n,o,r,e),a.centroid&&(i.centroid=new l.Z,ee(i.centroid,a.centroid,n,o,"esriGeometryPoint",e)),s[t]=i}return t.transform=e,t}function ee(e,t,r,s,n,o,a=r,i=s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[n],{coords:c,lengths:d}=t,f=u(r,s),y=u(r&&a,s&&i),p=g(r,s,a,i);if(!d.length)return p(e.coords,c,0,0,m(o,c[0]),b(o,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let I,w,F,R,q=0,Z=0,x=Z;for(const t of d){if(t<l)continue;let r=0;Z=x,F=I=m(o,c[q]),R=w=b(o,c[q+1]),p(e.coords,c,Z,q,F,R),r++,q+=f,Z+=y;for(let s=1;s<t;s++,q+=f)F=m(o,c[q]),R=b(o,c[q+1]),F===I&&R===w||(p(e.coords,c,Z,q,F-I,R-w),Z+=y,r++,I=F,w=R);r>=l&&(e.lengths.push(r),x=Z)}return e.coords.length=x,e.coords.length?e:null}function te(e,t,r,s,n,o,a=r,i=s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[n],{coords:c,lengths:d}=t,f=u(r,s),y=u(r&&a,s&&i),p=g(r,s,a,i);if(!d.length)return p(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let m=0;const b=o*o;for(const t of d){if(t<l){m+=t*f;continue}const r=e.coords.length/y,s=m,n=m+(t-1)*f;p(e.coords,c,e.coords.length,s,c[s],c[s+1]),se(e.coords,c,f,b,p,s,n),p(e.coords,c,e.coords.length,n,c[n],c[n+1]);const o=e.coords.length/y-r;o>=l?e.lengths.push(o):e.coords.length=r*y,m+=t*f}return e.coords.length?e:null}function re(e,t,r,s){const n=e[t],o=e[t+1],a=e[r],i=e[r+1],l=e[s],u=e[s+1];let c=a,h=i,d=l-c,f=u-h;if(0!==d||0!==f){const e=((n-c)*d+(o-h)*f)/(d*d+f*f);e>1?(c=l,h=u):e>0&&(c+=d*e,h+=f*e)}return d=n-c,f=o-h,d*d+f*f}function se(e,t,r,s,n,o,a){let i,l=s,u=0;for(let e=o+r;e<a;e+=r)i=re(t,e,o,a),i>l&&(u=e,l=i);l>s&&(u-o>r&&se(e,t,r,s,n,o,u),n(e,t,e.length,u,t[u],t[u+1]),a-u>r&&se(e,t,r,s,n,u,a))}function ne(e,t,r,s){if(!t||!t.coords||!t.coords.length)return null;const n=u(r,s);let o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],s=e[t+1];o=Math.min(o,r),i=Math.max(i,r),a=Math.min(a,s),l=Math.max(l,s)}}return e[0]=o,e[1]=a,e[2]=i,e[3]=l,e}function oe(e,t,r,s,n){const{coords:o,lengths:a}=t,i=r?s?p:f:s?f:d,l=u(r,s);if(!o.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return i(e.coords,o,0,0,I(n,o[0]),w(n,o[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=n.scale;let y=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;let s=I(n,o[y]),u=w(n,o[y+1]);i(e.coords,o,y,y,s,u),y+=l;for(let t=1;t<r;t++,y+=l)s+=o[y]*c,u-=o[y+1]*h,i(e.coords,o,y,y,s,u)}return e!==t&&(e.lengths.length=a.length,e.coords.length=o.length),e}function ae(e,t,r,s,n,o){const a=u(r,s),i=g(r,s,n,o),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<l.length;t+=a)i(e.coords,l,e.coords.length,t,l[t],l[t+1]);return e}function ie(e,t,r,s){let n=0,o=e[s*t],a=e[s*(t+1)];for(let i=1;i<r;i++){const r=o+e[s*(t+i)],l=a+e[s*(t+i)+1],u=(r-o)*(l+a);o=r,a=l,n+=u}return.5*n}function le(e,t){const{coords:r,lengths:s}=e;let n=0,o=0;for(let e=0;e<s.length;e++)o+=ie(r,n,s[e],t),n+=e;return Math.abs(o)}function ue(e,t){const r=e.clone(),s=e.coords,n=e.lengths;let o=0;for(let e=0;e<n.length;e++){const a=n[e];let i=s[t*o],l=s[t*o+1];for(let e=1;e<a;e++){const n=i+s[t*(o+e)],a=l+s[t*(o+e)+1];r.coords[t*(o+e)]=n,r.coords[t*(o+e)+1]=a,i=n,l=a}o+=a}return r}},20365:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var s=r(56140),n=r(95830),o=r(82550),a=r(10103),i=r(59472),l=(r(36544),r(68055),r(79881)),u=r(87566),c=r(32656),h=r(10923),d=(r(57002),r(86035),r(39105)),f=r(52937),y=r(54721),p=r(809),g=r(87864),m=r(72094),b=r(31060),I=r(92551),w=r(56471);const F=new Set(["Feature Layer","Table"]);let R=class extends p.Z{constructor(){super(...arguments),this.type="feature-layer"}load(e){const t=(0,i.pC)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),(0,d.resolve)(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,gdbVersion:s,spatialReference:o,fieldsIndex:a}=this.layer,i=(0,n.Z)("featurelayer-pbf")&&e?"pbf":"json";return new I.Z({url:t.path,format:i,fieldsIndex:a,dynamicDataSource:r,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/addAttachment",n=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,n.query);try{const e=await(0,y.default)(s,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const s=e.attributes[this.layer.objectIdField],n=this.layer.parsedUrl.path+"/"+s+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:t}}),a=this._getFormDataForAttachment(r,o.query);try{const e=await(0,y.default)(n,{body:a});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(s,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),n=this._getFeatureIds(e.deleteFeatures);(0,m.P)(r,s,this.layer.spatialReference);const o=[],a=[],i=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)a.push(await this._serializeAttachment(t));const l=o.length||a.length||i.length?{adds:o,updates:a,deletes:i}:null,u=this._getLayerRequestOptions({method:"post",query:{adds:r.length?JSON.stringify(r):null,updates:s.length?JSON.stringify(s):null,deletes:n.length?n.join(","):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:l&&JSON.stringify(l)}}),c=await(0,y.default)(this.layer.parsedUrl.path+"/applyEdits",u);return this._createEditsResult(c)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";try{return(await(0,y.default)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:s}=this.layer,{data:n}=await(0,y.default)(`${s}/${r}`,t),{id:o,extent:a,fullExtent:i,timeExtent:l}=n,u=a||i;return{id:o,fullExtent:u&&f.Z.fromJSON(u),timeExtent:l&&g.Z.fromJSON({start:l[0],end:l[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;await this.load();const n=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=s+"/"+e+"/attachments";r.push((0,y.default)(t,n))}return(0,d.all)(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>(0,b.O)(e,s)))}return this.queryTask.executeAttachmentQuery(e,n)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let t=this.layer.sourceJSON;if(!t){const{data:r}=await(0,y.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,n.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:e}));t=r}this.sourceJSON=this._patchServiceJSON(t);const r=t.type;if(!F.has(r))throw new c.Z("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=(0,w.bU)(e.geometryType).renderer;(0,a.RB)("drawingInfo.renderer",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return(0,i.Wi)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:n,contentType:o,data:a,uploadId:i}=r,l={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(l.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),i)l.uploadId=i;else if(a){const e=await async function(e){return"string"==typeof e?(0,h.sJ)(e)||{data:e}:(0,d.create)(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t((0,h.sJ)(s.result)),s.onerror=e=>r(e)}))}(a);l.contentType=e.mediaType,l.data=e.data,a instanceof File&&(l.name=a.name)}return n&&(l.name=n),o&&(l.contentType=o),l}_getFeatureIds(e){const t=e[0];return t?"objectId"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_getIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new c.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new c.Z("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:(0,o.yd)({gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:"json"}}};(0,s._)([(0,l.Cb)()],R.prototype,"type",void 0),(0,s._)([(0,l.Cb)({constructOnly:!0})],R.prototype,"layer",void 0),(0,s._)([(0,l.Cb)({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource","layer.fieldsIndex"]})],R.prototype,"queryTask",null),R=(0,s._)([(0,u.j)("esri.layers.graphics.sources.FeatureLayerSource")],R);const q=R},56471:(e,t,r)=>{"use strict";r.d(t,{Dm:()=>i,Hq:()=>l,bU:()=>a});var s=r(95830),n=r(82550),o=r(7767);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.I4:"esriGeometryPolyline"===e?o.ET:o.lF}}}function i(e,t){if((0,s.Z)("csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${t.indexOf(".")?`["${t}"]`:`.${t}`} = ${JSON.stringify(e[t])};`;const s=new Function(r);return()=>new s}catch(r){return()=>({[t]:null,...e})}}function l(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,n.d9)(e)}}]}},95986:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var s=r(56140),n=(r(95830),r(36544),r(68055),r(79881)),o=r(87566),a=r(10923),i=(r(57002),r(86035),r(82677));let l=class extends i.default{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?(0,a.mN)(e):null}_encode(e,t,r){const s={};for(const n in e){if("declaredClass"===n)continue;const o=e[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){s[n]=[];for(let e=0;e<o.length;e++)s[n][e]=this._encode(o[e])}else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(r&&r[n]);s[n]=t?e:JSON.stringify(e)}else s[n]=t?o:JSON.stringify(o);else s[n]=o}return s}};(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["url"]})],l.prototype,"parsedUrl",null),(0,s._)([(0,n.Cb)()],l.prototype,"requestOptions",void 0),(0,s._)([(0,n.Cb)({type:String})],l.prototype,"url",void 0),l=(0,s._)([(0,o.j)("esri.tasks.Task")],l);const u=l}}]);
//# sourceMappingURL=8173.js.map