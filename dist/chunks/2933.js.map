{"version":3,"sources":["webpack://imaps/./node_modules/@arcgis/core/layers/MapImageLayer.js"],"names":["U","e","super","this","alwaysRefetch","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","labelsVisible","isReference","operationalLayerType","sourceJSON","sublayers","type","url","r","t","signal","addResolvingPromise","loadFromPortal","supportedTypes","then","_fetchService","supportedImageFormatTypes","indexOf","s","loaded","o","slice","reverse","flatten","toArray","i","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","origin","createSublayersForOrigin","a","p","writeSublayerStructure","n","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","pixelRatio","version","clone","shiftCentralMeridian","layer","scale","extent","width","toJSON","destroy","rotation","m","spatialReference","wkid","JSON","stringify","l","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","timestamp","query","_ts","customParameters","parsedUrl","path","createExportImageParameters","f","Date","now","dynamicLayers","data","catch","error","returnUpdates","fullExtent","allSublayers","read","ssl","replace","prototype","json","origins","service","source","Boolean","enabled","overridePolicy","ignoreOrigin","readOnly","value"],"mappings":"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","file":"chunks/2933.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import\"../core/Logger.js\";import{Integer as t}from\"../core/accessorSupport/ensureType.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import{reader as o}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import p from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import{nameToId as m}from\"../core/accessorSupport/PropertyOrigin.js\";import\"../portal/support/resourceExtension.js\";import{resolve as n,reject as l,isAbortError as c}from\"../core/promiseUtils.js\";import u from\"../geometry/Extent.js\";import y from\"../request.js\";import{loadAll as h}from\"../core/loadAll.js\";import d from\"./Layer.js\";import f from\"../TimeExtent.js\";import{MultiOriginJSONMixin as g}from\"../core/MultiOriginJSONSupport.js\";import{url as j}from\"./support/commonProperties.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{ArcGISService as x}from\"./mixins/ArcGISService.js\";import{BlendLayer as v}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as S}from\"./mixins/CustomParametersMixin.js\";import{PortalLayer as w}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as O}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as L}from\"./mixins/ScaleRangeLayer.js\";import{TemporalLayer as E}from\"./mixins/TemporalLayer.js\";import{HandleOwnerMixin as I}from\"../core/HandleOwner.js\";import{getScale as M}from\"../geometry/support/scaleUtils.js\";import{ArcGISMapService as q}from\"./mixins/ArcGISMapService.js\";import P from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as N}from\"./support/sublayerUtils.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{ExportImageParameters as J}from\"./support/ExportImageParameters.js\";let U=class extends(v(E(L(O(R(q(x(b(w(g(S(I(d))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),n(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let i=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=m(s.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;i=N(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");i=N(o,e.sublayers,m(e.origin))}}const a=[],p={writeSublayerStructure:i,...s};let n=i;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,s){const o=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const i=new J({layer:this,scale:M({extent:e,width:r})*o}),a=i.toJSON();i.destroy();const p=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},m=e&&e.spatialReference,n=m.wkid||JSON.stringify(m.toJSON());a.dpi*=o;const l={};if(null!=s&&s.timeExtent){const{start:e,end:r}=s.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:n,imageSR:n,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,s){const o={responseType:\"image\"};s&&s.timestamp&&(o.query={...o.query,_ts:s.timestamp}),s&&s.signal&&(o.signal=s.signal),this.customParameters&&Object.keys(this.customParameters).length&&(o.query={...this.customParameters,...o.query});const i=this.parsedUrl.path+\"/export\",a={...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null};if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return l(new p(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a}));o.query?o.query={...a,...o.query}:o.query=a;return y(i,o).then((e=>e.data)).catch((e=>{if(c(e))throw e;throw new p(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${i}`,{error:e})}))}async fetchRecomputedExtents(e={}){const r={...e,query:{returnUpdates:!0,f:\"json\"}},{data:t}=await y(this.url,r),{extent:s,fullExtent:o,timeExtent:i}=t,a=s||o;return{fullExtent:a&&u.fromJSON(a),timeExtent:i&&f.fromJSON({start:i[0],end:i[1]})}}loadAll(){return h(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:r,ssl:t}=await y(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters},signal:e});t&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r,this.read(r,{origin:\"service\",url:this.parsedUrl})}};e([s()],U.prototype,\"alwaysRefetch\",void 0),e([s()],U.prototype,\"dpi\",void 0),e([s()],U.prototype,\"gdbVersion\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([s()],U.prototype,\"imageFormat\",void 0),e([o(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([s({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([s({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([s()],U.prototype,\"imageTransparency\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([s({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([s({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([s()],U.prototype,\"sourceJSON\",void 0),e([s({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([a(\"sublayers\",{layers:{type:[P]},visibleLayers:{type:[t]}})],U.prototype,\"writeSublayers\",null),e([s({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([s({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([s(j)],U.prototype,\"url\",void 0),U=e([i(\"esri.layers.MapImageLayer\")],U);var T=U;export default T;\n"],"sourceRoot":""}