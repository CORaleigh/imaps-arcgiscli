(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[8291],{12587:(t,e,i)=>{"use strict";i.d(e,{S:()=>d,b:()=>l});var r=i(85461),s=i(62213),n=i(51219),a=i(63230),o=i(61514),h=i(34658),c=i(20147);function l(t){const e=new n.kG;return e.include(s.w,{linearDepth:!1}),e.include(c.A.builder,{}),e.include(o.p,t),e.fragment.include(a.Y),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.fragment.uniforms.add("color","vec4"),e.attributes.add("position","vec3"),e.varyings.add("vWorldPosition","vec3"),t.screenSizeEnabled&&e.attributes.add("offset","vec3"),t.shadingEnabled&&(e.vertex.uniforms.add("viewNormal","mat4"),e.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),e.attributes.add("normal","vec3"),e.varyings.add("vViewNormal","vec3")),e.vertex.code.add(r.H`
    void main(void) {
      vWorldPosition = ${t.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),t.shadingEnabled&&e.vertex.code.add(r.H`
      vec3 worldNormal = normal;
      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;
    `),e.vertex.code.add(r.H`
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.fragment.code.add(r.H`
    void main() {
      discardBySlice(vWorldPosition);
    `),t.shadingEnabled?e.fragment.code.add(r.H`
      vec3 viewNormalNorm = normalize(vViewNormal);
      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
      vec4 finalColor = mix(color, shadedColor, shadingFactor);
    `):e.fragment.code.add(r.H`
      vec4 finalColor = color;
    `),e.fragment.code.add(r.H`
      if (finalColor.a < ${r.H.float(h.bf)}) {
        discard;
      }
      ${7===t.output?r.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===t.output?r.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${t.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),e}var d=Object.freeze({__proto__:null,build:l})},59492:(t,e,i)=>{"use strict";i.d(e,{Z:()=>R});var r=i(94588),s=i(59472),n=i(65575),a=i(61106),o=(i(36348),i(35470)),h=i(33655),c=i(96071),l=i(77625),d=i(17387),u=i(89333),p=i(67128),f=i(50897),_=i(17333),g=i(30663),m=i(12811),v=i(98501),y=i(14286),w=i(19132),b=i(8344),x=i(88),S=i(88909),T=i(90168),D=i(58722),M=i(89852);class R{constructor(t){this.camera=new T.Z,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,m.a)(),this._worldFrame=null,this._renderLocation=(0,l.c)(),this._renderLocationDirty=!0,this._location=new a.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new a.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new o.Z.EventEmitter,this._screenLocation={screenPointArray:(0,c.s1)(),renderScreenPointArray:(0,c.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayerId=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference;for(const e in t)this[e]=t[e];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(t){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=t.slice(),this._updateEngineObject()}set available(t){t!==this._available&&(this._available=t,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,n.IH)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(t){t!==this._radius&&(this._radius=t,this._updateEngineObject())}get radius(){return this._radius}set worldSized(t){t!==this._worldSized&&(this._worldSized=t,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(t){j(t)&&(this._screenLocationDirty=!0),(0,p.c)(this._modelTransform,t),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,m.a)()),function(t,e,i){switch(t.viewingMode){case"local":return(0,p.i)(i),!0;case"global":{const r=(0,u.Iu)(t.renderCoordsHelper.spatialReference);(0,_.C1)(e,0,A,0,r.radius),(0,_.tw)((0,h.Vl)(A[1]),(0,h.Vl)(A[0]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(t){this.view.renderCoordsHelper.fromRenderCoords(t,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(t){(0,D.WG)(t,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(t){(0,D.WG)(t,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const t=(0,s.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=t+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(t){t!==this._grabbing&&(this._grabbing=t,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(t){t!==this._hovering&&(this._hovering=t,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(t){t!==this._selected&&(this._selected=t,this._updateEngineObject(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._updateEngineObject())}updateStateEnabled(t,e){e?this.state|=t:this.state&=~t}_setFocused(t){t!==this._focused&&(this._focused=t,this.events.emit("focus-changed",{action:!0===t?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let t;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,j(this._modelTransform)){const e=this._calculateModelTransformOffset(N);t=(0,d.b)(e,e,this.renderLocation)}else t=this.renderLocation;this.camera.projectToRenderScreen(t,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(t){this._applyObjectTransform=t,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(t,e){if(!this.available)return null;const i=(0,c.md)(t,O),n=this._getCollisionRadius(e),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,y.j)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const t=this.collisionType.paths,e=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(e,C),o=n*this.screenLocation.pixelSize,h=x.kx.fromScreen(this.camera,i,L);if((0,s.Wi)(h))return null;for(const e of t){if(0===e.length)continue;const t=(0,d.i)(A,e[0],r);for(let i=1;i<e.length;i++){const s=(0,d.i)(I,e[i],r),n=x.KD.closestRayDistance2(x.KD.fromPoints(t,s,P),h);if(null!=n&&n<o*o){const e=(0,d.b)(b.WM.get(),t,s);(0,d.a)(e,e,.5);const i=(0,c.So)(b.WM.get());return this.camera.projectToRenderScreen(e,i),i[2]+a}(0,d.g)(t,s)}}break}case"disc":{var o;const t=this.collisionType.direction,e=null!=(o=this.collisionType.offset)?o:l.Z,r=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(r,C),c=n*this.screenLocation.pixelSize,u=x.kx.fromScreen(this.camera,i,L);if((0,s.Wi)(u))return null;const p=(0,v.f)(E,h),f=(0,d.t)(W,t,p),_=(0,d.i)(q,e,h);x.yC.fromPositionAndNormal(_,f,z);const g=V;if(x.yC.intersectRay(z,u,g)&&(0,d.h)(g,_)<c*c)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:t,direction:e}=this.collisionType,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,C),h=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=x.kx.fromScreen(this.camera,i,L);if((0,s.Wi)(l))return null;const u=(0,v.f)(E,o),p=(0,d.t)(W,e,u),f=this._calculateModelTransformPosition(q);x.yC.fromPositionAndNormal(f,p,z);const _=V;if(!x.yC.intersectRay(z,l,_))break;for(const e of t){if(0===e.length)continue;const t=(0,d.i)(A,e[0],o);for(let i=1;i<e.length;i++){const r=(0,d.i)(I,e[i],o),s=x.KD.distance2(x.KD.fromPoints(t,r,P),_);if(null!=s&&s<h*h){const e=(0,d.b)(b.WM.get(),t,r);(0,d.a)(e,e,.5);const i=(0,c.So)(b.WM.get());return this.camera.projectToRenderScreen(e,i),i[2]+a}(0,d.g)(t,r)}}break}default:(0,r.Bg)(this.collisionType)}return null}attach(t={manipulator3D:{}}){if(!this.view._stage)return;const e=t.manipulator3D;if(this._engineLayerId=e.engineLayerId,(0,s.Wi)(this._engineLayerId)){const t=new M.Z("manipulator-3d",{isPickable:!1});this.view._stage.add(0,t),this.view._stage.addToViewContent([t.id]),this._engineLayerId=t.id,e.engineLayerId=t.id}e.engineLayerReferences=(e.engineLayerReferences||0)+1,this._materialIdReferences=e.materialIdReferences,(0,s.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,e.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,_.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new a.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(t={manipulator3D:{}}){const e=t.manipulator3D;e.engineLayerReferences--;const i=0===e.engineLayerReferences;i&&(e.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayerId=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(t){(0,_.nF)(this.location,k,t.spatialReference),(0,f.Qn)(t.extent,k)&&(this.location=this._location)}_evaluateElevationAlignment(t=this.location){if((0,s.Wi)(this.elevationInfo))return!1;let e=null,i=0;const r=(0,s.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":e=(0,w.KO)(this.view.elevationProvider,t,"ground")||0;break;case"relative-to-ground":i=((0,w.KO)(this.view.elevationProvider,t,"ground")||0)+r;break;case"relative-to-scene":i=((0,w.KO)(this.view.elevationProvider,t,"scene")||0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||e!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=e,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const t=this._getWorldToScreenObjectScale(),e=C;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*t;this._calculateObjectTransform(i,e)}else this._calculateObjectTransform(t,e);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),s=this._noDisplayCount>0;for(const{stateMask:t,objects:n}of i){if(s){for(const t of n)t.setVisible(!1);continue}const i=!(0!=(15&t))||(r&t)==(15&t),a=!(0!=(65520&t))||(this.state&t)==(65520&t);if(i&&a)for(const t of n)t.setVisible(!0),t.objectTransformation=e;else for(const t of n)t.setVisible(!1)}}_ensureEngineResources(){if((0,s.Wi)(this._engineResources)){const t=this.view._stage.getContent(0,(0,s.Wg)(this._engineLayerId)),e=[],i=new Set;this.renderObjects.forEach((({material:t})=>{i.has(t)||(e.push(t),i.add(t))}));const r=(t,e)=>{const{geometry:i,material:r,transform:s}=e;Array.isArray(i)?i.forEach((e=>t.addGeometry(e,r,s))):t.addGeometry(i,r,s)},n=new Map;this.renderObjects.forEach((t=>{const e=new S.Z({idHint:"manipulator",castShadow:!1});r(e,t);const i=t.stateMask||0,s=n.get(i)||[];s.push(e),n.set(i,s)}));const a=[];n.forEach(((t,e)=>{a.push({stateMask:e,objects:t})})),this._engineResources={objectsByState:a,layer:t,materials:e}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||(0,s.Wi)(this._engineResources))return;const{objectsByState:t,layer:e,materials:i}=this._engineResources;i.forEach((t=>{const e=(0,s.Wg)(this._materialIdReferences),i=e.get(t.id)||0;0===i&&this.view._stage.add(3,t),e.set(t.id,i+1)})),t.forEach((({objects:t})=>{t.forEach((t=>{e.addObject(t),this.view._stage.add(1,t)}))})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(t=!1){if(!this._engineResourcesAddedToStage||(0,s.Wi)(this._engineResources))return;const{objectsByState:e,layer:i,materials:r}=this._engineResources;e.forEach((({objects:t})=>{t.forEach((t=>{i.removeObject(t),this.view._stage.remove(1,t.id)}))})),r.forEach((t=>{const e=(0,s.Wg)(this._materialIdReferences),i=e.get(t.id);1===i?(this.view._stage.remove(3,t.id),e.delete(t.id)):e.set(t.id,i-1)})),t&&this.view._stage.remove(0,i.id),this._engineResourcesAddedToStage=!1}_getCollisionRadius(t){return this._getFocusedSize(this.radius,!0)*("touch"===t?this.touchMultiplier:1)}_getFocusedSize(t,e){return t*(e?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(t){const e=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(e,F);return(0,d.s)(t,i[12],i[13],i[14])}_calculateModelTransformOffset(t){const e=this._calculateModelTransformPosition(t);return(0,d.f)(t,e,this.renderLocation)}_calculateObjectTransform(t,e){return(0,p.d)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1),this._worldFrame&&(0,p.m)(e,e,this._worldFrame),(0,p.m)(e,e,this._modelTransform),e[12]+=this.renderLocation[0],e[13]+=this.renderLocation[1],e[14]+=this.renderLocation[2],e[15]=1,(0,s.pC)(this._applyObjectTransform)&&this._applyObjectTransform(e),e}get test(){let t=!1;if((0,s.pC)(this._engineResources))for(const e in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[e];for(const e of i.objects)if(e.isVisible){t=!0;break}if(t)break}return{areAnyResourcesVisible:t}}}function j(t){return 0!==t[12]||0!==t[13]||0!==t[14]}const O=(0,c.s1)(),P=x.KD.create(),L=x.kx.create(),E=(0,g.a)(),F=(0,m.a)(),C=(0,m.a)(),z=x.yC.create(),A=(0,l.c)(),I=(0,l.c)(),V=(0,l.c)(),W=(0,l.c)(),q=(0,l.c)(),N=(0,l.c)(),k=new a.Z({x:0,y:0,z:0,spatialReference:null})},34937:(t,e,i)=>{"use strict";i.d(e,{J4:()=>b,gv:()=>x,G:()=>m,_y:()=>y,VG:()=>v,_N:()=>g,Sp:()=>w});var r=i(59472),s=i(61106),n=(i(36348),i(33655)),a=i(96071),o=i(77625),h=i(17387),c=i(17333),l=i(46970),d=i(8344),u=i(88),p=i(81495),f=i(67134),_=i(53640);function g(t,e){const i=(0,o.c)(),s=(0,o.c)();let n=!1;return o=>{if("start"===o.action){const s=(0,a.md)(o.screenStart,(0,a.c$)(d.qW.get())),h=u.kx.fromScreen(t.state.camera,s,D);(0,r.pC)(h)&&(n=u.yC.intersectRay(e,h,i))}if(!n)return null;const h=(0,a.md)(o.screenEnd,(0,a.c$)(d.qW.get())),c=u.kx.fromScreen(t.state.camera,h,D);return(0,r.Wi)(c)?null:u.yC.intersectRay(e,c,s)?{...o,renderStart:i,renderEnd:s,plane:e,ray:c}:null}}function m(t,e,i,s=null){return function(t,e,i,s=null){let n=null;return o=>{if("start"===o.action&&(n=t.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(o.screenStart.x,o.screenStart.y),e,i),(0,r.pC)(n)&&(0,r.pC)(s)&&!(0,c.nF)(n,n,s)))return null;if((0,r.Wi)(n))return null;const h=t.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(o.screenEnd.x,o.screenEnd.y),e,i);return(0,r.pC)(h)?(0,r.pC)(s)&&!(0,c.nF)(h,h,s)?null:{...o,mapStart:n,mapEnd:h}:null}}(t,i,(0,l.Ou)(e,t,i),s)}function v(t,e,i,r=null){return m(t,i,(0,l.RL)(e),r)}function y(t,e,i,s){const n=e.toMap(t.screenStart,{include:[i]});return(0,r.pC)(n)?v(e,i,n,s):null}function w(t,e,i){let a=null;const c=new _.hM;return c.next(g(t,function(t,e){const i=S,r=T,s=u.yC.create();t.renderCoordsHelper.worldUpAtPosition(e,i);const n=(0,h.c)(s,i,(0,h.f)(r,e,t.state.camera.eye));return(0,h.c)(n,n,i),u.yC.fromPositionAndNormal(e,n,s)}(t,e))).next(function(t,e){const i=(0,o.c)(),r=(0,h.l)(e);t.renderCoordsHelper.worldUpAtPosition(e,i);const s=(0,o.c)(),a=(0,o.c)(),c=s=>((0,h.f)(s,s,e),u.xr.projectPoint(i,s,s),"global"===t.viewingMode&&(0,h.l)(s)*(0,n.Xx)((0,h.d)(i,s))<.001-r&&(0,h.f)(s,(0,h.a)(s,i,.001),e),(0,h.b)(s,s,e),s);return t=>(t.renderStart=c((0,h.g)(s,t.renderStart)),t.renderEnd=c((0,h.g)(a,t.renderEnd)),t)}(t,e)).next(function(t,e){const i=t.renderCoordsHelper;return t=>{const n=i.fromRenderCoords(t.renderStart,new s.Z,e),a=i.fromRenderCoords(t.renderEnd,new s.Z,e);return(0,r.pC)(n)&&(0,r.pC)(a)?{...t,mapStart:n,mapEnd:a}:null}}(t,i)).next((t=>{t.mapEnd.x=t.mapStart.x,t.mapEnd.y=t.mapStart.y,a=t})),t=>(a=null,c.execute(t),a)}function b(t){let e=null;return i=>{switch(i.action){case"start":e=t.disableDisplay();break;case"end":case"cancel":(0,r.pC)(e)&&(e.remove(),e=null)}return i}}function x(t,e=null){let i=null;const n=new f.r(t.state.mode);n.options.selectionMode=!0,n.options.store=0;const h=(0,a.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,o.c)(),d=(0,r.Pt)(e,t.spatialReference),u=e=>{t.map.ground&&t.map.ground.opacity<1?c.exclude.add(p.cy):c.exclude.delete(p.cy),t.sceneIntersectionHelper.intersectIntersectorScreen((0,a.md)(e,h),n,c);const i=n.results.min;let r;if(i.getIntersectionPoint(l))r="TerrainRenderer"===i.intersector?0:1;else{if(!n.results.ground.getIntersectionPoint(l))return null;r=0}const o=new s.Z({spatialReference:d});return t.renderCoordsHelper.fromRenderCoords(l,o),{location:o,surfaceType:r}};return t=>{if("start"===t.action){const e=u(t.screenStart);i=(0,r.pC)(e)?e.location:null}if((0,r.Wi)(i))return null;const e=u(t.screenEnd);return(0,r.pC)(e)?{...t,mapStart:i,mapEnd:e.location,surfaceType:e.surfaceType}:null}}const S=(0,o.c)(),T=(0,o.c)(),D=u.kx.create()},50777:(t,e,i)=>{"use strict";i.d(e,{Gd:()=>v,EA:()=>_,qJ:()=>g,aD:()=>m,du:()=>y,u2:()=>w});var r=i(59472),s=i(17387),n=i(67128),a=i(38256),o=i(8344),h=i(39746),c=i(58722),l=i(74218),d=i(68500),u=i(94589),p=i(59492),f=i(81016);function _(t,e=4){const i=(0,a.b)(t[0],t[1],t[2],t.length>3?t[3]:1),r=t[3]<1;return new f.Q({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:e},"manipulator")}function g(t,e=4){const i=(0,a.b)(t[0],t[1],t[2],4===t.length?t[3]:1);return new u.E({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:e},"manipulator-outline")}function m(t,e,i){return new p.Z({view:t,renderObjects:[{geometry:new d.Z(h.Z.createSphereGeometry(1,32,32),"manipulator"),material:_((0,a.b)(e[0],e[1],e[2],null!=i?i:1))}]})}function v(t,e,i,r){const a=(0,s.f)(o.WM.get(),t,i),h=function(t,e,i,r){const n=(0,s.n)(o.WM.get(),t),a=(0,s.n)(o.WM.get(),e),h=(0,s.c)(o.WM.get(),n,a);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=h[0],r[9]=h[1],r[10]=h[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}(a,(0,s.c)(o.WM.get(),r,a),i,o.MP.get());(0,n.a)(h,h);const c=(0,s.i)(o.WM.get(),e,h);return Math.atan2(c[1],c[0])}function y(t,e){const i=t.getViewForGraphic(e);return(0,r.pC)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(e,t.spatialReference):null}function w(t,e,i){const s=y(t,i);(0,r.pC)(s)?e.elevationAlignedLocation=s:function(t,e){if((0,r.Wi)(e))return;const i=(0,l.zE)(e);(0,r.Wi)(i)||(t.location=(0,c.kB)(i))}(e,i.geometry)}},20147:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var r,s=i(85461);!function(t){t.builder=function(t,e){t.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),t.vertex.code.add(s.H`
    float computeRenderPixelSizeAt( vec3 pWorld ){
      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
      return viewDirectionDistance*perScreenPixelRatio;
    }

    vec3 screenSizeScaling(vec3 position, vec3 anchor){
      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
    }
  `)},t.bindPassUniforms=function(t,e,i){t.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),t.setUniform1f("screenSize",e.screenSize)}}(r||(r={}))},90168:(t,e,i)=>{"use strict";i.d(e,{Z:()=>T});var r=i(59472),s=i(33655),n=i(96071),a=i(77625),o=i(17387),h=i(17154),c=i(67128),l=i(12811),d=i(55735),u=i(38256),p=i(14286),f=i(34353),_=i(69987),g=i(88),m=i(56469);class v{constructor(t=null,e=null,i=null){this._viewUp=(0,a.c)(),this._viewForward=(0,a.c)(),this._viewRight=(0,a.c)(),this._ray=g.kx.createWrapper(),this._viewport=(0,u.b)(0,0,1,1),this._padding=(0,u.b)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,d.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,l.a)(),this._projectionDirty=!0,this._projectionMatrix=(0,l.a)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,l.a)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,l.a)(),this._frustumDirty=!0,this._frustum=g.oy.create(),this._fullViewport=(0,u.a)(),this._contextNavigation=!0,this.pixelRatio=1,this.relativeElevation=0,this._eye=(0,r.pC)(t)?(0,a.b)(t):(0,a.c)(),this._center=(0,r.pC)(e)?(0,a.b)(e):(0,a.c)(),this._up=(0,r.pC)(i)?(0,a.b)(i):(0,a.f)(0,0,1)}get eye(){return this._eye}set eye(t){this._compareAndSetView(t,this._eye)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=(0,a.c)()),(0,o.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){(0,c.c)(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[3],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[2],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[0]===t[0]&&this._padding[1]===t[1]&&this._padding[2]===t[2]&&this._padding[3]===t[3]||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),(0,f.c)(this._padding,t),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,c.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;(0,c.h)(this._projectionMatrix,-r*(1+2*this._padding[3]/t),r*(1+2*this._padding[1]/t),-i*(1+2*this._padding[2]/e),i*(1+2*this._padding[0]/e),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(t){(0,c.c)(this._projectionMatrix,t),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,m.tM)(this._fov,this.width,this.height)}set fovX(t){this._fov=(0,m.Kj)(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,m.RQ)(this._fov,this.width,this.height)}set fovY(t){this._fov=(0,m.zF)(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,o.k)(this._center,this._eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,c.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,c.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){const e=t;return(0,o.g)(this._eye,e._eye),(0,o.g)(this._center,e._center),(0,o.g)(this._up,e._up),(0,f.c)(this._viewport,e._viewport),(0,f.c)(this._padding,e._padding),(0,p.c)(this._nearFar,e._nearFar),this._fov=e._fov,this.relativeElevation=t.relativeElevation,this._viewDirty=e._viewDirty,this._viewDirty||((0,c.c)(this._viewMatrix,e._viewMatrix),(0,o.g)(this._viewRight,e._viewRight),(0,o.g)(this._viewUp,e._viewUp),(0,o.g)(this._viewForward,e._viewForward)),e._projectionDirty?this._projectionDirty=!0:((0,c.c)(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(g.oy.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,c.c)(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,f.c)(this._fullViewport,e._fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return(new v).copyFrom(this)}equals(t){return(0,o.m)(this._eye,t._eye)&&(0,o.m)(this._center,t._center)&&(0,o.m)(this._up,t._up)&&(0,f.g)(this._viewport,t._viewport)&&(0,f.g)(this._padding,t._padding)&&(0,p.k)(this._nearFar,t._nearFar)&&this._fov===t._fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this.pixelRatio!==t.pixelRatio||Math.abs(t._fov-this._fov)>=.001)return!1;const e=5e-4;(0,o.r)(b,t._eye,t._center),(0,o.r)(x,this._eye,this._center);const i=(0,o.d)(b,x),r=(0,o.u)(b),s=(0,o.u)(x);return i*i>=(1-1e-10)*r*s&&(0,o.v)(t._eye,this._eye)<Math.max(r,s)*e*e&&(0,f.i)(t._padding,this._padding)<.5&&(0,f.i)(t._viewport,this._viewport)<.5}markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(t))}viewDirectionDistance(t){return Math.abs((0,_.p)(this.viewForward,(0,o.f)(b,t,this._eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=(0,n.s1)()){return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t||(t=(0,n.J$)()),t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t.length>2&&(t[2]=.5),t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e,i=!1){t!==y&&(0,o.g)(y,t),y[3]=1,i&&(e[2]=-y[2]),(0,f.t)(y,y,this.projectionMatrix),(0,o.a)(y,y,1/Math.abs(y[3]));const r=this.fullViewport;return e[0]=(0,s.t7)(0,r[0]+r[2],.5+.5*y[0]),e[1]=(0,s.t7)(0,r[1]+r[3],.5+.5*y[1]),i||(e[2]=.5*(y[2]+1)),e}projectToScreen(t,e){return this.projectToRenderScreen(t,S),this.renderToScreen(S,e)}projectToRenderScreen(t,e){if(y[0]=t[0],y[1]=t[1],y[2]=t[2],y[3]=1,(0,f.t)(y,y,this.viewProjectionMatrix),0===y[3])return null;(0,o.a)(y,y,1/Math.abs(y[3]));const i=this.fullViewport;return"x"in e?(e.x=(0,s.t7)(0,i[0]+i[2],.5+.5*y[0]),e.y=(0,s.t7)(0,i[1]+i[3],.5+.5*y[1])):(e[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*y[0]),e[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*y[1]),e.length>2&&(e[2]=.5*(y[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,S),e)}unprojectFromRenderScreen(t,e){if((0,c.m)(w,this.projectionMatrix,this.viewMatrix),!(0,c.a)(w,w))return null;const i=this.fullViewport;return y[0]=2*(t[0]-i[0])/i[2]-1,y[1]=2*(t[1]-i[1])/i[3]-1,y[2]=2*t[2]-1,y[3]=1,(0,f.t)(y,y,w),0===y[3]?null:(e[0]=y[0]/y[3],e[1]=y[1]/y[3],e[2]=y[2]/y[3],e)}constrainWindowSize(t,e,i,r=1){const s=t*this.pixelRatio,n=e*this.pixelRatio,a=Math.max(s-i*r/2,0),o=Math.max(this.fullHeight-n-i/2,0),h=-Math.min(s-i*r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[a,o,i*r-h- -Math.min(this.fullWidth-s-i*r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){1===t?this.computeUpGlobal():this.computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;return e[0]=i,e[1]=r,e}computeUpGlobal(){(0,o.f)(b,this.center,this.eye);const t=(0,o.l)(this.center);t<1?((0,o.s)(this.up,0,0,1),this.markViewDirty()):Math.abs((0,o.d)(b,this.center))>.9999*(0,o.l)(b)*t||((0,o.c)(this.up,b,this.center),(0,o.c)(this.up,this.up,b),(0,o.n)(this.up,this.up),this.markViewDirty())}computeUpLocal(){(0,h.tB)(b,this.eye,this.center),Math.abs(b[2])<=.9999&&((0,o.a)(b,b,b[2]),(0,o.s)(this.up,-b[0],-b[1],1-b[2]),(0,o.n)(this.up,this.up),this.markViewDirty())}_compareAndSetView(t,e){(0,o.m)(t,e)||((0,o.g)(e,t),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}_recomputeFrustum(){this._frustumDirty&&(g.oy.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,c.l)(this._viewMatrix,this._eye,this._center,this._up),(0,o.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,o.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,o.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const y=(0,u.a)(),w=(0,l.a)(),b=(0,a.c)(),x=(0,a.c)(),S=(0,n.J$)(),T=v},67134:(t,e,i)=>{"use strict";i.d(e,{r:()=>l});i(95830);var r=i(59472),s=i(77625),n=i(17387),a=i(12811),o=i(88),h=i(49366),c=i(81495);class l{constructor(t){this.options=new c.om,this.results=new c.LV,this.transform=new c.yn,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=1e-5,this.verticalOffset=null,this._ray={origin:(0,s.c)(),direction:(0,s.c)()},this._rayEndPoint=(0,s.c)(),this._rayStartPointTransformed=(0,s.c)(),this._rayEndPointTransformed=(0,s.c)(),this.viewingMode=null==t?1:t}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(t,e){this.resetWithRay(o.kx.fromPoints(t,e,this._ray))}resetWithRay(t){t!==this._ray&&o.kx.copy(t,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,n.b)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(t,e,i,s,n,a){this.point=e,this.camera=i,this.filterPredicate=n,this.tolerance=null==s?1e-5:s;const o=(0,c.W9)(this.verticalOffset),h=a?t=>{a(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};if(t&&t.length>0)for(const e of t){const t=e.getSpatialQueryAccelerator&&e.getSpatialQueryAccelerator();if(t)(0,r.pC)(o)?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,h,o):t.forEachAlongRay(this._ray.origin,this._ray.direction,h),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(h);else{const t=e.getObjects();for(const e of t)h(e)}}this.sortResults()}intersectObject(t){this._numObjectsTested++;const e=t.geometryRecords;if(!e)return;const i=t.id,s=t.objectTransformation;let o;const l=(0,c.W9)(this.verticalOffset);for(const d of e){const{geometry:e,material:u,instanceParameters:p}=d;if((0,h.PD)(p))continue;o=e.id,this.transform.setAndInvalidateLazyTransforms(s,d.getShaderTransformation()),(0,n.i)(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),(0,n.i)(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const f=this.transform.transform;(0,r.pC)(l)&&(l.objectTransform=this.transform),u.intersect(e,p,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,((e,s,n,h,l,d)=>{if(e>=0){if((0,r.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,e))return;if(l)return void((null==this.results.hud.dist||e<this.results.hud.dist)&&this.results.hud.set(t,i,e,s,a.I,h,d,o,n));const u=r=>r.set(t,i,e,s,f,h,null,o,n);if((null==this.results.min.drapedLayerOrder||h>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||e<this.results.min.dist)&&u(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||h<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||e>this.results.max.dist)&&u(this.results.max),2===this.options.store){const t=new c.xM(this._ray);u(t),this.results.all.push(t)}}}),d.shaderTransformation)}}sortResults(){this.results.all.sort(((t,e)=>t.dist!==e.dist?t.dist-e.dist:t.drapedLayerOrder!==e.drapedLayerOrder?(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE):(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}l.DEFAULT_TOLERANCE=1e-5},81495:(t,e,i)=>{"use strict";i.d(e,{om:()=>v,xM:()=>x,LV:()=>b,yn:()=>y,cy:()=>R,W9:()=>M});var r=i(59472),s=i(77625),n=i(17387),a=i(67128),o=i(30663),h=i(12811),c=i(32232),l=i(38256),d=i(98501),u=i(34353),p=i(2847),f=i(69236),_=(i(55534),i(13633)),g=i(88),m=i(88909);class v{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}class y{constructor(){this._transform=(0,h.a)(),this._transformInverse=new w({value:this._transform},a.a,h.a),this._transformInverseTranspose=new w(this._transformInverse,a.b,h.a),this._transformTranspose=new w({value:this._transform},a.b,h.a),this._transformInverseRotation=new w({value:this._transform},d.b,o.a)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){(0,a.c)(this._transform,t)}multiplyTransform(t){(0,a.m)(this._transform,this._transform,t)}set(t){(0,a.c)(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this.invalidateLazyTransforms()}}class w{constructor(t,e,i){this.original=t,this.update=e,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class b{constructor(){this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}init(t){this.min.init(t),this.max.init(t),this.hud.init(t),this.ground.init(t),this.all=[]}}class x{constructor(t){this.normal=(0,s.c)(),this.transformation=(0,h.a)(),this._ray=g.kx.create(),this.init(t)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return(0,n.a)(j,this.ray.direction,this.dist),(0,n.l)(j)}getIntersectionPoint(t){return!!this.hasIntersectionPoint&&((0,n.a)(j,this.ray.direction,this.dist),(0,n.b)(t,this.ray.origin,j),!0)}getTransformedNormal(t){return(0,n.g)(O,this.normal),O[3]=0,(0,u.t)(O,O,this.transformation),(0,n.g)(t,O),(0,n.n)(t,t),t}init(t){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",t?g.kx.copy(t,this._ray):this._ray=g.kx.create()}set(t,e,i,r,o,h,c,l,d,u){t instanceof m.Z&&(t={type:"stage",obj:t}),this.dist=i,(0,n.g)(this.normal,r),(0,a.c)(this.transformation,o),this.target=t,this.name=e,this.drapedLayerOrder=h,this.center=c?(0,s.b)(c):null,this.geometryId=l,this.triangleNr=d,this.drapedLayerGraphicOrder=u}copyFrom(t){g.kx.copy(t._ray,this._ray),this.dist=t.dist,this.target=t.target,this.name=t.name,this.drapedLayerOrder=t.drapedLayerOrder,this.center=t.center?(0,s.b)(t.center):null,this.geometryId=t.geometryId,this.triangleNr=t.triangleNr,this.intersector=t.intersector,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,(0,n.g)(this.normal,t.normal),(0,a.c)(this.transformation,t.transformation)}toOwner(t){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return function(t,e){const i=t.metadata.layerUid;return null!=i?e.map.findLayerByUid(i):null}(this.target,t);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,t);case"TerrainRenderer":return t.map&&t.map.ground}}return null}toGraphic(t){if(!this.target)return null;switch(this.target.type){case"stage":return T(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return T(this.target.metadata,t)}}return null}}function S(t,e){return(0,r.Wi)(t)||null==t.layerUid?null:(0,r.pC)(e.graphicsView)&&t.layerUid===e.graphicsView.mockLayerId?e.graphics:e.map.findLayerByUid(t.layerUid)}function T(t,e){if((0,r.Wi)(t))return null;const i=S(t,e);if((0,r.Wi)(i))return null;if(i===e.graphics)return(0,r.pC)(e.graphicsView)?(0,r.Wg)(e.graphicsView.getGraphicFromGraphicUid(t.graphicUid)):null;const s=e.allLayerViews.find((t=>t.layer===i));return s?function(t,e){return!t||t.suspended?null:"getGraphicFromIntersectorMetadata"in t&&e?t.getGraphicFromIntersectorMetadata(e):"getGraphicFromGraphicUid"in t&&null!=e.graphicUid?t.getGraphicFromGraphicUid(e.graphicUid):null}(s,t):null}const D=new class{constructor(t=0){this.offset=t,this.sphere=(0,_.c)(),this.tmpVertex=(0,s.c)()}applyToVertex(t,e,i){const r=this.objectTransform.transform;let s=r[0]*t+r[4]*e+r[8]*i+r[12],n=r[1]*t+r[5]*e+r[9]*i+r[13],a=r[2]*t+r[6]*e+r[10]*i+r[14];const o=this.offset/Math.sqrt(s*s+n*n+a*a);s+=s*o,n+=n*o,a+=a*o;const h=this.objectTransform.inverse;return this.tmpVertex[0]=h[0]*s+h[4]*n+h[8]*a+h[12],this.tmpVertex[1]=h[1]*s+h[5]*n+h[9]*a+h[13],this.tmpVertex[2]=h[2]*s+h[6]*n+h[10]*a+h[14],this.tmpVertex}applyToMinMax(t,e){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t,e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/i;return this.sphere.center[0]=e[0]+e[0]*r,this.sphere.center[1]=e[1]+e[1]*r,this.sphere.center[2]=e[2]+e[2]*r,this.sphere.radius=t+t*this.offset/i,this.sphere}};function M(t){return(0,r.pC)(t)?(D.offset=t,D):null}new class{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=(0,s.c)(),this.mbs=(0,l.a)(),this.obb={center:(0,s.c)(),halfSize:(0,f.c)(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,e,i){const r=t,s=e,n=i+this.componentLocalOriginLength,a=this.offset/Math.sqrt(r*r+s*s+n*n);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=e+s*a,this.tmpVertex[2]=i+n*a,this.tmpVertex}applyToAabb(t){const e=t[0],i=t[1],r=t[2]+this.componentLocalOriginLength,s=t[3],n=t[4],a=t[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(e*e+i*i+r*r);t[0]+=e*o,t[1]+=i*o,t[2]+=r*o;const h=this.offset/Math.sqrt(s*s+n*n+a*a);return t[3]+=s*h,t[4]+=n*h,t[5]+=a*h,t}applyToMbs(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/e;return this.mbs[0]=t[0]+t[0]*i,this.mbs[1]=t[1]+t[1]*i,this.mbs[2]=t[2]+t[2]*i,this.mbs[3]=t[3]+t[3]*this.offset/e,this.mbs}applyToObb(t){const e=t.center,i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this.obb.center[0]=e[0]+e[0]*i,this.obb.center[1]=e[1]+e[1]*i,this.obb.center[2]=e[2]+e[2]*i,(0,n.q)(this.obb.halfSize,t.halfSize,t.quaternion),(0,n.b)(this.obb.halfSize,this.obb.halfSize,t.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,(0,n.f)(this.obb.halfSize,this.obb.halfSize,t.center),(0,p.c)(P,t.quaternion),(0,n.q)(this.obb.halfSize,this.obb.halfSize,P),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}};new class{constructor(t=0){this.offset=t,this.tmpVertex=(0,s.c)()}applyToVertex(t,e,i){const r=t+this.localOrigin[0],s=e+this.localOrigin[1],n=i+this.localOrigin[2],a=this.offset/Math.sqrt(r*r+s*s+n*n);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=e+s*a,this.tmpVertex[2]=i+n*a,this.tmpVertex}applyToAabb(t){const e=t[0]+this.localOrigin[0],i=t[1]+this.localOrigin[1],r=t[2]+this.localOrigin[2],s=t[3]+this.localOrigin[0],n=t[4]+this.localOrigin[1],a=t[5]+this.localOrigin[2],o=this.offset/Math.sqrt(e*e+i*i+r*r);t[0]+=e*o,t[1]+=i*o,t[2]+=r*o;const h=this.offset/Math.sqrt(s*s+n*n+a*a);return t[3]+=s*h,t[4]+=n*h,t[5]+=a*h,t}};const R="terrain",j=((0,s.c)(),(0,s.c)()),O=(0,l.a)(),P=(0,c.a)()},81016:(t,e,i)=>{"use strict";i.d(e,{Q:()=>f});var r=i(77625),s=i(17387),n=i(12608),a=i(69996),o=i(80905),h=i(56469),c=i(26701),l=i(30090),d=i(10762),u=i(13405),p=i(65148);class f extends d.F5{constructor(t,e){super(e,t,g),this.supportsEdges=!0,this.techniqueConfig=new p.e0,this._vertexAttributeLocations=p.Yq}getTechniqueConfig(t,e){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig}getPassParameters(){return this.params}intersect(t,e,i,r,n,o,h){if(this.params.screenSizeEnabled){const i=t.getAttribute(p.YN.OFFSET),c={applyToVertex:(t,e,n,a)=>{const o=(0,s.s)(v,i.data[3*a+0],i.data[3*a+1],i.data[3*a+2]),h=(0,s.s)(y,t,e,n);return(0,s.a)(o,o,this.params.screenSize*r.camera.computeRenderPixelSizeAt(o)),(0,s.b)(h,h,o),[h[0],h[1],h[2]]},applyToAabb:t=>{const e=(0,a.be)(t,v);return(0,a.bA)(t,this.params.screenSize*r.camera.computeRenderPixelSizeAt(e))}};(0,l.Bw)(t,e,r,n,o,c,h)}else(0,l.Bw)(t,e,r,n,o,void 0,h)}getGLMaterial(t){return 0===t.output||7===t.output||4===t.output?new _(t):void 0}createBufferWriter(){return new m(this.params.screenSizeEnabled)}}class _ extends c.Z{constructor(t){super(t),this.updateParameters()}updateParameters(t){this.technique=this.techniqueRep.acquireAndReleaseExisting(p.UB,this.material.getTechniqueConfig(this.output,t),this.technique)}beginSlot(t){if(4===this.output)return 3===t;let e=3;return this.technique.configuration.transparent&&(e=this.technique.configuration.writeDepth?5:8),t===e}ensureParameters(t){this.updateParameters(t)}bind(t,e){t.bindProgram(this.technique.program),this.technique.bindPass(t,this.material.getPassParameters(),e)}}const g={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:(0,s.n)((0,r.c)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...d.zh};class m{constructor(t){this.screenSizeEnabled=t;const e=(0,o.U$)().vec3f(p.YN.POSITION).vec3f(p.YN.NORMAL);this.screenSizeEnabled&&e.vec3f(p.YN.OFFSET),this.vertexBufferLayout=e}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices[p.YN.POSITION].length}write(t,e,i,r){if((0,u.NK)(e,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,r),this.screenSizeEnabled){if(!(p.YN.OFFSET in e.vertexAttr))throw new Error(`${p.YN.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const s=e.vertexAttr[p.YN.OFFSET],a=e.indices[p.YN.OFFSET];(0,h.hu)(3===s.size);const o=i.getField(p.YN.OFFSET,n.ct);if(!o)throw new Error("unable to acquire view for "+p.YN.OFFSET);(0,u.ho)(a,s.data,t.invTranspTransformation,o,r)}}}}const v=(0,r.c)(),y=(0,r.c)()},48430:(t,e,i)=>{"use strict";i.d(e,{h0:()=>n,i2:()=>a,z5:()=>o});i(95830);var r=i(59472),s=(i(5627),i(8634));i(84570),i(89930);class n{constructor(){this.cache=new Map}dispose(){this.cache.forEach((t=>{(0,r.pC)(t.texture)&&(t.texture.dispose(),t.texture=null)})),this.cache.clear()}acquire(t){if((0,r.Wi)(t))return null;const e=this.patternId(t),i=this.cache.get(e);if(i)return i.refCount++,i.bind;const n=this.patternToTextureData(t,2),a=n.length/2,o={refCount:1,texture:null,bind:(t,e)=>((0,r.Wi)(o.texture)&&(o.texture=new s.Z(t,{width:n.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},n)),t.bindTexture(o.texture,e),a)};return this.cache.set(e,o),o.bind}release(t){if((0,r.Wi)(t))return;const e=this.patternId(t),i=this.cache.get(e);i&&(i.refCount--,0===i.refCount&&((0,r.pC)(i.texture)&&i.texture.dispose(),this.cache.delete(e)))}swap(t,e){const i=this.acquire(e);return this.release(t),i}patternId(t){return t.join(",")}patternToTextureData(t,e){const i=t.reduce(((t,e)=>t+e))*e,r=new Uint8Array(i);let s=!0,n=0;for(const i of t){for(let t=0;t<i*e;t++)r[n++]=s?255:0;s=!s}return r}}function a(t){return(0,r.Wi)(t)?t:t.slice()}function o(t){return[t,t]}},65148:(t,e,i)=>{"use strict";i.d(e,{UB:()=>_,e0:()=>g,YN:()=>m,Yq:()=>v});var r=i(56140),s=i(38256),n=i(23240),a=i(97853),o=i(44801),h=i(51007),c=i(36904),l=i(89553),d=i(61514),u=i(66704),p=i(20147),f=i(12587);class _ extends a.A{initializeProgram(t){const e=_.shader.get(),i=this.configuration,r=e.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType});return new h.Z(t.rctx,r.generateSource("vertex"),r.generateSource("fragment"),v)}bindPass(t,e,i){const{screenSizeEnabled:r,shadingEnabled:s}=this.configuration,{color:n,shadingTint:a,shadingDirection:o}=e;l.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",n),s&&(this.program.setUniform4fv("shadedColor",this.blendColor(y,a,n)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),r&&p.A.bindPassUniforms(this.program,e,i)}blendColor(t,e,i){const r=1-e[3],s=e[3]+i[3]*r;return 0===s?(t[3]=s,t):(t[0]=(e[0]*e[3]+i[0]*i[3]*r)/s,t[1]=(e[1]*e[3]+i[1]*i[3]*r)/s,t[2]=(e[2]*e[3]+i[2]*i[3]*r)/s,t[3]=i[3],t)}bindDraw(t){l.G.bindView(this.program,t),l.G.bindCamPosition(this.program,t.origin,t.camera.viewInverseTransposeMatrix),d.p.bindUniformsWithOrigin(this.program,this.configuration,t)}setPipelineState(t){const e=this.configuration,i=3===t,r=2===t;return(0,c.sm)({blending:0!==e.output&&7!==e.output||!e.transparent?null:i?u.wu:(0,u.$L)(t),culling:(s=e.cullFace,0!==s&&{face:1===s?1028:1029,mode:2305}),depthTest:{func:r?513:e.shadingEnabled?515:513},depthWrite:i?e.writeDepth&&c.LZ:(0,u.Vc)(t),colorWrite:c.BK,polygonOffset:i||r?null:u.E0});var s}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}_.shader=new n.J(f.S,(()=>i.e(5316).then(i.bind(i,35316))));class g extends o.m{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3}}(0,r._)([(0,o.o)({count:8})],g.prototype,"output",void 0),(0,r._)([(0,o.o)({count:3})],g.prototype,"cullFace",void 0),(0,r._)([(0,o.o)()],g.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,o.o)()],g.prototype,"sliceHighlightDisabled",void 0),(0,r._)([(0,o.o)()],g.prototype,"transparent",void 0),(0,r._)([(0,o.o)()],g.prototype,"writeDepth",void 0),(0,r._)([(0,o.o)()],g.prototype,"screenSizeEnabled",void 0),(0,r._)([(0,o.o)()],g.prototype,"shadingEnabled",void 0),(0,r._)([(0,o.o)({count:4})],g.prototype,"transparencyPassType",void 0);const m={POSITION:"position",NORMAL:"normal",OFFSET:"offset"},v={position:0,normal:1,offset:2},y=(0,s.a)()}}]);
//# sourceMappingURL=8291.js.map