(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[9655],{12973:(e,t,r)=>{"use strict";r.d(t,{V:()=>s});var n=r(34926),i=r(10923);r(54721);function s(e){return(0,i.v_)(n.Z.assetsPath,e)}},23229:(e,t,r)=>{"use strict";r.d(t,{Hg:()=>y,uD:()=>p,V7:()=>m});var n=r(59472),i=r(65575),s=r(82677),o=r(83477);const a=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function l(e){return e instanceof s.default}function d(e){return e instanceof o.Z?Object.keys(e.items):l(e)?(0,i.vw)(e).keys():e?Object.keys(e):[]}function u(e,t){return e instanceof o.Z?e.items[t]:e[t]}function h(e){return e?e.declaredClass:null}function c(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=d(e),s=d(t);if(0===i.length&&0===s.length)return;if(!i.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const o=s.filter((e=>-1===i.indexOf(e))),p=i.filter((e=>-1===s.indexOf(e))),m=i.filter((r=>s.indexOf(r)>-1&&u(e,r)!==u(t,r))).concat(o,p).sort(),y=h(e);if(y&&a.indexOf(y)>-1&&m.length)return{type:"complete",oldValue:e,newValue:t};let f;const g=l(e)&&l(t);for(const i of m){const s=u(e,i),o=u(t,i);let a;(g||"function"!=typeof s&&"function"!=typeof o)&&s!==o&&(null==s&&null==o||(a=r&&r[i]&&"function"==typeof r[i]?r[i](s,o):"object"==typeof s&&"object"==typeof o&&h(s)===h(o)?c(s,o):{type:"complete",oldValue:s,newValue:o},(0,n.pC)(a)&&((0,n.pC)(f)?f.diff[i]=a:f={type:"partial",diff:{[i]:a}})))}return f}function p(e,t){if((0,n.Wi)(e))return!1;const r=t.split(".");let i=e;for(const e of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}function m(e,t){for(const r of t)if(p(e,r))return!0;return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&h(e)!==h(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)}},89771:(e,t,r)=>{"use strict";r(3766),r(21979),r(17427),r(61398);var n=r(14071),i=r(7584),s=r(59472),o=r(32656),a=r(54721);async function l(e){return(0,s.pC)(u.fetchBundleAsset)?u.fetchBundleAsset(e):(await(0,a.default)(e,{responseType:"json"})).data}class d{constructor({base:e="",pattern:t,location:r=new URL(window.location.href)}){let n;n="string"==typeof r?e=>new URL(e,new URL(r,i.Z.location)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,r,i){const s=t.exec(r);if(!s)throw new o.Z("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const a=s[1]?`${s[1]}/`:"",d=s[2],u=(0,n.Su)(i),h=`${a}${d}.json`,c=u?`${a}${d}_${u}.json`:h;let p;try{p=await l(e(c))}catch(t){if(c===h)throw t;try{p=await l(e(h))}catch{throw new o.Z("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:t})}}return p}(this.getAssetUrl,this.matcher,e,t)}}const u={};var h=r(12973);(0,n.tz)(function(e){return new d(e)}({pattern:"esri/",location:h.V}))},21979:(e,t,r)=>{"use strict";r.d(t,{Ze:()=>f,p6:()=>g});var n=r(56274),i=r(3766);const s={year:"numeric",month:"numeric",day:"numeric"},o={year:"numeric",month:"long",day:"numeric"},a={year:"numeric",month:"short",day:"numeric"},l={year:"numeric",month:"long",weekday:"long",day:"numeric"},d={hour:"numeric",minute:"numeric"},u={...d,second:"numeric"},h={"short-date":s,"short-date-short-time":{...s,...d},"short-date-short-time-24":{...s,...d,hour12:!1},"short-date-long-time":{...s,...u},"short-date-long-time-24":{...s,...u,hour12:!1},"short-date-le":s,"short-date-le-short-time":{...s,...d},"short-date-le-short-time-24":{...s,...d,hour12:!1},"short-date-le-long-time":{...s,...u},"short-date-le-long-time-24":{...s,...u,hour12:!1},"long-month-day-year":o,"long-month-day-year-short-time":{...o,...d},"long-month-day-year-short-time-24":{...o,...d,hour12:!1},"long-month-day-year-long-time":{...o,...u},"long-month-day-year-long-time-24":{...o,...u,hour12:!1},"day-short-month-year":a,"day-short-month-year-short-time":{...a,...d},"day-short-month-year-short-time-24":{...a,...d,hour12:!1},"day-short-month-year-long-time":{...a,...u},"day-short-month-year-long-time-24":{...a,...u,hour12:!1},"long-date":l,"long-date-short-time":{...l,...d},"long-date-short-time-24":{...l,...d,hour12:!1},"long-date-long-time":{...l,...u},"long-date-long-time-24":{...l,...u,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":d,"long-time":u},c=(0,n.wY)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),p=(c.apiValues,c.toJSON.bind(c),c.fromJSON.bind(c),{ar:"ar-u-nu-latn-ca-gregory"});let m=new WeakMap,y=h["short-date-short-time"];function f(e){return h[e]||null}function g(e,t){return function(e){const t=e||y;if(!m.has(t)){const e=(0,i.Kd)(),r=p[(0,i.Kd)()]||e;m.set(t,new Intl.DateTimeFormat(r,t))}return m.get(t)}(t).format(e)}(0,i.Ze)((()=>{m=new WeakMap,y=h["short-date-short-time"]}))},3766:(e,t,r)=>{"use strict";r.d(t,{Ze:()=>y,Kd:()=>h,qe:()=>p});var n,i,s,o=r(7584);let a,l;const d=null!=(n=null==(i=o.Z.esriConfig)?void 0:i.locale)?n:null==(s=o.Z.dojoConfig)?void 0:s.locale;function u(){var e,t;return null!=(e=null!=d?d:null==(t=o.Z.navigator)?void 0:t.language)?e:"en"}function h(){return void 0===l&&(l=u()),l}const c=[];function p(e){return c.push(e),{remove(){c.splice(c.indexOf(e),1)}}}const m=[];function y(e){return m.push(e),{remove(){c.splice(m.indexOf(e),1)}}}function f(){var e;const t=null!=(e=a)?e:u();l!==t&&(l=t,[...m].forEach((e=>{e.call(null,t)})),[...c].forEach((e=>{e.call(null,t)})))}null==o.Z.addEventListener||o.Z.addEventListener("languagechange",f)},14071:(e,t,r)=>{"use strict";r.d(t,{ME:()=>h,Su:()=>c,tz:()=>u});var n=r(32656),i=r(39105),s=r(3766);const o=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,a=new Set(["ar","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),l=[],d=new Map;function u(e){if(!l.includes(e)){for(const t of d.keys())p(e.pattern,t)&&d.delete(t);l.unshift(e)}}async function h(e){const t=(0,s.Kd)();d.has(e)||d.set(e,async function(e,t){const r=[];for(const n of l)if(p(n.pattern,e))try{return await n.fetchMessageBundle(e,t)}catch(e){r.push(e)}if(r.length)throw new n.Z("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r});throw new n.Z("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const r=d.get(e);return await m.add(r),r}function c(e){if(!o.test(e))return null;const[,t,r]=o.exec(e),n=t+(r?"-"+r.toUpperCase():"");return a.has(n)?n:a.has(t)?t:null}function p(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,s.Ze)((()=>{d.clear()}));const m=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,i.createDeferred)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},17427:(e,t,r)=>{"use strict";r.d(t,{sh:()=>l,uf:()=>d});var n=r(59472),i=r(3766);const s={ar:"ar-u-nu-latn"};let o=new WeakMap,a={};function l(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function d(e,t){return function(e){const t=e||a;if(!o.has(t)){const r=(0,i.Kd)(),n=s[(0,i.Kd)()]||r;o.set(t,new Intl.NumberFormat(n,e))}return(0,n.j0)(o.get(t))}(t).format(e)}(0,i.Ze)((()=>{o=new WeakMap,a={}}))},61398:(e,t,r)=>{"use strict";r.d(t,{n:()=>d});var n=r(10103),i=r(88263),s=r(36544),o=r(21979),a=r(17427);const l=s.Z.getLogger("esri.intl");function d(e,t,r={}){const{format:s={}}=r;return(0,i.gx)(e,(e=>function(e,t,r){let i,s;const d=e.indexOf(":");if(-1===d?i=e.trim():(i=e.slice(0,d).trim(),s=e.slice(d+1).trim()),!i)return"";const h=(0,n.hS)(i,t);if(null==h)return"";const c=r[s]||r[i];return c?function(e,t){switch(t.type){case"date":return(0,o.p6)(e,t.intlOptions);case"number":return(0,a.uf)(e,t.intlOptions);default:return l.warn("missing format descriptor for key {key}"),u(e)}}(h,c):s?function(e,t){switch(t.toLowerCase()){case"dateformat":return(0,o.p6)(e);case"numberformat":return(0,a.uf)(e);default:return l.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?(0,o.p6)(e):/^numberformat/i.test(t)?(0,a.uf)(e):u(e)}}(h,s):u(h)}(e,t,s)))}function u(e){switch(typeof e){case"string":return e;case"number":return(0,a.uf)(e);case"boolean":return""+e;default:return e instanceof Date?(0,o.p6)(e):""}}},97042:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(59472),i=r(36544),s=r(32656),o=r(39105),a=r(6513),l=r(50897),d=r(31518),u=r(18355),h=r(90440),c=r(3951);const p=i.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),m={getAttribute:(e,t)=>e.field(t)};async function y(e,t){const n=await r.e(1063).then(r.bind(r,71063));try{const r=n.WhereClause.create(e,t);if(!r.isStandardized){const e=new s.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",r);p.error(e)}return e=>{const t=e.readArcadeFeature();return r.testFeature(t,m)}}catch(t){return p.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}const f=i.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),g=class{constructor(e){this._geometryBounds=(0,l.Ue)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],r=[],n=new Set(e);return this._idToVisibility.forEach(((e,i)=>{const s=!!(1&this._idToVisibility.get(i)),o=n.has(i);!s&&o?t.push(i):s&&!o&&r.push(i),this._idToVisibility.set(i,o?3:0)})),{show:t,hide:r}}createQuery(){const{geometry:e,spatialRel:t,where:r,timeExtent:n,objectIds:i}=this;return d.Z.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:n,objectIds:i})}async update(e,t){this._hash=JSON.stringify(e);const r=await(0,u.n)(e,null,t);await(0,o.all)([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)])}async _setAttributeFilter(e){if(!e||!e.where)return this._clause=null,void(this.where=null);this._clause=await y(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}async _setGeometryFilter(e){if(!e||!e.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",n=await(0,u.g)(r,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,a.$P)(this._geometryBounds,t),this._spatialQueryOperator=n,this.geometry=t,this.spatialRel=r}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,h.y)(this._serviceInfo.timeInfo,e.timeExtent,c.k);else{const t=new s.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);f.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!(0,n.pC)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach(((t,r)=>{1&t||(this._idToVisibility.set(r,1),e.push(r))})),e}}},70834:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var n,i=r(56140),s=(r(95830),r(36544),r(68055)),o=r(79881),a=r(56274),l=r(9870),d=r(30590),u=r(87566),h=(r(10923),r(57002),r(86035),r(58385)),c=r(6585),p=r(88210);const m=new a.Xn({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let y=n=class extends h.wq{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let r;try{r=JSON.parse(t)}catch(e){}return r?r.value:null}readValueType(e,{description:t}){let r;try{r=JSON.parse(t)}catch(e){}return r?m.fromJSON(r.fieldValueType):null}clone(){return new n({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"alias",void 0),(0,i._)([(0,o.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],y.prototype,"defaultValue",void 0),(0,i._)([(0,o.Cb)()],y.prototype,"description",void 0),(0,i._)([(0,d.r)("description")],y.prototype,"readDescription",null),(0,i._)([(0,o.Cb)({types:c.V5,json:{read:{reader:c.im},write:!0}})],y.prototype,"domain",void 0),(0,i._)([(0,o.Cb)({type:Boolean,json:{write:!0}})],y.prototype,"editable",void 0),(0,i._)([(0,o.Cb)({type:s.z8,json:{write:!0}})],y.prototype,"length",void 0),(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"name",void 0),(0,i._)([(0,o.Cb)({type:Boolean,json:{write:!0}})],y.prototype,"nullable",void 0),(0,i._)([(0,l.J)(p.v)],y.prototype,"type",void 0),(0,i._)([(0,o.Cb)()],y.prototype,"valueType",void 0),(0,i._)([(0,d.r)("valueType",["description"])],y.prototype,"readValueType",null),y=n=(0,i._)([(0,u.j)("esri.layers.support.Field")],y);const f=y},88210:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});const n=new(r(56274).Xn)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},3951:(e,t,r)=>{"use strict";r.d(t,{p:()=>h,k:()=>u});var n=r(59472),i=r(35470),s=r(69996),o=r(96233),a=r(41833);function l(e){return(4294901760&e)>>>16}function d(e){return 65535&e}const u={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class h extends a.J{constructor(e,t){super(e,t),this.featureAdapter=u,this.events=new i.Z,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._index=(0,o.r)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)})))}get storeStatistics(){return{featureCount:0,vertexCount:0}}onTileData(e,t,r){if((0,n.Wi)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=r,t.addOrUpdate._storage=r;const i=t.addOrUpdate.getCursor();for(;i.next();){const t=i.getObjectId(),n=i.instance<<16|i.getIndex();let s=this._objectIdToDisplayId.get(t);s||(s=r.createDisplayId(),this._objectIdToDisplayId.set(t,s),this._spatialIndexInvalid=!0),i.setDisplayId(s),r.setInstanceId(s,n),this.setComputedAttributes(r,i,s,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t}forEach(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),n=this._lookupFeature(r);e(n)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),n=l(r),i=d(r),s=this._getFeatureSet(n);s.setIndex(i),e(s)}))}forEachInBounds(e,t){const r=this._searchIndex(e);for(const e of r){const r=this.lookupFeatureByDisplayId(e,this._storage);t((0,n.Wg)(r))}}forEachBounds(e,t,r){this._rebuildIndex();const n=[0,0,0,0];for(const i of e){if(!i.readGeometry())continue;const e=i.getDisplayId();n[0]=this._storage.getXMin(e),n[1]=this._storage.getYMin(e),n[2]=this._storage.getXMax(e),n[3]=this._storage.getYMax(e),t((0,s.JR)(r,n))}}sweepFeatures(e,t,r){this._objectIdToDisplayId.forEach(((n,i)=>{e.has(n)||(t.releaseDisplayId(n),r.unsetAttributeData(n),this._objectIdToDisplayId.delete(i))})),this.events.emit("changed")}sweepFeatureSets(e){this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){const r=this.lookupFeatureByDisplayId(e,t);return(0,n.Wi)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),r=l(t),n=d(t),i=this._getFeatureSet(r);return i?(i.setIndex(n),i):null}hasInstance(e){return this._featureSetsByInstance.has(e)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.load(e),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=l(e),r=d(e),n=this._getFeatureSet(t);if(!n)return null;const i=n.getCursor();return i.setIndex(r),i}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}},41833:(e,t,r)=>{"use strict";r.d(t,{J:()=>h});var n=r(95830),i=r(59472),s=r(39105),o=r(30927),a=r(23229),l=r(36544);const d=function(e,t,r){e.referencesGeometry();const n=t.readArcadeFeature();try{return e.evaluate({...r,$feature:n})}catch(e){return l.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}},u=r.e(2357).then(r.bind(r,82357));class h{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}async updateSchema(e,t){const r=(0,a.Hg)(this._schema,t);if(this._schema=t,!t||(0,i.Wi)(r)||!(0,a.uD)(r,"attributes"))return;(0,n.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const o=t.attributes,l=[],d=[];for(const e in o){const t=o[e];switch(t.type){case"field":break;case"expression":l.push(this._createArcadeComputedField(t));break;case"label-expression":l.push(this._createLabelArcadeComputedField(t));break;case"statistic":d.push(t)}}this._computedFields=await(0,s.all)(l),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=d}setComputedAttributes(e,t,r,n){const i=this._bitsets.computed;if(!this._canCacheExpressionValue||!i.has(r)){i.set(r);for(const i of this._computedFields){const s=this._evaluateField(t,i,n);switch(i.resultType){case"numeric":e.setComputedNumericAtIndex(r,i.fieldIndex,s);break;case"string":e.setComputedStringAtIndex(r,i.fieldIndex,s)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await(0,o.Yi)(e.valueExpression,t,r)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fields,{createLabelFunction:n}=await u,i=await n(e.label,r,t);return{...e,builder:i}}_evaluateField(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:n}=t;return d(n,e,{$view:{scale:r}})}}}}}}]);
//# sourceMappingURL=9655.js.map