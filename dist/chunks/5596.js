(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[5596],{45596:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var i=s(56140),o=(s(95830),s(59472)),h=(s(36544),s(68055),s(79881)),r=s(87566),a=(s(10923),s(57002),s(86035),s(61106)),n=s(92232),c=(s(36348),s(35470)),l=s(88083),p=s(15988),d=s(59691),v=s(80621),m=s(69948),y=s(70778),_=s(24591),u=s(32756),g=s(44883);class b{constructor(e,t,s){this.graphic=e,this.mover=t,this.selected=s,this.type="reshape-start"}}class f{constructor(e,t,s){this.graphic=e,this.mover=t,this.selected=s,this.type="reshape"}}class x{constructor(e,t,s){this.graphic=e,this.mover=t,this.selected=s,this.type="reshape-stop"}}class G{constructor(e,t,s){this.mover=e,this.dx=t,this.dy=s,this.type="move-start"}}class w{constructor(e,t,s){this.mover=e,this.dx=t,this.dy=s,this.type="move"}}class S{constructor(e,t,s){this.mover=e,this.dx=t,this.dy=s,this.type="move-stop"}}class k{constructor(e){this.added=e,this.type="vertex-select"}}class H{constructor(e){this.removed=e,this.type="vertex-deselect"}}class M{constructor(e,t,s,i){this.added=e,this.graphic=t,this.oldGraphic=s,this.vertices=i,this.type="vertex-add"}}class C{constructor(e,t,s,i){this.removed=e,this.graphic=t,this.oldGraphic=s,this.vertices=i,this.type="vertex-remove"}}const E={removeVertex:["Backspace","Delete"]},I=g.X.reshapeGraphics,R={vertices:{default:new l.Z({style:"circle",size:I.vertex.size,color:I.vertex.color,outline:{color:I.vertex.outlineColor,width:1}}),hover:new l.Z({style:"circle",size:I.vertex.hoverSize,color:I.vertex.hoverColor,outline:{color:I.vertex.hoverOutlineColor,width:1}}),selected:new l.Z({style:"circle",size:I.selected.size,color:I.selected.color,outline:{color:I.selected.outlineColor,width:1}})},midpoints:{default:new l.Z({style:"circle",size:I.midpoint.size,color:I.midpoint.color,outline:{color:I.midpoint.outlineColor,width:1}}),hover:new l.Z({style:"circle",size:I.midpoint.size,color:I.midpoint.color,outline:{color:I.midpoint.outlineColor,width:1}})}};let V=class extends c.Z.EventedAccessor{constructor(e){super(e),this._handles=new d.Z,this._graphicAttributes={esriSketchTool:"box"},this._mover=null,this._viewHandles=new d.Z,this._totalDx=0,this._totalDy=0,this.callbacks={onReshapeStart(){},onReshape(){},onReshapeStop(){},onMoveStart(){},onMove(){},onMoveStop(){},onGraphicClick(){}},this.enableMidpoints=!0,this.graphic=null,this.handleGraphics=[],this.layer=null,this.midpointGraphics=[],this.midpointSymbol=new l.Z({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),this.selectedHandles=[],this.type="reshape",this.view=null}initialize(){this._setup(),this._handles.add([(0,v.whenOnce)(this,"view.ready",(()=>{const{layer:e,view:t}=this;(0,_.p)(t,e),this._viewHandles.add([t.on("key-down",(e=>this._keyDownHandler(e)),m.f.TOOL)])})),(0,v.pausable)(this,"graphic",(()=>this.refresh())),(0,v.pausable)(this,"layer",((e,t)=>{t&&(this._clearSelection(),this._resetGraphics(t)),this.refresh()})),(0,v.pausable)(this,"enableMidpoints",(()=>{this.refresh()}))])}destroy(){this._reset(),this._mover&&this._mover.destroy(),this._mover=null,this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null}get state(){const e=!!this.get("view.ready"),t=!(!this.get("graphic")||!this.get("layer"));return e&&t?"active":e?"ready":"disabled"}set symbols(e){const{midpoints:t=R.midpoints,vertices:s=R.vertices}=e||{};this._set("symbols",{midpoints:t,vertices:s})}isUIGraphic(e){const t=[];return this.graphic&&t.push(this.graphic),t.concat(this.handleGraphics,this.midpointGraphics),t.length&&t.includes(e)}refresh(){this._reset(),this._setup()}reset(){this.graphic=null}clearSelection(){this._clearSelection()}removeSelectedHandles(){this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}_setup(){this.graphic&&this.layer&&(this._setupGraphics(),this._setupMover())}_reset(){this._clearSelection(),this._resetGraphicStateVars(),this._resetGraphics(),this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}_resetGraphicStateVars(){this._totalDx=0,this._totalDy=0}_resetGraphics(e){const t=e||this.layer;t&&(t.removeMany(this.handleGraphics),t.removeMany(this.midpointGraphics)),this.handleGraphics.forEach((e=>e.destroy())),this.midpointGraphics.forEach((e=>e.destroy())),this._set("handleGraphics",[]),this._set("midpointGraphics",[]),this._set("selectedHandles",[])}_setupGraphics(){const e=(0,o.Wg)(this.graphic.geometry),t=(0,n.nA)(e.clone());if("polygon"===e.type)for(const e of t){const t=e[e.length-1];e[0][0]===t[0]&&e[0][1]===t[1]&&e.length>2&&e.pop()}this._set("handleGraphics",this._createHandleGraphics(t)),this.enableMidpoints&&this._set("midpointGraphics",this._createMidpointGraphics(t)),this._saveRelatedIndices(this.handleGraphics),this.layer.addMany(this.midpointGraphics),this.layer.addMany(this.handleGraphics)}_createHandleGraphics(e){const{_graphicAttributes:t,symbols:s,view:{spatialReference:i}}=this,o=[];return null==e||e.forEach(((e,h)=>{e.forEach(((e,r)=>{var n;const[c,l]=e;o.push(new p.Z({geometry:new a.Z({x:c,y:l,spatialReference:i}),symbol:null==s||null==(n=s.vertices)?void 0:n.default,attributes:{...t,pathIndex:h,pointIndex:r}}))}))})),o}_createMidpointGraphics(e){const{_graphicAttributes:t,symbols:s,view:{spatialReference:i}}=this,h=[];return null==e||e.forEach(((e,r)=>{e.forEach(((c,l)=>{const[d,v]=c,m=e[l+1]?l+1:0;if("polygon"===(0,o.U2)(this.graphic.geometry,"type")||0!==m){const[o,c]=e[m],[y,_]=(0,n.Gi)([d,v],[o,c]);h.push(new p.Z({geometry:new a.Z({x:y,y:_,spatialReference:i}),symbol:s.midpoints.default,attributes:{...t,pathIndex:r,pointIndexStart:l,pointIndexEnd:m}}))}}))})),h}_saveRelatedIndices(e){if(!e)return;const t=e.map((({geometry:e})=>({x:e.x,y:e.y})));for(let s=0;s<t.length;s++){const i=[];for(let e=0;e<t.length;e++){if(s===e)continue;const o=t[s],h=t[e];o.x===h.x&&o.y===h.y&&i.push(e)}e[s].attributes.relatedGraphicIndices=i}}_setupMover(){this._mover=new u.default({enableMoveAllGraphics:!1,graphics:[].concat(this.handleGraphics,this.midpointGraphics,this.graphic),view:this.view,callbacks:{onGraphicClick:e=>this._onGraphicClickCallback(e),onGraphicMoveStart:e=>this._onGraphicMoveStartCallback(e),onGraphicMove:e=>this._onGraphicMoveCallback(e),onGraphicMoveStop:e=>this._onGraphicMoveStopCallback(e),onGraphicPointerOver:e=>this._onGraphicPointerOverCallback(e),onGraphicPointerOut:e=>this._onGraphicPointerOutCallback(e)}})}_onGraphicClickCallback(e){e.viewEvent.stopPropagation();const t=e.graphic;if(t===this.graphic)this.clearSelection(),this.emit("graphic-click",e),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(e);else if(this._isMidpoint(t)){if(2===e.viewEvent.button)return;const s=this.graphic.clone(),i=this._createHandleFromMidpoint(t);this.refresh(),this._emitVertexAddEvent([t],s,i)}else this._isHandle(t)&&(e.viewEvent.stopPropagation(),2===e.viewEvent.button?this._removeVertex(t):(e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedHandles.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)))}_onGraphicMoveStartCallback(e){const t=e.graphic;if(this._resetGraphicStateVars(),t===this.graphic){const{dx:t,dy:s}=e;return this.handleGraphics.forEach((e=>e.visible=!1)),this.midpointGraphics.forEach((e=>e.visible=!1)),this._clearSelection(),void this._emitMoveStartEvent(t,s)}if(this._isMidpoint(t)){this._clearSelection();const e=this.graphic.clone(),s=this._createHandleFromMidpoint(t);this._emitVertexAddEvent([t],e,s),this._addToSelection(t)}else this.selectedHandles.includes(t)||(this._clearSelection(),this._addToSelection(t));this._emitReshapeStartEvent(t)}_onGraphicMoveCallback(e){const{graphic:t,dx:s,dy:i}=e;this._totalDx+=s,this._totalDy+=i,t===this.graphic?this._emitMoveEvent(s,i):(this._syncGeometryAfterHandleMove(t,s,i),this._emitReshapeEvent(t))}_onGraphicMoveStopCallback(e){const{graphic:t,dx:s,dy:i}=e;if(this._totalDx+=s,this._totalDy+=i,t===this.graphic){for(const e of[].concat(this.handleGraphics,this.midpointGraphics))e.visible=!0;this._syncGraphicsWithGeometry(),this._emitMoveStopEvent()}else this._syncGeometryAfterHandleMove(t,s,i),this._isMidpoint(t)&&this.refresh(),this._emitReshapeStopEvent(t);this._resetGraphicStateVars()}_syncGraphicsWithGeometry(){const e=this.graphic.geometry,t="polyline"===e.type?e.paths:e.rings;this._updateHandleGraphicLocations(t),this._updateMidpointGraphicLocations(t)}_updateHandleGraphicLocations(e){for(const t of this.handleGraphics){const{pathIndex:s,pointIndex:i}=t.attributes,[o,h]=e[s][i];t.set("geometry",new a.Z(o,h,this.view.spatialReference))}}_updateMidpointGraphicLocations(e){for(const t of this.midpointGraphics){const{pathIndex:s,pointIndexStart:i,pointIndexEnd:o}=t.attributes,[h,r]=e[s][i],[c,l]=e[s][o],[p,d]=(0,n.Gi)([h,r],[c,l]);t.geometry=new a.Z({x:p,y:d,spatialReference:this.view.spatialReference})}}_syncGeometryAfterHandleMove(e,t,s){const i=(0,o.Wg)(this.graphic.geometry).clone(),h="polyline"===i.type?i.paths:i.rings,{pathIndex:r,pointIndex:a}=e.attributes,{x:n,y:c}=e.geometry,l=h[r].length-1;if(h[r][a]=[n,c],"polygon"===i.type&&(0===a?h[r][l]=[n,c]:a===l&&(h[r][0]=[n,c])),this._isHandle(e)){const{relatedGraphicIndices:o}=e.attributes;for(const t of o){const s=this.handleGraphics[t],{pathIndex:i,pointIndex:o}=s.attributes;h[i][o]=[n,c],s.geometry=e.geometry}for(const o of this.selectedHandles)if(o!==e){const{pathIndex:e,pointIndex:r,relatedGraphicIndices:a}=o.attributes,n=(0,y.e7)(o.geometry,t,s,this.view),c=h[e].length-1;h[e][r]=[n.x,n.y],o.geometry=n,"polygon"===i.type&&(0===r?h[e][c]=[n.x,n.y]:r===c&&(h[e][0]=[n.x,n.y]));for(const e of a){const t=this.handleGraphics[e],{pathIndex:s,pointIndex:i}=t.attributes;h[s][i]=[n.x,n.y],t.geometry=n}}this._updateMidpointGraphicLocations(h)}this.graphic.geometry=i}_onGraphicPointerOverCallback(e){const t=e.graphic;this._isHandle(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.hover),this._updateHoverCursor(t)}_onGraphicPointerOutCallback(e){const t=e.graphic;this._isHandle(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this.view.cursor="default"}_createHandleFromMidpoint(e){const{_graphicAttributes:t}=this,s=[],i=(0,o.Wg)(this.graphic.geometry).clone(),{pathIndex:h,pointIndexStart:r,pointIndexEnd:a}=e.attributes,{x:n,y:c}=e.geometry,l=0===a?r+1:a,p="polyline"===i.type?i.paths:i.rings;return p[h].splice(l,0,[n,c]),e.attributes={...t,pathIndex:h,pointIndex:l,relatedGraphicIndices:[]},s.push({coordinates:p[h][l],componentIndex:h,vertexIndex:l}),this.graphic.geometry=i,s}_removeHandles(e){const t=(0,o.Wg)(this.graphic.geometry).clone(),s="polygon"===t.type?t.rings:t.paths,i=[];e instanceof p.Z&&(e=[e]);for(const t of e){const{x:e,y:o}=t.geometry;for(let t=0;t<s.length;t++){const h=s[t];for(let r=0;r<h.length;r++){const[a,n]=h[r];e===a&&o===n&&(i.push({coordinates:s[t][r],componentIndex:t,vertexIndex:r}),s[t].splice(Number(r),1))}}}if("polygon"===t.type)for(const e of s){const[t,i]=e[0],[o,h]=e[e.length-1];(1===e.length||e.length<3&&t===o&&i===h)&&s.splice(s.indexOf(e),1),e.length>2&&(t!==o||i!==h)&&e.push(e[0])}else for(const e of s)1===e.length&&s.splice(s.indexOf(e),1);return this.graphic.geometry=t,i}_addToSelection(e){e instanceof p.Z&&(e=[e]);for(const t of e)t.symbol=this.symbols.vertices.selected;this._set("selectedHandles",this.selectedHandles.concat(e)),this._emitSelectEvent(e)}_removeFromSelection(e,t){const{vertices:s}=this.symbols,i=t?s.hover:s.default;e instanceof p.Z&&(e=[e]);for(const t of e)this.selectedHandles.splice(this.selectedHandles.indexOf(t),1),this._set("selectedHandles",this.selectedHandles),t.set("symbol",i);this._emitDeselectEvent(e)}_clearSelection(){if(this.selectedHandles.length){const e=this.selectedHandles;for(const e of this.selectedHandles)e.set("symbol",this.symbols.vertices.default);this._set("selectedHandles",[]),this._emitDeselectEvent(e)}}_keyDownHandler(e){E.removeVertex.includes(e.key)&&!e.repeat&&this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}_removeVertex(e){if("polygon"===this.graphic.geometry.type&&this.handleGraphics.length<4||this.handleGraphics.length<3)return;const t=this.graphic.clone();e instanceof p.Z&&(e=[e]);const s=this._removeHandles(e);this.refresh(),this._emitVertexRemoveEvent(e,t,s)}_isHandle(e){return this.handleGraphics.includes(e)}_isSelected(e){return this._isHandle(e)&&this.selectedHandles.includes(e)}_isMidpoint(e){return this.midpointGraphics.includes(e)}_updateHoverCursor(e){this.view.cursor=this._isMidpoint(e)?"copy":"move"}_emitMoveStartEvent(e,t){const s=new G(this.graphic,e,t);this.emit("move-start",s),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(s)}_emitMoveEvent(e,t){const s=new w(this.graphic,e,t);this.emit("move",s),this.callbacks.onMove&&this.callbacks.onMove(s)}_emitMoveStopEvent(){const e=new S(this.graphic,this._totalDx,this._totalDy);this.emit("move-stop",e),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(e)}_emitReshapeStartEvent(e){const t=new b(this.graphic,e,this.selectedHandles);this.emit("reshape-start",t),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(t)}_emitReshapeEvent(e){const t=new f(this.graphic,e,this.selectedHandles);this.emit("reshape",t),this.callbacks.onReshape&&this.callbacks.onReshape(t)}_emitReshapeStopEvent(e){const t=new x(this.graphic,e,this.selectedHandles);this.emit("reshape-stop",t),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(t)}_emitSelectEvent(e){const t=new k(e);this.emit("select",t),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(t)}_emitDeselectEvent(e){const t=new H(e);this.emit("deselect",t),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(t)}_emitVertexAddEvent(e,t,s){const i=new M(e,this.graphic,t,s);this.emit("vertex-add",i),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(i)}_emitVertexRemoveEvent(e,t,s){const i=new C(e,this.graphic,t,s);this.emit("vertex-remove",i),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(i)}};(0,i._)([(0,h.Cb)()],V.prototype,"callbacks",void 0),(0,i._)([(0,h.Cb)()],V.prototype,"enableMidpoints",void 0),(0,i._)([(0,h.Cb)()],V.prototype,"graphic",void 0),(0,i._)([(0,h.Cb)({readOnly:!0})],V.prototype,"handleGraphics",void 0),(0,i._)([(0,h.Cb)()],V.prototype,"layer",void 0),(0,i._)([(0,h.Cb)({readOnly:!0})],V.prototype,"midpointGraphics",void 0),(0,i._)([(0,h.Cb)()],V.prototype,"midpointSymbol",void 0),(0,i._)([(0,h.Cb)({readOnly:!0})],V.prototype,"selectedHandles",void 0),(0,i._)([(0,h.Cb)({dependsOn:["view.ready","graphic","layer"],readOnly:!0})],V.prototype,"state",null),(0,i._)([(0,h.Cb)({value:R})],V.prototype,"symbols",null),(0,i._)([(0,h.Cb)({readOnly:!0})],V.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],V.prototype,"view",void 0),V=(0,i._)([(0,r.j)("esri.views.draw.support.Reshape")],V);const O=V}}]);
//# sourceMappingURL=5596.js.map